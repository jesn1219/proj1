cscope 15 /home/jesn/Desktop/mysql-server/storage/innobase/buf               0000493517
	@buf.cc

40 
	~"∑ge0size.h
"

41 
	~"univ.i
"

47 
boﬁ
 
	$buf_∑ge_is_zî€s
(c⁄° 
byã
 *
ªad_buf
, c⁄° 
∑ge_size_t
 &
∑ge_size
) {

48 
ulöt
 
i
 = 0; i < 
∑ge_size
.
	`logiˇl
(); i++) {

49 i‡(
ªad_buf
[
i
] != 0) {

50  (
Ál£
);

53  (
åue
);

54 
	}
}

	@buf.h

33 #i‚de‡
buf_h


34 
	#buf_h


	)

36 
	~"univ.i
"

38 
	~"∑ge0size.h
"

44 
boﬁ
 
buf_∑ge_is_zî€s
(c⁄° 
byã
 *
ªad_buf
, c⁄° 
∑ge_size_t
 &
∑ge_size
);

	@buf0buddy.cc

33 
	~"buf0buddy.h
"

35 
	~"buf0buf.h
"

36 
	~"buf0Êu.h
"

37 
	~"buf0Ãu.h
"

38 
	~"di˘0di˘.h
"

40 
	~"∑ge0zù.h
"

74 
	#BUF_BUDDY_STAMP_OFFSET
 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID


	)

78 
	#BUF_BUDDY_STAMP_FREE
 
di˘_sys_t
::
s_log_•a˚_fú°_id


	)

82 
	#BUF_BUDDY_STAMP_NONFREE
 0XFFFFFFFFUL

	)

85 
	ebuf_buddy_°©e_t
 {

86 
	mBUF_BUDDY_STATE_FREE
,

87 
	mBUF_BUDDY_STATE_USED
,

88 
	mBUF_BUDDY_STATE_PARTIALLY_USED


92 #ifde‡
UNIV_DEBUG_VALGRIND


94 
UNIV_INLINE


95 
	$buf_buddy_mem_övÆid
(
buf_buddy_‰ì_t
 *
buf
,

96 
ulöt
 
i
)

98 c⁄° 
size_t
 
size
 = 
BUF_BUDDY_LOW
 << 
i
;

99 
	`ut_ad
(
i
 <
BUF_BUDDY_SIZES
);

101 
	`UNIV_MEM_ASSERT_W
(
buf
, 
size
);

102 
	`UNIV_MEM_INVALID
(
buf
, 
size
);

103 
	}
}

105 
	#buf_buddy_mem_övÆid
(
buf
, 
i
Ë
	`ut_ad
((iË<
BUF_BUDDY_SIZES
)

	)

110 
UNIV_INLINE
 
MY_ATTRIBUTE
((
w¨n_unu£d_ªsu…
)Ë
boﬁ
 
	$buf_buddy_°amp_is_‰ì
(

111 c⁄° 
buf_buddy_‰ì_t
 *
buf
)

113  (
	`mach_ªad_‰om_4
(
buf
->
°amp
.
byãs
 + 
BUF_BUDDY_STAMP_OFFSET
) ==

114 
BUF_BUDDY_STAMP_FREE
);

115 
	}
}

118 
UNIV_INLINE


119 
	$buf_buddy_°amp_‰ì
(
buf_buddy_‰ì_t
 *
buf
,

120 
ulöt
 
i
)

122 
	`ut_d
(
	`mem£t
(&
buf
->
°amp
, 
°©ic_ˇ°
<>(
i
), 
BUF_BUDDY_LOW
 << i));

123 
	`buf_buddy_mem_övÆid
(
buf
, 
i
);

124 
	`mach_wrôe_to_4
(
buf
->
°amp
.
byãs
 + 
BUF_BUDDY_STAMP_OFFSET
,

125 
BUF_BUDDY_STAMP_FREE
);

126 
buf
->
°amp
.
size
 = 
i
;

127 
	}
}

132 
	#buf_buddy_°amp_n⁄‰ì
(
buf
, 
i
) \

134 
	`buf_buddy_mem_övÆid
(
buf
, 
i
); \

135 
	`mem£t
(
buf
->
°amp
.
byãs
 + 
BUF_BUDDY_STAMP_OFFSET
, 0xff, 4); \

136 } 0)

	)

137 #i‡
BUF_BUDDY_STAMP_NONFREE
 != 0xffffffff

143 
UNIV_INLINE


144 *
	$buf_buddy_gë
(
byã
 *
∑ge
,

145 
ulöt
 
size
)

147 
	`ut_ad
(
	`ut_is_2pow
(
size
));

148 
	`ut_ad
(
size
 >
BUF_BUDDY_LOW
);

149 
	`ut_ad
(
BUF_BUDDY_LOW
 <
UNIV_ZIP_SIZE_MIN
);

150 
	`ut_ad
(
size
 < 
BUF_BUDDY_HIGH
);

151 
	`ut_ad
(
BUF_BUDDY_HIGH
 =
UNIV_PAGE_SIZE
);

152 
	`ut_ad
(!
	`ut_Æign_off£t
(
∑ge
, 
size
));

154 i‡(((
ulöt
)
∑ge
Ë& 
size
) {

155  (
∑ge
 - 
size
);

157  (
∑ge
 + 
size
);

159 
	}
}

161 #ifde‡
UNIV_DEBUG


163 
	sCheckZùFªe
 {

164 
CheckZùFªe
(
ulöt
 
i
Ë: 
m_i
(i) {}

166 
›î©‹
()(c⁄° 
buf_buddy_‰ì_t
 *
ñem
) const {

167 
ut_a
(
buf_buddy_°amp_is_‰ì
(
ñem
));

168 
ut_a
(
ñem
->
°amp
.
size
 <
m_i
);

171 
ulöt
 
	mm_i
;

177 
	$buf_buddy_li°_vÆid©e
(c⁄° 
buf_poﬁ_t
 *
buf_poﬁ
, 
ulöt
 
i
) {

178 
CheckZùFªe
 
	`check
(
i
);

179 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
zù_‰ì_muãx
));

180 
	`ut_li°_vÆid©e
(
buf_poﬁ
->
zù_‰ì
[
i
], 
check
);

181 
	}
}

189 
UNIV_INLINE


190 
boﬁ
 
	$buf_buddy_check_‰ì
(
buf_poﬁ_t
 *
buf_poﬁ
, c⁄° 
buf_buddy_‰ì_t
 *
buf
,

191 
ulöt
 
i
) {

192 c⁄° 
ulöt
 
size
 = 
BUF_BUDDY_LOW
 << 
i
;

194 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
zù_‰ì_muãx
));

195 
	`ut_ad
(!
	`ut_Æign_off£t
(
buf
, 
size
));

196 
	`ut_ad
(
i
 >
	`buf_buddy_gë_¶Ÿ
(
UNIV_ZIP_SIZE_MIN
));

198 
buf_buddy_‰ì_t
 *
ôr
;

200 
ôr
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
zù_‰ì
[
i
]); iå && iå !
buf
;

201 
ôr
 = 
	`UT_LIST_GET_NEXT
(
li°
, itr)) {

204  (
ôr
 =
buf
);

205 
	}
}

212 
MY_ATTRIBUTE
((
w¨n_unu£d_ªsu…
)Ë
buf_buddy_°©e_t


213 
	$buf_buddy_is_‰ì
(
buf_buddy_‰ì_t
 *
buf
,

214 
ulöt
 
i
)

217 #ifde‡
UNIV_DEBUG


218 c⁄° 
ulöt
 
size
 = 
BUF_BUDDY_LOW
 << 
i
;

219 
	`ut_ad
(!
	`ut_Æign_off£t
(
buf
, 
size
));

220 
	`ut_ad
(
i
 >
	`buf_buddy_gë_¶Ÿ
(
UNIV_ZIP_SIZE_MIN
));

237 i‡(!
	`buf_buddy_°amp_is_‰ì
(
buf
)) {

238  (
BUF_BUDDY_STATE_USED
);

245 
	`ut_ad
(
buf
->
°amp
.
size
 <
i
);

246  (
buf
->
°amp
.
size
 =
i
 ? 
BUF_BUDDY_STATE_FREE


247 : 
BUF_BUDDY_STATE_PARTIALLY_USED
);

248 
	}
}

254 
UNIV_INLINE


255 
	$buf_buddy_add_to_‰ì
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_buddy_‰ì_t
 *
buf
,

256 
ulöt
 
i
) {

257 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
zù_‰ì_muãx
));

258 
	`ut_ad
(
buf_poﬁ
->
zù_‰ì
[
i
].
°¨t
 !
buf
);

260 
	`buf_buddy_°amp_‰ì
(
buf
, 
i
);

261 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
zù_‰ì
[
i
], 
buf
);

262 
	`ut_d
(
	`buf_buddy_li°_vÆid©e
(
buf_poﬁ
, 
i
));

263 
	}
}

269 
UNIV_INLINE


270 
	$buf_buddy_ªmove_‰om_‰ì
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_buddy_‰ì_t
 *
buf
,

271 
ulöt
 
i
) {

272 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
zù_‰ì_muãx
));

273 
	`ut_ad
(
	`buf_buddy_check_‰ì
(
buf_poﬁ
, 
buf
, 
i
));

275 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
zù_‰ì
[
i
], 
buf
);

276 
	`buf_buddy_°amp_n⁄‰ì
(
buf
, 
i
);

277 
	}
}

283 
buf_buddy_‰ì_t
 *
	$buf_buddy_Æloc_zù
(
buf_poﬁ_t
 *
buf_poﬁ
, 
ulöt
 
i
) {

284 
buf_buddy_‰ì_t
 *
buf
;

286 
	`ut_a
(
i
 < 
BUF_BUDDY_SIZES
);

287 
	`ut_a
(
i
 >
	`buf_buddy_gë_¶Ÿ
(
UNIV_ZIP_SIZE_MIN
));

289 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

290 
	`ut_d
(
	`buf_buddy_li°_vÆid©e
(
buf_poﬁ
, 
i
));

292 
buf
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
zù_‰ì
[
i
]);

294 i‡(
	`buf_gë_wôhdøw_dïth
(
buf_poﬁ
)) {

295 
buf
 !
NULL
 &&

296 
	`buf_‰ame_wûl_wôhdøwn
(
buf_poﬁ
, 
ªöãΩªt_ˇ°
<
byã
 *>(
buf
))) {

298 
buf
 = 
	`UT_LIST_GET_NEXT
(
li°
, buf);

302 i‡(
buf
) {

303 
	`buf_buddy_ªmove_‰om_‰ì
(
buf_poﬁ
, 
buf
, 
i
);

304 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

306 } i‡(
i
 + 1 < 
BUF_BUDDY_SIZES
) {

307 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

309 
buf
 = 
	`buf_buddy_Æloc_zù
(
buf_poﬁ
, 
i
 + 1);

311 i‡(
buf
) {

312 
byã
 *
Æloˇãd_block
 = 
buf
->
°amp
.
byãs
;

313 
buf_buddy_‰ì_t
 *
buddy
 = 
ªöãΩªt_ˇ°
<buf_buddy_free_t *>(

314 
Æloˇãd_block
 + (
BUF_BUDDY_LOW
 << 
i
));

316 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

317 
	`ut_ad
(!
	`buf_poﬁ_c⁄èös_zù
(
buf_poﬁ
, 
buddy
));

318 
	`buf_buddy_add_to_‰ì
(
buf_poﬁ
, 
buddy
, 
i
);

319 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

322 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

325 i‡(
buf
) {

327 
	`UNIV_MEM_TRASH
(
buf
, ~
i
, 
BUF_BUDDY_STAMP_OFFSET
);

328 
	`UNIV_MEM_TRASH
(
BUF_BUDDY_STAMP_OFFSET
 + 4 + 
buf
->
°amp
.
byãs
, ~
i
,

329 (
BUF_BUDDY_LOW
 << 
i
Ë- (
BUF_BUDDY_STAMP_OFFSET
 + 4));

330 
	`ut_ad
(
	`mach_ªad_‰om_4
(
buf
->
°amp
.
byãs
 + 
BUF_BUDDY_STAMP_OFFSET
) ==

331 
BUF_BUDDY_STAMP_NONFREE
);

334  (
buf
);

335 
	}
}

340 
	$buf_buddy_block_‰ì
(
buf_poﬁ_t
 *
buf_poﬁ
, *
buf
) {

341 c⁄° 
ulöt
 
fﬁd
 = 
	`BUF_POOL_ZIP_FOLD_PTR
(
buf
);

342 
buf_∑ge_t
 *
b∑ge
;

344 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
zù_muãx
));

345 
	`ut_a
(!
	`ut_Æign_off£t
(
buf
, 
UNIV_PAGE_SIZE
));

347 
	`muãx_íãr
(&
buf_poﬁ
->
zù_hash_muãx
);

349 
	`HASH_SEARCH
(
hash
, 
buf_poﬁ
->
zù_hash
, 
fﬁd
, 
buf_∑ge_t
 *, 
b∑ge
,

350 
	`ut_ad
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_MEMORY
 &&

351 
b∑ge
->
ö_zù_hash
 && !b∑ge->
ö_∑ge_hash
),

352 ((
buf_block_t
 *)
b∑ge
)->
‰ame
 =
buf
);

353 
	`ut_a
(
b∑ge
);

354 
	`ut_a
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_MEMORY
);

355 
	`ut_ad
(!
b∑ge
->
ö_∑ge_hash
);

356 
	`ut_ad
(
b∑ge
->
ö_zù_hash
);

357 
	`ut_d
(
b∑ge
->
ö_zù_hash
 = 
FALSE
);

358 
	`HASH_DELETE
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
zù_hash
, 
fﬁd
, 
b∑ge
);

360 
	`ut_ad
(
buf_poﬁ
->
buddy_n_‰ames
 > 0);

361 
	`ut_d
(
buf_poﬁ
->
buddy_n_‰ames
--);

363 
	`muãx_exô
(&
buf_poﬁ
->
zù_hash_muãx
);

365 
	`ut_d
(
	`mem£t
(
buf
, 0, 
UNIV_PAGE_SIZE
));

366 
	`UNIV_MEM_INVALID
(
buf
, 
UNIV_PAGE_SIZE
);

368 
	`buf_LRU_block_‰ì_n⁄_fûe_∑ge
(
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
b∑ge
));

369 
	}
}

373 
	$buf_buddy_block_ªgi°î
(
buf_block_t
 *
block
) {

374 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_block
(
block
);

375 c⁄° 
ulöt
 
fﬁd
 = 
	`BUF_POOL_ZIP_FOLD
(
block
);

376 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
zù_muãx
));

377 
	`ut_ad
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_READY_FOR_USE
);

379 
	`buf_block_£t_°©e
(
block
, 
BUF_BLOCK_MEMORY
);

381 
	`ut_a
(
block
->
‰ame
);

382 
	`ut_a
(!
	`ut_Æign_off£t
(
block
->
‰ame
, 
UNIV_PAGE_SIZE
));

384 
	`ut_ad
(!
block
->
∑ge
.
ö_∑ge_hash
);

385 
	`ut_ad
(!
block
->
∑ge
.
ö_zù_hash
);

386 
	`ut_d
(
block
->
∑ge
.
ö_zù_hash
 = 
TRUE
);

388 
	`muãx_íãr
(&
buf_poﬁ
->
zù_hash_muãx
);

389 
	`HASH_INSERT
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
zù_hash
, 
fﬁd
, &
block
->
∑ge
);

391 
	`ut_d
(
buf_poﬁ
->
buddy_n_‰ames
++);

392 
	`muãx_exô
(&
buf_poﬁ
->
zù_hash_muãx
);

393 
	}
}

401 *
	$buf_buddy_Æloc_‰om
(
buf_poﬁ_t
 *
buf_poﬁ
, *
buf
, 
ulöt
 
i
,

402 
ulöt
 
j
) {

403 
ulöt
 
offs
 = 
BUF_BUDDY_LOW
 << 
j
;

404 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
zù_‰ì_muãx
));

405 
	`ut_ad
(
j
 <
BUF_BUDDY_SIZES
);

406 
	`ut_ad
(
i
 >
	`buf_buddy_gë_¶Ÿ
(
UNIV_ZIP_SIZE_MIN
));

407 
	`ut_ad
(
j
 >
i
);

408 
	`ut_ad
(!
	`ut_Æign_off£t
(
buf
, 
offs
));

411 
j
 > 
i
) {

412 
buf_buddy_‰ì_t
 *
zù_buf
;

414 
offs
 >>= 1;

415 
j
--;

417 
zù_buf
 = 
ªöãΩªt_ˇ°
<
buf_buddy_‰ì_t
 *>(

418 
ªöãΩªt_ˇ°
<
byã
 *>(
buf
Ë+ 
offs
);

419 
	`buf_buddy_add_to_‰ì
(
buf_poﬁ
, 
zù_buf
, 
j
);

422 
	`buf_buddy_°amp_n⁄‰ì
(
ªöãΩªt_ˇ°
<
buf_buddy_‰ì_t
 *>(
buf
), 
i
);

423  (
buf
);

424 
	}
}

431 *
	$buf_buddy_Æloc_low
(
buf_poﬁ_t
 *
buf_poﬁ
, 
ulöt
 
i
) {

432 
buf_block_t
 *
block
;

434 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
zù_muãx
));

435 
	`ut_ad
(
i
 >
	`buf_buddy_gë_¶Ÿ
(
UNIV_ZIP_SIZE_MIN
));

437 i‡(
i
 < 
BUF_BUDDY_SIZES
) {

439 
block
 = (
buf_block_t
 *)
	`buf_buddy_Æloc_zù
(
buf_poﬁ
, 
i
);

441 i‡(
block
) {

442 
func_exô
;

447 
block
 = 
	`buf_LRU_gë_‰ì_⁄ly
(
buf_poﬁ
);

449 i‡(
block
) {

450 
Æloc_big
;

454 
block
 = 
	`buf_LRU_gë_‰ì_block
(
buf_poﬁ
);

456 
Æloc_big
:

457 
	`buf_buddy_block_ªgi°î
(
block
);

459 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

460 
block
 = (
buf_block_t
 *)
	`buf_buddy_Æloc_‰om
(
buf_poﬁ
, block->
‰ame
, 
i
,

461 
BUF_BUDDY_SIZES
);

462 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

464 
func_exô
:

465 
	`os_©omic_ö¸emít_ulöt
(&
buf_poﬁ
->
buddy_°©
[
i
].
u£d
, 1);

466  (
block
);

467 
	}
}

477 
boﬁ
 
	$buf_buddy_ªloˇã
(
buf_poﬁ_t
 *
buf_poﬁ
, *
§c
, *
d°
,

478 
ulöt
 
i
, 
boﬁ
 
f‹˚
) {

479 
buf_∑ge_t
 *
b∑ge
;

480 c⁄° 
ulöt
 
size
 = 
BUF_BUDDY_LOW
 << 
i
;

481 
•a˚_id_t
 
•a˚
;

482 
∑ge_no_t
 
off£t
;

484 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
zù_‰ì_muãx
));

485 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
zù_muãx
));

486 
	`ut_ad
(!
	`ut_Æign_off£t
(
§c
, 
size
));

487 
	`ut_ad
(!
	`ut_Æign_off£t
(
d°
, 
size
));

488 
	`ut_ad
(
i
 >
	`buf_buddy_gë_¶Ÿ
(
UNIV_ZIP_SIZE_MIN
));

489 
	`UNIV_MEM_ASSERT_W
(
d°
, 
size
);

491 
•a˚
 =

492 
	`mach_ªad_‰om_4
((c⁄° 
byã
 *)
§c
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
);

493 
off£t
 = 
	`mach_ªad_‰om_4
((c⁄° 
byã
 *)
§c
 + 
FIL_PAGE_OFFSET
);

497 
	`UNIV_MEM_VALID
(&
•a˚
,  space);

498 
	`UNIV_MEM_VALID
(&
off£t
,  offset);

500 
	`ut_ad
(
•a˚
 !
BUF_BUDDY_STAMP_FREE
);

502 c⁄° 
∑ge_id_t
 
	`∑ge_id
(
•a˚
, 
off£t
);

506 i‡(!
f‹˚
 && 
buf_poﬁ
 !
	`buf_poﬁ_gë
(
∑ge_id
)) {

507  (
Ál£
);

510 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

512 
rw_lock_t
 *
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
);

514 
	`rw_lock_x_lock
(
hash_lock
);

517 
hash_lock
 = 
	`buf_∑ge_hash_lock_x_c⁄fúm
(hash_lock, 
buf_poﬁ
, 
∑ge_id
);

519 
b∑ge
 = 
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
);

521 i‡(!
b∑ge
 || b∑ge->
zù
.
d©a
 !
§c
) {

527 
	`rw_lock_x_u∆ock
(
hash_lock
);

529 i‡(!
f‹˚
 || 
•a˚
 !0 || 
off£t
 != 0) {

530 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

531  (
Ál£
);

540 
	`ut_ad
(
f‹˚
);

541 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

543 
b∑ge
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
LRU
);

544 
b∑ge
 !
NULL
) {

545 i‡(
b∑ge
->
zù
.
d©a
 =
§c
) {

546 
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
b∑ge
->
id
);

547 
	`rw_lock_x_lock
(
hash_lock
);

550 
b∑ge
 = 
	`UT_LIST_GET_NEXT
(
LRU
, bpage);

553 i‡(
b∑ge
 =
NULL
) {

554 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

555  (
Ál£
);

559 i‡(
	`∑ge_zù_gë_size
(&
b∑ge
->
zù
Ë!
size
) {

563 
	`ut_ad
(
	`∑ge_zù_gë_size
(&
b∑ge
->
zù
Ë< 
size
);

565 
	`rw_lock_x_u∆ock
(
hash_lock
);

567 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

568  (
Ál£
);

573 
	`UNIV_MEM_ASSERT_W
(
§c
, 
size
);

575 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

577 
	`muãx_íãr
(
block_muãx
);

579 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

581 i‡(
	`buf_∑ge_ˇn_ªloˇã
(
b∑ge
)) {

583 
uötmax_t
 
u£c
 = 
	`ut_time_us
(
NULL
);

585 
	`ut_a
(
b∑ge
->
zù
.
d©a
 =
§c
);

587 
	`mem˝y
(
d°
, 
§c
, 
size
);

588 
b∑ge
->
zù
.
d©a
 = 
ªöãΩªt_ˇ°
<
∑ge_zù_t
 *>(
d°
);

590 
	`rw_lock_x_u∆ock
(
hash_lock
);

592 
	`muãx_exô
(
block_muãx
);

594 
	`buf_buddy_mem_övÆid
(
ªöãΩªt_ˇ°
<
buf_buddy_‰ì_t
 *>(
§c
), 
i
);

596 
buf_buddy_°©_t
 *
buddy_°©
 = &
buf_poﬁ
->buddy_°©[
i
];

597 
buddy_°©
->
ªloˇãd
++;

598 
buddy_°©
->
ªloˇãd_u£c
 +
	`ut_time_us
(
NULL
Ë- 
u£c
;

599  (
åue
);

602 
	`rw_lock_x_u∆ock
(
hash_lock
);

604 
	`muãx_exô
(
block_muãx
);

605  (
Ál£
);

606 
	}
}

615 
	$buf_buddy_‰ì_low
(
buf_poﬁ_t
 *
buf_poﬁ
, *
buf
, 
ulöt
 
i
,

616 
boﬁ
 
has_zù_‰ì
) {

617 
buf_buddy_‰ì_t
 *
buddy
;

619 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
zù_muãx
));

620 
	`ut_ad
(
i
 <
BUF_BUDDY_SIZES
);

621 
	`ut_ad
(
i
 >
	`buf_buddy_gë_¶Ÿ
(
UNIV_ZIP_SIZE_MIN
));

623 i‡(!
has_zù_‰ì
) {

624 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

627 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
zù_‰ì_muãx
));

628 
	`ut_ad
(
buf_poﬁ
->
buddy_°©
[
i
].
u£d
 > 0);

629 
	`os_©omic_de¸emít_ulöt
(&
buf_poﬁ
->
buddy_°©
[
i
].
u£d
, 1);

630 
ªcomböe
:

631 
	`UNIV_MEM_ASSERT_AND_ALLOC
(
buf
, 
BUF_BUDDY_LOW
 << 
i
);

633 i‡(
i
 =
BUF_BUDDY_SIZES
) {

634 i‡(!
has_zù_‰ì
) {

635 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

637 
	`buf_buddy_block_‰ì
(
buf_poﬁ
, 
buf
);

641 
	`ut_ad
(
i
 < 
BUF_BUDDY_SIZES
);

642 
	`ut_ad
(
buf
 =
	`ut_Æign_down
(buf, 
BUF_BUDDY_LOW
 << 
i
));

643 
	`ut_ad
(!
	`buf_poﬁ_c⁄èös_zù
(
buf_poﬁ
, 
buf
));

648 i‡(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
zù_‰ì
[
i
]) < 16 &&

649 
buf_poﬁ
->
cuº_size
 >buf_poﬁ->
ﬁd_size
) {

650 
func_exô
;

654 
buddy
 = 
ªöãΩªt_ˇ°
<
buf_buddy_‰ì_t
 *>(

655 
	`buf_buddy_gë
(
ªöãΩªt_ˇ°
<
byã
 *>(
buf
), 
BUF_BUDDY_LOW
 << 
i
));

657 
	`buf_buddy_is_‰ì
(
buddy
, 
i
)) {

658 
BUF_BUDDY_STATE_FREE
:

660 
	`buf_buddy_ªmove_‰om_‰ì
(
buf_poﬁ
, 
buddy
, 
i
);

661 
buddy_is_‰ì
:

662 
	`ut_ad
(!
	`buf_poﬁ_c⁄èös_zù
(
buf_poﬁ
, 
buddy
));

663 
i
++;

664 
buf
 = 
	`ut_Æign_down
(buf, 
BUF_BUDDY_LOW
 << 
i
);

666 
ªcomböe
;

668 
BUF_BUDDY_STATE_USED
:

669 
	`ut_d
(
	`buf_buddy_li°_vÆid©e
(
buf_poﬁ
, 
i
));

673 i‡(
buf_buddy_‰ì_t
 *
zù_buf
 =

674 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
zù_‰ì
[
i
])) {

678 
	`buf_buddy_ªmove_‰om_‰ì
(
buf_poﬁ
, 
zù_buf
, 
i
);

682 i‡(
	`buf_buddy_ªloˇã
(
buf_poﬁ
, 
buddy
, 
zù_buf
, 
i
, 
Ál£
)) {

683 
buddy_is_‰ì
;

686 
	`buf_buddy_add_to_‰ì
(
buf_poﬁ
, 
zù_buf
, 
i
);

690 
BUF_BUDDY_STATE_PARTIALLY_USED
:

696 
func_exô
:

698 
	`buf_buddy_add_to_‰ì
(
buf_poﬁ
, 
ªöãΩªt_ˇ°
<
buf_buddy_‰ì_t
 *>(
buf
), 
i
);

699 i‡(!
has_zù_‰ì
) {

700 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

702 
	}
}

711 
boﬁ
 
	$buf_buddy_ªÆloc
(
buf_poﬁ_t
 *
buf_poﬁ
, *
buf
, 
ulöt
 
size
) {

712 
buf_block_t
 *
block
 = 
NULL
;

713 
ulöt
 
i
 = 
	`buf_buddy_gë_¶Ÿ
(
size
);

715 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
zù_muãx
));

716 
	`ut_ad
(
i
 <
BUF_BUDDY_SIZES
);

717 
	`ut_ad
(
i
 >
	`buf_buddy_gë_¶Ÿ
(
UNIV_ZIP_SIZE_MIN
));

719 i‡(
i
 < 
BUF_BUDDY_SIZES
) {

721 
block
 = 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
	`buf_buddy_Æloc_zù
(
buf_poﬁ
, 
i
));

724 i‡(
block
 =
NULL
) {

726 
block
 = 
	`buf_LRU_gë_‰ì_⁄ly
(
buf_poﬁ
);

728 i‡(
block
 =
NULL
) {

729  (
Ál£
);

732 
	`buf_buddy_block_ªgi°î
(
block
);

734 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

735 
block
 = 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(

736 
	`buf_buddy_Æloc_‰om
(
buf_poﬁ
, 
block
->
‰ame
, 
i
, 
BUF_BUDDY_SIZES
));

738 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

741 
	`os_©omic_ö¸emít_ulöt
(&
buf_poﬁ
->
buddy_°©
[
i
].
u£d
, 1);

744 i‡(
	`buf_buddy_ªloˇã
(
buf_poﬁ
, 
buf
, 
block
, 
i
, 
åue
)) {

745 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

747 
	`buf_buddy_‰ì_low
(
buf_poﬁ
, 
buf
, 
i
, 
Ál£
);

748  (
åue
);

752 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

753 
	`buf_buddy_‰ì_low
(
buf_poﬁ
, 
block
, 
i
, 
Ál£
);

755  (
Ál£
);

756 
	}
}

760 
	$buf_buddy_c⁄dí£_‰ì
(
buf_poﬁ_t
 *
buf_poﬁ
) {

761 
	`muãx_íãr
(&
buf_poﬁ
->
zù_‰ì_muãx
);

762 
	`ut_ad
(
buf_poﬁ
->
cuº_size
 < buf_poﬁ->
ﬁd_size
);

764 
ulöt
 
i
 = 0; i < 
	`UT_ARR_SIZE
(
buf_poﬁ
->
zù_‰ì
); ++i) {

765 
buf_buddy_‰ì_t
 *
buf
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
zù_‰ì
[
i
]);

768 
buf
 !
NULL
 &&

769 !
	`buf_‰ame_wûl_wôhdøwn
(
buf_poﬁ
, 
ªöãΩªt_ˇ°
<
byã
 *>(
buf
))) {

770 
buf
 = 
	`UT_LIST_GET_NEXT
(
li°
, buf);

773 
buf
 !
NULL
) {

774 
buf_buddy_‰ì_t
 *
√xt
 = 
	`UT_LIST_GET_NEXT
(
li°
, 
buf
);

776 
buf_buddy_‰ì_t
 *
buddy
 = 
ªöãΩªt_ˇ°
<buf_buddy_free_t *>(

777 
	`buf_buddy_gë
(
ªöãΩªt_ˇ°
<
byã
 *>(
buf
), 
BUF_BUDDY_LOW
 << 
i
));

780 
åue
) {

781 
√xt
 !
NULL
 && !
	`buf_‰ame_wûl_wôhdøwn
(

782 
buf_poﬁ
, 
ªöãΩªt_ˇ°
<
byã
 *>(
√xt
))) {

783 
√xt
 = 
	`UT_LIST_GET_NEXT
(
li°
,Çext);

786 i‡(
buddy
 !
√xt
) {

790 
√xt
 = 
	`UT_LIST_GET_NEXT
(
li°
,Çext);

793 i‡(
	`buf_buddy_is_‰ì
(
buddy
, 
i
Ë=
BUF_BUDDY_STATE_FREE
) {

796 
	`buf_buddy_ªmove_‰om_‰ì
(
buf_poﬁ
, 
buf
, 
i
);

797 
	`os_©omic_ö¸emít_ulöt
(&
buf_poﬁ
->
buddy_°©
[
i
].
u£d
, 1);

799 
	`buf_buddy_‰ì_low
(
buf_poﬁ
, 
buf
, 
i
, 
åue
);

802 
buf
 = 
√xt
;

805 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

806 
	}
}

	@buf0buf.cc

40 
	~"my_c⁄fig.h
"

42 
	~"bå0bå.h
"

43 
	~"buf0buf.h
"

44 
	~"fû0fû.h
"

45 
	~"f•0sys•a˚.h
"

46 
	~"ha_¥ŸŸy≥s.h
"

47 
	~"mem0mem.h
"

48 
	~"my_dbug.h
"

49 
	~"∑ge0size.h
"

50 #i‚de‡
UNIV_HOTBACKUP


51 
	~"bå0£a.h
"

52 
	~"buf0buddy.h
"

53 
	~"buf0°©s.h
"

54 
	~"di˘0°©s_bg.h
"

55 
	~"ibuf0ibuf.h
"

56 
	~"lock0lock.h
"

57 
	~"log0log.h
"

58 
	~"sync0rw.h
"

59 
	~"åx0purge.h
"

60 
	~"åx0undo.h
"

62 
	~<î∫o.h
>

63 
	~<°d¨g.h
>

64 
	~<sys/ty≥s.h
>

65 
	~<time.h
>

66 
	~<m≠
>

67 
	~<√w
>

68 
	~<s°ªam
>

70 
	~"buf0checksum.h
"

71 
	~"buf0dump.h
"

72 
	~"di˘0di˘.h
"

73 
	~"log0ªcv.h
"

74 
	~"os0thªad-¸óã.h
"

75 
	~"∑ge0zù.h
"

76 
	~"§v0m⁄.h
"

77 
	~"§v0§v.h
"

78 
	~"§v0°¨t.h
"

79 
	~"sync0sync.h
"

80 
	~"ut0√w.h
"

83 #ifde‡
HAVE_LIBNUMA


84 
	~<numa.h
>

85 
	~<numaif.h
>

87 
	s£t_numa_öãæóve_t
 {

88 
£t_numa_öãæóve_t
() {

89 i‡(
	m§v_numa_öãæóve
) {

90 
	mib
::
öfo
(
ER_IB_MSG_47
) << "Setting NUMA memoryÖolicyÅo"

92 i‡(
£t_mempﬁicy
(
MPOL_INTERLEAVE
, 
numa_Æl_nodes_±r
->
maskp
,

93 
numa_Æl_nodes_±r
->
size
) != 0) {

94 
ib
::
w¨n
(
ER_IB_MSG_48
) << "FailedÅo set NUMA memory"

96 << 
°ªº‹
(
î∫o
);

101 ~
£t_numa_öãæóve_t
() {

102 i‡(
	m§v_numa_öãæóve
) {

103 
	mib
::
öfo
(
ER_IB_MSG_49
) << "Setting NUMA memoryÖolicyÅo"

105 i‡(
£t_mempﬁicy
(
MPOL_DEFAULT
, 
NULL
, 0) != 0) {

106 
ib
::
w¨n
(
ER_IB_MSG_50
) << "FailedÅo set NUMA memory"

108 << 
°ªº‹
(
î∫o
);

114 
	#NUMA_MEMPOLICY_INTERLEAVE_IN_SCOPE
 
£t_numa_öãæóve_t
 
sc›ed_numa


	)

116 
	#NUMA_MEMPOLICY_INTERLEAVE_IN_SCOPE


	)

273 #i‚de‡
UNIV_HOTBACKUP


275 c⁄° 
	gWAIT_FOR_READ
 = 100;

276 c⁄° 
	gWAIT_FOR_WRITE
 = 100;

278 c⁄° 
ulöt
 
	gBUF_PAGE_READ_MAX_RETRIES
 = 100;

280 c⁄° 
ulöt
 
	gBUF_READ_AHEAD_PAGES
 = 64;

283 c⁄° 
ulöt
 
	gBUF_READ_AHEAD_PORTION
 = 32;

286 
buf_poﬁ_t
 *
	gbuf_poﬁ_±r
;

289 vﬁ©ûê
boﬁ
 
	gbuf_poﬁ_ªsizög
;

292 vﬁ©ûê
boﬁ
 
	gbuf_poﬁ_wôhdøwög
;

297 vﬁ©ûê
ulöt
 
	gbuf_wôhdøw_˛ock
;

304 
	g°d
::
	tm≠
<c⁄° 
	tbyã
 *, 
	tbuf_chunk_t
 *, 
	t°d
::
	tÀss
<const byte *>,

305 
	tut_Æloˇt‹
<
	t°d
::
	t∑ú
<c⁄° 
	tbyã
 *c⁄°, 
	tbuf_chunk_t
 *>>>

306 
	tbuf_poﬁ_chunk_m≠_t
;

308 
buf_poﬁ_chunk_m≠_t
 *
	gbuf_chunk_m≠_ªg
;

312 
buf_°©_≥r_ödex_t
 *
	gbuf_°©_≥r_ödex
;

314 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


317 
ulöt
 
	gbuf_dbg_cou¡î
 = 0;

320 #ifde‡
UNIV_DEBUG


323 
boﬁ
 
	g§v_buf_poﬁ_debug
;

326 #i‡
deföed
 
UNIV_PFS_MUTEX
 || deföed 
UNIV_PFS_RWLOCK


327 #i‚de‡
PFS_SKIP_BUFFER_MUTEX_RWLOCK


333 
	#PFS_GROUP_BUFFER_SYNC


	)

339 
	#PFS_MAX_BUFFER_MUTEX_LOCK_REGISTER
 
ULINT_MAX


	)

346 
	#MONITOR_RW_COUNTER
(
io_ty≥
, 
cou¡î
) \

347 ((
io_ty≥
 =
BUF_IO_READ
Ë? (
cou¡î
##
_READ
Ë: (cou¡î##
_WRITTEN
))

	)

351 
	$buf_poﬁ_ªgi°î_chunk
(
buf_chunk_t
 *
chunk
) {

352 
buf_chunk_m≠_ªg
->
	`ö£π
(

353 
buf_poﬁ_chunk_m≠_t
::
	`vÆue_ty≥
(
chunk
->
blocks
->
‰ame
, chunk));

354 
	}
}

356 
l¢_t
 
	$buf_poﬁ_gë_ﬁde°_modifiˇti⁄_≠¥ox
() {

357 
l¢_t
 
l¢
 = 0;

358 
l¢_t
 
ﬁde°_l¢
 = 0;

363 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

364 
buf_poﬁ_t
 *
buf_poﬁ
;

366 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

368 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

370 
buf_∑ge_t
 *
b∑ge
;

375 
b∑ge
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
Êush_li°
);

376 
b∑ge
 !
NULL
 && 
	`f•_is_sy°em_ãmp‹¨y
(b∑ge->
id
.
	`•a˚
());

377 
b∑ge
 = 
	`UT_LIST_GET_PREV
(
li°
, bpage)) {

381 i‡(
b∑ge
 !
NULL
) {

382 
	`ut_ad
(
b∑ge
->
ö_Êush_li°
);

383 
l¢
 = 
b∑ge
->
ﬁde°_modifiˇti⁄
;

386 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

388 i‡(!
ﬁde°_l¢
 || olde°_l¢ > 
l¢
) {

389 
ﬁde°_l¢
 = 
l¢
;

396  (
ﬁde°_l¢
);

397 
	}
}

399 
l¢_t
 
	$buf_poﬁ_gë_ﬁde°_modifiˇti⁄_lwm
() {

400 c⁄° 
l¢_t
 
l¢
 = 
	`buf_poﬁ_gë_ﬁde°_modifiˇti⁄_≠¥ox
();

402 i‡(
l¢
 == 0) {

406 
	`ut_a
(
l¢
 % 
OS_FILE_LOG_BLOCK_SIZE
 >
LOG_BLOCK_HDR_SIZE
);

408 c⁄° 
log_t
 &
log
 = *
log_sys
;

410 c⁄° 
l¢_t
 
œg
 = 
	`log_buf„r_Êush_‹dî_œg
(
log
);

412 
	`ut_a
(
œg
 % 
OS_FILE_LOG_BLOCK_SIZE
 == 0);

414 c⁄° 
l¢_t
 
checkpoöt_l¢
 = 
	`log_gë_checkpoöt_l¢
(
log
);

416 
	`ut_a
(
checkpoöt_l¢
 != 0);

418 i‡(
l¢
 > 
œg
) {

419  (
°d
::
	`max
(
checkpoöt_l¢
, 
l¢
 - 
œg
));

422  (
checkpoöt_l¢
);

424 
	}
}

427 
	$buf_gë_tŸÆ_li°_Àn
(

428 
ulöt
 *
LRU_Àn
,

429 
ulöt
 *
‰ì_Àn
,

430 
ulöt
 *
Êush_li°_Àn
)

432 
ulöt
 
i
;

434 *
LRU_Àn
 = 0;

435 *
‰ì_Àn
 = 0;

436 *
Êush_li°_Àn
 = 0;

438 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

439 
buf_poﬁ_t
 *
buf_poﬁ
;

441 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

443 *
LRU_Àn
 +
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
);

444 *
‰ì_Àn
 +
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
);

445 *
Êush_li°_Àn
 +
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
Êush_li°
);

447 
	}
}

450 
	$buf_gë_tŸÆ_li°_size_ö_byãs
(

451 
buf_poﬁs_li°_size_t
 *
buf_poﬁs_li°_size
)

454 
	`ut_ad
(
buf_poﬁs_li°_size
);

455 
	`mem£t
(
buf_poﬁs_li°_size
, 0, (*buf_pools_list_size));

457 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

458 
buf_poﬁ_t
 *
buf_poﬁ
;

460 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

463 
buf_poﬁs_li°_size
->
LRU_byãs
 +
buf_poﬁ
->
°©
.LRU_bytes;

464 
buf_poﬁs_li°_size
->
unzù_LRU_byãs
 +=

465 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
unzù_LRU
Ë* 
UNIV_PAGE_SIZE
;

466 
buf_poﬁs_li°_size
->
Êush_li°_byãs
 +
buf_poﬁ
->
°©
.flush_list_bytes;

468 
	}
}

471 
	$buf_gë_tŸÆ_°©
(

472 
buf_poﬁ_°©_t
 *
tŸ_°©
)

474 
ulöt
 
i
;

476 
	`mem£t
(
tŸ_°©
, 0, (*tot_stat));

478 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

479 
buf_poﬁ_°©_t
 *
buf_°©
;

480 
buf_poﬁ_t
 *
buf_poﬁ
;

482 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

484 
buf_°©
 = &
buf_poﬁ
->
°©
;

485 
tŸ_°©
->
n_∑ge_gës
 +
buf_°©
->n_page_gets;

486 
tŸ_°©
->
n_∑ges_ªad
 +
buf_°©
->n_pages_read;

487 
tŸ_°©
->
n_∑ges_wrôãn
 +
buf_°©
->n_pages_written;

488 
tŸ_°©
->
n_∑ges_¸óãd
 +
buf_°©
->n_pages_created;

489 
tŸ_°©
->
n_ø_∑ges_ªad_∫d
 +
buf_°©
->n_ra_pages_read_rnd;

490 
tŸ_°©
->
n_ø_∑ges_ªad
 +
buf_°©
->n_ra_pages_read;

491 
tŸ_°©
->
n_ø_∑ges_evi˘ed
 +
buf_°©
->n_ra_pages_evicted;

492 
tŸ_°©
->
n_∑ges_made_young
 +
buf_°©
->n_pages_made_young;

494 
tŸ_°©
->
n_∑ges_nŸ_made_young
 +
buf_°©
->n_pages_not_made_young;

496 
	}
}

500 
buf_block_t
 *
	$buf_block_Æloc
(

501 
buf_poﬁ_t
 *
buf_poﬁ
)

505 
buf_block_t
 *
block
;

506 
ulöt
 
ödex
;

507 
ulöt
 
buf_poﬁ_ödex
;

509 i‡(
buf_poﬁ
 =
NULL
) {

512 
ödex
 = 
buf_poﬁ_ödex
++ % 
§v_buf_poﬁ_ö°™˚s
;

513 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
ödex
);

516 
block
 = 
	`buf_LRU_gë_‰ì_block
(
buf_poﬁ
);

518 
	`buf_block_£t_°©e
(
block
, 
BUF_BLOCK_MEMORY
);

520  (
block
);

521 
	}
}

529 
	$buf_∑ge_¥öt
(c⁄° 
byã
 *
ªad_buf
, c⁄° 
∑ge_size_t
 &
∑ge_size
,

530 
ulöt
 
Êags
) {

531 i‡(!(
Êags
 & 
BUF_PAGE_PRINT_NO_FULL
)) {

532 
ib
::
	`öfo
(
ER_IB_MSG_51
) << "Page dump inásciiánd hex ("

533 << 
∑ge_size
.
	`physiˇl
() << " bytes):";

535 
	`ut_¥öt_buf
(
°dîr
, 
ªad_buf
, 
∑ge_size
.
	`physiˇl
());

536 
	`Âuts
("\nI¬oDB: End o‡∑gêdump\n", 
°dîr
);

539 i‡(
∑ge_size
.
	`is_com¥es£d
()) {

540 
BlockRï‹ãr
 
com¥es£d
 = 
	`BlockRï‹ãr
(
Ál£
, 
ªad_buf
, 
∑ge_size
, false);

543 
ib
::
	`öfo
(
ER_IB_MSG_52
)

544 << "Com¥es£dÖagêty≥ (" << 
	`fû_∑ge_gë_ty≥
(
ªad_buf
)

546 << 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
FIL_PAGE_SPACE_OR_CHKSUM
)

548 << 
	`buf_checksum_Æg‹ôhm_«me
(
SRV_CHECKSUM_ALGORITHM_CRC32
) << " "

549 << 
com¥es£d
.
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_CRC32
) << "/"

550 << 
com¥es£d
.
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_CRC32
, 
åue
)

551 << ", " << 
	`buf_checksum_Æg‹ôhm_«me
(
SRV_CHECKSUM_ALGORITHM_INNODB
)

552 << " " << 
com¥es£d
.
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_INNODB
)

553 << ", " << 
	`buf_checksum_Æg‹ôhm_«me
(
SRV_CHECKSUM_ALGORITHM_NONE
)

554 << " " << 
com¥es£d
.
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_NONE
)

555 << ";ÖagêLSN " << 
	`mach_ªad_‰om_8
(
ªad_buf
 + 
FIL_PAGE_LSN
)

557 << "áÃódyË" << 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
FIL_PAGE_OFFSET
)

559 << 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
);

562 c⁄° 
uöt32_t
 
¸c32
 = 
	`buf_ˇlc_∑ge_¸c32
(
ªad_buf
);

564 c⁄° 
uöt32_t
 
¸c32_Àgacy
 = 
	`buf_ˇlc_∑ge_¸c32
(
ªad_buf
, 
åue
);

566 
ib
::
	`öfo
(
ER_IB_MSG_53
)

568 << 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
FIL_PAGE_SPACE_OR_CHKSUM
)

570 << 
	`buf_checksum_Æg‹ôhm_«me
(
SRV_CHECKSUM_ALGORITHM_CRC32
) << " "

571 << 
¸c32
 << "/" << 
¸c32_Àgacy
 << ", "

572 << 
	`buf_checksum_Æg‹ôhm_«me
(
SRV_CHECKSUM_ALGORITHM_INNODB
) << " "

573 << 
	`buf_ˇlc_∑ge_√w_checksum
(
ªad_buf
) << ", "

574 << 
	`buf_checksum_Æg‹ôhm_«me
(
SRV_CHECKSUM_ALGORITHM_NONE
) << " "

575 << 
BUF_NO_CHECKSUM_MAGIC
 << ", stored checksum in field2 "

576 << 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
∑ge_size
.
	`logiˇl
() -

577 
FIL_PAGE_END_LSN_OLD_CHKSUM
)

579 << 
	`buf_checksum_Æg‹ôhm_«me
(
SRV_CHECKSUM_ALGORITHM_CRC32
) << " "

580 << 
¸c32
 << "/" << 
¸c32_Àgacy
 << ", "

581 << 
	`buf_checksum_Æg‹ôhm_«me
(
SRV_CHECKSUM_ALGORITHM_INNODB
) << " "

582 << 
	`buf_ˇlc_∑ge_ﬁd_checksum
(
ªad_buf
) << ", "

583 << 
	`buf_checksum_Æg‹ôhm_«me
(
SRV_CHECKSUM_ALGORITHM_NONE
) << " "

584 << 
BUF_NO_CHECKSUM_MAGIC
 << ",Öage LSN "

585 << 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
FIL_PAGE_LSN
) << " "

586 << 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
FIL_PAGE_LSN
 + 4)

588 << 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
∑ge_size
.
	`logiˇl
() -

589 
FIL_PAGE_END_LSN_OLD_CHKSUM
 + 4)

591 << 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
FIL_PAGE_OFFSET
)

594 << 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
);

597 #i‚de‡
UNIV_HOTBACKUP


598 i‡(
	`mach_ªad_‰om_2
(
ªad_buf
 + 
TRX_UNDO_PAGE_HDR
 + 
TRX_UNDO_PAGE_TYPE
) ==

599 
TRX_UNDO_INSERT
) {

600 
	`Ârötf
(
°dîr
, "InnoDB: Page may beán insert undoÜogÖage\n");

601 } i‡(
	`mach_ªad_‰om_2
(
ªad_buf
 + 
TRX_UNDO_PAGE_HDR
 +

602 
TRX_UNDO_PAGE_TYPE
Ë=
TRX_UNDO_UPDATE
) {

603 
	`Ârötf
(
°dîr
, "InnoDB: Page may beán update undoÜogÖage\n");

607 
	`fû_∑ge_gë_ty≥
(
ªad_buf
)) {

608 
•a˚_ödex_t
 
ödex_id
;

609 
FIL_PAGE_INDEX
:

610 
FIL_PAGE_RTREE
:

611 
ödex_id
 = 
	`bå_∑ge_gë_ödex_id
(
ªad_buf
);

612 
	`Ârötf
(
°dîr
,

614 " index id i†" 
IB_ID_FMT
 "\n",

615 
ödex_id
);

617 
FIL_PAGE_INODE
:

618 
	`Âuts
("I¬oDB: Pagêmay bê™ 'öode'Öage\n", 
°dîr
);

620 
FIL_PAGE_IBUF_FREE_LIST
:

621 
	`Âuts
("I¬oDB: Pagêmay bê™ in£π buf„∏‰ìÜi°Öage\n", 
°dîr
);

623 
FIL_PAGE_TYPE_ALLOCATED
:

624 
	`Âuts
("I¬oDB: Pagêmay bê®‰eshlyáŒoˇãdÖage\n", 
°dîr
);

626 
FIL_PAGE_IBUF_BITMAP
:

627 
	`Âuts
("I¬oDB: Pagêmay bê™ in£π buf„∏bôm≠Öage\n", 
°dîr
);

629 
FIL_PAGE_TYPE_SYS
:

630 
	`Âuts
("I¬oDB: Pagêmay bê®sy°emÖage\n", 
°dîr
);

632 
FIL_PAGE_TYPE_TRX_SYS
:

633 
	`Âuts
("I¬oDB: Pagêmay bê®å™ß˘i⁄ sy°emÖage\n", 
°dîr
);

635 
FIL_PAGE_TYPE_FSP_HDR
:

636 
	`Âuts
("I¬oDB: Pagêmay bê®fûê•a˚ hódîÖage\n", 
°dîr
);

638 
FIL_PAGE_TYPE_XDES
:

639 
	`Âuts
("I¬oDB: Pagêmay bê™Éxã¡ des¸ùt‹Öage\n", 
°dîr
);

641 
FIL_PAGE_TYPE_BLOB
:

642 
	`Âuts
("I¬oDB: Pagêmay bê®BLOBÖage\n", 
°dîr
);

644 
FIL_PAGE_SDI_BLOB
:

645 
	`Âuts
("I¬oDB: Pagêmay bê®SDI BLOBÖage\n", 
°dîr
);

647 
FIL_PAGE_TYPE_ZBLOB
:

648 
FIL_PAGE_TYPE_ZBLOB2
:

649 
	`Âuts
("I¬oDB: Pagêmay bê®com¥es£d BLOBÖage\n", 
°dîr
);

651 
FIL_PAGE_SDI_ZBLOB
:

652 
	`Âuts
("I¬oDB: Pagêmay bê®com¥es£d SDI BLOBÖage\n", 
°dîr
);

654 
FIL_PAGE_TYPE_RSEG_ARRAY
:

655 
	`Âuts
("I¬oDB: Pagêmay bê®Rﬁlback SegmíàAºayÖage\n", 
°dîr
);

659 
	`ut_ad
(
Êags
 & 
BUF_PAGE_PRINT_NO_CRASH
);

660 
	}
}

662 #i‚de‡
UNIV_HOTBACKUP


664 #ifde‡
PFS_GROUP_BUFFER_SYNC


666 #i‚de‡
PFS_SKIP_BUFFER_MUTEX_RWLOCK


667 
mysql_pfs_key_t
 
buf„r_block_muãx_key
;

675 
	$pfs_ªgi°î_buf„r_block
(

676 
buf_chunk_t
 *
chunk
)

678 
buf_block_t
 *
block
;

679 
ulöt
 
num_to_ªgi°î
;

681 
block
 = 
chunk
->
blocks
;

683 
num_to_ªgi°î
 = 
	`ut_mö
(
chunk
->
size
, 
PFS_MAX_BUFFER_MUTEX_LOCK_REGISTER
);

685 
ulöt
 
i
 = 0; i < 
num_to_ªgi°î
; i++) {

686 #ifde‡
UNIV_PFS_MUTEX


687 
BPageMuãx
 *
muãx
;

689 
muãx
 = &
block
->mutex;

691 #i‚de‡
PFS_SKIP_BUFFER_MUTEX_RWLOCK


692 
muãx
->
	`pfs_add
(
buf„r_block_muãx_key
);

697 
rw_lock_t
 *
rwlock
;

699 #ifde‡
UNIV_PFS_RWLOCK


700 
rwlock
 = &
block
->
lock
;

701 
	`ut_a
(!
rwlock
->
pfs_psi
);

703 #i‚de‡
PFS_SKIP_BUFFER_MUTEX_RWLOCK


704 
rwlock
->
pfs_psi
 = (
PSI_£rvî
)

705 ? 
PSI_£rvî
->
	`öô_rwlock
(
buf_block_lock_key
, 
rwlock
)

706 : 
NULL
;

708 
rwlock
->
pfs_psi
 =

709 (
PSI_£rvî
Ë? PSI_£rvî->
	`öô_rwlock
(
PFS_NOT_INSTRUMENTED
, 
rwlock
)

710 : 
NULL
;

713 #ifde‡
UNIV_DEBUG


714 
rwlock
 = &
block
->
debug_œtch
;

715 
	`ut_a
(!
rwlock
->
pfs_psi
);

716 
rwlock
->
pfs_psi
 = (
PSI_£rvî
Ë? PSI_£rvî->
	`öô_rwlock
(

717 
buf_block_debug_œtch_key
, 
rwlock
)

718 : 
NULL
;

722 
block
++;

724 
	}
}

728 
	$buf_block_öô
(

729 
buf_poﬁ_t
 *
buf_poﬁ
,

730 
buf_block_t
 *
block
,

731 
byã
 *
‰ame
)

733 
	`UNIV_MEM_DESC
(
‰ame
, 
UNIV_PAGE_SIZE
);

737 
	`as£π_block_ahi_em±y_⁄_öô
(
block
);

739 
block
->
‰ame
 = frame;

741 
block
->
∑ge
.
buf_poﬁ_ödex
 = 
	`buf_poﬁ_ödex
(
buf_poﬁ
);

742 
block
->
∑ge
.
°©e
 = 
BUF_BLOCK_NOT_USED
;

743 
block
->
∑ge
.
buf_fix_cou¡
 = 0;

744 
block
->
∑ge
.
io_fix
 = 
BUF_IO_NONE
;

745 
block
->
∑ge
.
Êush_ob£rvî
 = 
NULL
;

747 
block
->
modify_˛ock
 = 0;

749 
	`ut_d
(
block
->
∑ge
.
fûe_∑ge_was_‰ìd
 = 
FALSE
);

751 
block
->
ödex
 = 
NULL
;

752 
block
->
made_dúty_wôh_no_œtch
 = 
Ál£
;

754 
	`ut_d
(
block
->
∑ge
.
ö_∑ge_hash
 = 
FALSE
);

755 
	`ut_d
(
block
->
∑ge
.
ö_zù_hash
 = 
FALSE
);

756 
	`ut_d
(
block
->
∑ge
.
ö_Êush_li°
 = 
FALSE
);

757 
	`ut_d
(
block
->
∑ge
.
ö_‰ì_li°
 = 
FALSE
);

758 
	`ut_d
(
block
->
∑ge
.
ö_LRU_li°
 = 
FALSE
);

759 
	`ut_d
(
block
->
ö_unzù_LRU_li°
 = 
FALSE
);

760 
	`ut_d
(
block
->
ö_wôhdøw_li°
 = 
FALSE
);

762 
	`∑ge_zù_des_öô
(&
block
->
∑ge
.
zù
);

764 
	`muãx_¸óã
(
LATCH_ID_BUF_BLOCK_MUTEX
, &
block
->
muãx
);

766 #i‡
deföed
 
PFS_SKIP_BUFFER_MUTEX_RWLOCK
 || deföed 
PFS_GROUP_BUFFER_SYNC


774 
	`rw_lock_¸óã
(
PFS_NOT_INSTRUMENTED
, &
block
->
lock
, 
SYNC_LEVEL_VARYING
);

776 
	`ut_d
(
	`rw_lock_¸óã
(
PFS_NOT_INSTRUMENTED
, &
block
->
debug_œtch
,

777 
SYNC_NO_ORDER_CHECK
));

781 
	`rw_lock_¸óã
(
buf_block_lock_key
, &
block
->
lock
, 
SYNC_LEVEL_VARYING
);

783 
	`ut_d
(
	`rw_lock_¸óã
(
buf_block_debug_œtch_key
, &
block
->
debug_œtch
,

784 
SYNC_NO_ORDER_CHECK
));

788 
block
->
lock
.
is_block_lock
 = 1;

790 
	`ut_ad
(
	`rw_lock_vÆid©e
(&(
block
->
lock
)));

791 
	}
}

796 
buf_chunk_t
 *
	$buf_chunk_öô
(

797 
buf_poﬁ_t
 *
buf_poﬁ
,

798 
buf_chunk_t
 *
chunk
,

799 
ul⁄gl⁄g
 
mem_size
,

800 
°d
::
muãx
 *mutex)

802 
buf_block_t
 *
block
;

803 
byã
 *
‰ame
;

804 
ulöt
 
i
;

808 
mem_size
 = 
	`ut_2pow_round
(mem_size, 
UNIV_PAGE_SIZE
);

810 
mem_size
 +
	`ut_2pow_round
(

811 (
mem_size
 / 
UNIV_PAGE_SIZE
Ë* ( *
block
) + (UNIV_PAGE_SIZE - 1),

812 
UNIV_PAGE_SIZE
);

814 
	`DBUG_EXECUTE_IF
("ib_buf_chunk_öô_Áûs",  (
NULL
););

816 
chunk
->
mem
 = 
buf_poﬁ
->
Æloˇt‹
.
	`Æloˇã_œrge
(
mem_size
, &chunk->
mem_pfx
);

818 i‡(
chunk
->
mem
 =
NULL
) {

819  (
NULL
);

822 #ifde‡
HAVE_LIBNUMA


823 i‡(
§v_numa_öãæóve
) {

824 
°
 = 
	`mböd
(
chunk
->
mem
, chunk->
	`mem_size
(), 
MPOL_INTERLEAVE
,

825 
numa_Æl_nodes_±r
->
maskp
,Çuma_Æl_nodes_±r->
size
,

826 
MPOL_MF_MOVE
);

827 i‡(
°
 != 0) {

828 
ib
::
	`w¨n
(
ER_IB_MSG_54
) << "FailedÅo set NUMA memoryÖolicy of"

831 << 
	`°ªº‹
(
î∫o
) << ").";

838 
chunk
->
blocks
 = (
buf_block_t
 *)chunk->
mem
;

845 
‰ame
 = (
byã
 *)
	`ut_Æign
(
chunk
->
mem
, 
UNIV_PAGE_SIZE
);

846 
chunk
->
size
 = chunk->
mem_pfx
.
m_size
 / 
UNIV_PAGE_SIZE
 - (
‰ame
 !chunk->
mem
);

850 
ulöt
 
size
 = 
chunk
->size;

852 
‰ame
 < (
byã
 *)(
chunk
->
blocks
 + 
size
)) {

853 
‰ame
 +
UNIV_PAGE_SIZE
;

854 
size
--;

857 
chunk
->
size
 = size;

864 
block
 = 
chunk
->
blocks
;

866 
i
 = 
chunk
->
size
; i--;) {

867 
	`buf_block_öô
(
buf_poﬁ
, 
block
, 
‰ame
);

868 
	`UNIV_MEM_INVALID
(
block
->
‰ame
, 
UNIV_PAGE_SIZE
);

871 
	`UT_LIST_ADD_LAST
(
buf_poﬁ
->
‰ì
, &
block
->
∑ge
);

873 
	`ut_d
(
block
->
∑ge
.
ö_‰ì_li°
 = 
TRUE
);

874 
	`ut_ad
(
	`buf_poﬁ_‰om_block
(
block
Ë=
buf_poﬁ
);

876 
block
++;

877 
‰ame
 +
UNIV_PAGE_SIZE
;

880 i‡(
muãx
 !
nuŒ±r
) {

881 
muãx
->
	`lock
();

884 
	`buf_poﬁ_ªgi°î_chunk
(
chunk
);

886 i‡(
muãx
 !
nuŒ±r
) {

887 
muãx
->
	`u∆ock
();

890 #ifde‡
PFS_GROUP_BUFFER_SYNC


891 
	`pfs_ªgi°î_buf„r_block
(
chunk
);

893  (
chunk
);

894 
	}
}

896 #ifde‡
UNIV_DEBUG


900 
buf_block_t
 *
	$buf_chunk_c⁄èös_zù
(

901 
buf_chunk_t
 *
chunk
,

902 c⁄° *
d©a
)

904 
buf_block_t
 *
block
;

905 
ulöt
 
i
;

907 
block
 = 
chunk
->
blocks
;

909 
i
 = 
chunk
->
size
; i--; 
block
++) {

910 i‡(
block
->
∑ge
.
zù
.
d©a
 == data) {

911  (
block
);

915  (
NULL
);

916 
	}
}

924 
buf_block_t
 *
	$buf_poﬁ_c⁄èös_zù
(
buf_poﬁ_t
 *
buf_poﬁ
, c⁄° *
d©a
) {

925 
ulöt
 
n
;

926 
buf_chunk_t
 *
chunk
 = 
buf_poﬁ
->
chunks
;

928 
	`ut_ad
(
buf_poﬁ
);

929 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
zù_‰ì_muãx
));

930 
n
 = 
buf_poﬁ
->
n_chunks
;Ç--; 
chunk
++) {

931 
buf_block_t
 *
block
 = 
	`buf_chunk_c⁄èös_zù
(
chunk
, 
d©a
);

933 i‡(
block
) {

934  (
block
);

938  (
NULL
);

939 
	}
}

944 c⁄° 
buf_block_t
 *
	$buf_chunk_nŸ_‰ìd
(

945 
buf_chunk_t
 *
chunk
)

947 
buf_block_t
 *
block
;

948 
ulöt
 
i
;

950 
block
 = 
chunk
->
blocks
;

952 
i
 = 
chunk
->
size
; i--; 
block
++) {

953 
iboﬁ
 
ªady
;

955 
	`buf_block_gë_°©e
(
block
)) {

956 
BUF_BLOCK_POOL_WATCH
:

957 
BUF_BLOCK_ZIP_PAGE
:

958 
BUF_BLOCK_ZIP_DIRTY
:

961 
ut_îr‹
;

963 
BUF_BLOCK_NOT_USED
:

964 
BUF_BLOCK_READY_FOR_USE
:

965 
BUF_BLOCK_MEMORY
:

966 
BUF_BLOCK_REMOVE_HASH
:

970 
BUF_BLOCK_FILE_PAGE
:

971 
	`buf_∑ge_muãx_íãr
(
block
);

972 
ªady
 = 
	`buf_Êush_ªady_f‹_ª∂a˚
(&
block
->
∑ge
);

973 
	`buf_∑ge_muãx_exô
(
block
);

975 i‡(!
ªady
) {

976  (
block
);

983  (
NULL
);

984 
	}
}

988 
	$buf_poﬁ_£t_sizes
() {

989 
ulöt
 
i
;

990 
ulöt
 
cuº_size
 = 0;

992 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

993 
buf_poﬁ_t
 *
buf_poﬁ
;

995 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

996 
cuº_size
 +
buf_poﬁ
->
cuº_poﬁ_size
;

998 i‡(
§v_buf_poﬁ_cuº_size
 == 0) {

999 
§v_buf_poﬁ_cuº_size
 = 
cuº_size
;

1001 
§v_buf_poﬁ_cuº_size
 = 
§v_buf_poﬁ_size
;

1003 
§v_buf_poﬁ_ﬁd_size
 = 
§v_buf_poﬁ_size
;

1004 
§v_buf_poﬁ_ba£_size
 = 
§v_buf_poﬁ_size
;

1005 
os_wmb
;

1006 
	}
}

1014 
	$buf_poﬁ_¸óã
(
buf_poﬁ_t
 *
buf_poﬁ
, 
ulöt
 
buf_poﬁ_size
,

1015 
ulöt
 
ö°™˚_no
, 
°d
::
muãx
 *mutex,

1016 
dbîr_t
 &
îr
) {

1017 
ulöt
 
i
;

1018 
ulöt
 
chunk_size
;

1019 
buf_chunk_t
 *
chunk
;

1021 #ifde‡
UNIV_LINUX


1022 
˝u_£t_t
 
˝u£t
;

1024 
	`CPU_ZERO
(&
˝u£t
);

1026 c⁄° 
n_c‹es
 = 
	`sysc⁄f
(
_SC_NPROCESSORS_ONLN
);

1028 
	`CPU_SET
(
ö°™˚_no
 % 
n_c‹es
, &
˝u£t
);

1030 
os_thªad_id_t
 
thªad_id
;

1032 
thªad_id
 = 
	`os_thªad_gë_cuº_id
();

1034 i‡(
	`±hªad_£èfföôy_≈
(
thªad_id
, (
˝u£t
), &cpuset) == -1) {

1035 
ib
::
	`îr‹
() << "sched_setaffinity() failed!";

1039 
	`£çri‹ôy
(
PRIO_PROCESS
, (
pid_t
)
	`sysˇŒ
(
SYS_gëtid
), -20);

1042 
	`ut_ad
(
buf_poﬁ_size
 % 
§v_buf_poﬁ_chunk_unô
 == 0);

1046 
	`muãx_¸óã
(
LATCH_ID_BUF_POOL_LRU_LIST
, &
buf_poﬁ
->
LRU_li°_muãx
);

1047 
	`muãx_¸óã
(
LATCH_ID_BUF_POOL_FREE_LIST
, &
buf_poﬁ
->
‰ì_li°_muãx
);

1048 
	`muãx_¸óã
(
LATCH_ID_BUF_POOL_ZIP_FREE
, &
buf_poﬁ
->
zù_‰ì_muãx
);

1049 
	`muãx_¸óã
(
LATCH_ID_BUF_POOL_ZIP_HASH
, &
buf_poﬁ
->
zù_hash_muãx
);

1050 
	`muãx_¸óã
(
LATCH_ID_BUF_POOL_ZIP
, &
buf_poﬁ
->
zù_muãx
);

1051 
	`muãx_¸óã
(
LATCH_ID_BUF_POOL_FLUSH_STATE
, &
buf_poﬁ
->
Êush_°©e_muãx
);

1053 
	`√w
 (&
buf_poﬁ
->
Æloˇt‹
Ë
ut_Æloˇt‹
<>(
mem_key_buf_buf_poﬁ
);

1055 i‡(
buf_poﬁ_size
 > 0) {

1056 
buf_poﬁ
->
n_chunks
 = 
buf_poﬁ_size
 / 
§v_buf_poﬁ_chunk_unô
;

1057 
chunk_size
 = 
§v_buf_poﬁ_chunk_unô
;

1059 
buf_poﬁ
->
chunks
 = 
ªöãΩªt_ˇ°
<
buf_chunk_t
 *>(

1060 
	`ut_zÆloc_nokey
(
buf_poﬁ
->
n_chunks
 * (*
chunk
)));

1061 
buf_poﬁ
->
chunks_ﬁd
 = 
NULL
;

1063 
	`UT_LIST_INIT
(
buf_poﬁ
->
LRU
, &
buf_∑ge_t
::LRU);

1064 
	`UT_LIST_INIT
(
buf_poﬁ
->
‰ì
, &
buf_∑ge_t
::
li°
);

1065 
	`UT_LIST_INIT
(
buf_poﬁ
->
wôhdøw
, &
buf_∑ge_t
::
li°
);

1066 
buf_poﬁ
->
wôhdøw_èrgë
 = 0;

1067 
	`UT_LIST_INIT
(
buf_poﬁ
->
Êush_li°
, &
buf_∑ge_t
::
li°
);

1068 
	`UT_LIST_INIT
(
buf_poﬁ
->
unzù_LRU
, &
buf_block_t
::unzip_LRU);

1070 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


1071 
	`UT_LIST_INIT
(
buf_poﬁ
->
zù_˛ón
, &
buf_∑ge_t
::
li°
);

1074 
i
 = 0; i < 
	`UT_ARR_SIZE
(
buf_poﬁ
->
zù_‰ì
); ++i) {

1075 
	`UT_LIST_INIT
(
buf_poﬁ
->
zù_‰ì
[
i
], &
buf_buddy_‰ì_t
::
li°
);

1078 
buf_poﬁ
->
cuº_size
 = 0;

1079 
chunk
 = 
buf_poﬁ
->
chunks
;

1082 i‡(!
	`buf_chunk_öô
(
buf_poﬁ
, 
chunk
, 
chunk_size
, 
muãx
)) {

1083 --
chunk
 >
buf_poﬁ
->
chunks
) {

1084 
buf_block_t
 *
block
 = 
chunk
->
blocks
;

1086 
i
 = 
chunk
->
size
; i--; 
block
++) {

1087 
	`muãx_‰ì
(&
block
->
muãx
);

1088 
	`rw_lock_‰ì
(&
block
->
lock
);

1090 
	`ut_d
(
	`rw_lock_‰ì
(&
block
->
debug_œtch
));

1093 
buf_poﬁ
->
Æloˇt‹
.
	`dóŒoˇã_œrge
(
chunk
->
mem
, &chunk->
mem_pfx
);

1095 
	`ut_‰ì
(
buf_poﬁ
->
chunks
);

1096 
buf_poﬁ
->
chunks
 = 
nuŒ±r
;

1098 
îr
 = 
DB_ERROR
;

1102 
buf_poﬁ
->
cuº_size
 +
chunk
->
size
;

1103 } ++
chunk
 < 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks
);

1105 
buf_poﬁ
->
ö°™˚_no
 = instance_no;

1106 
buf_poﬁ
->
ªad_ahód_¨ó
 = 
°©ic_ˇ°
<
∑ge_no_t
>(

1107 
	`ut_mö
(
BUF_READ_AHEAD_PAGES
,

1108 
	`ut_2_powî_up
(
buf_poﬁ
->
cuº_size
 / 
BUF_READ_AHEAD_PORTION
)));

1109 
buf_poﬁ
->
cuº_poﬁ_size
 = buf_poﬁ->
cuº_size
 * 
UNIV_PAGE_SIZE
;

1111 
buf_poﬁ
->
ﬁd_size
 = buf_poﬁ->
cuº_size
;

1112 
buf_poﬁ
->
n_chunks_√w
 = buf_poﬁ->
n_chunks
;

1116 
§v_n_∑ge_hash_locks
 =

1117 
°©ic_ˇ°
<
ul⁄g
>(
	`ut_2_powî_up
(
§v_n_∑ge_hash_locks
));

1118 
	`ut_a
(
§v_n_∑ge_hash_locks
 != 0);

1119 
	`ut_a
(
§v_n_∑ge_hash_locks
 <
MAX_PAGE_HASH_LOCKS
);

1121 
buf_poﬁ
->
∑ge_hash
 =

1122 
	`ib_¸óã
(2 * 
buf_poﬁ
->
cuº_size
, 
LATCH_ID_HASH_TABLE_RW_LOCK
,

1123 
§v_n_∑ge_hash_locks
, 
MEM_HEAP_FOR_PAGE_HASH
);

1125 
buf_poﬁ
->
∑ge_hash_ﬁd
 = 
NULL
;

1127 
buf_poﬁ
->
zù_hash
 = 
	`hash_¸óã
(2 * buf_poﬁ->
cuº_size
);

1129 
buf_poﬁ
->
œ°_¥ötout_time
 = 
	`ut_time
();

1134 
	`muãx_¸óã
(
LATCH_ID_FLUSH_LIST
, &
buf_poﬁ
->
Êush_li°_muãx
);

1136 
i
 = 
BUF_FLUSH_LRU
; i < 
BUF_FLUSH_N_TYPES
; i++) {

1137 
buf_poﬁ
->
no_Êush
[
i
] = 
	`os_evít_¸óã
(0);

1140 
buf_poﬁ
->
w©ch
 = (
buf_∑ge_t
 *)
	`ut_zÆloc_nokey
((*buf_pool->watch) *

1141 
BUF_POOL_WATCH_SIZE
);

1142 
i
 = 0; i < 
BUF_POOL_WATCH_SIZE
; i++) {

1143 
buf_poﬁ
->
w©ch
[
i
].
buf_poﬁ_ödex
 = buf_poﬁ->
ö°™˚_no
;

1148 
buf_poﬁ
->
åy_LRU_sˇn
 = 
TRUE
;

1151 
buf_poﬁ
->
åack_∑ge_l¢
 = 
LSN_MAX
;

1153 
buf_poﬁ
->
max_l¢_io
 = 0;

1156 
	`√w
 (&
buf_poﬁ
->
Êush_hp
Ë
	`FlushHp
(buf_poﬁ, &buf_poﬁ->
Êush_li°_muãx
);

1159 
	`√w
 (&
buf_poﬁ
->
Ãu_hp
Ë
	`LRUHp
(buf_poﬁ, &buf_poﬁ->
LRU_li°_muãx
);

1162 
	`√w
 (&
buf_poﬁ
->
Ãu_sˇn_ôr
Ë
	`LRUIå
(buf_poﬁ, &buf_poﬁ->
LRU_li°_muãx
);

1165 
	`√w
 (&
buf_poﬁ
->
sögÀ_sˇn_ôr
Ë
	`LRUIå
(buf_poﬁ, &buf_poﬁ->
LRU_li°_muãx
);

1167 
îr
 = 
DB_SUCCESS
;

1168 
	}
}

1172 
	$buf_poﬁ_‰ì_ö°™˚
(
buf_poﬁ_t
 *
buf_poﬁ
) {

1173 
buf_chunk_t
 *
chunk
;

1174 
buf_chunk_t
 *
chunks
;

1175 
buf_∑ge_t
 *
b∑ge
;

1176 
buf_∑ge_t
 *
¥ev_b∑ge
 = 0;

1178 
	`muãx_‰ì
(&
buf_poﬁ
->
LRU_li°_muãx
);

1179 
	`muãx_‰ì
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1180 
	`muãx_‰ì
(&
buf_poﬁ
->
zù_‰ì_muãx
);

1181 
	`muãx_‰ì
(&
buf_poﬁ
->
zù_hash_muãx
);

1182 
	`muãx_‰ì
(&
buf_poﬁ
->
Êush_°©e_muãx
);

1183 
	`muãx_‰ì
(&
buf_poﬁ
->
zù_muãx
);

1184 
	`muãx_‰ì
(&
buf_poﬁ
->
Êush_li°_muãx
);

1186 
b∑ge
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
LRU
); b∑gê!
NULL
;

1187 
b∑ge
 = 
¥ev_b∑ge
) {

1188 
¥ev_b∑ge
 = 
	`UT_LIST_GET_PREV
(
LRU
, 
b∑ge
);

1189 
buf_∑ge_°©e
 
°©e
 = 
	`buf_∑ge_gë_°©e
(
b∑ge
);

1191 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1192 
	`ut_ad
(
b∑ge
->
ö_LRU_li°
);

1194 i‡(
°©e
 !
BUF_BLOCK_FILE_PAGE
) {

1197 
	`ut_ad
(
°©e
 =
BUF_BLOCK_ZIP_PAGE
 || 
§v_Á°_shutdown
 == 2);

1198 
	`buf_∑ge_‰ì_des¸ùt‹
(
b∑ge
);

1202 
	`ut_‰ì
(
buf_poﬁ
->
w©ch
);

1203 
buf_poﬁ
->
w©ch
 = 
NULL
;

1205 
chunks
 = 
buf_poﬁ
->chunks;

1206 
chunk
 = 
chunks
 + 
buf_poﬁ
->
n_chunks
;

1208 --
chunk
 >
chunks
) {

1209 
buf_block_t
 *
block
 = 
chunk
->
blocks
;

1211 
ulöt
 
i
 = 
chunk
->
size
; i--; 
block
++) {

1212 
	`muãx_‰ì
(&
block
->
muãx
);

1213 
	`rw_lock_‰ì
(&
block
->
lock
);

1215 
	`ut_d
(
	`rw_lock_‰ì
(&
block
->
debug_œtch
));

1218 
buf_poﬁ
->
Æloˇt‹
.
	`dóŒoˇã_œrge
(
chunk
->
mem
, &chunk->
mem_pfx
);

1221 
ulöt
 
i
 = 
BUF_FLUSH_LRU
; i < 
BUF_FLUSH_N_TYPES
; ++i) {

1222 
	`os_evít_de°roy
(
buf_poﬁ
->
no_Êush
[
i
]);

1225 
	`ut_‰ì
(
buf_poﬁ
->
chunks
);

1226 
	`ha_˛ór
(
buf_poﬁ
->
∑ge_hash
);

1227 
	`hash_èbÀ_‰ì
(
buf_poﬁ
->
∑ge_hash
);

1228 
	`hash_èbÀ_‰ì
(
buf_poﬁ
->
zù_hash
);

1230 
buf_poﬁ
->
Æloˇt‹
.~
	`ut_Æloˇt‹
();

1231 
	}
}

1234 
	$buf_poﬁ_‰ì
() {

1235 
	`UT_DELETE
(
buf_°©_≥r_ödex
);

1237 
	`UT_DELETE
(
buf_chunk_m≠_ªg
);

1238 
buf_chunk_m≠_ªg
 = 
nuŒ±r
;

1240 
	`ut_‰ì
(
buf_poﬁ_±r
);

1241 
buf_poﬁ_±r
 = 
nuŒ±r
;

1242 
	}
}

1248 
dbîr_t
 
	$buf_poﬁ_öô
(
ulöt
 
tŸÆ_size
, ulöà
n_ö°™˚s
) {

1249 
ulöt
 
i
;

1250 c⁄° 
ulöt
 
size
 = 
tŸÆ_size
 / 
n_ö°™˚s
;

1252 
	`ut_ad
(
n_ö°™˚s
 > 0);

1253 
	`ut_ad
(
n_ö°™˚s
 <
MAX_BUFFER_POOLS
);

1254 
	`ut_ad
(
n_ö°™˚s
 =
§v_buf_poﬁ_ö°™˚s
);

1256 
NUMA_MEMPOLICY_INTERLEAVE_IN_SCOPE
;

1258 
buf_poﬁ_ªsizög
 = 
Ál£
;

1259 
buf_poﬁ_wôhdøwög
 = 
Ál£
;

1260 
buf_wôhdøw_˛ock
 = 0;

1262 
buf_poﬁ_±r
 =

1263 (
buf_poﬁ_t
 *)
	`ut_zÆloc_nokey
(
n_ö°™˚s
 *  *
buf_poﬁ_±r
);

1265 
buf_chunk_m≠_ªg
 = 
	`UT_NEW_NOKEY
(
	`buf_poﬁ_chunk_m≠_t
());

1267 
°d
::
ve˘‹
<
dbîr_t
> 
îrs
;

1269 
îrs
.
	`assign
(
n_ö°™˚s
, 
DB_SUCCESS
);

1271 #ifde‡
UNIV_LINUX


1272 
ulöt
 
n_c‹es
 = 
	`sysc⁄f
(
_SC_NPROCESSORS_ONLN
);

1279 i‡(
n_c‹es
 > 8) {

1280 
n_c‹es
 = 8;

1283 
ulöt
 
n_c‹es
 = 4;

1286 
dbîr_t
 
îr
 = 
DB_SUCCESS
;

1288 
i
 = 0; i < 
n_ö°™˚s
; ) {

1289 
ulöt
 
n
 = 
i
 + 
n_c‹es
;

1291 i‡(
n
 > 
n_ö°™˚s
) {

1292 
n
 = 
n_ö°™˚s
;

1295 
°d
::
ve˘‹
<°d::
thªad
> 
thªads
;

1297 
°d
::
muãx
 
m
;

1299 
ulöt
 
id
 = 
i
; id < 
n
; ++id) {

1300 
thªads
.
	`em∂a˚_back
(
°d
::
	`thªad
(
buf_poﬁ_¸óã
, &
buf_poﬁ_±r
[
id
], 
size
,

1301 
id
, &
m
, 
°d
::
	`ªf
(
îrs
[id])));

1304 
ulöt
 
id
 = 
i
; id < 
n
; ++id) {

1305 
thªads
[
id
 - 
i
].
	`joö
();

1307 i‡(
îrs
[
id
] !
DB_SUCCESS
) {

1308 
îr
 = 
îrs
[
id
];

1312 i‡(
îr
 !
DB_SUCCESS
) {

1313 
size_t
 
id
 = 0; id < 
n
; ++id) {

1314 i‡(
buf_poﬁ_±r
[
id
].
chunks
 !
nuŒ±r
) {

1315 
	`buf_poﬁ_‰ì_ö°™˚
(&
buf_poﬁ_±r
[
id
]);

1319 
	`buf_poﬁ_‰ì
();

1321  (
îr
);

1325 
i
 = 
n
;

1328 
	`buf_poﬁ_£t_sizes
();

1329 
	`buf_LRU_ﬁd_øtio_upd©e
(100 * 3 / 8, 
FALSE
);

1331 
	`bå_£¨ch_sys_¸óã
(
	`buf_poﬁ_gë_cuº_size
() / (*) / 64);

1333 
buf_°©_≥r_ödex
 =

1334 
	`UT_NEW
(
	`buf_°©_≥r_ödex_t
(), 
mem_key_buf_°©_≥r_ödex_t
);

1336  (
DB_SUCCESS
);

1337 
	}
}

1344 
boﬁ
 
	$buf_∑ge_ªÆloc
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_block_t
 *
block
) {

1345 
buf_block_t
 *
√w_block
;

1347 
	`ut_ad
(
buf_poﬁ_wôhdøwög
);

1348 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1350 
√w_block
 = 
	`buf_LRU_gë_‰ì_⁄ly
(
buf_poﬁ
);

1352 i‡(
√w_block
 =
NULL
) {

1353  (
Ál£
);

1356 
rw_lock_t
 *
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
block
->
∑ge
.
id
);

1358 
	`rw_lock_x_lock
(
hash_lock
);

1359 
	`muãx_íãr
(&
block
->
muãx
);

1361 i‡(
	`buf_∑ge_ˇn_ªloˇã
(&
block
->
∑ge
)) {

1362 
	`muãx_íãr
(&
√w_block
->
muãx
);

1364 
	`mem˝y
(
√w_block
->
‰ame
, 
block
->‰ame, 
UNIV_PAGE_SIZE
);

1365 
	`√w
 (&
√w_block
->
∑ge
Ë
	`buf_∑ge_t
(
block
->page);

1368 
	`ut_ad
(
block
->
∑ge
.
ö_LRU_li°
);

1369 
	`ut_ad
(!
block
->
∑ge
.
ö_zù_hash
);

1370 
	`ut_d
(
block
->
∑ge
.
ö_LRU_li°
 = 
FALSE
);

1372 
	`buf_LRU_adju°_hp
(
buf_poﬁ
, &
block
->
∑ge
);

1374 
buf_∑ge_t
 *
¥ev_b
 = 
	`UT_LIST_GET_PREV
(
LRU
, &
block
->
∑ge
);

1375 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
LRU
, &
block
->
∑ge
);

1377 i‡(
¥ev_b
 !
NULL
) {

1378 
	`UT_LIST_INSERT_AFTER
(
buf_poﬁ
->
LRU
, 
¥ev_b
, &
√w_block
->
∑ge
);

1380 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
LRU
, &
√w_block
->
∑ge
);

1383 i‡(
buf_poﬁ
->
LRU_ﬁd
 =&
block
->
∑ge
) {

1384 
buf_poﬁ
->
LRU_ﬁd
 = &
√w_block
->
∑ge
;

1387 
	`ut_ad
(
√w_block
->
∑ge
.
ö_LRU_li°
);

1390 i‡(
block
->
∑ge
.
zù
.
d©a
 !
NULL
) {

1391 
	`ut_ad
(
block
->
ö_unzù_LRU_li°
);

1392 
	`ut_d
(
√w_block
->
ö_unzù_LRU_li°
 = 
TRUE
);

1393 
	`UNIV_MEM_DESC
(&
√w_block
->
∑ge
.
zù
.
d©a
,

1394 
	`∑ge_zù_gë_size
(&
√w_block
->
∑ge
.
zù
));

1396 
buf_block_t
 *
¥ev_block
 = 
	`UT_LIST_GET_PREV
(
unzù_LRU
, 
block
);

1397 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
unzù_LRU
, 
block
);

1399 
	`ut_d
(
block
->
ö_unzù_LRU_li°
 = 
FALSE
);

1400 
block
->
∑ge
.
zù
.
d©a
 = 
NULL
;

1401 
	`∑ge_zù_£t_size
(&
block
->
∑ge
.
zù
, 0);

1403 i‡(
¥ev_block
 !
NULL
) {

1404 
	`UT_LIST_INSERT_AFTER
(
buf_poﬁ
->
unzù_LRU
, 
¥ev_block
, 
√w_block
);

1406 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
unzù_LRU
, 
√w_block
);

1409 
	`ut_ad
(!
block
->
ö_unzù_LRU_li°
);

1410 
	`ut_d
(
√w_block
->
ö_unzù_LRU_li°
 = 
FALSE
);

1414 
	`ut_ad
(
block
->
∑ge
.
ö_∑ge_hash
);

1415 
	`ut_ad
(&
block
->
∑ge
 =
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, block->∑ge.
id
));

1416 
	`ut_d
(
block
->
∑ge
.
ö_∑ge_hash
 = 
FALSE
);

1417 
ulöt
 
fﬁd
 = 
block
->
∑ge
.
id
.
	`fﬁd
();

1418 
	`ut_ad
(
fﬁd
 =
√w_block
->
∑ge
.
id
.
	`fﬁd
());

1419 
	`HASH_DELETE
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
fﬁd
, (&
block
->
∑ge
));

1420 
	`HASH_INSERT
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
fﬁd
,

1421 (&
√w_block
->
∑ge
));

1423 
	`ut_ad
(
√w_block
->
∑ge
.
ö_∑ge_hash
);

1425 
	`buf_block_modify_˛ock_öc
(
block
);

1426 
	`mem£t
(
block
->
‰ame
 + 
FIL_PAGE_OFFSET
, 0xff, 4);

1427 
	`mem£t
(
block
->
‰ame
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
, 0xff, 4);

1428 
	`UNIV_MEM_INVALID
(
block
->
‰ame
, 
UNIV_PAGE_SIZE
);

1429 
	`buf_block_£t_°©e
(
block
, 
BUF_BLOCK_REMOVE_HASH
);

1430 
block
->
∑ge
.
id
.
	`ª£t
(
ULINT32_UNDEFINED
, ULINT32_UNDEFINED);

1433 i‡(
block
->
∑ge
.
ﬁde°_modifiˇti⁄
) {

1434 
	`buf_Êush_ªloˇã_⁄_Êush_li°
(&
block
->
∑ge
, &
√w_block
->page);

1441 
	`as£π_block_ahi_em±y
(
block
);

1442 
	`as£π_block_ahi_em±y_⁄_öô
(
√w_block
);

1443 
	`ut_ad
(!
block
->
ödex
);

1444 
√w_block
->
ödex
 = 
NULL
;

1445 
√w_block
->
n_hash_hñps
 = 0;

1446 
√w_block
->
n_fõlds
 = 1;

1447 
√w_block
->
À·_side
 = 
TRUE
;

1449 
√w_block
->
lock_hash_vÆ
 = 
block
->lock_hash_val;

1450 
	`ut_ad
(
√w_block
->
lock_hash_vÆ
 ==

1451 
	`lock_ªc_hash
(
√w_block
->
∑ge
.
id
.
	`•a˚
(),

1452 
√w_block
->
∑ge
.
id
.
	`∑ge_no
()));

1454 
	`rw_lock_x_u∆ock
(
hash_lock
);

1455 
	`muãx_exô
(&
block
->
muãx
);

1456 
	`muãx_exô
(&
√w_block
->
muãx
);

1459 
	`buf_block_£t_°©e
(
block
, 
BUF_BLOCK_MEMORY
);

1460 
	`buf_LRU_block_‰ì_n⁄_fûe_∑ge
(
block
);

1462 
	`rw_lock_x_u∆ock
(
hash_lock
);

1463 
	`muãx_exô
(&
block
->
muãx
);

1466 
	`buf_LRU_block_‰ì_n⁄_fûe_∑ge
(
√w_block
);

1469  (
åue
);

1470 
	}
}

1472 
	$buf_ªsize_°©us
(c⁄° *
fmt
, ...)

1473 
	`MY_ATTRIBUTE
((
	`f‹m©
(
¥ötf
, 1, 2)));

1480 
	$buf_ªsize_°©us
(c⁄° *
fmt
, ...) {

1481 
va_li°
 
≠
;

1483 
	`va_°¨t
(
≠
, 
fmt
);

1485 
	`ut_v¢¥ötf
(
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªsize_°©us
,

1486 (
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªsize_°©us
), 
fmt
, 
≠
);

1488 
	`va_íd
(
≠
);

1490 
ib
::
	`öfo
(
ER_IB_MSG_55
Ë<< 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªsize_°©us
;

1491 
	}
}

1498 
boﬁ
 
	$buf_block_wûl_wôhdøwn
(
buf_poﬁ_t
 *
buf_poﬁ
, c⁄° 
buf_block_t
 *
block
) {

1499 
	`ut_ad
(
buf_poﬁ
->
cuº_size
 < buf_poﬁ->
ﬁd_size
);

1501 c⁄° 
buf_chunk_t
 *
chunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks_√w
;

1502 c⁄° 
buf_chunk_t
 *
echunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks
;

1504 
chunk
 < 
echunk
) {

1505 i‡(
block
 >
chunk
->
blocks
 && block < chunk->block†+ chunk->
size
) {

1506  (
åue
);

1508 ++
chunk
;

1511  (
Ál£
);

1512 
	}
}

1519 
boﬁ
 
	$buf_‰ame_wûl_wôhdøwn
(
buf_poﬁ_t
 *
buf_poﬁ
, c⁄° 
byã
 *
±r
) {

1520 
	`ut_ad
(
buf_poﬁ
->
cuº_size
 < buf_poﬁ->
ﬁd_size
);

1522 c⁄° 
buf_chunk_t
 *
chunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks_√w
;

1523 c⁄° 
buf_chunk_t
 *
echunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks
;

1525 
chunk
 < 
echunk
) {

1526 i‡(
±r
 >
chunk
->
blocks
->
‰ame
 &&

1527 
±r
 < (
chunk
->
blocks
 + chunk->
size
 - 1)->
‰ame
 + 
UNIV_PAGE_SIZE
) {

1528  (
åue
);

1530 ++
chunk
;

1533  (
Ál£
);

1534 
	}
}

1540 
boﬁ
 
	$buf_poﬁ_wôhdøw_blocks
(
buf_poﬁ_t
 *
buf_poﬁ
) {

1541 
buf_block_t
 *
block
;

1542 
ulöt
 
lo›_cou¡
 = 0;

1543 
ulöt
 
i
 = 
	`buf_poﬁ_ödex
(
buf_poﬁ
);

1544 
ulöt
 
Ãu_Àn
;

1546 
ib
::
	`öfo
(
ER_IB_MSG_56
Ë<< "buf„∏poﬁ " << 
i


1548 << 
buf_poﬁ
->
wôhdøw_èrgë
 << " blocks.";

1551 
	`buf_buddy_c⁄dí£_‰ì
(
buf_poﬁ
);

1553 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

1554 
Ãu_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
);

1555 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

1557 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1558 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
wôhdøw
Ë< buf_poﬁ->
wôhdøw_èrgë
) {

1560 
ulöt
 
cou¡1
 = 0;

1562 
block
 = 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
‰ì
));

1563 
block
 !
NULL
 &&

1564 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
wôhdøw
Ë< buf_poﬁ->
wôhdøw_èrgë
) {

1565 
	`ut_ad
(
block
->
∑ge
.
ö_‰ì_li°
);

1566 
	`ut_ad
(!
block
->
∑ge
.
ö_Êush_li°
);

1567 
	`ut_ad
(!
block
->
∑ge
.
ö_LRU_li°
);

1568 
	`ut_a
(!
	`buf_∑ge_ö_fûe
(&
block
->
∑ge
));

1570 
buf_block_t
 *
√xt_block
;

1571 
√xt_block
 =

1572 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
	`UT_LIST_GET_NEXT
(
li°
, &
block
->
∑ge
));

1574 i‡(
	`buf_block_wûl_wôhdøwn
(
buf_poﬁ
, 
block
)) {

1576 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
‰ì
, &
block
->
∑ge
);

1577 
	`UT_LIST_ADD_LAST
(
buf_poﬁ
->
wôhdøw
, &
block
->
∑ge
);

1578 
	`ut_d
(
block
->
ö_wôhdøw_li°
 = 
TRUE
);

1579 
cou¡1
++;

1582 
block
 = 
√xt_block
;

1586 i‡(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
wôhdøw
Ë< buf_poﬁ->
wôhdøw_èrgë
) {

1587 
ulöt
 
sˇn_dïth
;

1588 
ulöt
 
n_Êushed
 = 0;

1591 
sˇn_dïth
 = 
	`ut_mö
(
	`ut_max
(
buf_poﬁ
->
wôhdøw_èrgë
 -

1592 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
wôhdøw
),

1593 
°©ic_ˇ°
<
ulöt
>(
§v_LRU_sˇn_dïth
)),

1594 
Ãu_Àn
);

1595 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1597 
	`buf_Êush_do_b©ch
(
buf_poﬁ
, 
BUF_FLUSH_LRU
, 
sˇn_dïth
, 0, &
n_Êushed
);

1598 
	`buf_Êush_waô_b©ch_íd
(
buf_poﬁ
, 
BUF_FLUSH_LRU
);

1600 i‡(
n_Êushed
) {

1601 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_LRU_BATCH_FLUSH_TOTAL_PAGE
,

1602 
MONITOR_LRU_BATCH_FLUSH_COUNT
,

1603 
MONITOR_LRU_BATCH_FLUSH_PAGES
, 
n_Êushed
);

1606 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1610 
ulöt
 
cou¡2
 = 0;

1612 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

1613 
buf_∑ge_t
 *
b∑ge
;

1614 
b∑ge
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
LRU
);

1615 
b∑ge
 !
NULL
) {

1616 
BPageMuãx
 *
block_muãx
;

1617 
buf_∑ge_t
 *
√xt_b∑ge
;

1619 
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

1620 
	`muãx_íãr
(
block_muãx
);

1622 
√xt_b∑ge
 = 
	`UT_LIST_GET_NEXT
(
LRU
, 
b∑ge
);

1624 i‡(
b∑ge
->
zù
.
d©a
 !
NULL
 &&

1625 
	`buf_‰ame_wûl_wôhdøwn
(
buf_poﬁ
,

1626 
°©ic_ˇ°
<
byã
 *>(
b∑ge
->
zù
.
d©a
))) {

1627 i‡(
	`buf_∑ge_ˇn_ªloˇã
(
b∑ge
)) {

1628 
	`muãx_exô
(
block_muãx
);

1629 i‡(!
	`buf_buddy_ªÆloc
(
buf_poﬁ
, 
b∑ge
->
zù
.
d©a
,

1630 
	`∑ge_zù_gë_size
(&
b∑ge
->
zù
))) {

1634 
	`muãx_íãr
(
block_muãx
);

1635 
cou¡2
++;

1641 i‡(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_FILE_PAGE
 &&

1642 
	`buf_block_wûl_wôhdøwn
(
buf_poﬁ
,

1643 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
b∑ge
))) {

1644 i‡(
	`buf_∑ge_ˇn_ªloˇã
(
b∑ge
)) {

1645 
	`muãx_exô
(
block_muãx
);

1646 i‡(!
	`buf_∑ge_ªÆloc
(
buf_poﬁ
,

1647 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
b∑ge
))) {

1651 
cou¡2
++;

1653 
	`muãx_exô
(
block_muãx
);

1658 
	`muãx_exô
(
block_muãx
);

1661 
b∑ge
 = 
√xt_b∑ge
;

1664 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

1666 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1668 
	`buf_ªsize_°©us
("buf„∏poﬁ %lu : wôhdøwög blocks. (%lu/%lu)", 
i
,

1669 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
wôhdøw
),

1670 
buf_poﬁ
->
wôhdøw_èrgë
);

1672 
ib
::
	`öfo
(
ER_IB_MSG_57
Ë<< "buf„∏poﬁ " << 
i
 << " : wôhdªw " << 
cou¡1


1674 << " TrõdÅÿªloˇã " << 
cou¡2
 << "Öages ("

1675 << 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
wôhdøw
) << "/"

1676 << 
buf_poﬁ
->
wôhdøw_èrgë
 << ").";

1678 i‡(++
lo›_cou¡
 >= 10) {

1682 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1684 
ib
::
	`öfo
(
ER_IB_MSG_58
)

1685 << "buf„∏poﬁ " << 
i
 << " : willÑetryÅo withdrawÜater.";

1688  (
åue
);

1691 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1694 c⁄° 
buf_chunk_t
 *
chunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks_√w
;

1695 c⁄° 
buf_chunk_t
 *
echunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks
;

1697 
chunk
 < 
echunk
) {

1698 
block
 = 
chunk
->
blocks
;

1699 
ulöt
 
j
 = 
chunk
->
size
; j--; 
block
++) {

1703 
	`ut_a
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_NOT_USED
);

1704 
	`ut_ad
(
block
->
ö_wôhdøw_li°
);

1706 ++
chunk
;

1709 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1710 
ib
::
	`öfo
(
ER_IB_MSG_59
Ë<< "buf„∏poﬁ " << 
i
 << " : withdrawnÅarget "

1711 << 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
wôhdøw
) << " blocks.";

1712 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1715 ++
buf_wôhdøw_˛ock
;

1716 
os_wmb
;

1718  (
Ál£
);

1719 
	}
}

1723 
	$buf_poﬁ_ªsize_hash
(
buf_poﬁ_t
 *
buf_poﬁ
) {

1724 
hash_èbÀ_t
 *
√w_hash_èbÀ
;

1726 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
zù_hash_muãx
));

1727 
	`ut_ad
(
buf_poﬁ
->
∑ge_hash_ﬁd
 =
NULL
);

1730 
√w_hash_èbÀ
 = 
	`ib_ª¸óã
(
buf_poﬁ
->
∑ge_hash
, 2 * buf_poﬁ->
cuº_size
);

1732 
ulöt
 
i
 = 0; i < 
	`hash_gë_n_˚Œs
(
buf_poﬁ
->
∑ge_hash
); i++) {

1733 
buf_∑ge_t
 *
b∑ge
;

1735 
b∑ge
 = 
°©ic_ˇ°
<
buf_∑ge_t
 *>(
	`HASH_GET_FIRST
(
buf_poﬁ
->
∑ge_hash
, 
i
));

1737 
b∑ge
) {

1738 
buf_∑ge_t
 *
¥ev_b∑ge
 = 
b∑ge
;

1739 
ulöt
 
fﬁd
;

1741 
b∑ge
 = 
°©ic_ˇ°
<
buf_∑ge_t
 *>(
	`HASH_GET_NEXT
(
hash
, 
¥ev_b∑ge
));

1743 
fﬁd
 = 
¥ev_b∑ge
->
id
.
	`fﬁd
();

1745 
	`HASH_DELETE
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
fﬁd
, 
¥ev_b∑ge
);

1747 
	`HASH_INSERT
(
buf_∑ge_t
, 
hash
, 
√w_hash_èbÀ
, 
fﬁd
, 
¥ev_b∑ge
);

1751 
buf_poﬁ
->
∑ge_hash_ﬁd
 = buf_poﬁ->
∑ge_hash
;

1752 
buf_poﬁ
->
∑ge_hash
 = 
√w_hash_èbÀ
;

1755 
√w_hash_èbÀ
 = 
	`hash_¸óã
(2 * 
buf_poﬁ
->
cuº_size
);

1757 
ulöt
 
i
 = 0; i < 
	`hash_gë_n_˚Œs
(
buf_poﬁ
->
zù_hash
); i++) {

1758 
buf_∑ge_t
 *
b∑ge
;

1760 
b∑ge
 = 
°©ic_ˇ°
<
buf_∑ge_t
 *>(
	`HASH_GET_FIRST
(
buf_poﬁ
->
zù_hash
, 
i
));

1762 
b∑ge
) {

1763 
buf_∑ge_t
 *
¥ev_b∑ge
 = 
b∑ge
;

1764 
ulöt
 
fﬁd
;

1766 
b∑ge
 = 
°©ic_ˇ°
<
buf_∑ge_t
 *>(
	`HASH_GET_NEXT
(
hash
, 
¥ev_b∑ge
));

1768 
fﬁd
 = 
	`BUF_POOL_ZIP_FOLD
(
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
¥ev_b∑ge
));

1770 
	`HASH_DELETE
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
zù_hash
, 
fﬁd
, 
¥ev_b∑ge
);

1772 
	`HASH_INSERT
(
buf_∑ge_t
, 
hash
, 
√w_hash_èbÀ
, 
fﬁd
, 
¥ev_b∑ge
);

1776 
	`hash_èbÀ_‰ì
(
buf_poﬁ
->
zù_hash
);

1777 
buf_poﬁ
->
zù_hash
 = 
√w_hash_èbÀ
;

1778 
	}
}

1780 #ifde‡
UNIV_DEBUG


1782 
	$buf_poﬁ_ªsize_chunk_make_nuŒ
(
buf_chunk_t
 **
√w_chunks
) {

1783 
cou¡
 = 0;

1785 i‡(
cou¡
 == 1) {

1786 
	`ut_‰ì
(*
√w_chunks
);

1787 *
√w_chunks
 = 
NULL
;

1790 
cou¡
++;

1791 
	}
}

1796 
	$buf_poﬁ_ªsize
() {

1797 
buf_poﬁ_t
 *
buf_poﬁ
;

1798 
ulöt
 
√w_ö°™˚_size
;

1799 
boﬁ
 
w¨nög
 = 
Ál£
;

1801 
NUMA_MEMPOLICY_INTERLEAVE_IN_SCOPE
;

1803 
	`ut_ad
(!
buf_poﬁ_ªsizög
);

1804 
	`ut_ad
(!
buf_poﬁ_wôhdøwög
);

1805 
	`ut_ad
(
§v_buf_poﬁ_chunk_unô
 > 0);

1809 
√w_ö°™˚_size
 = 
§v_buf_poﬁ_size
 / 
§v_buf_poﬁ_ö°™˚s
;

1810 
√w_ö°™˚_size
 /
UNIV_PAGE_SIZE
;

1812 
	`buf_ªsize_°©us
(

1813 "Resizög buf„∏poﬁ from " 
ULINTPF
 "Åo " ULINTPF " (unit=%llu).",

1814 
§v_buf_poﬁ_ﬁd_size
, 
§v_buf_poﬁ_size
, 
§v_buf_poﬁ_chunk_unô
);

1817 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

1818 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

1821 
	`ut_ad
(
buf_poﬁ
->
cuº_size
 =buf_poﬁ->
ﬁd_size
);

1822 
	`ut_ad
(
buf_poﬁ
->
n_chunks_√w
 =buf_poﬁ->
n_chunks
);

1823 #ifde‡
UNIV_DEBUG


1824 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1825 
	`ut_ad
(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
wôhdøw
) == 0);

1826 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1828 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

1829 
	`ut_ad
(
buf_poﬁ
->
Êush_rbt
 =
NULL
);

1830 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

1833 
buf_poﬁ
->
cuº_size
 = 
√w_ö°™˚_size
;

1835 
buf_poﬁ
->
n_chunks_√w
 =

1836 
√w_ö°™˚_size
 * 
UNIV_PAGE_SIZE
 / 
§v_buf_poﬁ_chunk_unô
;

1838 
os_wmb
;

1842 
boﬁ
 
bå_£¨ch_dißbÀd
 = 
Ál£
;

1844 
	`buf_ªsize_°©us
("Disablingádaptive hash index.");

1846 
	`bå_£¨ch_s_lock_Æl
();

1847 i‡(
bå_£¨ch_íabÀd
) {

1848 
	`bå_£¨ch_s_u∆ock_Æl
();

1849 
bå_£¨ch_dißbÀd
 = 
åue
;

1851 
	`bå_£¨ch_s_u∆ock_Æl
();

1854 
	`bå_£¨ch_dißbÀ
(
åue
);

1856 i‡(
bå_£¨ch_dißbÀd
) {

1857 
ib
::
	`öfo
(
ER_IB_MSG_60
) << "disabledádaptive hash index.";

1861 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

1862 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

1863 i‡(
buf_poﬁ
->
cuº_size
 < buf_poﬁ->
ﬁd_size
) {

1864 
ulöt
 
wôhdøw_èrgë
 = 0;

1866 c⁄° 
buf_chunk_t
 *
chunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks_√w
;

1867 c⁄° 
buf_chunk_t
 *
echunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks
;

1869 
chunk
 < 
echunk
) {

1870 
wôhdøw_èrgë
 +
chunk
->
size
;

1871 ++
chunk
;

1874 
	`ut_ad
(
buf_poﬁ
->
wôhdøw_èrgë
 == 0);

1875 
buf_poﬁ
->
wôhdøw_èrgë
 = withdraw_target;

1876 
buf_poﬁ_wôhdøwög
 = 
åue
;

1880 
	`buf_ªsize_°©us
("Withdrawing blocksÅo be shrunken.");

1882 
ib_time_t
 
wôhdøw_°¨ãd
 = 
	`ut_time
();

1883 
ulöt
 
mesßge_öãrvÆ
 = 60;

1884 
ulöt
 
ªåy_öãrvÆ
 = 1;

1886 
wôhdøw_ªåy
:

1887 
boﬁ
 
should_ªåy_wôhdøw
 = 
Ál£
;

1890 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

1891 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

1892 i‡(
buf_poﬁ
->
cuº_size
 < buf_poﬁ->
ﬁd_size
) {

1893 
should_ªåy_wôhdøw
 |
	`buf_poﬁ_wôhdøw_blocks
(
buf_poﬁ
);

1897 i‡(
§v_shutdown_°©e
 !
SRV_SHUTDOWN_NONE
) {

1899 
buf_poﬁ_wôhdøwög
 = 
Ál£
;

1904 
	`buf_lﬂd_ab‹t
();

1906 i‡(
should_ªåy_wôhdøw
 &&

1907 
	`ut_dif·ime
(
	`ut_time
(), 
wôhdøw_°¨ãd
Ë>
mesßge_öãrvÆ
) {

1908 i‡(
mesßge_öãrvÆ
 > 900) {

1909 
mesßge_öãrvÆ
 = 1800;

1911 
mesßge_öãrvÆ
 *= 2;

1914 
	`lock_muãx_íãr
();

1915 
	`åx_sys_muãx_íãr
();

1916 
boﬁ
 
found
 = 
Ál£
;

1917 
åx_t
 *
åx
 = 
	`UT_LIST_GET_FIRST
(
åx_sys
->
mysql_åx_li°
);Årx !
NULL
;

1918 
åx
 = 
	`UT_LIST_GET_NEXT
(
mysql_åx_li°
,Årx)) {

1919 i‡(
åx
->
°©e
 !
TRX_STATE_NOT_STARTED
 &&Årx->
mysql_thd
 !
NULL
 &&

1920 
	`ut_dif·ime
(
wôhdøw_°¨ãd
, 
åx
->
°¨t_time
) > 0) {

1921 i‡(!
found
) {

1922 
ib
::
	`w¨n
(
ER_IB_MSG_61
) << "The followingÅrx might hold"

1928 
found
 = 
åue
;

1931 
	`lock_åx_¥öt_waô_™d_mvcc_°©e
(
°dîr
, 
åx
);

1934 
	`åx_sys_muãx_exô
();

1935 
	`lock_muãx_exô
();

1937 
wôhdøw_°¨ãd
 = 
	`ut_time
();

1940 i‡(
should_ªåy_wôhdøw
) {

1941 
ib
::
	`öfo
(
ER_IB_MSG_62
Ë<< "Wû»ªåyÅÿwôhdøw " << 
ªåy_öãrvÆ


1943 
	`os_thªad_¶ìp
(
ªåy_öãrvÆ
 * 1000000);

1945 i‡(
ªåy_öãrvÆ
 > 5) {

1946 
ªåy_öãrvÆ
 = 10;

1948 
ªåy_öãrvÆ
 *= 2;

1951 
wôhdøw_ªåy
;

1954 
buf_poﬁ_wôhdøwög
 = 
Ál£
;

1956 
	`buf_ªsize_°©us
("Latching whole of bufferÖool.");

1958 #ifde‡
UNIV_DEBUG


1960 
boﬁ
 
should_waô
 = 
åue
;

1962 
should_waô
) {

1963 
should_waô
 = 
Ál£
;

1964 
	`DBUG_EXECUTE_IF
("ib_buf_pool_resize_wait_before_resize",

1965 
should_waô
 = 
åue
;

1966 
	`os_thªad_¶ìp
(10000););

1971 i‡(
§v_shutdown_°©e
 !
SRV_SHUTDOWN_NONE
) {

1976 
buf_poﬁ_ªsizög
 = 
åue
;

1984 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

1985 
	`muãx_íãr
(&(
	`buf_poﬁ_‰om_¨øy
(
i
)->
LRU_li°_muãx
));

1988 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

1989 
	`hash_lock_x_Æl
(
	`buf_poﬁ_‰om_¨øy
(
i
)->
∑ge_hash
);

1992 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

1993 
	`muãx_íãr
(&(
	`buf_poﬁ_‰om_¨øy
(
i
)->
zù_‰ì_muãx
));

1996 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

1997 
	`muãx_íãr
(&(
	`buf_poﬁ_‰om_¨øy
(
i
)->
‰ì_li°_muãx
));

2000 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

2001 
	`muãx_íãr
(&(
	`buf_poﬁ_‰om_¨øy
(
i
)->
zù_hash_muãx
));

2004 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

2005 
	`muãx_íãr
(&(
	`buf_poﬁ_‰om_¨øy
(
i
)->
Êush_°©e_muãx
));

2008 
	`UT_DELETE
(
buf_chunk_m≠_ªg
);

2009 
buf_chunk_m≠_ªg
 = 
	`UT_NEW_NOKEY
(
	`buf_poﬁ_chunk_m≠_t
());

2012 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

2013 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2014 
buf_chunk_t
 *
chunk
;

2015 
buf_chunk_t
 *
echunk
;

2017 
	`buf_ªsize_°©us
(

2020 
i
, 
buf_poﬁ
->
n_chunks
, buf_poﬁ->
n_chunks_√w
);

2022 i‡(
buf_poﬁ
->
n_chunks_√w
 < buf_poﬁ->
n_chunks
) {

2024 
chunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks_√w
;

2025 
echunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks
;

2027 
ulöt
 
sum_‰ìd
 = 0;

2029 
chunk
 < 
echunk
) {

2030 
buf_block_t
 *
block
 = 
chunk
->
blocks
;

2032 
ulöt
 
j
 = 
chunk
->
size
; j--; 
block
++) {

2033 
	`muãx_‰ì
(&
block
->
muãx
);

2034 
	`rw_lock_‰ì
(&
block
->
lock
);

2036 
	`ut_d
(
	`rw_lock_‰ì
(&
block
->
debug_œtch
));

2039 
buf_poﬁ
->
Æloˇt‹
.
	`dóŒoˇã_œrge
(
chunk
->
mem
, &chunk->
mem_pfx
);

2041 
sum_‰ìd
 +
chunk
->
size
;

2043 ++
chunk
;

2047 
	`UT_LIST_INIT
(
buf_poﬁ
->
wôhdøw
, &
buf_∑ge_t
::
li°
);

2048 
buf_poﬁ
->
wôhdøw_èrgë
 = 0;

2050 
ib
::
	`öfo
(
ER_IB_MSG_63
)

2051 << "buf„∏poﬁ " << 
i
 << " : "

2052 << 
buf_poﬁ
->
n_chunks
 - buf_poﬁ->
n_chunks_√w
 << " chunks ("

2053 << 
sum_‰ìd
 << " blocks) were freed.";

2055 
buf_poﬁ
->
n_chunks
 = buf_poﬁ->
n_chunks_√w
;

2060 c⁄° 
ulöt
 
√w_chunks_size
 = 
buf_poﬁ
->
n_chunks_√w
 * (*
chunk
);

2062 
buf_chunk_t
 *
√w_chunks
 = 
ªöãΩªt_ˇ°
<buf_chunk_t *>(

2063 
	`ut_zÆloc_nokey_noÁèl
(
√w_chunks_size
));

2065 
	`DBUG_EXECUTE_IF
("buf_pool_resize_chunk_null",

2066 
	`buf_poﬁ_ªsize_chunk_make_nuŒ
(&
√w_chunks
););

2068 i‡(
√w_chunks
 =
NULL
) {

2069 
ib
::
	`îr‹
(
ER_IB_MSG_64
Ë<< "buf„∏poﬁ " << 
i


2072 
buf_poﬁ
->
n_chunks_√w
 = buf_poﬁ->
n_chunks
;

2073 
w¨nög
 = 
åue
;

2074 
buf_poﬁ
->
chunks_ﬁd
 = 
NULL
;

2075 
ulöt
 
j
 = 0; j < 
buf_poﬁ
->
n_chunks_√w
; j++) {

2076 
	`buf_poﬁ_ªgi°î_chunk
(&
buf_poﬁ
->
chunks
[
j
]);

2078 
ˇlc_buf_poﬁ_size
;

2081 
ulöt
 
n_chunks_c›y
 = 
	`ut_mö
(
buf_poﬁ
->
n_chunks_√w
, buf_poﬁ->
n_chunks
);

2083 
	`mem˝y
(
√w_chunks
, 
buf_poﬁ
->
chunks
, 
n_chunks_c›y
 * (*
chunk
));

2085 
ulöt
 
j
 = 0; j < 
n_chunks_c›y
; j++) {

2086 
	`buf_poﬁ_ªgi°î_chunk
(&
√w_chunks
[
j
]);

2089 
buf_poﬁ
->
chunks_ﬁd
 = buf_poﬁ->
chunks
;

2090 
buf_poﬁ
->
chunks
 = 
√w_chunks
;

2093 i‡(
buf_poﬁ
->
n_chunks_√w
 > buf_poﬁ->
n_chunks
) {

2095 
chunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks
;

2096 
echunk
 = 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks_√w
;

2098 
ulöt
 
sum_added
 = 0;

2099 
ulöt
 
n_chunks
 = 
buf_poﬁ
->n_chunks;

2101 
chunk
 < 
echunk
) {

2102 
ul⁄gl⁄g
 
unô
 = 
§v_buf_poﬁ_chunk_unô
;

2104 i‡(!
	`buf_chunk_öô
(
buf_poﬁ
, 
chunk
, 
unô
, 
nuŒ±r
)) {

2105 
ib
::
	`îr‹
(
ER_IB_MSG_65
Ë<< "buf„∏poﬁ " << 
i


2109 
w¨nög
 = 
åue
;

2111 
buf_poﬁ
->
n_chunks_√w
 = 
n_chunks
;

2116 
sum_added
 +
chunk
->
size
;

2118 ++
n_chunks
;

2119 ++
chunk
;

2122 
ib
::
	`öfo
(
ER_IB_MSG_66
)

2123 << "buf„∏poﬁ " << 
i
 << " : "

2124 << 
buf_poﬁ
->
n_chunks_√w
 - buf_poﬁ->
n_chunks
 << " chunks ("

2125 << 
sum_added
 << " blocks) wereádded.";

2127 
buf_poﬁ
->
n_chunks
 =Ç_chunks;

2129 
ˇlc_buf_poﬁ_size
:

2132 
ulöt
 
√w_size
 = 0;

2134 
chunk
 = 
buf_poﬁ
->
chunks
;

2136 
√w_size
 +
chunk
->
size
;

2137 } ++
chunk
 < 
buf_poﬁ
->
chunks
 + buf_poﬁ->
n_chunks
);

2139 
buf_poﬁ
->
cuº_size
 = 
√w_size
;

2140 
buf_poﬁ
->
n_chunks_√w
 = buf_poﬁ->
n_chunks
;

2142 i‡(
buf_poﬁ
->
chunks_ﬁd
) {

2143 
	`ut_‰ì
(
buf_poﬁ
->
chunks_ﬁd
);

2144 
buf_poﬁ
->
chunks_ﬁd
 = 
NULL
;

2150 
ulöt
 
cuº_size
 = 0;

2152 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

2153 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2155 
	`ut_ad
(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
wôhdøw
) == 0);

2157 
buf_poﬁ
->
ªad_ahód_¨ó
 = 
°©ic_ˇ°
<
∑ge_no_t
>(

2158 
	`ut_mö
(
BUF_READ_AHEAD_PAGES
,

2159 
	`ut_2_powî_up
(
buf_poﬁ
->
cuº_size
 / 
BUF_READ_AHEAD_PORTION
)));

2160 
buf_poﬁ
->
cuº_poﬁ_size
 = buf_poﬁ->
cuº_size
 * 
UNIV_PAGE_SIZE
;

2161 
cuº_size
 +
buf_poﬁ
->
cuº_poﬁ_size
;

2162 
buf_poﬁ
->
ﬁd_size
 = buf_poﬁ->
cuº_size
;

2164 
§v_buf_poﬁ_cuº_size
 = 
cuº_size
;

2165 
	`önodb_£t_buf_poﬁ_size
(
	`buf_poﬁ_size_Æign
(
cuº_size
));

2168 c⁄° 
boﬁ
 
√w_size_too_diff
 =

2169 
§v_buf_poﬁ_ba£_size
 > 
§v_buf_poﬁ_size
 * 2 ||

2170 
§v_buf_poﬁ_ba£_size
 * 2 < 
§v_buf_poﬁ_size
;

2174 i‡(!
w¨nög
 && 
√w_size_too_diff
) {

2175 
	`buf_ªsize_°©us
("Resizing hashÅables.");

2177 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

2178 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2180 
	`buf_poﬁ_ªsize_hash
(
buf_poﬁ
);

2182 
ib
::
	`öfo
(
ER_IB_MSG_67
)

2183 << "buf„∏poﬁ " << 
i
 << " : hashÅables wereÑesized.";

2188 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

2189 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2191 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

2192 
	`muãx_exô
(&
buf_poﬁ
->
zù_hash_muãx
);

2193 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

2194 
	`muãx_exô
(&
buf_poﬁ
->
zù_‰ì_muãx
);

2195 
	`hash_u∆ock_x_Æl
(
buf_poﬁ
->
∑ge_hash
);

2196 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

2198 i‡(
buf_poﬁ
->
∑ge_hash_ﬁd
 !
NULL
) {

2199 
	`hash_èbÀ_‰ì
(
buf_poﬁ
->
∑ge_hash_ﬁd
);

2200 
buf_poﬁ
->
∑ge_hash_ﬁd
 = 
NULL
;

2204 
buf_poﬁ_ªsizög
 = 
Ál£
;

2207 i‡(!
w¨nög
 && 
√w_size_too_diff
) {

2208 
§v_buf_poﬁ_ba£_size
 = 
§v_buf_poﬁ_size
;

2210 
	`buf_ªsize_°©us
("Resizingálso other hashÅables.");

2213 
§v_lock_èbÀ_size
 = 5 * (
§v_buf_poﬁ_size
 / 
UNIV_PAGE_SIZE
);

2214 
	`lock_sys_ªsize
(
§v_lock_èbÀ_size
);

2217 
	`bå_£¨ch_sys_ªsize
(
	`buf_poﬁ_gë_cuº_size
() / (*) / 64);

2220 
	`di˘_ªsize
();

2222 
ib
::
	`öfo
(
ER_IB_MSG_68
) << "Resized hashÅablesátÜock_sys,"

2227 
	`ibuf_max_size_upd©e
(
§v_ch™ge_buf„r_max_size
);

2229 i‡(
§v_buf_poﬁ_ﬁd_size
 !
§v_buf_poﬁ_size
) {

2230 
ib
::
	`öfo
(
ER_IB_MSG_69
) << "CompletedÅoÑesize bufferÖool from "

2231 << 
§v_buf_poﬁ_ﬁd_size
 << "Åo "

2232 << 
§v_buf_poﬁ_size
 << ".";

2233 
§v_buf_poﬁ_ﬁd_size
 = 
§v_buf_poﬁ_size
;

2234 
os_wmb
;

2238 i‡(
bå_£¨ch_dißbÀd
) {

2239 
	`bå_£¨ch_íabÀ
();

2240 
ib
::
	`öfo
(
ER_IB_MSG_70
) << "Re-enabledádaptive hash index.";

2243 
now
[32];

2245 
	`ut_•rötf_time°amp
(
now
);

2246 i‡(!
w¨nög
) {

2247 
	`buf_ªsize_°©us
("Com∂ëedÑesizög buf„∏poﬁáà%s.", 
now
);

2249 
	`buf_ªsize_°©us
(

2252 
now
);

2255 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


2256 
	`ut_a
(
	`buf_vÆid©e
());

2260 
	}
}

2264 
	$buf_ªsize_thªad
() {

2265 
	`my_thªad_öô
();

2267 
§v_shutdown_°©e
 =
SRV_SHUTDOWN_NONE
) {

2268 
	`os_evít_waô
(
§v_buf_ªsize_evít
);

2269 
	`os_evít_ª£t
(
§v_buf_ªsize_evít
);

2271 i‡(
§v_shutdown_°©e
 !
SRV_SHUTDOWN_NONE
) {

2275 
os_rmb
;

2276 i‡(
§v_buf_poﬁ_ﬁd_size
 =
§v_buf_poﬁ_size
) {

2277 
°d
::
o°rög°ªam
 
sout
;

2278 
sout
 << "SizêdidÇŸ ch™gê(ﬁd sizê√w sizê" << 
§v_buf_poﬁ_size


2280 
	`buf_ªsize_°©us
("%s", 
sout
.
	`°r
().
	`c_°r
());

2286 
	`buf_poﬁ_ªsize
();

2289 
	`my_thªad_íd
();

2291 
°d
::
	`©omic_thªad_„n˚
(°d::
mem‹y_‹dî_£q_c°
);

2292 
§v_thªads
.
m_buf_ªsize_thªad_a˘ive
 = 
Ál£
;

2293 
	}
}

2296 
	$buf_poﬁ_˛ór_hash_ödex
() {

2297 
ulöt
 
p
;

2299 
	`ut_ad
(
	`bå_£¨ch_own_Æl
(
RW_LOCK_X
));

2300 
	`ut_ad
(!
buf_poﬁ_ªsizög
);

2301 
	`ut_ad
(!
bå_£¨ch_íabÀd
);

2303 
	`DEBUG_SYNC_C
("purge_wait_for_btr_search_latch");

2305 
p
 = 0;Ö < 
§v_buf_poﬁ_ö°™˚s
;Ö++) {

2306 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
p
);

2307 
buf_chunk_t
 *
chunks
 = 
buf_poﬁ
->chunks;

2308 
buf_chunk_t
 *
chunk
 = 
chunks
 + 
buf_poﬁ
->
n_chunks
;

2310 --
chunk
 >
chunks
) {

2311 
buf_block_t
 *
block
 = 
chunk
->
blocks
;

2312 
ulöt
 
i
 = 
chunk
->
size
;

2314 ; 
i
--; 
block
++) {

2315 
di˘_ödex_t
 *
ödex
 = 
block
->index;

2316 
	`as£π_block_ahi_vÆid
(
block
);

2323 i‡(!
ödex
) {

2327 
	`buf_block_gë_°©e
(
block
)) {

2328 
BUF_BLOCK_FILE_PAGE
:

2330 
BUF_BLOCK_REMOVE_HASH
:

2341 
	`ut_ad
(
block
->
ödex
 =
nuŒ±r
);

2342 
	`ut_ad
(
block
->
n_poöãrs
 == 0);

2345 #i‡
deföed
 
UNIV_AHI_DEBUG
 || deföed 
UNIV_DEBUG


2346 
block
->
n_poöãrs
 = 0;

2348 
block
->
ödex
 = 
NULL
;

2352 
	}
}

2360 
	$buf_ªloˇã
(
buf_∑ge_t
 *
b∑ge
, buf_∑ge_à*
d∑ge
) {

2361 
buf_∑ge_t
 *
b
;

2362 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

2364 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

2365 
	`ut_ad
(
	`buf_∑ge_hash_lock_hñd_x
(
buf_poﬁ
, 
b∑ge
));

2366 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(
b∑ge
)));

2367 
	`ut_a
(
	`buf_∑ge_gë_io_fix
(
b∑ge
Ë=
BUF_IO_NONE
);

2368 
	`ut_a
(
b∑ge
->
buf_fix_cou¡
 == 0);

2369 
	`ut_ad
(
b∑ge
->
ö_LRU_li°
);

2370 
	`ut_ad
(!
b∑ge
->
ö_zù_hash
);

2371 
	`ut_ad
(
b∑ge
->
ö_∑ge_hash
);

2372 
	`ut_ad
(
b∑ge
 =
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, b∑ge->
id
));

2374 
	`ut_ad
(!
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, 
b∑ge
));

2375 #ifde‡
UNIV_DEBUG


2376 
	`buf_∑ge_gë_°©e
(
b∑ge
)) {

2377 
BUF_BLOCK_POOL_WATCH
:

2378 
BUF_BLOCK_NOT_USED
:

2379 
BUF_BLOCK_READY_FOR_USE
:

2380 
BUF_BLOCK_FILE_PAGE
:

2381 
BUF_BLOCK_MEMORY
:

2382 
BUF_BLOCK_REMOVE_HASH
:

2383 
ut_îr‹
;

2384 
BUF_BLOCK_ZIP_DIRTY
:

2385 
BUF_BLOCK_ZIP_PAGE
:

2390 
	`√w
 (
d∑ge
Ë
	`buf_∑ge_t
(*
b∑ge
);

2394 
	`buf_LRU_adju°_hp
(
buf_poﬁ
, 
b∑ge
);

2396 
	`ut_d
(
b∑ge
->
ö_LRU_li°
 = 
FALSE
);

2397 
	`ut_d
(
b∑ge
->
ö_∑ge_hash
 = 
FALSE
);

2400 
b
 = 
	`UT_LIST_GET_PREV
(
LRU
, 
b∑ge
);

2401 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
LRU
, 
b∑ge
);

2403 i‡(
b
 !
NULL
) {

2404 
	`UT_LIST_INSERT_AFTER
(
buf_poﬁ
->
LRU
, 
b
, 
d∑ge
);

2406 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
LRU
, 
d∑ge
);

2409 i‡(
buf_poﬁ
->
LRU_ﬁd
 =
b∑ge
) {

2410 
buf_poﬁ
->
LRU_ﬁd
 = 
d∑ge
;

2411 #ifde‡
UNIV_LRU_DEBUG


2414 
	`ut_a
(
buf_poﬁ
->
LRU_ﬁd
->
ﬁd
);

2415 
	`ut_a
(!
	`UT_LIST_GET_PREV
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
) ||

2416 !
	`UT_LIST_GET_PREV
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
)->
ﬁd
);

2417 
	`ut_a
(!
	`UT_LIST_GET_NEXT
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
) ||

2418 
	`UT_LIST_GET_NEXT
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
)->
ﬁd
);

2422 
	`buf_∑ge_£t_ﬁd
(
d∑ge
, 
	`buf_∑ge_is_ﬁd
(dpage));

2426 
	`ut_d
(
CheckInLRULi°
::
	`vÆid©e
(
buf_poﬁ
));

2429 
ulöt
 
fﬁd
 = 
b∑ge
->
id
.
	`fﬁd
();

2430 
	`ut_ad
(
fﬁd
 =
d∑ge
->
id
.
	`fﬁd
());

2431 
	`HASH_DELETE
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
fﬁd
, 
b∑ge
);

2432 
	`HASH_INSERT
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
fﬁd
, 
d∑ge
);

2433 
	}
}

2439 
	gHaz¨dPoöãr
::
	$£t
(
buf_∑ge_t
 *
b∑ge
) {

2440 
	`ut_ad
(
	`muãx_own
(
m_muãx
));

2441 
	`ut_ad
(!
b∑ge
 || 
	`buf_poﬁ_‰om_b∑ge
(b∑geË=
m_buf_poﬁ
);

2442 
	`ut_ad
(!
b∑ge
 || 
	`buf_∑ge_ö_fûe
(bpage) ||

2443 
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_REMOVE_HASH
);

2445 
m_hp
 = 
b∑ge
;

2446 
	}
}

2452 
boﬁ
 
	gHaz¨dPoöãr
::
	$is_hp
(c⁄° 
buf_∑ge_t
 *
b∑ge
) {

2453 
	`ut_ad
(
	`muãx_own
(
m_muãx
));

2454 
	`ut_ad
(!
m_hp
 || 
	`buf_poﬁ_‰om_b∑ge
(m_hpË=
m_buf_poﬁ
);

2455 
	`ut_ad
(!
b∑ge
 || 
	`buf_poﬁ_‰om_b∑ge
(b∑geË=
m_buf_poﬁ
);

2457  (
b∑ge
 =
m_hp
);

2458 
	}
}

2464 
	gFlushHp
::
	$adju°
(c⁄° 
buf_∑ge_t
 *
b∑ge
) {

2465 
	`ut_ad
(
b∑ge
 !
NULL
);

2468 i‡(
	`is_hp
(
b∑ge
)) {

2469 
m_hp
 = 
	`UT_LIST_GET_PREV
(
li°
, m_hp);

2472 
	`ut_ad
(!
m_hp
 || m_hp->
ö_Êush_li°
);

2473 
	}
}

2479 
	gLRUHp
::
	$adju°
(c⁄° 
buf_∑ge_t
 *
b∑ge
) {

2480 
	`ut_ad
(
b∑ge
);

2483 i‡(
	`is_hp
(
b∑ge
)) {

2484 
m_hp
 = 
	`UT_LIST_GET_PREV
(
LRU
, m_hp);

2487 
	`ut_ad
(!
m_hp
 || m_hp->
ö_LRU_li°
);

2488 
	}
}

2494 
buf_∑ge_t
 *
	gLRUIå
::
	$°¨t
() {

2495 
	`ut_ad
(
	`muãx_own
(
m_muãx
));

2497 i‡(!
m_hp
 || m_hp->
ﬁd
) {

2498 
m_hp
 = 
	`UT_LIST_GET_LAST
(
m_buf_poﬁ
->
LRU
);

2501  (
m_hp
);

2502 
	}
}

2508 
iboﬁ
 
	$buf_poﬁ_w©ch_is_£¡öñ
(c⁄° 
buf_poﬁ_t
 *
buf_poﬁ
,

2509 c⁄° 
buf_∑ge_t
 *
b∑ge
) {

2511 
	`ut_ad
(
	`buf_∑ge_hash_lock_hñd_s_‹_x
(
buf_poﬁ
, 
b∑ge
));

2512 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

2514 i‡(
b∑ge
 < &
buf_poﬁ
->
w©ch
[0] ||

2515 
b∑ge
 >&
buf_poﬁ
->
w©ch
[
BUF_POOL_WATCH_SIZE
]) {

2516 
	`ut_ad
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë!
BUF_BLOCK_ZIP_PAGE
 ||

2517 
b∑ge
->
zù
.
d©a
 !
NULL
);

2519  (
FALSE
);

2522 
	`ut_ad
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_ZIP_PAGE
);

2523 
	`ut_ad
(!
b∑ge
->
ö_zù_hash
);

2524 
	`ut_ad
(
b∑ge
->
ö_∑ge_hash
);

2525 
	`ut_ad
(
b∑ge
->
zù
.
d©a
 =
NULL
);

2526  (
TRUE
);

2527 
	}
}

2536 
buf_∑ge_t
 *
	$buf_poﬁ_w©ch_£t
(c⁄° 
∑ge_id_t
 &
∑ge_id
,

2537 
rw_lock_t
 **
hash_lock
) {

2538 
buf_∑ge_t
 *
b∑ge
;

2539 
ulöt
 
i
;

2540 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

2542 
	`ut_ad
(*
hash_lock
 =
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
));

2544 
	`ut_ad
(
	`rw_lock_own
(*
hash_lock
, 
RW_LOCK_X
));

2546 
b∑ge
 = 
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
);

2548 i‡(
b∑ge
 !
NULL
) {

2549 
∑ge_found
:

2550 i‡(!
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, 
b∑ge
)) {

2552  (
b∑ge
);

2556 
	`buf_block_fix
(
b∑ge
);

2557  (
NULL
);

2567 
	`rw_lock_x_u∆ock
(*
hash_lock
);

2569 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

2570 
	`hash_lock_x_Æl
(
buf_poﬁ
->
∑ge_hash
);

2573 *
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
);

2581 
b∑ge
 = 
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
);

2582 i‡(
b∑ge
) {

2583 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

2584 
	`hash_u∆ock_x_Æl_but
(
buf_poﬁ
->
∑ge_hash
, *
hash_lock
);

2585 
∑ge_found
;

2591 
i
 = 0; i < 
BUF_POOL_WATCH_SIZE
; i++) {

2592 
b∑ge
 = &
buf_poﬁ
->
w©ch
[
i
];

2594 
	`ut_ad
(
b∑ge
->
ac˚ss_time
 == 0);

2595 
	`ut_ad
(
b∑ge
->
√we°_modifiˇti⁄
 == 0);

2596 
	`ut_ad
(
b∑ge
->
ﬁde°_modifiˇti⁄
 == 0);

2597 
	`ut_ad
(
b∑ge
->
zù
.
d©a
 =
NULL
);

2598 
	`ut_ad
(!
b∑ge
->
ö_zù_hash
);

2600 
b∑ge
->
°©e
) {

2601 
BUF_BLOCK_POOL_WATCH
:

2602 
	`ut_ad
(!
b∑ge
->
ö_∑ge_hash
);

2603 
	`ut_ad
(
b∑ge
->
buf_fix_cou¡
 == 0);

2605 
b∑ge
->
°©e
 = 
BUF_BLOCK_ZIP_PAGE
;

2606 
b∑ge
->
id
.
	`c›y_‰om
(
∑ge_id
);

2607 
b∑ge
->
buf_fix_cou¡
 = 1;

2608 
b∑ge
->
buf_poﬁ_ödex
 = 
	`buf_poﬁ_ödex
(
buf_poﬁ
);

2610 
	`ut_d
(
b∑ge
->
ö_∑ge_hash
 = 
TRUE
);

2611 
	`HASH_INSERT
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
∑ge_id
.
	`fﬁd
(),

2612 
b∑ge
);

2614 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

2619 
	`hash_u∆ock_x_Æl_but
(
buf_poﬁ
->
∑ge_hash
, *
hash_lock
);

2621  (
NULL
);

2622 
BUF_BLOCK_ZIP_PAGE
:

2623 
	`ut_ad
(
b∑ge
->
ö_∑ge_hash
);

2624 
	`ut_ad
(
b∑ge
->
buf_fix_cou¡
 > 0);

2627 
ut_îr‹
;

2635 
ut_îr‹
;

2636 
	}
}

2644 
	$buf_poﬁ_w©ch_ªmove
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_∑ge_t
 *
w©ch
) {

2645 #ifde‡
UNIV_DEBUG


2647 
rw_lock_t
 *
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
w©ch
->
id
);

2648 
	`ut_ad
(
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
));

2651 
	`ut_ad
(
	`buf_∑ge_gë_°©e
(
w©ch
Ë=
BUF_BLOCK_ZIP_PAGE
);

2653 
	`HASH_DELETE
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
w©ch
->
id
.
	`fﬁd
(), watch);

2654 
	`ut_d
(
w©ch
->
ö_∑ge_hash
 = 
FALSE
);

2655 
w©ch
->
buf_fix_cou¡
 = 0;

2656 
w©ch
->
°©e
 = 
BUF_BLOCK_POOL_WATCH
;

2657 
	}
}

2662 
	$buf_poﬁ_w©ch_un£t
(c⁄° 
∑ge_id_t
 &
∑ge_id
) {

2663 
buf_∑ge_t
 *
b∑ge
;

2664 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

2666 
rw_lock_t
 *
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
);

2667 
	`rw_lock_x_lock
(
hash_lock
);

2670 
hash_lock
 = 
	`buf_∑ge_hash_lock_x_c⁄fúm
(hash_lock, 
buf_poﬁ
, 
∑ge_id
);

2674 
b∑ge
 = 
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
);

2676 i‡(
	`buf_block_unfix
(
b∑ge
) == 0 &&

2677 
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, 
b∑ge
)) {

2678 
	`buf_poﬁ_w©ch_ªmove
(
buf_poﬁ
, 
b∑ge
);

2681 
	`rw_lock_x_u∆ock
(
hash_lock
);

2682 
	}
}

2689 
iboﬁ
 
	$buf_poﬁ_w©ch_occuºed
(c⁄° 
∑ge_id_t
 &
∑ge_id
) {

2690 
iboﬁ
 
ªt
;

2691 
buf_∑ge_t
 *
b∑ge
;

2692 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

2693 
rw_lock_t
 *
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
);

2695 
	`rw_lock_s_lock
(
hash_lock
);

2698 
hash_lock
 = 
	`buf_∑ge_hash_lock_s_c⁄fúm
(hash_lock, 
buf_poﬁ
, 
∑ge_id
);

2702 
b∑ge
 = 
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
);

2704 
ªt
 = !
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, 
b∑ge
);

2705 
	`rw_lock_s_u∆ock
(
hash_lock
);

2707  (
ªt
);

2708 
	}
}

2714 
	$buf_∑ge_make_young
(
buf_∑ge_t
 *
b∑ge
) {

2715 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

2717 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

2719 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

2721 
	`buf_LRU_make_block_young
(
b∑ge
);

2723 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

2724 
	}
}

2730 
	$buf_∑ge_make_young_if_√eded
(
buf_∑ge_t
 *
b∑ge
) {

2731 
	`ut_ad
(!
	`muãx_own
(&
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
)->
LRU_li°_muãx
));

2732 
	`ut_ad
(
b∑ge
->
buf_fix_cou¡
 > 0);

2733 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

2735 i‡(
	`buf_∑ge_≥ek_if_too_ﬁd
(
b∑ge
)) {

2736 
	`buf_∑ge_make_young
(
b∑ge
);

2738 
	}
}

2740 #ifde‡
UNIV_DEBUG


2748 
buf_∑ge_t
 *
	$buf_∑ge_£t_fûe_∑ge_was_‰ìd
(c⁄° 
∑ge_id_t
 &
∑ge_id
) {

2749 
buf_∑ge_t
 *
b∑ge
;

2750 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

2751 
rw_lock_t
 *
hash_lock
;

2753 
b∑ge
 = 
	`buf_∑ge_hash_gë_s_locked
(
buf_poﬁ
, 
∑ge_id
, &
hash_lock
);

2755 i‡(
b∑ge
) {

2756 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

2757 
	`ut_ad
(!
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, 
b∑ge
));

2758 
	`muãx_íãr
(
block_muãx
);

2759 
	`rw_lock_s_u∆ock
(
hash_lock
);

2761 
b∑ge
->
fûe_∑ge_was_‰ìd
 = 
TRUE
;

2762 
	`muãx_exô
(
block_muãx
);

2765  (
b∑ge
);

2766 
	}
}

2774 
buf_∑ge_t
 *
	$buf_∑ge_ª£t_fûe_∑ge_was_‰ìd
(c⁄° 
∑ge_id_t
 &
∑ge_id
) {

2775 
buf_∑ge_t
 *
b∑ge
;

2776 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

2777 
rw_lock_t
 *
hash_lock
;

2779 
b∑ge
 = 
	`buf_∑ge_hash_gë_s_locked
(
buf_poﬁ
, 
∑ge_id
, &
hash_lock
);

2780 i‡(
b∑ge
) {

2781 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

2782 
	`ut_ad
(!
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, 
b∑ge
));

2783 
	`muãx_íãr
(
block_muãx
);

2784 
	`rw_lock_s_u∆ock
(
hash_lock
);

2785 
b∑ge
->
fûe_∑ge_was_‰ìd
 = 
FALSE
;

2786 
	`muãx_exô
(
block_muãx
);

2789  (
b∑ge
);

2790 
	}
}

2797 
	$buf_block_åy_disˇrd_uncom¥es£d
(c⁄° 
∑ge_id_t
 &
∑ge_id
) {

2798 
buf_∑ge_t
 *
b∑ge
;

2799 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

2807 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

2809 
b∑ge
 = 
	`buf_∑ge_hash_gë
(
buf_poﬁ
, 
∑ge_id
);

2811 i‡(
b∑ge
) {

2812 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

2814 
	`muãx_íãr
(
block_muãx
);

2816 i‡(
	`buf_LRU_‰ì_∑ge
(
b∑ge
, 
Ál£
)) {

2819 
	`muãx_exô
(
block_muãx
);

2822 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

2823 
	}
}

2835 
buf_∑ge_t
 *
	$buf_∑ge_gë_zù
(c⁄° 
∑ge_id_t
 &
∑ge_id
,

2836 c⁄° 
∑ge_size_t
 &
∑ge_size
) {

2837 
buf_∑ge_t
 *
b∑ge
;

2838 
BPageMuãx
 *
block_muãx
;

2839 
rw_lock_t
 *
hash_lock
;

2840 
iboﬁ
 
disˇrd_©ãm±ed
 = 
FALSE
;

2841 
iboﬁ
 
mu°_ªad
;

2842 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

2844 
buf_poﬁ
->
°©
.
n_∑ge_gës
++;

2847 
lookup
:

2851 
b∑ge
 = 
	`buf_∑ge_hash_gë_s_locked
(
buf_poﬁ
, 
∑ge_id
, &
hash_lock
);

2852 i‡(
b∑ge
) {

2853 
	`ut_ad
(!
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, 
b∑ge
));

2859 
	`ut_ad
(!
hash_lock
);

2860 
	`buf_ªad_∑ge
(
∑ge_id
, 
∑ge_size
);

2862 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


2863 
	`ut_a
(++
buf_dbg_cou¡î
 % 5771 || 
	`buf_vÆid©e
());

2867 
	`ut_ad
(
	`buf_∑ge_hash_lock_hñd_s
(
buf_poﬁ
, 
b∑ge
));

2869 i‡(
b∑ge
->
zù
.
d©a
 =
NULL
) {

2871 
îr_exô
:

2872 
	`rw_lock_s_u∆ock
(
hash_lock
);

2874  (
NULL
);

2877 
	`ut_ad
(!
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, 
b∑ge
));

2879 
	`buf_∑ge_gë_°©e
(
b∑ge
)) {

2880 
BUF_BLOCK_POOL_WATCH
:

2881 
BUF_BLOCK_NOT_USED
:

2882 
BUF_BLOCK_READY_FOR_USE
:

2883 
BUF_BLOCK_MEMORY
:

2884 
BUF_BLOCK_REMOVE_HASH
:

2885 
ut_îr‹
;

2887 
BUF_BLOCK_ZIP_PAGE
:

2888 
BUF_BLOCK_ZIP_DIRTY
:

2889 
	`buf_block_fix
(
b∑ge
);

2890 
block_muãx
 = &
buf_poﬁ
->
zù_muãx
;

2891 
	`muãx_íãr
(
block_muãx
);

2892 
gŸ_block
;

2893 
BUF_BLOCK_FILE_PAGE
:

2895 i‡(!
disˇrd_©ãm±ed
) {

2896 
	`rw_lock_s_u∆ock
(
hash_lock
);

2897 
	`buf_block_åy_disˇrd_uncom¥es£d
(
∑ge_id
);

2898 
disˇrd_©ãm±ed
 = 
TRUE
;

2899 
lookup
;

2902 
block_muãx
 = &((
buf_block_t
 *)
b∑ge
)->
muãx
;

2904 
	`muãx_íãr
(
block_muãx
);

2906 
	`buf_block_buf_fix_öc
((
buf_block_t
 *)
b∑ge
, 
__FILE__
, 
__LINE__
);

2908 
gŸ_block
;

2911 
ut_îr‹
;

2912 
îr_exô
;

2914 
gŸ_block
:

2915 
mu°_ªad
 = 
	`buf_∑ge_gë_io_fix
(
b∑ge
Ë=
BUF_IO_READ
;

2917 
	`rw_lock_s_u∆ock
(
hash_lock
);

2919 
	`ut_ad
(!
b∑ge
->
fûe_∑ge_was_‰ìd
);

2921 
	`buf_∑ge_£t_ac˚s£d
(
b∑ge
);

2923 
	`muãx_exô
(
block_muãx
);

2925 
	`buf_∑ge_make_young_if_√eded
(
b∑ge
);

2927 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


2928 
	`ut_a
(++
buf_dbg_cou¡î
 % 5771 || 
	`buf_vÆid©e
());

2929 
	`ut_a
(
b∑ge
->
buf_fix_cou¡
 > 0);

2930 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

2933 i‡(
mu°_ªad
) {

2938 
buf_io_fix
 
io_fix
;

2940 
	`muãx_íãr
(
block_muãx
);

2941 
io_fix
 = 
	`buf_∑ge_gë_io_fix
(
b∑ge
);

2942 
	`muãx_exô
(
block_muãx
);

2944 i‡(
io_fix
 =
BUF_IO_READ
) {

2945 
	`os_thªad_¶ìp
(
WAIT_FOR_READ
);

2952 #ifde‡
UNIV_IBUF_COUNT_DEBUG


2953 
	`ut_a
(
	`ibuf_cou¡_gë
(
∑ge_id
) == 0);

2956  (
b∑ge
);

2957 
	}
}

2960 
UNIV_INLINE


2961 
	$buf_block_öô_low
(
buf_block_t
 *
block
)

2965 
	`as£π_block_ahi_em±y_⁄_öô
(
block
);

2966 
block
->
ödex
 = 
NULL
;

2967 
block
->
made_dúty_wôh_no_œtch
 = 
Ál£
;

2969 
block
->
n_hash_hñps
 = 0;

2970 
block
->
n_fõlds
 = 1;

2971 
block
->
n_byãs
 = 0;

2972 
block
->
À·_side
 = 
TRUE
;

2973 
	}
}

2978 
iboﬁ
 
	$buf_zù_decom¥ess
(
buf_block_t
 *
block
,

2979 
iboﬁ
 
check
)

2981 c⁄° 
byã
 *
‰ame
 = 
block
->
∑ge
.
zù
.
d©a
;

2983 
	`ut_ad
(
block
->
∑ge
.
size
.
	`is_com¥es£d
());

2984 
	`ut_a
(
block
->
∑ge
.
id
.
	`•a˚
() != 0);

2986 
BlockRï‹ãr
 
com¥es£d
 =

2987 
	`BlockRï‹ãr
(
Ál£
, 
‰ame
, 
block
->
∑ge
.
size
, false);

2989 i‡(
check
 && !
com¥es£d
.
	`vîify_zù_checksum
()) {

2990 
ib
::
	`îr‹
(
ER_IB_MSG_71
)

2991 << "Com¥es£dÖagêchecksum mism©ch " << 
block
->
∑ge
.
id


2992 << "): st‹ed: " << 
	`mach_ªad_‰om_4
(
‰ame
 + 
FIL_PAGE_SPACE_OR_CHKSUM
)

2994 << 
com¥es£d
.
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_CRC32
) << "/"

2995 << 
com¥es£d
.
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_CRC32
, 
åue
)

2997 << 
com¥es£d
.
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_INNODB
)

2999 << 
com¥es£d
.
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_NONE
);

3001  (
FALSE
);

3004 
	`fû_∑ge_gë_ty≥
(
‰ame
)) {

3005 
FIL_PAGE_INDEX
:

3006 
FIL_PAGE_SDI
:

3007 
FIL_PAGE_RTREE
:

3008 i‡(
	`∑ge_zù_decom¥ess
(&
block
->
∑ge
.
zù
, block->
‰ame
, 
TRUE
)) {

3009  (
TRUE
);

3012 
ib
::
	`îr‹
(
ER_IB_MSG_72
)

3013 << "U«bÀÅÿdecom¥es†•a˚ " << 
block
->
∑ge
.
id
.
	`•a˚
() << "Öage "

3014 << 
block
->
∑ge
.
id
.
	`∑ge_no
();

3016  (
FALSE
);

3018 
FIL_PAGE_TYPE_ALLOCATED
:

3019 
FIL_PAGE_INODE
:

3020 
FIL_PAGE_IBUF_BITMAP
:

3021 
FIL_PAGE_TYPE_FSP_HDR
:

3022 
FIL_PAGE_TYPE_XDES
:

3023 
FIL_PAGE_TYPE_ZBLOB
:

3024 
FIL_PAGE_TYPE_ZBLOB2
:

3025 
FIL_PAGE_SDI_ZBLOB
:

3026 
FIL_PAGE_TYPE_ZLOB_FIRST
:

3027 
FIL_PAGE_TYPE_ZLOB_DATA
:

3028 
FIL_PAGE_TYPE_ZLOB_INDEX
:

3029 
FIL_PAGE_TYPE_ZLOB_FRAG
:

3030 
FIL_PAGE_TYPE_ZLOB_FRAG_ENTRY
:

3032 
	`mem˝y
(
block
->
‰ame
, føme, block->
∑ge
.
size
.
	`physiˇl
());

3033  (
TRUE
);

3036 
ib
::
	`îr‹
(
ER_IB_MSG_73
) << "Unknown compressedÖageÅype "

3037 << 
	`fû_∑ge_gë_ty≥
(
‰ame
);

3039  (
FALSE
);

3040 
	}
}

3042 #i‚de‡
UNIV_HOTBACKUP


3047 
buf_block_t
 *
	$buf_block_‰om_ahi
(c⁄° 
byã
 *
±r
) {

3048 
buf_poﬁ_chunk_m≠_t
::
ôî©‹
 
ô
;

3050 
buf_poﬁ_chunk_m≠_t
 *
chunk_m≠
 = 
buf_chunk_m≠_ªg
;

3051 
	`ut_ad
(!
buf_poﬁ_ªsizög
);

3053 
buf_chunk_t
 *
chunk
;

3054 
ô
 = 
chunk_m≠
->
	`uµî_bound
(
±r
);

3056 
	`ut_a
(
ô
 !
chunk_m≠
->
	`begö
());

3058 i‡(
ô
 =
chunk_m≠
->
	`íd
()) {

3059 
chunk
 = 
chunk_m≠
->
	`rbegö
()->
£c⁄d
;

3061 
chunk
 = (--
ô
)->
£c⁄d
;

3064 
ulöt
 
offs
 = 
±r
 - 
chunk
->
blocks
->
‰ame
;

3066 
offs
 >>
UNIV_PAGE_SIZE_SHIFT
;

3068 
	`ut_a
(
offs
 < 
chunk
->
size
);

3070 
buf_block_t
 *
block
 = &
chunk
->
blocks
[
offs
];

3074 
	`ut_ad
(
block
->
‰ame
 =
	`∑ge_Æign
(
±r
));

3078 
	`ut_d
(c⁄° 
buf_∑ge_°©e
 
°©e
 = 
	`buf_block_gë_°©e
(
block
));

3079 
	`ut_ad
(
°©e
 =
BUF_BLOCK_FILE_PAGE
 || sèã =
BUF_BLOCK_REMOVE_HASH
);

3080  (
block
);

3081 
	}
}

3087 
iboﬁ
 
	$buf_poöãr_is_block_fõld_ö°™˚
(

3088 
buf_poﬁ_t
 *
buf_poﬁ
,

3089 c⁄° *
±r
)

3091 c⁄° 
buf_chunk_t
 *
chunk
 = 
buf_poﬁ
->
chunks
;

3092 c⁄° 
buf_chunk_t
 *c⁄° 
echunk
 =

3093 
chunk
 + 
	`ut_mö
(
buf_poﬁ
->
n_chunks
, buf_poﬁ->
n_chunks_√w
);

3097 
chunk
 < 
echunk
) {

3098 i‡(
±r
 >(*)
chunk
->
blocks
 &&

3099 
±r
 < (*)(
chunk
->
blocks
 + chunk->
size
)) {

3100  (
TRUE
);

3103 
chunk
++;

3106  (
FALSE
);

3107 
	}
}

3111 
iboﬁ
 
	$buf_block_is_uncom¥es£d
(

3112 
buf_poﬁ_t
 *
buf_poﬁ
,

3113 c⁄° 
buf_block_t
 *
block
)

3116 i‡((((
ulöt
)
block
) %  *block) != 0) {

3118  (
FALSE
);

3121  (
	`buf_poöãr_is_block_fõld_ö°™˚
(
buf_poﬁ
, (*)
block
));

3122 
	}
}

3124 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_IBUF_DEBUG


3127 
boﬁ
 
	$buf_debug_execuã_is_f‹˚_Êush
() {

3128 
	`DBUG_EXECUTE_IF
("ib_buf_f‹˚_Êush",  (
åue
););

3133 i‡(
§v_ibuf_dißbÀ_background_mîge
) {

3134  (
åue
);

3137  (
Ál£
);

3138 
	}
}

3143 
	$buf_waô_f‹_ªad
(
buf_block_t
 *
block
) {

3152 i‡(
	`buf_block_gë_io_fix_u∆ocked
(
block
Ë=
BUF_IO_READ
) {

3155 i‡(
	`buf_block_gë_io_fix_u∆ocked
(
block
Ë=
BUF_IO_READ
) {

3157 
	`rw_lock_s_lock
(&
block
->
lock
);

3158 
	`rw_lock_s_u∆ock
(&
block
->
lock
);

3164 
	}
}

3180 
buf_block_t
 *
	$buf_∑ge_gë_gí
(c⁄° 
∑ge_id_t
 &
∑ge_id
,

3181 c⁄° 
∑ge_size_t
 &
∑ge_size
, 
ulöt
 
rw_œtch
,

3182 
buf_block_t
 *
guess
, 
ulöt
 
mode
, c⁄° *
fûe
,

3183 
ulöt
 
löe
, 
må_t
 *
må
,

3184 
boﬁ
 
dúty_wôh_no_œtch
) {

3185 
buf_block_t
 *
block
;

3186 
ac˚ss_time
;

3187 
rw_lock_t
 *
hash_lock
;

3188 
buf_block_t
 *
fix_block
;

3189 
ulöt
 
ªåõs
 = 0;

3190 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

3192 
	`ut_ad
(
må
->
	`is_a˘ive
());

3193 
	`ut_ad
((
rw_œtch
 =
RW_S_LATCH
Ë|| (rw_œtch =
RW_X_LATCH
) ||

3194 (
rw_œtch
 =
RW_SX_LATCH
Ë|| (rw_œtch =
RW_NO_LATCH
));

3195 #ifde‡
UNIV_DEBUG


3196 
mode
) {

3197 
BUF_GET_NO_LATCH
:

3198 
	`ut_ad
(
rw_œtch
 =
RW_NO_LATCH
);

3200 
BUF_GET
:

3201 
BUF_GET_IF_IN_POOL
:

3202 
BUF_PEEK_IF_IN_POOL
:

3203 
BUF_GET_IF_IN_POOL_OR_WATCH
:

3204 
BUF_GET_POSSIBLY_FREED
:

3207 
ut_îr‹
;

3210 
boﬁ
 
found
;

3211 c⁄° 
∑ge_size_t
 &
•a˚_∑ge_size
 =

3212 
	`fû_•a˚_gë_∑ge_size
(
∑ge_id
.
	`•a˚
(), &
found
);

3214 
	`ut_ad
(
found
);

3216 
	`ut_ad
(
∑ge_size
.
	`equÆs_to
(
•a˚_∑ge_size
));

3219 
	`ut_ad
(!
	`ibuf_öside
(
må
) ||

3220 
	`ibuf_∑ge_low
(
∑ge_id
, 
∑ge_size
, 
FALSE
, 
fûe
, 
löe
, 
NULL
));

3222 
buf_poﬁ
->
°©
.
n_∑ge_gës
++;

3223 
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
);

3224 
lo›
:

3225 
block
 = 
guess
;

3227 
	`rw_lock_s_lock
(
hash_lock
);

3230 
hash_lock
 = 
	`buf_∑ge_hash_lock_s_c⁄fúm
(hash_lock, 
buf_poﬁ
, 
∑ge_id
);

3232 i‡(
block
 !
NULL
) {

3237 i‡(!
	`buf_block_is_uncom¥es£d
(
buf_poﬁ
, 
block
) ||

3238 !
∑ge_id
.
	`equÆs_to
(
block
->
∑ge
.
id
) ||

3239 
	`buf_block_gë_°©e
(
block
Ë!
BUF_BLOCK_FILE_PAGE
) {

3242 
block
 = 
guess
 = 
NULL
;

3244 
	`ut_ad
(!
block
->
∑ge
.
ö_zù_hash
);

3248 i‡(
block
 =
NULL
) {

3249 
block
 = (
buf_block_t
 *)
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
);

3252 i‡(!
block
 || 
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, &block->
∑ge
)) {

3253 
	`rw_lock_s_u∆ock
(
hash_lock
);

3254 
block
 = 
NULL
;

3257 i‡(
block
 =
NULL
) {

3260 i‡(
mode
 =
BUF_GET_IF_IN_POOL_OR_WATCH
) {

3261 
	`rw_lock_x_lock
(
hash_lock
);

3265 
hash_lock
 = 
	`buf_∑ge_hash_lock_x_c⁄fúm
(hash_lock, 
buf_poﬁ
, 
∑ge_id
);

3267 
block
 = (
buf_block_t
 *)
	`buf_poﬁ_w©ch_£t
(
∑ge_id
, &
hash_lock
);

3269 i‡(
block
) {

3273 
fix_block
 = 
block
;

3275 i‡(
	`f•_is_sy°em_ãmp‹¨y
(
∑ge_id
.
	`•a˚
())) {

3284 
BPageMuãx
 *
fix_muãx
 = 
	`buf_∑ge_gë_muãx
(&
fix_block
->
∑ge
);

3285 
	`muãx_íãr
(
fix_muãx
);

3286 
	`buf_block_fix
(
fix_block
);

3287 
	`muãx_exô
(
fix_muãx
);

3289 
	`buf_block_fix
(
fix_block
);

3293 
	`rw_lock_x_u∆ock
(
hash_lock
);

3294 
gŸ_block
;

3297 
	`rw_lock_x_u∆ock
(
hash_lock
);

3300 i‡(
mode
 =
BUF_GET_IF_IN_POOL
 || modê=
BUF_PEEK_IF_IN_POOL
 ||

3301 
mode
 =
BUF_GET_IF_IN_POOL_OR_WATCH
) {

3302 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
));

3303 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_S
));

3305  (
NULL
);

3308 i‡(
	`buf_ªad_∑ge
(
∑ge_id
, 
∑ge_size
)) {

3309 
	`buf_ªad_ahód_øndom
(
∑ge_id
, 
∑ge_size
, 
	`ibuf_öside
(
må
));

3311 
ªåõs
 = 0;

3312 } i‡(
ªåõs
 < 
BUF_PAGE_READ_MAX_RETRIES
) {

3313 ++
ªåõs
;

3314 
	`DBUG_EXECUTE_IF
("innodb_page_corruption_retries",

3315 
ªåõs
 = 
BUF_PAGE_READ_MAX_RETRIES
;);

3317 
ib
::
	`Áèl
(
ER_IB_MSG_74
)

3318 << "U«bÀÅÿªadÖagê" << 
∑ge_id
 << " intoÅhe bufferÖooláfter "

3319 << 
BUF_PAGE_READ_MAX_RETRIES


3328 " PÀa£ sì " 
REFMAN


3333 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


3334 
	`ut_a
(
	`f•_skù_ßnôy_check
(
∑ge_id
.
	`•a˚
()Ë|| ++
buf_dbg_cou¡î
 % 5771 ||

3335 
	`buf_vÆid©e
());

3337 
lo›
;

3339 
fix_block
 = 
block
;

3342 i‡(
	`f•_is_sy°em_ãmp‹¨y
(
∑ge_id
.
	`•a˚
())) {

3347 
BPageMuãx
 *
fix_muãx
 = 
	`buf_∑ge_gë_muãx
(&
fix_block
->
∑ge
);

3348 
	`muãx_íãr
(
fix_muãx
);

3349 
	`buf_block_fix
(
fix_block
);

3350 
	`muãx_exô
(
fix_muãx
);

3352 
	`buf_block_fix
(
fix_block
);

3356 
	`rw_lock_s_u∆ock
(
hash_lock
);

3358 
gŸ_block
:

3359 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_IBUF_DEBUG


3360 
BPageMuãx
 *
fix_muãx
 = 
	`buf_∑ge_gë_muãx
(&
fix_block
->
∑ge
);

3363 i‡(
mode
 =
BUF_GET_IF_IN_POOL
 || modê=
BUF_PEEK_IF_IN_POOL
) {

3364 
buf_∑ge_t
 *
fix_∑ge
 = &
fix_block
->
∑ge
;

3365 
BPageMuãx
 *
fix_muãx
 = 
	`buf_∑ge_gë_muãx
(
fix_∑ge
);

3367 
	`muãx_íãr
(
fix_muãx
);

3368 c⁄° 
boﬁ
 
mu°_ªad
 =

3369 (
	`buf_∑ge_gë_io_fix_u∆ocked
(
fix_∑ge
Ë=
BUF_IO_READ
);

3370 
	`muãx_exô
(
fix_muãx
);

3372 i‡(
mu°_ªad
) {

3376 
	`buf_block_unfix
(
fix_block
);

3378  (
NULL
);

3382 
	`buf_block_gë_°©e
(
fix_block
)) {

3383 
buf_∑ge_t
 *
b∑ge
;

3385 
BUF_BLOCK_FILE_PAGE
:

3386 
	`ut_ad
(
fix_muãx
 !&
buf_poﬁ
->
zù_muãx
);

3387 
b∑ge
 = &
block
->
∑ge
;

3388 i‡(
	`f•_is_sy°em_ãmp‹¨y
(
∑ge_id
.
	`•a˚
()) &&

3389 
	`buf_∑ge_gë_io_fix_u∆ocked
(
b∑ge
Ë!
BUF_IO_NONE
) {

3395 
	`buf_block_unfix
(
fix_block
);

3396 
	`os_thªad_¶ìp
(
WAIT_FOR_WRITE
);

3397 
lo›
;

3401 
BUF_BLOCK_ZIP_PAGE
:

3402 
BUF_BLOCK_ZIP_DIRTY
:

3403 i‡(
mode
 =
BUF_PEEK_IF_IN_POOL
) {

3408 
	`buf_block_unfix
(
fix_block
);

3410  (
NULL
);

3413 
b∑ge
 = &
block
->
∑ge
;

3414 
	`ut_ad
(
fix_muãx
 =&
buf_poﬁ
->
zù_muãx
);

3417 i‡(
b∑ge
->
buf_fix_cou¡
 > 1 ||

3418 
	`buf_∑ge_gë_io_fix_u∆ocked
(
b∑ge
Ë!
BUF_IO_NONE
) {

3422 
	`buf_block_unfix
(
fix_block
);

3426 
	`os_thªad_¶ìp
(
WAIT_FOR_READ
);

3428 
lo›
;

3435 
block
 = 
	`buf_LRU_gë_‰ì_block
(
buf_poﬁ
);

3437 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

3440 
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
);

3442 
	`rw_lock_x_lock
(
hash_lock
);

3445 
	`ut_ad
(
b∑ge
 =
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
));

3447 
	`buf_block_unfix
(
fix_block
);

3449 
	`buf_∑ge_muãx_íãr
(
block
);

3450 
	`muãx_íãr
(&
buf_poﬁ
->
zù_muãx
);

3452 
fix_block
 = 
block
;

3454 i‡(
b∑ge
->
buf_fix_cou¡
 > 0 ||

3455 
	`buf_∑ge_gë_io_fix
(
b∑ge
Ë!
BUF_IO_NONE
) {

3456 
	`muãx_exô
(&
buf_poﬁ
->
zù_muãx
);

3463 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

3464 
	`rw_lock_x_u∆ock
(
hash_lock
);

3465 
	`buf_∑ge_muãx_exô
(
block
);

3466 
	`buf_LRU_block_‰ì_n⁄_fûe_∑ge
(
block
);

3469 
lo›
;

3478 
	`buf_ªloˇã
(
b∑ge
, &
block
->
∑ge
);

3480 
	`buf_block_öô_low
(
block
);

3483 
block
->
∑ge
.
buf_fix_cou¡
 = 1;

3485 
block
->
lock_hash_vÆ
 = 
	`lock_ªc_hash
(
∑ge_id
.
	`•a˚
(),Öage_id.
	`∑ge_no
());

3487 
	`UNIV_MEM_DESC
(&
block
->
∑ge
.
zù
.
d©a
, 
	`∑ge_zù_gë_size
(&block->page.zip));

3489 i‡(
	`buf_∑ge_gë_°©e
(&
block
->
∑ge
Ë=
BUF_BLOCK_ZIP_PAGE
) {

3490 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


3491 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
zù_˛ón
, &
block
->
∑ge
);

3493 
	`ut_ad
(!
block
->
∑ge
.
ö_Êush_li°
);

3496 
	`buf_Êush_ªloˇã_⁄_Êush_li°
(
b∑ge
, &
block
->
∑ge
);

3502 
block
->
∑ge
.
°©e
 = 
BUF_BLOCK_FILE_PAGE
;

3505 
	`buf_unzù_LRU_add_block
(
block
, 
FALSE
);

3507 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

3509 
	`buf_block_£t_io_fix
(
block
, 
BUF_IO_READ
);

3510 
	`rw_lock_x_lock_ölöe
(&
block
->
lock
, 0, 
fûe
, 
löe
);

3512 
	`UNIV_MEM_INVALID
(
b∑ge
,  *bpage);

3514 
	`rw_lock_x_u∆ock
(
hash_lock
);

3515 
	`muãx_exô
(&
buf_poﬁ
->
zù_muãx
);

3517 
ac˚ss_time
 = 
	`buf_∑ge_is_ac˚s£d
(&
block
->
∑ge
);

3519 
	`buf_∑ge_muãx_exô
(
block
);

3521 
	`os_©omic_ö¸emít_ulöt
(&
buf_poﬁ
->
n_≥nd_unzù
, 1);

3523 
	`buf_∑ge_‰ì_des¸ùt‹
(
b∑ge
);

3532 
boﬁ
 
suc˚ss
 = 
	`buf_zù_decom¥ess
(
block
, 
FALSE
);

3533 
	`ut_a
(
suc˚ss
);

3536 i‡(!
ªcv_no_ibuf_›î©i⁄s
) {

3537 i‡(
ac˚ss_time
) {

3538 #ifde‡
UNIV_IBUF_COUNT_DEBUG


3539 
	`ut_a
(
	`ibuf_cou¡_gë
(
∑ge_id
) == 0);

3542 
	`ibuf_mîge_‹_dñëe_f‹_∑ge
(
block
, 
∑ge_id
, &
∑ge_size
, 
TRUE
);

3546 
	`buf_∑ge_muãx_íãr
(
fix_block
);

3548 
	`buf_block_£t_io_fix
(
fix_block
, 
BUF_IO_NONE
);

3550 
	`buf_∑ge_muãx_exô
(
fix_block
);

3552 
	`os_©omic_de¸emít_ulöt
(&
buf_poﬁ
->
n_≥nd_unzù
, 1);

3554 
	`rw_lock_x_u∆ock
(&
block
->
lock
);

3558 
BUF_BLOCK_POOL_WATCH
:

3559 
BUF_BLOCK_NOT_USED
:

3560 
BUF_BLOCK_READY_FOR_USE
:

3561 
BUF_BLOCK_MEMORY
:

3562 
BUF_BLOCK_REMOVE_HASH
:

3563 
ut_îr‹
;

3567 
	`ut_ad
(
block
 =
fix_block
);

3568 
	`ut_ad
(
fix_block
->
∑ge
.
buf_fix_cou¡
 > 0);

3570 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
));

3571 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_S
));

3573 
	`ut_ad
(
	`buf_block_gë_°©e
(
fix_block
Ë=
BUF_BLOCK_FILE_PAGE
);

3575 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_IBUF_DEBUG


3577 i‡((
mode
 =
BUF_GET_IF_IN_POOL
 || modê=
BUF_GET_IF_IN_POOL_OR_WATCH
) &&

3578 (
ibuf_debug
 || 
	`buf_debug_execuã_is_f‹˚_Êush
())) {

3582 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

3584 
	`buf_block_unfix
(
fix_block
);

3591 
fix_muãx
 = 
	`buf_∑ge_gë_muãx
(&
fix_block
->
∑ge
);

3592 
	`muãx_íãr
(
fix_muãx
);

3594 i‡(
	`buf_LRU_‰ì_∑ge
(&
fix_block
->
∑ge
, 
åue
)) {

3597 
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
);

3598 
	`rw_lock_x_lock
(
hash_lock
);

3602 
hash_lock
 = 
	`buf_∑ge_hash_lock_x_c⁄fúm
(hash_lock, 
buf_poﬁ
, 
∑ge_id
);

3604 i‡(
mode
 =
BUF_GET_IF_IN_POOL_OR_WATCH
) {

3608 
block
 = (
buf_block_t
 *)
	`buf_poﬁ_w©ch_£t
(
∑ge_id
, &
hash_lock
);

3610 
block
 = (
buf_block_t
 *)
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
);

3613 
	`rw_lock_x_u∆ock
(
hash_lock
);

3615 i‡(
block
 !
NULL
) {

3621 
guess
 = 
block
;

3623 
lo›
;

3626 
ib
::
	`öfo
(
ER_IB_MSG_75
)

3627 << "önodb_ch™ge_buf„rög_debugÉvi˘ " << 
∑ge_id
;

3629  (
NULL
);

3632 i‡(
	`buf_Êush_∑ge_åy
(
buf_poﬁ
, 
fix_block
)) {

3633 
ib
::
	`öfo
(
ER_IB_MSG_76
)

3634 << "önodb_ch™ge_buf„rög_debug flush " << 
∑ge_id
;

3636 
guess
 = 
fix_block
;

3638 
lo›
;

3641 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

3643 
	`buf_block_fix
(
fix_block
);

3645 
	`buf_∑ge_muãx_exô
(
fix_block
);

3651 
	`ut_ad
(
fix_block
->
∑ge
.
buf_fix_cou¡
 > 0);

3653 #ifde‡
UNIV_DEBUG


3658 i‡(!
	`f•_is_sy°em_ãmp‹¨y
(
∑ge_id
.
	`•a˚
())) {

3659 
iboﬁ
 
ªt
;

3660 
ªt
 = 
	`rw_lock_s_lock_nowaô
(&
fix_block
->
debug_œtch
, 
fûe
, 
löe
);

3661 
	`ut_a
(
ªt
);

3665 
	`ut_ad
(
mode
 =
BUF_GET_POSSIBLY_FREED
 || !
fix_block
->
∑ge
.
fûe_∑ge_was_‰ìd
);

3668 
ac˚ss_time
 = 
	`buf_∑ge_is_ac˚s£d
(&
fix_block
->
∑ge
);

3671 i‡(
ac˚ss_time
 == 0) {

3672 
	`buf_∑ge_muãx_íãr
(
fix_block
);

3674 
	`buf_∑ge_£t_ac˚s£d
(&
fix_block
->
∑ge
);

3676 
	`buf_∑ge_muãx_exô
(
fix_block
);

3679 i‡(
mode
 !
BUF_PEEK_IF_IN_POOL
) {

3680 
	`buf_∑ge_make_young_if_√eded
(&
fix_block
->
∑ge
);

3683 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


3684 
	`ut_a
(
	`f•_skù_ßnôy_check
(
∑ge_id
.
	`•a˚
()Ë|| ++
buf_dbg_cou¡î
 % 5771 ||

3685 
	`buf_vÆid©e
());

3686 
	`ut_a
(
	`buf_block_gë_°©e
(
fix_block
Ë=
BUF_BLOCK_FILE_PAGE
);

3692 
	`buf_waô_f‹_ªad
(
fix_block
);

3701 i‡(
dúty_wôh_no_œtch
) {

3702 
fix_block
->
made_dúty_wôh_no_œtch
 = 
dúty_wôh_no_œtch
;

3705 
må_memo_ty≥_t
 
fix_ty≥
;

3707 
rw_œtch
) {

3708 
RW_NO_LATCH
:

3710 
fix_ty≥
 = 
MTR_MEMO_BUF_FIX
;

3713 
RW_S_LATCH
:

3714 
	`rw_lock_s_lock_ölöe
(&
fix_block
->
lock
, 0, 
fûe
, 
löe
);

3716 
fix_ty≥
 = 
MTR_MEMO_PAGE_S_FIX
;

3719 
RW_SX_LATCH
:

3720 
	`rw_lock_sx_lock_ölöe
(&
fix_block
->
lock
, 0, 
fûe
, 
löe
);

3722 
fix_ty≥
 = 
MTR_MEMO_PAGE_SX_FIX
;

3726 
	`ut_ad
(
rw_œtch
 =
RW_X_LATCH
);

3727 
	`rw_lock_x_lock_ölöe
(&
fix_block
->
lock
, 0, 
fûe
, 
löe
);

3729 
fix_ty≥
 = 
MTR_MEMO_PAGE_X_FIX
;

3733 
	`må_memo_push
(
må
, 
fix_block
, 
fix_ty≥
);

3735 i‡(
mode
 !
BUF_PEEK_IF_IN_POOL
 && !
ac˚ss_time
) {

3739 
	`buf_ªad_ahód_löór
(
∑ge_id
, 
∑ge_size
, 
	`ibuf_öside
(
må
));

3742 #ifde‡
UNIV_IBUF_COUNT_DEBUG


3743 
	`ut_a
(
	`ibuf_cou¡_gë
(
fix_block
->
∑ge
.
id
) == 0);

3746 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
));

3747 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_S
));

3749  (
fix_block
);

3750 
	}
}

3755 
iboﬁ
 
	$buf_∑ge_›timi°ic_gë
(

3756 
ulöt
 
rw_œtch
,

3757 
buf_block_t
 *
block
,

3758 
ib_uöt64_t
 
modify_˛ock
,

3759 c⁄° *
fûe
,

3760 
ulöt
 
löe
,

3761 
må_t
 *
må
)

3763 
buf_poﬁ_t
 *
buf_poﬁ
;

3764 
ac˚ss_time
;

3765 
iboﬁ
 
suc˚ss
;

3767 
	`ut_ad
(
block
);

3768 
	`ut_ad
(
må
);

3769 
	`ut_ad
(
må
->
	`is_a˘ive
());

3770 
	`ut_ad
((
rw_œtch
 =
RW_S_LATCH
Ë|| (rw_œtch =
RW_X_LATCH
));

3772 
	`buf_∑ge_muãx_íãr
(
block
);

3774 i‡(
	`buf_block_gë_°©e
(
block
Ë!
BUF_BLOCK_FILE_PAGE
) {

3775 
	`buf_∑ge_muãx_exô
(
block
);

3777  (
FALSE
);

3780 
	`buf_block_buf_fix_öc
(
block
, 
fûe
, 
löe
);

3782 
ac˚ss_time
 = 
	`buf_∑ge_is_ac˚s£d
(&
block
->
∑ge
);

3784 
	`buf_∑ge_£t_ac˚s£d
(&
block
->
∑ge
);

3786 
	`buf_∑ge_muãx_exô
(
block
);

3788 
	`buf_∑ge_make_young_if_√eded
(&
block
->
∑ge
);

3790 
	`ut_ad
(!
	`ibuf_öside
(
må
Ë|| 
	`ibuf_∑ge
(
block
->
∑ge
.
id
, block->∑ge.
size
, 
NULL
));

3792 
må_memo_ty≥_t
 
fix_ty≥
;

3794 
rw_œtch
) {

3795 
RW_S_LATCH
:

3796 
suc˚ss
 = 
	`rw_lock_s_lock_nowaô
(&
block
->
lock
, 
fûe
, 
löe
);

3798 
fix_ty≥
 = 
MTR_MEMO_PAGE_S_FIX
;

3800 
RW_X_LATCH
:

3801 
suc˚ss
 = 
	`rw_lock_x_lock_func_nowaô_ölöe
(&
block
->
lock
, 
fûe
, 
löe
);

3803 
fix_ty≥
 = 
MTR_MEMO_PAGE_X_FIX
;

3806 
ut_îr‹
;

3809 i‡(!
suc˚ss
) {

3810 
	`buf_∑ge_muãx_íãr
(
block
);

3811 
	`buf_block_buf_fix_dec
(
block
);

3812 
	`buf_∑ge_muãx_exô
(
block
);

3814  (
FALSE
);

3817 i‡(
modify_˛ock
 !
block
->modify_clock) {

3818 
	`buf_block_dbg_add_Àvñ
(
block
, 
SYNC_NO_ORDER_CHECK
);

3820 i‡(
rw_œtch
 =
RW_S_LATCH
) {

3821 
	`rw_lock_s_u∆ock
(&
block
->
lock
);

3823 
	`rw_lock_x_u∆ock
(&
block
->
lock
);

3826 
	`buf_∑ge_muãx_íãr
(
block
);

3827 
	`buf_block_buf_fix_dec
(
block
);

3828 
	`buf_∑ge_muãx_exô
(
block
);

3830  (
FALSE
);

3833 
	`må_memo_push
(
må
, 
block
, 
fix_ty≥
);

3835 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


3836 
	`ut_a
(
	`f•_skù_ßnôy_check
(
block
->
∑ge
.
id
.
	`•a˚
()) ||

3837 ++
buf_dbg_cou¡î
 % 5771 || 
	`buf_vÆid©e
());

3838 
	`ut_a
(
block
->
∑ge
.
buf_fix_cou¡
 > 0);

3839 
	`ut_a
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

3842 
	`ut_d
(
	`buf_∑ge_muãx_íãr
(
block
));

3843 
	`ut_ad
(!
block
->
∑ge
.
fûe_∑ge_was_‰ìd
);

3844 
	`ut_d
(
	`buf_∑ge_muãx_exô
(
block
));

3846 i‡(!
ac˚ss_time
) {

3849 
	`buf_ªad_ahód_löór
(
block
->
∑ge
.
id
, block->∑ge.
size
, 
	`ibuf_öside
(
må
));

3852 #ifde‡
UNIV_IBUF_COUNT_DEBUG


3853 
	`ut_a
(
	`ibuf_cou¡_gë
(
block
->
∑ge
.
id
) == 0);

3856 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_block
(
block
);

3857 
buf_poﬁ
->
°©
.
n_∑ge_gës
++;

3859  (
TRUE
);

3860 
	}
}

3866 
iboﬁ
 
	$buf_∑ge_gë_known_nowaô
(

3867 
ulöt
 
rw_œtch
,

3868 
buf_block_t
 *
block
,

3869 
ulöt
 
mode
,

3870 c⁄° *
fûe
,

3871 
ulöt
 
löe
,

3872 
må_t
 *
må
)

3874 
buf_poﬁ_t
 *
buf_poﬁ
;

3875 
iboﬁ
 
suc˚ss
;

3877 
	`ut_ad
(
må
->
	`is_a˘ive
());

3878 
	`ut_ad
((
rw_œtch
 =
RW_S_LATCH
Ë|| (rw_œtch =
RW_X_LATCH
));

3880 
	`buf_∑ge_muãx_íãr
(
block
);

3882 i‡(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_REMOVE_HASH
) {

3890 
	`buf_∑ge_muãx_exô
(
block
);

3892  (
FALSE
);

3895 
	`ut_a
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

3897 
	`buf_block_buf_fix_öc
(
block
, 
fûe
, 
löe
);

3899 
	`buf_∑ge_£t_ac˚s£d
(&
block
->
∑ge
);

3901 
	`buf_∑ge_muãx_exô
(
block
);

3903 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_block
(
block
);

3905 i‡(
mode
 =
BUF_MAKE_YOUNG
) {

3906 
	`buf_∑ge_make_young_if_√eded
(&
block
->
∑ge
);

3909 
	`ut_ad
(!
	`ibuf_öside
(
må
Ë|| 
mode
 =
BUF_KEEP_OLD
);

3911 
må_memo_ty≥_t
 
fix_ty≥
;

3913 
rw_œtch
) {

3914 
RW_S_LATCH
:

3915 
suc˚ss
 = 
	`rw_lock_s_lock_nowaô
(&
block
->
lock
, 
fûe
, 
löe
);

3916 
fix_ty≥
 = 
MTR_MEMO_PAGE_S_FIX
;

3918 
RW_X_LATCH
:

3919 
suc˚ss
 = 
	`rw_lock_x_lock_func_nowaô_ölöe
(&
block
->
lock
, 
fûe
, 
löe
);

3921 
fix_ty≥
 = 
MTR_MEMO_PAGE_X_FIX
;

3924 
ut_îr‹
;

3927 i‡(!
suc˚ss
) {

3928 
	`buf_∑ge_muãx_íãr
(
block
);

3929 
	`buf_block_buf_fix_dec
(
block
);

3930 
	`buf_∑ge_muãx_exô
(
block
);

3932  (
FALSE
);

3935 
	`må_memo_push
(
må
, 
block
, 
fix_ty≥
);

3937 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


3938 
	`ut_a
(++
buf_dbg_cou¡î
 % 5771 || 
	`buf_vÆid©e
());

3939 
	`ut_a
(
block
->
∑ge
.
buf_fix_cou¡
 > 0);

3940 
	`ut_a
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

3943 #ifde‡
UNIV_DEBUG


3944 i‡(
mode
 !
BUF_KEEP_OLD
) {

3952 
	`buf_∑ge_muãx_íãr
(
block
);

3953 
	`ut_a
(!
block
->
∑ge
.
fûe_∑ge_was_‰ìd
);

3954 
	`buf_∑ge_muãx_exô
(
block
);

3958 #ifde‡
UNIV_IBUF_COUNT_DEBUG


3959 
	`ut_a
((
mode
 =
BUF_KEEP_OLD
Ë|| 
	`ibuf_cou¡_gë
(
block
->
∑ge
.
id
) == 0);

3961 
buf_poﬁ
->
°©
.
n_∑ge_gës
++;

3963  (
TRUE
);

3964 
	}
}

3974 c⁄° 
buf_block_t
 *
	$buf_∑ge_åy_gë_func
(c⁄° 
∑ge_id_t
 &
∑ge_id
,

3975 c⁄° *
fûe
, 
ulöt
 
löe
,

3976 
må_t
 *
må
) {

3977 
buf_block_t
 *
block
;

3978 
iboﬁ
 
suc˚ss
;

3979 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

3980 
rw_lock_t
 *
hash_lock
;

3982 
	`ut_ad
(
må
);

3983 
	`ut_ad
(
må
->
	`is_a˘ive
());

3985 
block
 = 
	`buf_block_hash_gë_s_locked
(
buf_poﬁ
, 
∑ge_id
, &
hash_lock
);

3987 i‡(!
block
 || 
	`buf_block_gë_°©e
(blockË!
BUF_BLOCK_FILE_PAGE
) {

3988 i‡(
block
) {

3989 
	`rw_lock_s_u∆ock
(
hash_lock
);

3991  (
NULL
);

3994 
	`ut_ad
(!
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, &
block
->
∑ge
));

3996 
	`buf_∑ge_muãx_íãr
(
block
);

3997 
	`rw_lock_s_u∆ock
(
hash_lock
);

3999 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


4000 
	`ut_a
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

4001 
	`ut_a
(
∑ge_id
.
	`equÆs_to
(
block
->
∑ge
.
id
));

4004 
	`buf_block_buf_fix_öc
(
block
, 
fûe
, 
löe
);

4005 
	`buf_∑ge_muãx_exô
(
block
);

4007 
må_memo_ty≥_t
 
fix_ty≥
 = 
MTR_MEMO_PAGE_S_FIX
;

4008 
suc˚ss
 = 
	`rw_lock_s_lock_nowaô
(&
block
->
lock
, 
fûe
, 
löe
);

4010 i‡(!
suc˚ss
) {

4015 
fix_ty≥
 = 
MTR_MEMO_PAGE_X_FIX
;

4016 
suc˚ss
 = 
	`rw_lock_x_lock_func_nowaô_ölöe
(&
block
->
lock
, 
fûe
, 
löe
);

4019 i‡(!
suc˚ss
) {

4020 
	`buf_∑ge_muãx_íãr
(
block
);

4021 
	`buf_block_buf_fix_dec
(
block
);

4022 
	`buf_∑ge_muãx_exô
(
block
);

4024  (
NULL
);

4027 
	`må_memo_push
(
må
, 
block
, 
fix_ty≥
);

4029 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


4030 
	`ut_a
(
	`f•_skù_ßnôy_check
(
block
->
∑ge
.
id
.
	`•a˚
()) ||

4031 ++
buf_dbg_cou¡î
 % 5771 || 
	`buf_vÆid©e
());

4032 
	`ut_a
(
block
->
∑ge
.
buf_fix_cou¡
 > 0);

4033 
	`ut_a
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

4036 
	`ut_d
(
	`buf_∑ge_muãx_íãr
(
block
));

4037 
	`ut_d
(
	`ut_a
(!
block
->
∑ge
.
fûe_∑ge_was_‰ìd
));

4038 
	`ut_d
(
	`buf_∑ge_muãx_exô
(
block
));

4040 
	`buf_block_dbg_add_Àvñ
(
block
, 
SYNC_NO_ORDER_CHECK
);

4042 
buf_poﬁ
->
°©
.
n_∑ge_gës
++;

4044 #ifde‡
UNIV_IBUF_COUNT_DEBUG


4045 
	`ut_a
(
	`ibuf_cou¡_gë
(
block
->
∑ge
.
id
) == 0);

4048  (
block
);

4049 
	}
}

4052 
UNIV_INLINE


4053 
	$buf_∑ge_öô_low
(
buf_∑ge_t
 *
b∑ge
)

4055 
b∑ge
->
Êush_ty≥
 = 
BUF_FLUSH_LRU
;

4056 
b∑ge
->
io_fix
 = 
BUF_IO_NONE
;

4057 
b∑ge
->
buf_fix_cou¡
 = 0;

4058 
b∑ge
->
‰ìd_∑ge_˛ock
 = 0;

4059 
b∑ge
->
ac˚ss_time
 = 0;

4060 
b∑ge
->
√we°_modifiˇti⁄
 = 0;

4061 
b∑ge
->
ﬁde°_modifiˇti⁄
 = 0;

4062 
	`HASH_INVALIDATE
(
b∑ge
, 
hash
);

4064 
	`ut_d
(
b∑ge
->
fûe_∑ge_was_‰ìd
 = 
FALSE
);

4065 
	}
}

4073 
	$buf_∑ge_öô
(
buf_poﬁ_t
 *
buf_poﬁ
, c⁄° 
∑ge_id_t
 &
∑ge_id
,

4074 c⁄° 
∑ge_size_t
 &
∑ge_size
, 
buf_block_t
 *
block
) {

4075 
buf_∑ge_t
 *
hash_∑ge
;

4077 
	`ut_ad
(
buf_poﬁ
 =
	`buf_poﬁ_gë
(
∑ge_id
));

4079 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(&
block
->
∑ge
)));

4080 
	`ut_a
(
	`buf_block_gë_°©e
(
block
Ë!
BUF_BLOCK_FILE_PAGE
);

4082 
	`ut_ad
(
	`rw_lock_own
(
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
), 
RW_LOCK_X
));

4085 
	`buf_block_£t_fûe_∑ge
(
block
, 
∑ge_id
);

4087 #ifde‡
UNIV_DEBUG_VALGRIND


4088 i‡(
	`f•_is_sy°em_‹_ãmp_èbÀ•a˚
(
∑ge_id
.
	`•a˚
())) {

4092 
	`UNIV_MEM_VALID
(
block
->
‰ame
, 
UNIV_PAGE_SIZE
);

4096 
	`buf_block_öô_low
(
block
);

4098 
block
->
lock_hash_vÆ
 = 
	`lock_ªc_hash
(
∑ge_id
.
	`•a˚
(),Öage_id.
	`∑ge_no
());

4100 
	`buf_∑ge_öô_low
(&
block
->
∑ge
);

4104 
hash_∑ge
 = 
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
);

4106 i‡(
hash_∑ge
 =
NULL
) {

4108 } i‡(
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, 
hash_∑ge
)) {

4110 
ib_uöt32_t
 
buf_fix_cou¡
 = 
hash_∑ge
->buf_fix_count;

4112 
	`ut_a
(
buf_fix_cou¡
 > 0);

4114 
	`os_©omic_ö¸emít_uöt32
(&
block
->
∑ge
.
buf_fix_cou¡
, buf_fix_count);

4116 
	`buf_poﬁ_w©ch_ªmove
(
buf_poﬁ
, 
hash_∑ge
);

4118 
ib
::
	`îr‹
(
ER_IB_MSG_77
)

4119 << "Pagê" << 
∑ge_id


4120 << "áÃódy found i¿thêhashÅabÀ: " << 
hash_∑ge
 << ", " << 
block
;

4122 
	`ut_d
(
	`buf_¥öt
());

4123 
	`ut_d
(
	`buf_LRU_¥öt
());

4124 
	`ut_d
(
	`buf_vÆid©e
());

4125 
	`ut_d
(
	`buf_LRU_vÆid©e
());

4126 
	`ut_ad
(0);

4129 
	`ut_ad
(!
block
->
∑ge
.
ö_zù_hash
);

4130 
	`ut_ad
(!
block
->
∑ge
.
ö_∑ge_hash
);

4131 
	`ut_d
(
block
->
∑ge
.
ö_∑ge_hash
 = 
TRUE
);

4133 
block
->
∑ge
.
id
.
	`c›y_‰om
(
∑ge_id
);

4134 
block
->
∑ge
.
size
.
	`c›y_‰om
(
∑ge_size
);

4136 
	`HASH_INSERT
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
∑ge_id
.
	`fﬁd
(),

4137 &
block
->
∑ge
);

4139 i‡(
∑ge_size
.
	`is_com¥es£d
()) {

4140 
	`∑ge_zù_£t_size
(&
block
->
∑ge
.
zù
, 
∑ge_size
.
	`physiˇl
());

4142 
	}
}

4158 
buf_∑ge_t
 *
	$buf_∑ge_öô_f‹_ªad
(
dbîr_t
 *
îr
, 
ulöt
 
mode
,

4159 c⁄° 
∑ge_id_t
 &
∑ge_id
,

4160 c⁄° 
∑ge_size_t
 &
∑ge_size
, 
iboﬁ
 
unzù
) {

4161 
buf_block_t
 *
block
;

4162 
rw_lock_t
 *
hash_lock
;

4163 
må_t
 
må
;

4164 *
d©a
 = 
NULL
;

4165 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

4167 
	`ut_ad
(
buf_poﬁ
);

4169 *
îr
 = 
DB_SUCCESS
;

4171 i‡(
mode
 =
BUF_READ_IBUF_PAGES_ONLY
) {

4174 
	`ut_ad
(!
	`ibuf_bôm≠_∑ge
(
∑ge_id
, 
∑ge_size
));

4176 
	`ibuf_må_°¨t
(&
må
);

4178 i‡(!
ªcv_no_ibuf_›î©i⁄s
 && !
	`ibuf_∑ge
(
∑ge_id
, 
∑ge_size
, &
må
)) {

4179 
	`ibuf_må_commô
(&
må
);

4181  (
NULL
);

4184 
	`ut_ad
(
mode
 =
BUF_READ_ANY_PAGE
);

4187 i‡(
∑ge_size
.
	`is_com¥es£d
(Ë&& !
unzù
 && !
	`ªcv_ªcovîy_is_⁄
()) {

4188 
block
 = 
NULL
;

4190 
block
 = 
	`buf_LRU_gë_‰ì_block
(
buf_poﬁ
);

4191 
	`ut_ad
(
block
);

4192 
	`ut_ad
(
	`buf_poﬁ_‰om_block
(
block
Ë=
buf_poﬁ
);

4195 
buf_∑ge_t
 *
b∑ge
 = 
NULL
;

4196 i‡(
block
 =
NULL
) {

4197 
b∑ge
 = 
	`buf_∑ge_Æloc_des¸ùt‹
();

4200 i‡((
block
 !
NULL
 && 
∑ge_size
.
	`is_com¥es£d
()) || block == NULL) {

4201 
d©a
 = 
	`buf_buddy_Æloc
(
buf_poﬁ
, 
∑ge_size
.
	`physiˇl
());

4204 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

4206 
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
);

4208 
	`rw_lock_x_lock
(
hash_lock
);

4210 
buf_∑ge_t
 *
w©ch_∑ge
;

4212 
w©ch_∑ge
 = 
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
);

4214 i‡(
w©ch_∑ge
 !
NULL
 && !
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, watch_page)) {

4216 
w©ch_∑ge
 = 
NULL
;

4218 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4220 
	`rw_lock_x_u∆ock
(
hash_lock
);

4222 i‡(
b∑ge
 !
NULL
) {

4223 
	`buf_∑ge_‰ì_des¸ùt‹
(
b∑ge
);

4226 i‡(
d©a
 !
NULL
) {

4227 
	`buf_buddy_‰ì
(
buf_poﬁ
, 
d©a
, 
∑ge_size
.
	`physiˇl
());

4230 i‡(
block
 !
NULL
) {

4231 
	`buf_LRU_block_‰ì_n⁄_fûe_∑ge
(
block
);

4234 
b∑ge
 = 
NULL
;

4236 
func_exô
;

4239 i‡(
block
 !
NULL
) {

4240 
	`ut_ad
(!
b∑ge
);

4241 
b∑ge
 = &
block
->
∑ge
;

4243 
	`ut_ad
(
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
Ë=
buf_poﬁ
);

4245 
	`buf_∑ge_muãx_íãr
(
block
);

4247 
	`buf_∑ge_öô
(
buf_poﬁ
, 
∑ge_id
, 
∑ge_size
, 
block
);

4253 
	`buf_∑ge_£t_io_fix
(
b∑ge
, 
BUF_IO_READ
);

4256 
	`buf_LRU_add_block
(
b∑ge
, 
TRUE
 );

4258 i‡(
∑ge_size
.
	`is_com¥es£d
()) {

4259 
block
->
∑ge
.
zù
.
d©a
 = (
∑ge_zù_t
 *)data;

4266 
	`ut_ad
(
	`buf_∑ge_bñ⁄gs_to_unzù_LRU
(&
block
->
∑ge
));

4267 
	`buf_unzù_LRU_add_block
(
block
, 
TRUE
);

4270 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4281 
	`rw_lock_x_lock_gí
(&
block
->
lock
, 
BUF_IO_READ
);

4283 
	`rw_lock_x_u∆ock
(
hash_lock
);

4285 
	`buf_∑ge_muãx_exô
(
block
);

4288 
b∑ge
->
buf_poﬁ_ödex
 = 
	`buf_poﬁ_ödex
(
buf_poﬁ
);

4290 
	`∑ge_zù_des_öô
(&
b∑ge
->
zù
);

4291 
	`∑ge_zù_£t_size
(&
b∑ge
->
zù
, 
∑ge_size
.
	`physiˇl
());

4292 
	`ut_ad
(
d©a
);

4293 
b∑ge
->
zù
.
d©a
 = (
∑ge_zù_t
 *)data;

4295 
b∑ge
->
size
.
	`c›y_‰om
(
∑ge_size
);

4297 
	`muãx_íãr
(&
buf_poﬁ
->
zù_muãx
);

4298 
	`UNIV_MEM_DESC
(
b∑ge
->
zù
.
d©a
, b∑ge->
size
.
	`physiˇl
());

4300 
	`buf_∑ge_öô_low
(
b∑ge
);

4302 
b∑ge
->
°©e
 = 
BUF_BLOCK_ZIP_PAGE
;

4303 
b∑ge
->
id
.
	`c›y_‰om
(
∑ge_id
);

4304 
b∑ge
->
Êush_ob£rvî
 = 
NULL
;

4306 
	`ut_d
(
b∑ge
->
ö_∑ge_hash
 = 
FALSE
);

4307 
	`ut_d
(
b∑ge
->
ö_zù_hash
 = 
FALSE
);

4308 
	`ut_d
(
b∑ge
->
ö_Êush_li°
 = 
FALSE
);

4309 
	`ut_d
(
b∑ge
->
ö_‰ì_li°
 = 
FALSE
);

4310 
	`ut_d
(
b∑ge
->
ö_LRU_li°
 = 
FALSE
);

4312 
	`ut_d
(
b∑ge
->
ö_∑ge_hash
 = 
TRUE
);

4314 i‡(
w©ch_∑ge
 !
NULL
) {

4316 
ib_uöt32_t
 
buf_fix_cou¡
;

4318 
buf_fix_cou¡
 = 
w©ch_∑ge
->buf_fix_count;

4320 
	`ut_a
(
buf_fix_cou¡
 > 0);

4322 
	`os_©omic_ö¸emít_uöt32
(&
b∑ge
->
buf_fix_cou¡
, buf_fix_count);

4324 
	`ut_ad
(
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, 
w©ch_∑ge
));

4325 
	`buf_poﬁ_w©ch_ªmove
(
buf_poﬁ
, 
w©ch_∑ge
);

4328 
	`HASH_INSERT
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
b∑ge
->
id
.
	`fﬁd
(), bpage);

4330 
	`rw_lock_x_u∆ock
(
hash_lock
);

4334 
	`buf_LRU_add_block
(
b∑ge
, 
TRUE
 );

4335 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


4336 
	`buf_LRU_ö£π_zù_˛ón
(
b∑ge
);

4338 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4340 
	`buf_∑ge_£t_io_fix
(
b∑ge
, 
BUF_IO_READ
);

4342 
	`muãx_exô
(&
buf_poﬁ
->
zù_muãx
);

4345 
	`os_©omic_ö¸emít_ulöt
(&
buf_poﬁ
->
n_≥nd_ªads
, 1);

4346 
func_exô
:

4348 i‡(
mode
 =
BUF_READ_IBUF_PAGES_ONLY
) {

4349 
	`ibuf_må_commô
(&
må
);

4352 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
));

4353 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_S
));

4354 
	`ut_ad
(!
b∑ge
 || 
	`buf_∑ge_ö_fûe
(bpage));

4356  (
b∑ge
);

4357 
	}
}

4359 
buf_block_t
 *
	$buf_∑ge_¸óã
(c⁄° 
∑ge_id_t
 &
∑ge_id
,

4360 c⁄° 
∑ge_size_t
 &
∑ge_size
,

4361 
rw_lock_ty≥_t
 
rw_œtch
, 
må_t
 *
må
) {

4362 
buf_‰ame_t
 *
‰ame
;

4363 
buf_block_t
 *
block
;

4364 
buf_block_t
 *
‰ì_block
 = 
NULL
;

4365 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

4366 
rw_lock_t
 *
hash_lock
;

4368 
	`ut_ad
(
må
->
	`is_a˘ive
());

4369 
	`ut_ad
(
∑ge_id
.
	`•a˚
(Ë!0 || !
∑ge_size
.
	`is_com¥es£d
());

4371 
‰ì_block
 = 
	`buf_LRU_gë_‰ì_block
(
buf_poﬁ
);

4373 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

4375 
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
∑ge_id
);

4376 
	`rw_lock_x_lock
(
hash_lock
);

4378 
block
 = (
buf_block_t
 *)
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
∑ge_id
);

4380 i‡(
block
 && 
	`buf_∑ge_ö_fûe
(&block->
∑ge
) &&

4381 !
	`buf_poﬁ_w©ch_is_£¡öñ
(
buf_poﬁ
, &
block
->
∑ge
)) {

4382 #ifde‡
UNIV_IBUF_COUNT_DEBUG


4383 
	`ut_a
(
	`ibuf_cou¡_gë
(
∑ge_id
) == 0);

4386 
	`ut_d
(
block
->
∑ge
.
fûe_∑ge_was_‰ìd
 = 
FALSE
);

4389 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4390 
	`rw_lock_x_u∆ock
(
hash_lock
);

4392 
	`buf_block_‰ì
(
‰ì_block
);

4394  (
	`buf_∑ge_gë
(
∑ge_id
, 
∑ge_size
, 
rw_œtch
, 
må
));

4399 
	`DBUG_PRINT
("ib_buf", ("¸óãÖagê" 
UINT32PF
 ":" UINT32PF, 
∑ge_id
.
	`•a˚
(),

4400 
∑ge_id
.
	`∑ge_no
()));

4402 
block
 = 
‰ì_block
;

4404 
	`buf_∑ge_muãx_íãr
(
block
);

4406 
	`buf_∑ge_öô
(
buf_poﬁ
, 
∑ge_id
, 
∑ge_size
, 
block
);

4408 
	`buf_block_buf_fix_öc
(
block
, 
__FILE__
, 
__LINE__
);

4410 
	`buf_∑ge_£t_ac˚s£d
(&
block
->
∑ge
);

4412 
	`muãx_exô
(&
block
->
muãx
);

4418 
må_memo_ty≥_t
 
må_œtch_ty≥
;

4420 i‡(
rw_œtch
 =
RW_X_LATCH
) {

4421 
	`rw_lock_x_lock
(&
block
->
lock
);

4422 
må_œtch_ty≥
 = 
MTR_MEMO_PAGE_X_FIX
;

4424 
	`rw_lock_sx_lock
(&
block
->
lock
);

4425 
må_œtch_ty≥
 = 
MTR_MEMO_PAGE_SX_FIX
;

4427 
	`må_memo_push
(
må
, 
block
, 
må_œtch_ty≥
);

4429 
	`rw_lock_x_u∆ock
(
hash_lock
);

4432 
	`buf_LRU_add_block
(&
block
->
∑ge
, 
FALSE
);

4434 
	`os_©omic_ö¸emít_ulöt
(&
buf_poﬁ
->
°©
.
n_∑ges_¸óãd
, 1);

4436 i‡(
∑ge_size
.
	`is_com¥es£d
()) {

4437 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4439 autÿ
d©a
 = 
	`buf_buddy_Æloc
(
buf_poﬁ
, 
∑ge_size
.
	`physiˇl
());

4441 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

4443 
	`buf_∑ge_muãx_íãr
(
block
);

4444 
block
->
∑ge
.
zù
.
d©a
 = (
∑ge_zù_t
 *)data;

4445 
	`buf_∑ge_muãx_exô
(
block
);

4452 
	`ut_ad
(
	`buf_∑ge_bñ⁄gs_to_unzù_LRU
(&
block
->
∑ge
));

4453 
	`buf_unzù_LRU_add_block
(
block
, 
FALSE
);

4456 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4460 
	`ibuf_mîge_‹_dñëe_f‹_∑ge
(
NULL
, 
∑ge_id
, &
∑ge_size
, 
TRUE
);

4462 
‰ame
 = 
block
->frame;

4464 
	`mem£t
(
‰ame
 + 
FIL_PAGE_PREV
, 0xff, 4);

4465 
	`mem£t
(
‰ame
 + 
FIL_PAGE_NEXT
, 0xff, 4);

4466 
	`mach_wrôe_to_2
(
‰ame
 + 
FIL_PAGE_TYPE
, 
FIL_PAGE_TYPE_ALLOCATED
);

4477 
	`mem£t
(
‰ame
 + 
FIL_PAGE_FILE_FLUSH_LSN
, 0, 8);

4479 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


4480 
	`ut_a
(++
buf_dbg_cou¡î
 % 5771 || 
	`buf_vÆid©e
());

4482 #ifde‡
UNIV_IBUF_COUNT_DEBUG


4483 
	`ut_a
(
	`ibuf_cou¡_gë
(
block
->
∑ge
.
id
) == 0);

4485  (
block
);

4486 
	}
}

4491 
	$buf_∑ge_m⁄ô‹
(

4492 c⁄° 
buf_∑ge_t
 *
b∑ge
,

4493 
buf_io_fix
 
io_ty≥
)

4495 
m⁄ô‹_id_t
 
cou¡î
;

4497 
	`ut_a
(
io_ty≥
 =
BUF_IO_READ
 || io_ty≥ =
BUF_IO_WRITE
);

4499 c⁄° 
byã
 *
‰ame
 =

4500 
b∑ge
->
zù
.
d©a
 !
NULL
 ? b∑ge->zù.d©®: ((
buf_block_t
 *)b∑ge)->
‰ame
;

4502 c⁄° 
ulöt
 
∑ge_ty≥
 = 
	`fû_∑ge_gë_ty≥
(
‰ame
);

4504 
boﬁ
 
is_Àaf
 = 
Ál£
;

4505 
boﬁ
 
is_ibuf
 = 
Ál£
;

4507 i‡(
∑ge_ty≥
 =
FIL_PAGE_INDEX
 ||Öage_ty≥ =
FIL_PAGE_RTREE
) {

4508 
is_Àaf
 = 
	`∑ge_is_Àaf
(
‰ame
);

4510 c⁄° 
•a˚_ödex_t
 
ibuf_ödex_id
 =

4511 
°©ic_ˇ°
<
•a˚_ödex_t
>(
DICT_IBUF_ID_MIN
 + 
IBUF_SPACE_ID
);

4513 c⁄° 
uöt32_t
 
•a˚_id
 = 
b∑ge
->
id
.
	`•a˚
();

4514 c⁄° 
•a˚_ödex_t
 
idx_id
 = 
	`bå_∑ge_gë_ödex_id
(
‰ame
);

4516 
is_ibuf
 = 
•a˚_id
 =
IBUF_SPACE_ID
 && 
idx_id
 =
ibuf_ödex_id
;

4519 i‡(
is_Àaf
 && 
io_ty≥
 =
BUF_IO_READ
) {

4520 
buf_°©_≥r_ödex
->
	`öc
(
	`ödex_id_t
(
•a˚_id
, 
idx_id
));

4524 i‡(!
	`MONITOR_IS_ON
(
MONITOR_MODULE_BUF_PAGE
)) {

4528 
∑ge_ty≥
) {

4529 
FIL_PAGE_INDEX
:

4531 i‡(
is_ibuf
) {

4532 i‡(
is_Àaf
) {

4533 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_INDEX_IBUF_LEAF_PAGE
);

4535 
cou¡î
 =

4536 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_INDEX_IBUF_NON_LEAF_PAGE
);

4541 
FIL_PAGE_RTREE
:

4542 i‡(
is_Àaf
) {

4543 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_INDEX_LEAF_PAGE
);

4545 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_INDEX_NON_LEAF_PAGE
);

4549 
FIL_PAGE_UNDO_LOG
:

4550 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_UNDO_LOG_PAGE
);

4553 
FIL_PAGE_INODE
:

4554 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_INODE_PAGE
);

4557 
FIL_PAGE_IBUF_FREE_LIST
:

4558 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_IBUF_FREELIST_PAGE
);

4561 
FIL_PAGE_IBUF_BITMAP
:

4562 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_IBUF_BITMAP_PAGE
);

4565 
FIL_PAGE_TYPE_SYS
:

4566 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_SYSTEM_PAGE
);

4569 
FIL_PAGE_TYPE_TRX_SYS
:

4570 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_TRX_SYSTEM_PAGE
);

4573 
FIL_PAGE_TYPE_FSP_HDR
:

4574 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_FSP_HDR_PAGE
);

4577 
FIL_PAGE_TYPE_XDES
:

4578 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_XDES_PAGE
);

4581 
FIL_PAGE_TYPE_BLOB
:

4582 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_BLOB_PAGE
);

4585 
FIL_PAGE_TYPE_ZBLOB
:

4586 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_ZBLOB_PAGE
);

4589 
FIL_PAGE_TYPE_ZBLOB2
:

4590 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_ZBLOB2_PAGE
);

4593 
FIL_PAGE_TYPE_RSEG_ARRAY
:

4594 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_RSEG_ARRAY_PAGE
);

4598 
cou¡î
 = 
	`MONITOR_RW_COUNTER
(
io_ty≥
, 
MONITOR_OTHER_PAGE
);

4601 
	`MONITOR_INC_NOCHECK
(
cou¡î
);

4602 
	}
}

4607 
	$buf_ªad_∑ge_h™dÀ_îr‹
(
buf_∑ge_t
 *
b∑ge
) {

4608 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

4609 c⁄° 
iboﬁ
 
uncom¥es£d
 = (
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_FILE_PAGE
);

4612 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

4614 
rw_lock_t
 *
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
b∑ge
->
id
);

4616 
	`rw_lock_x_lock
(
hash_lock
);

4618 
	`muãx_íãr
(
	`buf_∑ge_gë_muãx
(
b∑ge
));

4620 
	`ut_ad
(
	`buf_∑ge_gë_io_fix
(
b∑ge
Ë=
BUF_IO_READ
);

4621 
	`ut_ad
(
b∑ge
->
buf_fix_cou¡
 == 0);

4624 
	`buf_∑ge_£t_io_fix
(
b∑ge
, 
BUF_IO_NONE
);

4626 i‡(
uncom¥es£d
) {

4627 
	`rw_lock_x_u∆ock_gí
(&((
buf_block_t
 *)
b∑ge
)->
lock
, 
BUF_IO_READ
);

4631 
	`buf_LRU_‰ì_⁄e_∑ge
(
b∑ge
, 
åue
,Årue);

4633 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
) &&

4634 !
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_S
));

4636 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4638 
	`ut_ad
(
buf_poﬁ
->
n_≥nd_ªads
 > 0);

4639 
	`os_©omic_de¸emít_ulöt
(&
buf_poﬁ
->
n_≥nd_ªads
, 1);

4640 
	}
}

4647 
boﬁ
 
	$buf_∑ge_io_com∂ëe
(
buf_∑ge_t
 *
b∑ge
, 
boﬁ
 
evi˘
) {

4648 
buf_io_fix
 
io_ty≥
;

4649 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

4650 c⁄° 
iboﬁ
 
uncom¥es£d
 = (
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_FILE_PAGE
);

4651 
boﬁ
 
have_LRU_muãx
 = 
Ál£
;

4653 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

4661 
io_ty≥
 = 
	`buf_∑ge_gë_io_fix_u∆ocked
(
b∑ge
);

4662 
	`ut_ad
(
io_ty≥
 =
BUF_IO_READ
 || io_ty≥ =
BUF_IO_WRITE
);

4664 i‡(
io_ty≥
 =
BUF_IO_READ
) {

4665 
∑ge_no_t
 
ªad_∑ge_no
;

4666 
•a˚_id_t
 
ªad_•a˚_id
;

4667 
byã
 *
‰ame
;

4668 
boﬁ
 
com¥es£d_∑ge
;

4670 i‡(
b∑ge
->
size
.
	`is_com¥es£d
()) {

4671 
‰ame
 = 
b∑ge
->
zù
.
d©a
;

4672 
	`os_©omic_ö¸emít_ulöt
(&
buf_poﬁ
->
n_≥nd_unzù
, 1);

4673 i‡(
uncom¥es£d
 && !
	`buf_zù_decom¥ess
((
buf_block_t
 *)
b∑ge
, 
FALSE
)) {

4674 
	`os_©omic_de¸emít_ulöt
(&
buf_poﬁ
->
n_≥nd_unzù
, 1);

4676 
com¥es£d_∑ge
 = 
Ál£
;

4677 
c‹ru±
;

4679 
	`os_©omic_de¸emít_ulöt
(&
buf_poﬁ
->
n_≥nd_unzù
, 1);

4681 
	`ut_a
(
uncom¥es£d
);

4682 
‰ame
 = ((
buf_block_t
 *)
b∑ge
)->frame;

4688 
ªad_∑ge_no
 = 
	`mach_ªad_‰om_4
(
‰ame
 + 
FIL_PAGE_OFFSET
);

4689 
ªad_•a˚_id
 = 
	`mach_ªad_‰om_4
(
‰ame
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
);

4691 i‡(
b∑ge
->
id
.
	`•a˚
(Ë=
TRX_SYS_SPACE
 &&

4692 
	`buf_dblwr_∑ge_öside
(
b∑ge
->
id
.
	`∑ge_no
())) {

4693 
ib
::
	`îr‹
(
ER_IB_MSG_78
Ë<< "RódögÖagê" << 
b∑ge
->
id


4696 } i‡(
ªad_•a˚_id
 =0 && 
ªad_∑ge_no
 == 0) {

4698 } i‡((
b∑ge
->
id
.
	`•a˚
(Ë!0 && b∑ge->id.•a˚(Ë!
ªad_•a˚_id
) ||

4699 
b∑ge
->
id
.
	`∑ge_no
(Ë!
ªad_∑ge_no
) {

4705 
ib
::
	`îr‹
(
ER_IB_MSG_79
) << "Space idándÖageÇo stored in "

4707 << 
	`∑ge_id_t
(
ªad_•a˚_id
, 
ªad_∑ge_no
)

4708 << ", should bê" << 
b∑ge
->
id
;

4711 
com¥es£d_∑ge
 = 
Com¥essi⁄
::
	`is_com¥es£d_∑ge
(
‰ame
);

4716 i‡(
com¥es£d_∑ge
) {

4717 
Com¥essi⁄
::
mëa_t
 
mëa
;

4719 
Com¥essi⁄
::
	`de£rülize_hódî
(
‰ame
, &
mëa
);

4721 
ib
::
	`îr‹
(
ER_IB_MSG_80
)

4722 << "Pagê" << 
b∑ge
->
id
 << " "

4723 << "com¥es£d wôh " << 
Com¥essi⁄
::
	`to_°rög
(
mëa
) << " "

4729 
boﬁ
 
is_c‹ru±ed
;

4731 
BlockRï‹ãr
 
ªp‹ãr
 =

4732 
	`BlockRï‹ãr
(
åue
, 
‰ame
, 
b∑ge
->
size
,

4733 
	`f•_is_checksum_dißbÀd
(
b∑ge
->
id
.
	`•a˚
()));

4734 
is_c‹ru±ed
 = 
ªp‹ãr
.
	`is_c‹ru±ed
();

4737 i‡(
com¥es£d_∑ge
 || 
is_c‹ru±ed
) {

4740 
	`DBUG_EXECUTE_IF
("buf_page_import_corrupt_failure",

4741 
∑ge_nŸ_c‹ru±
;);

4743 
c‹ru±
:

4746 i‡(!
com¥es£d_∑ge
) {

4747 
ib
::
	`îr‹
(
ER_IB_MSG_81
)

4750 << 
b∑ge
->
id
 << ". You may haveÅoÑecover from "

4753 
	`buf_∑ge_¥öt
(
‰ame
, 
b∑ge
->
size
, 
BUF_PAGE_PRINT_NO_CRASH
);

4755 
ib
::
	`öfo
(
ER_IB_MSG_82
) << "It isálsoÖossibleÅhat your"

4765 << 
FORCE_RECOVERY_MSG
;

4768 i‡(
§v_f‹˚_ªcovîy
 < 
SRV_FORCE_IGNORE_CORRUPT
) {

4775 
	`buf_ªad_∑ge_h™dÀ_îr‹
(
b∑ge
);

4776  (
Ál£
);

4780 
	`DBUG_EXECUTE_IF
("buf_∑ge_imp‹t_c‹ru±_Áûuª", 
∑ge_nŸ_c‹ru±


4781 : 
b∑ge
 = bpage;);

4783 i‡(
	`ªcv_ªcovîy_is_⁄
()) {

4785 
	`ut_a
(
uncom¥es£d
);

4786 
	`ªcv_ªcovî_∑ge
(
åue
, (
buf_block_t
 *)
b∑ge
);

4789 i‡(
uncom¥es£d
 && !
Com¥essi⁄
::
	`is_com¥es£d_∑ge
(
‰ame
) &&

4790 !
ªcv_no_ibuf_›î©i⁄s
 &&

4791 
	`fû_∑ge_gë_ty≥
(
‰ame
Ë=
FIL_PAGE_INDEX
 && 
	`∑ge_is_Àaf
(frame) &&

4792 !
	`f•_is_sy°em_ãmp‹¨y
(
b∑ge
->
id
.
	`•a˚
()) &&

4793 !
	`f•_is_undo_èbÀ•a˚
(
b∑ge
->
id
.
	`•a˚
())) {

4794 
	`ibuf_mîge_‹_dñëe_f‹_∑ge
((
buf_block_t
 *)
b∑ge
, b∑ge->
id
,

4795 &
b∑ge
->
size
, 
TRUE
);

4799 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

4801 
BPageMuãx
 *
∑ge_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

4802 
	`muãx_íãr
(
∑ge_muãx
);

4804 i‡(
io_ty≥
 =
BUF_IO_WRITE
 &&

4806 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


4808 
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_ZIP_DIRTY
 ||

4810 
	`buf_∑ge_gë_Êush_ty≥
(
b∑ge
Ë=
BUF_FLUSH_LRU
 ||

4811 
	`buf_∑ge_gë_Êush_ty≥
(
b∑ge
Ë=
BUF_FLUSH_SINGLE_PAGE
)) {

4813 
have_LRU_muãx
 = 
åue
;

4815 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4818 #ifde‡
UNIV_IBUF_COUNT_DEBUG


4819 i‡(
io_ty≥
 =
BUF_IO_WRITE
 || 
uncom¥es£d
) {

4823 
	`ut_a
(
	`ibuf_cou¡_gë
(
b∑ge
->
id
) == 0);

4832 
	`buf_∑ge_m⁄ô‹
(
b∑ge
, 
io_ty≥
);

4834 
io_ty≥
) {

4835 
BUF_IO_READ
:

4837 
	`ut_ad
(!
have_LRU_muãx
);

4839 
	`buf_∑ge_£t_io_fix
(
b∑ge
, 
BUF_IO_NONE
);

4845 i‡(
uncom¥es£d
) {

4846 
	`rw_lock_x_u∆ock_gí
(&((
buf_block_t
 *)
b∑ge
)->
lock
, 
BUF_IO_READ
);

4849 
	`muãx_exô
(
	`buf_∑ge_gë_muãx
(
b∑ge
));

4851 
	`ut_ad
(
buf_poﬁ
->
n_≥nd_ªads
 > 0);

4852 
	`os_©omic_de¸emít_ulöt
(&
buf_poﬁ
->
n_≥nd_ªads
, 1);

4853 
	`os_©omic_ö¸emít_ulöt
(&
buf_poﬁ
->
°©
.
n_∑ges_ªad
, 1);

4857 
BUF_IO_WRITE
:

4861 
	`buf_Êush_wrôe_com∂ëe
(
b∑ge
);

4863 i‡(
uncom¥es£d
) {

4864 
	`rw_lock_sx_u∆ock_gí
(&((
buf_block_t
 *)
b∑ge
)->
lock
, 
BUF_IO_WRITE
);

4867 
	`os_©omic_ö¸emít_ulöt
(&
buf_poﬁ
->
°©
.
n_∑ges_wrôãn
, 1);

4875 i‡(
	`buf_∑ge_gë_Êush_ty≥
(
b∑ge
Ë=
BUF_FLUSH_LRU
) {

4876 
evi˘
 = 
åue
;

4877 
	`ut_ad
(
have_LRU_muãx
);

4880 i‡(
evi˘
 && 
	`buf_LRU_‰ì_∑ge
(
b∑ge
, 
åue
)) {

4881 
have_LRU_muãx
 = 
Ál£
;

4883 
	`muãx_exô
(
	`buf_∑ge_gë_muãx
(
b∑ge
));

4885 i‡(
have_LRU_muãx
) {

4886 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4892 
ut_îr‹
;

4895 
	`DBUG_PRINT
("ib_buf", ("%†∑gê" 
UINT32PF
 ":" UINT32PF,

4896 
io_ty≥
 =
BUF_IO_READ
 ? "read" : "wrote",

4897 
b∑ge
->
id
.
	`•a˚
(), b∑ge->id.
	`∑ge_no
()));

4899  (
åue
);

4900 
	}
}

4904 
	$buf_mu°_be_Æl_‰ìd_ö°™˚
(
buf_poﬁ_t
 *
buf_poﬁ
) {

4905 
ulöt
 
i
;

4906 
buf_chunk_t
 *
chunk
;

4908 
	`ut_ad
(
buf_poﬁ
);

4910 
chunk
 = 
buf_poﬁ
->
chunks
;

4912 
i
 = 
buf_poﬁ
->
n_chunks
; i--; 
chunk
++) {

4913 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

4915 c⁄° 
buf_block_t
 *
block
 = 
	`buf_chunk_nŸ_‰ìd
(
chunk
);

4917 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4919 i‡(
block
) {

4920 
ib
::
	`Áèl
(
ER_IB_MSG_83
)

4921 << "Pagê" << 
block
->
∑ge
.
id
 << " still fixed or dirty";

4924 
	}
}

4928 
	$buf_ª‰esh_io_°©s
(
buf_poﬁ_t
 *
buf_poﬁ
) {

4929 
buf_poﬁ
->
œ°_¥ötout_time
 = 
	`ut_time
();

4930 
buf_poﬁ
->
ﬁd_°©
 = buf_poﬁ->
°©
;

4931 
	}
}

4935 
	$buf_poﬁ_övÆid©e_ö°™˚
(
buf_poﬁ_t
 *
buf_poﬁ
) {

4936 
ulöt
 
i
;

4938 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

4940 
	`muãx_íãr
(&
buf_poﬁ
->
Êush_°©e_muãx
);

4942 
i
 = 
BUF_FLUSH_LRU
; i < 
BUF_FLUSH_N_TYPES
; i++) {

4948 
	`ut_ad
(
buf_poﬁ
->
öô_Êush
[
i
] =
FALSE
);

4954 i‡(
buf_poﬁ
->
n_Êush
[
i
] > 0) {

4955 
buf_Êush_t
 
ty≥
 = 
°©ic_ˇ°
<buf_Êush_t>(
i
);

4957 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

4958 
	`buf_Êush_waô_b©ch_íd
(
buf_poﬁ
, 
ty≥
);

4959 
	`muãx_íãr
(&
buf_poﬁ
->
Êush_°©e_muãx
);

4963 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

4965 
	`ut_d
(
	`buf_mu°_be_Æl_‰ìd_ö°™˚
(
buf_poﬁ
));

4967 
	`buf_LRU_sˇn_™d_‰ì_block
(
buf_poﬁ
, 
åue
)) {

4970 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

4972 
	`ut_ad
(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
) == 0);

4973 
	`ut_ad
(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
unzù_LRU
) == 0);

4975 
buf_poﬁ
->
‰ìd_∑ge_˛ock
 = 0;

4976 
buf_poﬁ
->
LRU_ﬁd
 = 
NULL
;

4977 
buf_poﬁ
->
LRU_ﬁd_Àn
 = 0;

4979 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

4981 
	`mem£t
(&
buf_poﬁ
->
°©
, 0x00, (buf_pool->stat));

4982 
	`buf_ª‰esh_io_°©s
(
buf_poﬁ
);

4983 
	}
}

4988 
	$buf_poﬁ_övÆid©e
() {

4989 
ulöt
 
i
;

4991 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

4992 
	`buf_poﬁ_övÆid©e_ö°™˚
(
	`buf_poﬁ_‰om_¨øy
(
i
));

4994 
	}
}

4996 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


5000 
iboﬁ
 
	$buf_poﬁ_vÆid©e_ö°™˚
(
buf_poﬁ_t
 *
buf_poﬁ
) {

5001 
buf_∑ge_t
 *
b
;

5002 
buf_chunk_t
 *
chunk
;

5003 
ulöt
 
i
;

5004 
ulöt
 
n_Ãu_Êush
 = 0;

5005 
ulöt
 
n_∑ge_Êush
 = 0;

5006 
ulöt
 
n_li°_Êush
 = 0;

5007 
ulöt
 
n_Ãu
 = 0;

5008 
ulöt
 
n_Êush
 = 0;

5009 
ulöt
 
n_‰ì
 = 0;

5010 
ulöt
 
n_zù
 = 0;

5012 
	`ut_ad
(
buf_poﬁ
);

5014 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

5015 
	`hash_lock_x_Æl
(
buf_poﬁ
->
∑ge_hash
);

5016 
	`muãx_íãr
(&
buf_poﬁ
->
zù_muãx
);

5017 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

5018 
	`muãx_íãr
(&
buf_poﬁ
->
Êush_°©e_muãx
);

5020 
chunk
 = 
buf_poﬁ
->
chunks
;

5024 
i
 = 
buf_poﬁ
->
n_chunks
; i--; 
chunk
++) {

5025 
ulöt
 
j
;

5026 
buf_block_t
 *
block
 = 
chunk
->
blocks
;

5028 
j
 = 
chunk
->
size
; j--; 
block
++) {

5029 
	`buf_block_gë_°©e
(
block
)) {

5030 
BUF_BLOCK_POOL_WATCH
:

5031 
BUF_BLOCK_ZIP_PAGE
:

5032 
BUF_BLOCK_ZIP_DIRTY
:

5035 
ut_îr‹
;

5038 
BUF_BLOCK_FILE_PAGE
:

5039 
	`ut_a
(
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
block
->
∑ge
.
id
) == &block->page);

5041 #ifde‡
UNIV_IBUF_COUNT_DEBUG


5042 
	`ut_a
(
	`buf_∑ge_gë_io_fix
(&
block
->
∑ge
Ë=
BUF_IO_READ
 ||

5043 !
	`ibuf_cou¡_gë
(
block
->
∑ge
.
id
));

5045 
	`buf_∑ge_gë_io_fix_u∆ocked
(&
block
->
∑ge
)) {

5046 
BUF_IO_NONE
:

5049 
BUF_IO_WRITE
:

5050 
	`buf_∑ge_gë_Êush_ty≥
(&
block
->
∑ge
)) {

5051 
BUF_FLUSH_LRU
:

5052 
BUF_FLUSH_SINGLE_PAGE
:

5053 
BUF_FLUSH_LIST
:

5056 
ut_îr‹
;

5061 
BUF_IO_READ
:

5063 
	`ut_a
(
	`rw_lock_is_locked
(&
block
->
lock
, 
RW_LOCK_X
));

5066 
BUF_IO_PIN
:

5070 
n_Ãu
++;

5073 
BUF_BLOCK_NOT_USED
:

5074 
n_‰ì
++;

5077 
BUF_BLOCK_READY_FOR_USE
:

5078 
BUF_BLOCK_MEMORY
:

5079 
BUF_BLOCK_REMOVE_HASH
:

5088 
b
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
zù_˛ón
); b;

5089 
b
 = 
	`UT_LIST_GET_NEXT
(
li°
, b)) {

5090 
	`ut_a
(
	`buf_∑ge_gë_°©e
(
b
Ë=
BUF_BLOCK_ZIP_PAGE
);

5091 
	`buf_∑ge_gë_io_fix
(
b
)) {

5092 
BUF_IO_NONE
:

5093 
BUF_IO_PIN
:

5096 
BUF_IO_READ
:

5103 
ut_îr‹
;

5110 
	`ut_a
(!
b
->
ﬁde°_modifiˇti⁄
);

5111 
	`ut_a
(
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
b
->
id
) == b);

5112 
n_Ãu
++;

5113 
n_zù
++;

5118 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

5119 
b
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
Êush_li°
); b;

5120 
b
 = 
	`UT_LIST_GET_NEXT
(
li°
, b)) {

5121 
	`ut_ad
(
b
->
ö_Êush_li°
);

5122 
	`ut_a
(
b
->
ﬁde°_modifiˇti⁄
);

5123 
n_Êush
++;

5125 
	`buf_∑ge_gë_°©e
(
b
)) {

5126 
BUF_BLOCK_ZIP_DIRTY
:

5127 
n_Ãu
++;

5128 
n_zù
++;

5130 
BUF_BLOCK_FILE_PAGE
:

5131 
	`buf_∑ge_gë_io_fix_u∆ocked
(
b
)) {

5132 
BUF_IO_NONE
:

5133 
BUF_IO_READ
:

5134 
BUF_IO_PIN
:

5136 
BUF_IO_WRITE
:

5137 
	`buf_∑ge_gë_Êush_ty≥
(
b
)) {

5138 
BUF_FLUSH_LRU
:

5139 
n_Ãu_Êush
++;

5141 
BUF_FLUSH_SINGLE_PAGE
:

5142 
n_∑ge_Êush
++;

5144 
BUF_FLUSH_LIST
:

5145 
n_li°_Êush
++;

5148 
ut_îr‹
;

5153 
BUF_BLOCK_POOL_WATCH
:

5154 
BUF_BLOCK_ZIP_PAGE
:

5155 
BUF_BLOCK_NOT_USED
:

5156 
BUF_BLOCK_READY_FOR_USE
:

5157 
BUF_BLOCK_MEMORY
:

5158 
BUF_BLOCK_REMOVE_HASH
:

5159 
ut_îr‹
;

5162 
	`ut_a
(
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
b
->
id
) == b);

5165 
	`ut_a
(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
Êush_li°
Ë=
n_Êush
);

5167 
	`hash_u∆ock_x_Æl
(
buf_poﬁ
->
∑ge_hash
);

5168 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

5170 
	`muãx_exô
(&
buf_poﬁ
->
zù_muãx
);

5172 i‡(
buf_poﬁ
->
cuº_size
 =buf_poﬁ->
ﬁd_size
 &&

5173 
n_Ãu
 + 
n_‰ì
 > 
buf_poﬁ
->
cuº_size
 + 
n_zù
) {

5174 
ib
::
	`Áèl
(
ER_IB_MSG_84
)

5175 << "n_LRU " << 
n_Ãu
 << ",Ç_‰ì " << 
n_‰ì
 << ",Öool "

5176 << 
buf_poﬁ
->
cuº_size
 << " zù " << 
n_zù
 << ". Aborting...";

5179 
	`ut_a
(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë=
n_Ãu
);

5181 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

5183 i‡(
buf_poﬁ
->
cuº_size
 =buf_poﬁ->
ﬁd_size
 &&

5184 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
Ë> 
n_‰ì
) {

5185 
ib
::
	`Áèl
(
ER_IB_MSG_85
)

5186 << "Fªêli°Üí " << 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
)

5187 << ", fªêblock†" << 
n_‰ì
 << ". Aborting...";

5190 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

5192 
	`ut_a
(
buf_poﬁ
->
n_Êush
[
BUF_FLUSH_LIST
] =
n_li°_Êush
);

5193 
	`ut_a
(
buf_poﬁ
->
n_Êush
[
BUF_FLUSH_LRU
] =
n_Ãu_Êush
);

5194 
	`ut_a
(
buf_poﬁ
->
n_Êush
[
BUF_FLUSH_SINGLE_PAGE
] =
n_∑ge_Êush
);

5196 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

5198 
	`ut_a
(
	`buf_LRU_vÆid©e
());

5199 
	`ut_a
(
	`buf_Êush_vÆid©e
(
buf_poﬁ
));

5201  (
TRUE
);

5202 
	}
}

5206 
iboﬁ
 
	$buf_vÆid©e
() {

5207 
ulöt
 
i
;

5209 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

5210 
buf_poﬁ_t
 *
buf_poﬁ
;

5212 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

5214 
	`buf_poﬁ_vÆid©e_ö°™˚
(
buf_poﬁ
);

5216  (
TRUE
);

5217 
	}
}

5221 #i‡
deföed
 
UNIV_DEBUG_PRINT
 || deföed 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


5224 
	$buf_¥öt_ö°™˚
(
buf_poﬁ_t
 *
buf_poﬁ
) {

5225 
ödex_id_t
 *
ödex_ids
;

5226 
ulöt
 *
cou¡s
;

5227 
ulöt
 
size
;

5228 
ulöt
 
i
;

5229 
ulöt
 
j
;

5230 
ulöt
 
n_found
;

5231 
buf_chunk_t
 *
chunk
;

5233 
	`ut_ad
(
buf_poﬁ
);

5235 
size
 = 
buf_poﬁ
->
cuº_size
;

5237 
ödex_ids
 =

5238 
°©ic_ˇ°
<
ödex_id_t
 *>(
	`ut_mÆloc_nokey
(
size
 *  *
ödex_ids
));

5240 
cou¡s
 = 
°©ic_ˇ°
<
ulöt
 *>(
	`ut_mÆloc_nokey
((ulötË* 
size
));

5242 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

5243 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

5244 
	`muãx_íãr
(&
buf_poﬁ
->
Êush_°©e_muãx
);

5245 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

5247 
ib
::
	`öfo
(
ER_IB_MSG_86
Ë<< *
buf_poﬁ
;

5249 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

5250 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

5251 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

5255 
n_found
 = 0;

5257 
chunk
 = 
buf_poﬁ
->
chunks
;

5259 
i
 = 
buf_poﬁ
->
n_chunks
; i--; 
chunk
++) {

5260 
buf_block_t
 *
block
 = 
chunk
->
blocks
;

5261 
ulöt
 
n_blocks
 = 
chunk
->
size
;

5263 ; 
n_blocks
--; 
block
++) {

5264 c⁄° 
buf_‰ame_t
 *
‰ame
 = 
block
->frame;

5266 i‡(
	`fû_∑ge_ödex_∑ge_check
(
‰ame
)) {

5267 
ödex_id_t
 
	`id
(
block
->
∑ge
.
id
.
	`•a˚
(), 
	`bå_∑ge_gë_ödex_id
(
‰ame
));

5270 
j
 = 0;

5272 
j
 < 
n_found
) {

5273 i‡(
ödex_ids
[
j
] =
id
) {

5274 
cou¡s
[
j
]++;

5278 
j
++;

5281 i‡(
j
 =
n_found
) {

5282 
n_found
++;

5283 
ödex_ids
[
j
] = 
id
;

5284 
cou¡s
[
j
] = 1;

5290 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

5292 
i
 = 0; i < 
n_found
; i++) {

5293 
ib
::
öfo
 
	`öfo
(
ER_IB_MSG_1217
);

5295 
öfo
 << "Block cou¡ f‹ index " << 
ödex_ids
[
i
] << " in buffer isábout "

5296 << 
cou¡s
[
i
];

5299 
	`ut_‰ì
(
ödex_ids
);

5300 
	`ut_‰ì
(
cou¡s
);

5302 
	`ut_a
(
	`buf_poﬁ_vÆid©e_ö°™˚
(
buf_poﬁ
));

5303 
	}
}

5306 
	$buf_¥öt
() {

5307 
ulöt
 
i
;

5309 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

5310 
buf_poﬁ_t
 *
buf_poﬁ
;

5312 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

5313 
	`buf_¥öt_ö°™˚
(
buf_poﬁ
);

5315 
	}
}

5318 #ifde‡
UNIV_DEBUG


5322 
ulöt
 
	$buf_gë_œtched_∑ges_numbî_ö°™˚
(
buf_poﬁ_t
 *
buf_poﬁ
) {

5323 
buf_∑ge_t
 *
b
;

5324 
ulöt
 
i
;

5325 
buf_chunk_t
 *
chunk
;

5326 
ulöt
 
fixed_∑ges_numbî
 = 0;

5328 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

5330 
chunk
 = 
buf_poﬁ
->
chunks
;

5332 
i
 = 
buf_poﬁ
->
n_chunks
; i--; 
chunk
++) {

5333 
buf_block_t
 *
block
;

5334 
ulöt
 
j
;

5336 
block
 = 
chunk
->
blocks
;

5338 
j
 = 
chunk
->
size
; j--; 
block
++) {

5339 i‡(
	`buf_block_gë_°©e
(
block
Ë!
BUF_BLOCK_FILE_PAGE
) {

5343 i‡(
block
->
∑ge
.
buf_fix_cou¡
 != 0 ||

5344 
	`buf_∑ge_gë_io_fix_u∆ocked
(&
block
->
∑ge
Ë!
BUF_IO_NONE
) {

5345 
fixed_∑ges_numbî
++;

5350 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

5352 
	`muãx_íãr
(&
buf_poﬁ
->
zù_muãx
);

5356 
b
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
zù_˛ón
); b;

5357 
b
 = 
	`UT_LIST_GET_NEXT
(
li°
, b)) {

5358 
	`ut_a
(
	`buf_∑ge_gë_°©e
(
b
Ë=
BUF_BLOCK_ZIP_PAGE
);

5359 
	`ut_a
(
	`buf_∑ge_gë_io_fix
(
b
Ë!
BUF_IO_WRITE
);

5361 i‡(
b
->
buf_fix_cou¡
 !0 || 
	`buf_∑ge_gë_io_fix
(bË!
BUF_IO_NONE
) {

5362 
fixed_∑ges_numbî
++;

5366 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

5367 
b
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
Êush_li°
); b;

5368 
b
 = 
	`UT_LIST_GET_NEXT
(
li°
, b)) {

5369 
	`ut_ad
(
b
->
ö_Êush_li°
);

5371 
	`buf_∑ge_gë_°©e
(
b
)) {

5372 
BUF_BLOCK_ZIP_DIRTY
:

5373 i‡(
b
->
buf_fix_cou¡
 !0 || 
	`buf_∑ge_gë_io_fix
(bË!
BUF_IO_NONE
) {

5374 
fixed_∑ges_numbî
++;

5377 
BUF_BLOCK_FILE_PAGE
:

5380 
BUF_BLOCK_REMOVE_HASH
:

5385 
BUF_BLOCK_POOL_WATCH
:

5386 
BUF_BLOCK_ZIP_PAGE
:

5387 
BUF_BLOCK_NOT_USED
:

5388 
BUF_BLOCK_READY_FOR_USE
:

5389 
BUF_BLOCK_MEMORY
:

5390 
ut_îr‹
;

5395 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

5396 
	`muãx_exô
(&
buf_poﬁ
->
zù_muãx
);

5398  (
fixed_∑ges_numbî
);

5399 
	}
}

5403 
ulöt
 
	$buf_gë_œtched_∑ges_numbî
() {

5404 
ulöt
 
i
;

5405 
ulöt
 
tŸÆ_œtched_∑ges
 = 0;

5407 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

5408 
buf_poﬁ_t
 *
buf_poﬁ
;

5410 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

5412 
tŸÆ_œtched_∑ges
 +
	`buf_gë_œtched_∑ges_numbî_ö°™˚
(
buf_poﬁ
);

5415  (
tŸÆ_œtched_∑ges
);

5416 
	}
}

5422 
ulöt
 
	$buf_gë_n_≥ndög_ªad_ios
() {

5423 
ulöt
 
≥nd_ios
 = 0;

5425 
os_rmb
;

5426 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

5427 
≥nd_ios
 +
	`buf_poﬁ_‰om_¨øy
(
i
)->
n_≥nd_ªads
;

5430  (
≥nd_ios
);

5431 
	}
}

5436 
	$buf_gë_modifõd_øtio_p˘
() {

5437 
øtio
;

5438 
ulöt
 
Ãu_Àn
 = 0;

5439 
ulöt
 
‰ì_Àn
 = 0;

5440 
ulöt
 
Êush_li°_Àn
 = 0;

5442 
	`buf_gë_tŸÆ_li°_Àn
(&
Ãu_Àn
, &
‰ì_Àn
, &
Êush_li°_Àn
);

5444 
øtio
 = 
°©ic_ˇ°
<>(100 * 
Êush_li°_Àn
Ë/ (1 + 
Ãu_Àn
 + 
‰ì_Àn
);

5448  (
øtio
);

5449 
	}
}

5452 
	$buf_°©s_aggªg©e_poﬁ_öfo
(

5453 
buf_poﬁ_öfo_t
 *
tŸÆ_öfo
,

5456 c⁄° 
buf_poﬁ_öfo_t
 *
poﬁ_öfo
)

5459 
	`ut_a
(
tŸÆ_öfo
 && 
poﬁ_öfo
);

5462 i‡(
tŸÆ_öfo
 =
poﬁ_öfo
) {

5466 
tŸÆ_öfo
->
poﬁ_size
 +
poﬁ_öfo
->pool_size;

5467 
tŸÆ_öfo
->
Ãu_Àn
 +
poﬁ_öfo
->lru_len;

5468 
tŸÆ_öfo
->
ﬁd_Ãu_Àn
 +
poﬁ_öfo
->old_lru_len;

5469 
tŸÆ_öfo
->
‰ì_li°_Àn
 +
poﬁ_öfo
->free_list_len;

5470 
tŸÆ_öfo
->
Êush_li°_Àn
 +
poﬁ_öfo
->flush_list_len;

5471 
tŸÆ_öfo
->
n_≥nd_unzù
 +
poﬁ_öfo
->n_pend_unzip;

5472 
tŸÆ_öfo
->
n_≥nd_ªads
 +
poﬁ_öfo
->n_pend_reads;

5473 
tŸÆ_öfo
->
n_≥ndög_Êush_Ãu
 +
poﬁ_öfo
->n_pending_flush_lru;

5474 
tŸÆ_öfo
->
n_≥ndög_Êush_li°
 +
poﬁ_öfo
->n_pending_flush_list;

5475 
tŸÆ_öfo
->
n_∑ges_made_young
 +
poﬁ_öfo
->n_pages_made_young;

5476 
tŸÆ_öfo
->
n_∑ges_nŸ_made_young
 +
poﬁ_öfo
->n_pages_not_made_young;

5477 
tŸÆ_öfo
->
n_∑ges_ªad
 +
poﬁ_öfo
->n_pages_read;

5478 
tŸÆ_öfo
->
n_∑ges_¸óãd
 +
poﬁ_öfo
->n_pages_created;

5479 
tŸÆ_öfo
->
n_∑ges_wrôãn
 +
poﬁ_öfo
->n_pages_written;

5480 
tŸÆ_öfo
->
n_∑ge_gës
 +
poﬁ_öfo
->n_page_gets;

5481 
tŸÆ_öfo
->
n_ø_∑ges_ªad_∫d
 +
poﬁ_öfo
->n_ra_pages_read_rnd;

5482 
tŸÆ_öfo
->
n_ø_∑ges_ªad
 +
poﬁ_öfo
->n_ra_pages_read;

5483 
tŸÆ_öfo
->
n_ø_∑ges_evi˘ed
 +
poﬁ_öfo
->n_ra_pages_evicted;

5484 
tŸÆ_öfo
->
∑ge_made_young_øã
 +
poﬁ_öfo
->page_made_young_rate;

5485 
tŸÆ_öfo
->
∑ge_nŸ_made_young_øã
 +
poﬁ_öfo
->page_not_made_young_rate;

5486 
tŸÆ_öfo
->
∑ges_ªad_øã
 +
poﬁ_öfo
->pages_read_rate;

5487 
tŸÆ_öfo
->
∑ges_¸óãd_øã
 +
poﬁ_öfo
->pages_created_rate;

5488 
tŸÆ_öfo
->
∑ges_wrôãn_øã
 +
poﬁ_öfo
->pages_written_rate;

5489 
tŸÆ_öfo
->
n_∑ge_gë_dñè
 +
poﬁ_öfo
->n_page_get_delta;

5490 
tŸÆ_öfo
->
∑ge_ªad_dñè
 +
poﬁ_öfo
->page_read_delta;

5491 
tŸÆ_öfo
->
young_makög_dñè
 +
poﬁ_öfo
->young_making_delta;

5492 
tŸÆ_öfo
->
nŸ_young_makög_dñè
 +
poﬁ_öfo
->not_young_making_delta;

5493 
tŸÆ_öfo
->
∑ges_ªadahód_∫d_øã
 +
poﬁ_öfo
->pages_readahead_rnd_rate;

5494 
tŸÆ_öfo
->
∑ges_ªadahód_øã
 +
poﬁ_öfo
->pages_readahead_rate;

5495 
tŸÆ_öfo
->
∑ges_evi˘ed_øã
 +
poﬁ_öfo
->pages_evicted_rate;

5496 
tŸÆ_öfo
->
unzù_Ãu_Àn
 +
poﬁ_öfo
->unzip_lru_len;

5497 
tŸÆ_öfo
->
io_sum
 +
poﬁ_öfo
->io_sum;

5498 
tŸÆ_öfo
->
io_cur
 +
poﬁ_öfo
->io_cur;

5499 
tŸÆ_öfo
->
unzù_sum
 +
poﬁ_öfo
->unzip_sum;

5500 
tŸÆ_öfo
->
unzù_cur
 +
poﬁ_öfo
->unzip_cur;

5501 
	}
}

5505 
	$buf_°©s_gë_poﬁ_öfo
(

5506 
buf_poﬁ_t
 *
buf_poﬁ
,

5507 
ulöt
 
poﬁ_id
,

5508 
buf_poﬁ_öfo_t
 *
Æl_poﬁ_öfo
)

5511 
buf_poﬁ_öfo_t
 *
poﬁ_öfo
;

5512 
time_t
 
cuºít_time
;

5513 
time_ñ≠£d
;

5516 
poﬁ_öfo
 = &
Æl_poﬁ_öfo
[
poﬁ_id
];

5518 
poﬁ_öfo
->
poﬁ_unique_id
 = 
poﬁ_id
;

5520 
poﬁ_öfo
->
poﬁ_size
 = 
buf_poﬁ
->
cuº_size
;

5522 
poﬁ_öfo
->
Ãu_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
);

5524 
poﬁ_öfo
->
ﬁd_Ãu_Àn
 = 
buf_poﬁ
->
LRU_ﬁd_Àn
;

5526 
poﬁ_öfo
->
‰ì_li°_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
);

5528 
poﬁ_öfo
->
Êush_li°_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
Êush_li°
);

5530 
poﬁ_öfo
->
n_≥nd_unzù
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
unzù_LRU
);

5532 
poﬁ_öfo
->
n_≥nd_ªads
 = 
buf_poﬁ
->n_pend_reads;

5534 
poﬁ_öfo
->
n_≥ndög_Êush_Ãu
 =

5535 (
buf_poﬁ
->
n_Êush
[
BUF_FLUSH_LRU
] + buf_poﬁ->
öô_Êush
[BUF_FLUSH_LRU]);

5537 
poﬁ_öfo
->
n_≥ndög_Êush_li°
 = (
buf_poﬁ
->
n_Êush
[
BUF_FLUSH_LIST
] +

5538 
buf_poﬁ
->
öô_Êush
[
BUF_FLUSH_LIST
]);

5540 
poﬁ_öfo
->
n_≥ndög_Êush_sögÀ_∑ge
 =

5541 (
buf_poﬁ
->
n_Êush
[
BUF_FLUSH_SINGLE_PAGE
] +

5542 
buf_poﬁ
->
öô_Êush
[
BUF_FLUSH_SINGLE_PAGE
]);

5544 
cuºít_time
 = 
	`time
(
NULL
);

5545 
time_ñ≠£d
 = 0.001 + 
	`dif·ime
(
cuºít_time
, 
buf_poﬁ
->
œ°_¥ötout_time
);

5547 
poﬁ_öfo
->
n_∑ges_made_young
 = 
buf_poﬁ
->
°©
.n_pages_made_young;

5549 
poﬁ_öfo
->
n_∑ges_nŸ_made_young
 = 
buf_poﬁ
->
°©
.n_pages_not_made_young;

5551 
poﬁ_öfo
->
n_∑ges_ªad
 = 
buf_poﬁ
->
°©
.n_pages_read;

5553 
poﬁ_öfo
->
n_∑ges_¸óãd
 = 
buf_poﬁ
->
°©
.n_pages_created;

5555 
poﬁ_öfo
->
n_∑ges_wrôãn
 = 
buf_poﬁ
->
°©
.n_pages_written;

5557 
poﬁ_öfo
->
n_∑ge_gës
 = 
buf_poﬁ
->
°©
.n_page_gets;

5559 
poﬁ_öfo
->
n_ø_∑ges_ªad_∫d
 = 
buf_poﬁ
->
°©
.n_ra_pages_read_rnd;

5560 
poﬁ_öfo
->
n_ø_∑ges_ªad
 = 
buf_poﬁ
->
°©
.n_ra_pages_read;

5562 
poﬁ_öfo
->
n_ø_∑ges_evi˘ed
 = 
buf_poﬁ
->
°©
.n_ra_pages_evicted;

5564 
poﬁ_öfo
->
∑ge_made_young_øã
 = (
buf_poﬁ
->
°©
.
n_∑ges_made_young
 -

5565 
buf_poﬁ
->
ﬁd_°©
.
n_∑ges_made_young
) /

5566 
time_ñ≠£d
;

5568 
poﬁ_öfo
->
∑ge_nŸ_made_young_øã
 =

5569 (
buf_poﬁ
->
°©
.
n_∑ges_nŸ_made_young
 -

5570 
buf_poﬁ
->
ﬁd_°©
.
n_∑ges_nŸ_made_young
) /

5571 
time_ñ≠£d
;

5573 
poﬁ_öfo
->
∑ges_ªad_øã
 =

5574 (
buf_poﬁ
->
°©
.
n_∑ges_ªad
 - buf_poﬁ->
ﬁd_°©
.n_pages_read) /

5575 
time_ñ≠£d
;

5577 
poﬁ_öfo
->
∑ges_¸óãd_øã
 =

5578 (
buf_poﬁ
->
°©
.
n_∑ges_¸óãd
 - buf_poﬁ->
ﬁd_°©
.n_pages_created) /

5579 
time_ñ≠£d
;

5581 
poﬁ_öfo
->
∑ges_wrôãn_øã
 =

5582 (
buf_poﬁ
->
°©
.
n_∑ges_wrôãn
 - buf_poﬁ->
ﬁd_°©
.n_pages_written) /

5583 
time_ñ≠£d
;

5585 
poﬁ_öfo
->
n_∑ge_gë_dñè
 =

5586 
buf_poﬁ
->
°©
.
n_∑ge_gës
 - buf_poﬁ->
ﬁd_°©
.n_page_gets;

5588 i‡(
poﬁ_öfo
->
n_∑ge_gë_dñè
) {

5589 
poﬁ_öfo
->
∑ge_ªad_dñè
 =

5590 
buf_poﬁ
->
°©
.
n_∑ges_ªad
 - buf_poﬁ->
ﬁd_°©
.n_pages_read;

5592 
poﬁ_öfo
->
young_makög_dñè
 = 
buf_poﬁ
->
°©
.
n_∑ges_made_young
 -

5593 
buf_poﬁ
->
ﬁd_°©
.
n_∑ges_made_young
;

5595 
poﬁ_öfo
->
nŸ_young_makög_dñè
 =

5596 
buf_poﬁ
->
°©
.
n_∑ges_nŸ_made_young
 -

5597 
buf_poﬁ
->
ﬁd_°©
.
n_∑ges_nŸ_made_young
;

5599 
poﬁ_öfo
->
∑ges_ªadahód_∫d_øã
 =

5600 (
buf_poﬁ
->
°©
.
n_ø_∑ges_ªad_∫d
 -

5601 
buf_poﬁ
->
ﬁd_°©
.
n_ø_∑ges_ªad_∫d
) /

5602 
time_ñ≠£d
;

5604 
poﬁ_öfo
->
∑ges_ªadahód_øã
 =

5605 (
buf_poﬁ
->
°©
.
n_ø_∑ges_ªad
 - buf_poﬁ->
ﬁd_°©
.n_ra_pages_read) /

5606 
time_ñ≠£d
;

5608 
poﬁ_öfo
->
∑ges_evi˘ed_øã
 = (
buf_poﬁ
->
°©
.
n_ø_∑ges_evi˘ed
 -

5609 
buf_poﬁ
->
ﬁd_°©
.
n_ø_∑ges_evi˘ed
) /

5610 
time_ñ≠£d
;

5612 
poﬁ_öfo
->
unzù_Ãu_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
unzù_LRU
);

5614 
poﬁ_öfo
->
io_sum
 = 
buf_LRU_°©_sum
.
io
;

5616 
poﬁ_öfo
->
io_cur
 = 
buf_LRU_°©_cur
.
io
;

5618 
poﬁ_öfo
->
unzù_sum
 = 
buf_LRU_°©_sum
.
unzù
;

5620 
poﬁ_öfo
->
unzù_cur
 = 
buf_LRU_°©_cur
.
unzù
;

5622 
	`buf_ª‰esh_io_°©s
(
buf_poﬁ
);

5623 
	}
}

5626 
	$buf_¥öt_io_ö°™˚
(

5627 
buf_poﬁ_öfo_t
 *
poﬁ_öfo
,

5628 
FILE
 *
fûe
)

5630 
	`ut_ad
(
poﬁ_öfo
);

5632 
	`Ârötf
(
fûe
,

5633 "Buf„∏poﬁ sizê " 
ULINTPF


5635 "Fªêbuf„r† " 
ULINTPF


5637 "D©aba£Öage† " 
ULINTPF


5639 "Old d©aba£Öage†" 
ULINTPF


5641 "Modifõd dbÖage† " 
ULINTPF


5643 "PídögÑód† " 
ULINTPF


5645 "Pídög wrôes: LRU " 
ULINTPF
 ", flushÜist " ULINTPF

5646 ", sögÀÖagê" 
ULINTPF
 "\n",

5647 
poﬁ_öfo
->
poﬁ_size
,Öoﬁ_öfo->
‰ì_li°_Àn
,Öoﬁ_öfo->
Ãu_Àn
,

5648 
poﬁ_öfo
->
ﬁd_Ãu_Àn
,Öoﬁ_öfo->
Êush_li°_Àn
,

5649 
poﬁ_öfo
->
n_≥nd_ªads
,Öoﬁ_öfo->
n_≥ndög_Êush_Ãu
,

5650 
poﬁ_öfo
->
n_≥ndög_Êush_li°
,

5651 
poﬁ_öfo
->
n_≥ndög_Êush_sögÀ_∑ge
);

5653 
	`Ârötf
(
fûe
,

5654 "Page†madêyoung " 
ULINTPF
 ",Çot young " ULINTPF

5657 "Page†ªad " 
ULINTPF
 ", created " ULINTPF ", written " ULINTPF

5660 
poﬁ_öfo
->
n_∑ges_made_young
,Öoﬁ_öfo->
n_∑ges_nŸ_made_young
,

5661 
poﬁ_öfo
->
∑ge_made_young_øã
,Öoﬁ_öfo->
∑ge_nŸ_made_young_øã
,

5662 
poﬁ_öfo
->
n_∑ges_ªad
,Öoﬁ_öfo->
n_∑ges_¸óãd
,

5663 
poﬁ_öfo
->
n_∑ges_wrôãn
,Öoﬁ_öfo->
∑ges_ªad_øã
,

5664 
poﬁ_öfo
->
∑ges_¸óãd_øã
,Öoﬁ_öfo->
∑ges_wrôãn_øã
);

5666 i‡(
poﬁ_öfo
->
n_∑ge_gë_dñè
) {

5667 
	`Ârötf
(
fûe
,

5670 (
ul⁄g
)(1000 - (1000 * 
poﬁ_öfo
->
∑ge_ªad_dñè
 /

5671 
poﬁ_öfo
->
n_∑ge_gë_dñè
)),

5672 (
ul⁄g
)(1000 * 
poﬁ_öfo
->
young_makög_dñè
 /

5673 
poﬁ_öfo
->
n_∑ge_gë_dñè
),

5674 (
ul⁄g
)(1000 * 
poﬁ_öfo
->
nŸ_young_makög_dñè
 /

5675 
poﬁ_öfo
->
n_∑ge_gë_dñè
));

5677 
	`Âuts
("Nÿbuf„∏poﬁÖagêgë†sö˚Åhêœ°Örötout\n", 
fûe
);

5681 
	`Ârötf
(
fûe
,

5686 
poﬁ_öfo
->
∑ges_ªadahód_øã
,Öoﬁ_öfo->
∑ges_evi˘ed_øã
,

5687 
poﬁ_öfo
->
∑ges_ªadahód_∫d_øã
);

5691 
	`Ârötf
(
fûe
,

5692 "LRUÜí: " 
ULINTPF
 ", unzip_LRUÜen: " ULINTPF

5694 "I/O sum[" 
ULINTPF
 "]:cur[" ULINTPF

5696 "unzù sum[" 
ULINTPF
 "]:cur[" ULINTPF "]\n",

5697 
poﬁ_öfo
->
Ãu_Àn
,Öoﬁ_öfo->
unzù_Ãu_Àn
,Öoﬁ_öfo->
io_sum
,

5698 
poﬁ_öfo
->
io_cur
,Öoﬁ_öfo->
unzù_sum
,Öoﬁ_öfo->
unzù_cur
);

5699 
	}
}

5702 
	$buf_¥öt_io
(
FILE
 *
fûe
)

5704 
ulöt
 
i
;

5705 
buf_poﬁ_öfo_t
 *
poﬁ_öfo
;

5706 
buf_poﬁ_öfo_t
 *
poﬁ_öfo_tŸÆ
;

5711 i‡(
§v_buf_poﬁ_ö°™˚s
 > 1) {

5712 
poﬁ_öfo
 = (
buf_poﬁ_öfo_t
 *)
	`ut_zÆloc_nokey
(

5713 (
§v_buf_poﬁ_ö°™˚s
 + 1Ë*  *
poﬁ_öfo
);

5715 
poﬁ_öfo_tŸÆ
 = &
poﬁ_öfo
[
§v_buf_poﬁ_ö°™˚s
];

5717 
	`ut_a
(
§v_buf_poﬁ_ö°™˚s
 == 1);

5719 
poﬁ_öfo_tŸÆ
 = 
poﬁ_öfo
 =

5720 
°©ic_ˇ°
<
buf_poﬁ_öfo_t
 *>(
	`ut_zÆloc_nokey
( *
poﬁ_öfo
));

5723 
os_rmb
;

5725 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

5726 
buf_poﬁ_t
 *
buf_poﬁ
;

5728 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

5732 
	`buf_°©s_gë_poﬁ_öfo
(
buf_poﬁ
, 
i
, 
poﬁ_öfo
);

5736 i‡(
§v_buf_poﬁ_ö°™˚s
 > 1) {

5737 
	`buf_°©s_aggªg©e_poﬁ_öfo
(
poﬁ_öfo_tŸÆ
, &
poﬁ_öfo
[
i
]);

5742 
	`buf_¥öt_io_ö°™˚
(
poﬁ_öfo_tŸÆ
, 
fûe
);

5746 i‡(
§v_buf_poﬁ_ö°™˚s
 > 1) {

5747 
	`Âuts
(

5751 
fûe
);

5753 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

5754 
	`Ârötf
(
fûe
, "---BUFFER POOL " 
ULINTPF
 "\n", 
i
);

5755 
	`buf_¥öt_io_ö°™˚
(&
poﬁ_öfo
[
i
], 
fûe
);

5759 
	`ut_‰ì
(
poﬁ_öfo
);

5760 
	}
}

5763 
	$buf_ª‰esh_io_°©s_Æl
() {

5764 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

5765 
buf_poﬁ_t
 *
buf_poﬁ
;

5767 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

5769 
	`buf_ª‰esh_io_°©s
(
buf_poﬁ
);

5771 
	}
}

5774 
	$buf_mu°_be_Æl_‰ìd
() {

5775 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

5776 
buf_poﬁ_t
 *
buf_poﬁ
;

5778 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

5780 
	`buf_mu°_be_Æl_‰ìd_ö°™˚
(
buf_poﬁ
);

5782 
	}
}

5787 
ulöt
 
	$buf_poﬁ_check_no_≥ndög_io
() {

5788 
ulöt
 
i
;

5789 
ulöt
 
≥ndög_io
 = 0;

5791 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

5792 
buf_poﬁ_t
 *
buf_poﬁ
;

5794 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

5796 
≥ndög_io
 +
buf_poﬁ
->
n_≥nd_ªads
;

5798 
	`muãx_íãr
(&
buf_poﬁ
->
Êush_°©e_muãx
);

5799 
≥ndög_io
 ++
buf_poﬁ
->
n_Êush
[
BUF_FLUSH_LRU
] +

5800 
buf_poﬁ
->
n_Êush
[
BUF_FLUSH_SINGLE_PAGE
] +

5801 
buf_poﬁ
->
n_Êush
[
BUF_FLUSH_LIST
];

5802 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

5805  (
≥ndög_io
);

5806 
	}
}

5809 
Code
 
cuºíéy
 
nŸ
 
u£d


5813 
ulöt


5814 
	$buf_gë_‰ì_li°_Àn
()

5816 
ulöt
 
Àn
;

5818 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

5820 
Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
);

5822 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

5824 (
Àn
);

5825 
	}
}

5834 
	$meb_∑ge_öô
(c⁄° 
∑ge_id_t
 &
∑ge_id
, c⁄° 
∑ge_size_t
 &
∑ge_size
,

5835 
buf_block_t
 *
block
) {

5836 
block
->
∑ge
.
°©e
 = 
BUF_BLOCK_FILE_PAGE
;

5837 
block
->
∑ge
.
id
.
	`c›y_‰om
(
∑ge_id
);

5838 
block
->
∑ge
.
size
.
	`c›y_‰om
(
∑ge_size
);

5840 
	`∑ge_zù_des_öô
(&
block
->
∑ge
.
zù
);

5844 i‡(
∑ge_size
.
	`is_com¥es£d
()) {

5845 
	`∑ge_zù_£t_size
(&
block
->
∑ge
.
zù
, 
∑ge_size
.
	`physiˇl
());

5846 
block
->
∑ge
.
zù
.
d©a
 = block->
‰ame
 + 
∑ge_size
.
	`logiˇl
();

5848 
	`∑ge_zù_£t_size
(&
block
->
∑ge
.
zù
, 0);

5851 
ib
::
	`åa˚_1
(Ë<< "meb_∑ge_öô: block S∑˚: " << 
block
->
∑ge
.
id
.
	`•a˚
()

5852 << " , zù_size: " << 
block
->
∑ge
.
size
.
	`physiˇl
()

5853 << " unzù_size: " << 
block
->
∑ge
.
size
.
	`logiˇl
() << " }\n";

5854 
	}
}

5862 
	g°d
::
o°ªam
 &
›î©‹
<<(
°d
::o°ªam &
out
, c⁄° 
	gbuf_poﬁ_t
 &
	gbuf_poﬁ
) {

5863 #i‚de‡
UNIV_HOTBACKUP


5865 
ut_ad
(
muãx_own
(&
buf_poﬁ
.
LRU_li°_muãx
));

5866 
ut_ad
(
muãx_own
(&
buf_poﬁ
.
‰ì_li°_muãx
));

5867 
ut_ad
(
muãx_own
(&
buf_poﬁ
.
Êush_°©e_muãx
));

5868 
ut_ad
(
buf_Êush_li°_muãx_own
(&
buf_poﬁ
));

5870 
	gout
 << "[bufferÖool instance: "

5871 << "buf_poﬁ size=" << 
	gbuf_poﬁ
.
	gcuº_size


5872 << ", d©aba£Öages=" << 
UT_LIST_GET_LEN
(
buf_poﬁ
.
LRU
)

5873 << ", fªê∑ges=" << 
UT_LIST_GET_LEN
(
buf_poﬁ
.
‰ì
)

5874 << ", modifõd d©aba£Öages=" << 
UT_LIST_GET_LEN
(
buf_poﬁ
.
Êush_li°
)

5875 << ",ÇÖídög decom¥essi⁄s=" << 
	gbuf_poﬁ
.
	gn_≥nd_unzù


5876 << ",ÇÖídögÑóds=" << 
	gbuf_poﬁ
.
	gn_≥nd_ªads


5877 << ",ÇÖídög flush LRU=" << 
	gbuf_poﬁ
.
	gn_Êush
[
BUF_FLUSH_LRU
]

5878 << "Üi°=" << 
	gbuf_poﬁ
.
	gn_Êush
[
BUF_FLUSH_LIST
]

5879 << " sögÀÖage=" << 
	gbuf_poﬁ
.
	gn_Êush
[
BUF_FLUSH_SINGLE_PAGE
]

5880 << ",Öage†madêyoung=" << 
	gbuf_poﬁ
.
	g°©
.
	gn_∑ges_made_young


5881 << ",ÇŸ young=" << 
	gbuf_poﬁ
.
	g°©
.
	gn_∑ges_nŸ_made_young


5882 << ",Öage†ªad=" << 
	gbuf_poﬁ
.
	g°©
.
	gn_∑ges_ªad


5883 << ", cª©ed=" << 
	gbuf_poﬁ
.
	g°©
.
	gn_∑ges_¸óãd


5884 << ", wrôãn=" << 
	gbuf_poﬁ
.
	g°©
.
	gn_∑ges_wrôãn
 << "]";

5886  (
	gout
);

5891 c⁄° *
	gbuf_block_t
::
	$gë_∑ge_ty≥_°r
() const {

5892 
∑ge_ty≥_t
 
ty≥
 = 
	`gë_∑ge_ty≥
();

5894 
	#PAGE_TYPE
(
x
) \

5895 
x
: \

5896  (#x);

	)

5898 
ty≥
) {

5899 
	`PAGE_TYPE
(
FIL_PAGE_INDEX
);

5900 
	`PAGE_TYPE
(
FIL_PAGE_RTREE
);

5901 
	`PAGE_TYPE
(
FIL_PAGE_SDI
);

5902 
	`PAGE_TYPE
(
FIL_PAGE_UNDO_LOG
);

5903 
	`PAGE_TYPE
(
FIL_PAGE_INODE
);

5904 
	`PAGE_TYPE
(
FIL_PAGE_IBUF_FREE_LIST
);

5905 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_ALLOCATED
);

5906 
	`PAGE_TYPE
(
FIL_PAGE_IBUF_BITMAP
);

5907 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_SYS
);

5908 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_TRX_SYS
);

5909 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_FSP_HDR
);

5910 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_XDES
);

5911 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_BLOB
);

5912 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_ZBLOB
);

5913 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_ZBLOB2
);

5914 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_UNKNOWN
);

5915 
	`PAGE_TYPE
(
FIL_PAGE_COMPRESSED
);

5916 
	`PAGE_TYPE
(
FIL_PAGE_ENCRYPTED
);

5917 
	`PAGE_TYPE
(
FIL_PAGE_COMPRESSED_AND_ENCRYPTED
);

5918 
	`PAGE_TYPE
(
FIL_PAGE_ENCRYPTED_RTREE
);

5919 
	`PAGE_TYPE
(
FIL_PAGE_SDI_BLOB
);

5920 
	`PAGE_TYPE
(
FIL_PAGE_SDI_ZBLOB
);

5921 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_LOB_INDEX
);

5922 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_LOB_DATA
);

5923 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_LOB_FIRST
);

5924 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_ZLOB_FIRST
);

5925 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_ZLOB_DATA
);

5926 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_ZLOB_INDEX
);

5927 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_ZLOB_FRAG
);

5928 
	`PAGE_TYPE
(
FIL_PAGE_TYPE_ZLOB_FRAG_ENTRY
);

5930 
	`ut_ad
(0);

5932 
	}
}

5934 #i‚de‡
UNIV_HOTBACKUP


5936 
	$buf_poﬁ_‰ì_Æl
() {

5937 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

5938 
buf_poﬁ_t
 *
±r
 = &
buf_poﬁ_±r
[
i
];

5940 
	`buf_poﬁ_‰ì_ö°™˚
(
±r
);

5943 
	`buf_poﬁ_‰ì
();

5944 
	}
}

	@buf0dblwr.cc

33 
	~<sys/ty≥s.h
>

35 
	~"buf0buf.h
"

36 
	~"buf0checksum.h
"

37 
	~"buf0dblwr.h
"

38 
	~"ha_¥ŸŸy≥s.h
"

39 
	~"my_compûî.h
"

40 
	~"my_öây≥s.h
"

41 
	~"∑ge0zù.h
"

42 
	~"§v0§v.h
"

43 
	~"§v0°¨t.h
"

44 
	~"åx0purge.h
"

45 
	~"ˇl˛ock.h
"

48 
	gbuf_dblwr_öô_‹_lﬂd_∑ges_time
, 
	gbuf_dblwr_öô_‹_lﬂd_∑ges_cou¡
;

52 
buf_dblwr_t
 *
	gbuf_dblwr
 = 
NULL
;

55 
iboﬁ
 
	gbuf_dblwr_beög_¸óãd
 = 
FALSE
;

60 
iboﬁ
 
	$buf_dblwr_∑ge_öside
(
∑ge_no_t
 
∑ge_no
)

62 i‡(
buf_dblwr
 =
NULL
) {

63  (
FALSE
);

66 i‡(
∑ge_no
 >
buf_dblwr
->
block1
 &&

67 
∑ge_no
 < 
buf_dblwr
->
block1
 + 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

68  (
TRUE
);

71 i‡(
∑ge_no
 >
buf_dblwr
->
block2
 &&

72 
∑ge_no
 < 
buf_dblwr
->
block2
 + 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

73  (
TRUE
);

76  (
FALSE
);

77 
	}
}

83 
UNIV_INLINE


84 
byã
 *
	$buf_dblwr_gë
(
må_t
 *
må
)

86 
buf_block_t
 *
block
;

88 
block
 = 
	`buf_∑ge_gë
(
	`∑ge_id_t
(
TRX_SYS_SPACE
, 
TRX_SYS_PAGE_NO
),

89 
univ_∑ge_size
, 
RW_X_LATCH
, 
må
);

91 
	`buf_block_dbg_add_Àvñ
(
block
, 
SYNC_NO_ORDER_CHECK
);

93  (
	`buf_block_gë_‰ame
(
block
Ë+ 
TRX_SYS_DOUBLEWRITE
);

94 
	}
}

98 
	$buf_dblwr_sync_d©afûes
() {

101 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

105 
	`os_aio_waô_u¡û_no_≥ndög_wrôes
();

108 
	`fû_Êush_fûe_•a˚s
(
	`to_öt
(
FIL_TYPE_TABLESPACE
));

109 
	}
}

114 
	$buf_dblwr_öô
(

115 
byã
 *
doubÀwrôe
)

118 
ulöt
 
buf_size
;

120 
buf_dblwr
 = 
°©ic_ˇ°
<
buf_dblwr_t
 *>(
	`ut_zÆloc_nokey
((buf_dblwr_t)));

124 
buf_size
 = 2 * 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
;

128 
	`ut_a
(
§v_doubÀwrôe_b©ch_size
 > 0 && srv_doubÀwrôe_b©ch_sizê< 
buf_size
);

130 
	`muãx_¸óã
(
LATCH_ID_BUF_DBLWR
, &
buf_dblwr
->
muãx
);

132 
buf_dblwr
->
b_evít
 = 
	`os_evít_¸óã
("dblwr_batch_event");

133 
buf_dblwr
->
s_evít
 = 
	`os_evít_¸óã
("dblwr_single_event");

134 
buf_dblwr
->
fú°_‰ì
 = 0;

135 
buf_dblwr
->
s_ª£rved
 = 0;

136 
buf_dblwr
->
b_ª£rved
 = 0;

138 
buf_dblwr
->
block1
 =

139 
	`mach_ªad_‰om_4
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_BLOCK1
);

141 
	`¥ötf
("block1 : %lu\n",
buf_dblwr
->
block1
);

142 
buf_dblwr
->
block2
 =

143 
	`mach_ªad_‰om_4
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_BLOCK2
);

144 
	`¥ötf
("bœck2 : %lu\n",
buf_dblwr
->
block2
);

147 
buf_dblwr
->
ö_u£
 =

148 
°©ic_ˇ°
<
boﬁ
 *>(
	`ut_zÆloc_nokey
(
buf_size
 * (bool)));

150 
buf_dblwr
->
wrôe_buf_u«lig√d
 =

151 
°©ic_ˇ°
<
byã
 *>(
	`ut_mÆloc_nokey
((1 + 
buf_size
Ë* 
UNIV_PAGE_SIZE
));

153 
buf_dblwr
->
wrôe_buf
 = 
°©ic_ˇ°
<
byã
 *>(

154 
	`ut_Æign
(
buf_dblwr
->
wrôe_buf_u«lig√d
, 
UNIV_PAGE_SIZE
));

156 
buf_dblwr
->
buf_block_¨r
 =

157 
°©ic_ˇ°
<
buf_∑ge_t
 **>(
	`ut_zÆloc_nokey
(
buf_size
 * (*)));

158 
	}
}

163 
MY_ATTRIBUTE
((
w¨n_unu£d_ªsu…
))

164 
boﬁ
 
	$buf_dblwr_¸óã
() {

165 
buf_block_t
 *
block2
;

166 
buf_block_t
 *
√w_block
;

167 
byã
 *
doubÀwrôe
;

168 
byã
 *
f£g_hódî
;

169 
∑ge_no_t
 
∑ge_no
;

170 
∑ge_no_t
 
¥ev_∑ge_no
;

171 
ulöt
 
i
;

172 
må_t
 
må
;

174 c⁄° *
ˇ¬Ÿ_c⁄töue
 =

178 i‡(
buf_dblwr
) {

181  (
åue
);

184 
°¨t_agaö
:

185 
	`må_°¨t
(&
må
);

186 
buf_dblwr_beög_¸óãd
 = 
TRUE
;

188 
doubÀwrôe
 = 
	`buf_dblwr_gë
(&
må
);

190 i‡(
	`mach_ªad_‰om_4
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_MAGIC
) ==

191 
TRX_SYS_DOUBLEWRITE_MAGIC_N
) {

195 
	`buf_dblwr_öô
(
doubÀwrôe
);

197 
	`må_commô
(&
må
);

198 
buf_dblwr_beög_¸óãd
 = 
FALSE
;

199  (
åue
);

202 
ib
::
	`öfo
(
ER_IB_MSG_95
) << "Doublewrite bufferÇot found: creatingÇew";

204 
ulöt
 
mö_doubÀwrôe_size
 =

205 ((2 * 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 + 
FSP_EXTENT_SIZE
 / 2 + 100) *

206 
UNIV_PAGE_SIZE
);

207 i‡(
	`buf_poﬁ_gë_cuº_size
(Ë< 
mö_doubÀwrôe_size
) {

208 
ib
::
	`îr‹
(
ER_IB_MSG_96
Ë<< 
ˇ¬Ÿ_c⁄töue
;

210 
	`må_commô
(&
må
);

211 
buf_dblwr_beög_¸óãd
 = 
FALSE
;

212  (
Ál£
);

215 
block2
 = 
	`f£g_¸óã
(
TRX_SYS_SPACE
, 
TRX_SYS_PAGE_NO
,

216 
TRX_SYS_DOUBLEWRITE
 + 
TRX_SYS_DOUBLEWRITE_FSEG
, &
må
);

221 
	`buf_block_dbg_add_Àvñ
(
block2
, 
SYNC_NO_ORDER_CHECK
);

223 i‡(
block2
 =
NULL
) {

224 
ib
::
	`îr‹
(
ER_IB_MSG_97
Ë<< 
ˇ¬Ÿ_c⁄töue
;

229 
	`må_commô
(&
må
);

230 
buf_dblwr_beög_¸óãd
 = 
FALSE
;

231  (
Ál£
);

234 
f£g_hódî
 = 
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_FSEG
;

235 
¥ev_∑ge_no
 = 0;

237 
i
 = 0; i < 2 * 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 + 
FSP_EXTENT_SIZE
 / 2;

238 
i
++) {

239 
√w_block
 =

240 
	`f£g_Æloc_‰ì_∑ge
(
f£g_hódî
, 
¥ev_∑ge_no
 + 1, 
FSP_UP
, &
må
);

241 i‡(
√w_block
 =
NULL
) {

242 
ib
::
	`îr‹
(
ER_IB_MSG_98
Ë<< 
ˇ¬Ÿ_c⁄töue
;

244 
	`må_commô
(&
må
);

245 
buf_dblwr_beög_¸óãd
 = 
FALSE
;

246  (
Ál£
);

258 
	`ut_ad
(
	`rw_lock_gë_x_lock_cou¡
(&
√w_block
->
lock
) == 1);

259 
∑ge_no
 = 
√w_block
->
∑ge
.
id
.
	`∑ge_no
();

261 i‡(
i
 =
FSP_EXTENT_SIZE
 / 2) {

262 
	`ut_a
(
∑ge_no
 =
FSP_EXTENT_SIZE
);

263 
	`mlog_wrôe_ulöt
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_BLOCK1
, 
∑ge_no
,

264 
MLOG_4BYTES
, &
må
);

265 
	`mlog_wrôe_ulöt
(

266 
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_REPEAT
 + 
TRX_SYS_DOUBLEWRITE_BLOCK1
,

267 
∑ge_no
, 
MLOG_4BYTES
, &
må
);

269 } i‡(
i
 =
FSP_EXTENT_SIZE
 / 2 + 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

270 
	`ut_a
(
∑ge_no
 =2 * 
FSP_EXTENT_SIZE
);

271 
	`mlog_wrôe_ulöt
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_BLOCK2
, 
∑ge_no
,

272 
MLOG_4BYTES
, &
må
);

273 
	`mlog_wrôe_ulöt
(

274 
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_REPEAT
 + 
TRX_SYS_DOUBLEWRITE_BLOCK2
,

275 
∑ge_no
, 
MLOG_4BYTES
, &
må
);

277 } i‡(
i
 > 
FSP_EXTENT_SIZE
 / 2) {

278 
	`ut_a
(
∑ge_no
 =
¥ev_∑ge_no
 + 1);

281 i‡(((
i
 + 1) & 15) == 0) {

291 
	`må_commô
(&
må
);

292 
	`må_°¨t
(&
må
);

293 
doubÀwrôe
 = 
	`buf_dblwr_gë
(&
må
);

294 
f£g_hódî
 = 
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_FSEG
;

297 
¥ev_∑ge_no
 = 
∑ge_no
;

300 
	`mlog_wrôe_ulöt
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_MAGIC
,

301 
TRX_SYS_DOUBLEWRITE_MAGIC_N
, 
MLOG_4BYTES
, &
må
);

302 
	`mlog_wrôe_ulöt
(

303 
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_MAGIC
 + 
TRX_SYS_DOUBLEWRITE_REPEAT
,

304 
TRX_SYS_DOUBLEWRITE_MAGIC_N
, 
MLOG_4BYTES
, &
må
);

306 
	`mlog_wrôe_ulöt
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_SPACE_ID_STORED
,

307 
TRX_SYS_DOUBLEWRITE_SPACE_ID_STORED_N
, 
MLOG_4BYTES
, &
må
);

308 
	`må_commô
(&
må
);

311 
	`log_make_œã°_checkpoöt
();

314 
	`buf_poﬁ_övÆid©e
();

316 
ib
::
	`öfo
(
ER_IB_MSG_99
) << "Doublewrite buffer created";

318 
°¨t_agaö
;

319 
	}
}

333 
dbîr_t
 
buf_dblwr_öô_‹_lﬂd_∑ges_öã∫Æ
(
pfs_os_fûe_t
 
fûe
, c⁄° *
∑th
);

334 
dbîr_t
 
	$buf_dblwr_öô_‹_lﬂd_∑ges
(
pfs_os_fûe_t
 
fûe
, c⁄° *
∑th
) {

336 
	`¥ötf
("jesnk : AT buf_dblwr_init_or_load_pages ... it can call buf_dblwr_init_or_load_pages_internal\n");

337 
dbîr_t
 
ªt
;

339 
time•ec
 
loˇl_time
[2];

341 
	`˛ock_gëtime
(
CLOCK_MONOTONIC
, &
loˇl_time
[0]);

342 
ªt
 = 
	`buf_dblwr_öô_‹_lﬂd_∑ges_öã∫Æ
(
fûe
,
∑th
);

343 
	`˛ock_gëtime
(
CLOCK_MONOTONIC
, &
loˇl_time
[1]);

344 
	`ˇl˛ock
(
loˇl_time
, &
buf_dblwr_öô_‹_lﬂd_∑ges_time
, &
buf_dblwr_öô_‹_lﬂd_∑ges_cou¡
);

346  
ªt
;

348 
	}
}

355 
dbîr_t
 
	$buf_dblwr_öô_‹_lﬂd_∑ges_öã∫Æ
(
pfs_os_fûe_t
 
fûe
, c⁄° *
∑th
) {

356 
byã
 *
buf
;

357 
byã
 *
∑ge
;

358 
∑ge_no_t
 
block1
;

359 
∑ge_no_t
 
block2
;

360 
•a˚_id_t
 
•a˚_id
;

361 
byã
 *
ªad_buf
;

362 
byã
 *
doubÀwrôe
;

363 
byã
 *
u«lig√d_ªad_buf
;

364 
iboﬁ
 
ª£t_•a˚_ids
 = 
FALSE
;

365 
ªcv_dblwr_t
 &
ªcv_dblwr
 = 
ªcv_sys
->
dblwr
;

369 
	`¥ötf
("jesnk : AT buf_dblwr_init_or_load_pages_internal\n");

373 
u«lig√d_ªad_buf
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_mÆloc_nokey
(2 * 
UNIV_PAGE_SIZE
));

374 
	`¥ötf
("%d\n", 
UNIV_PAGE_SIZE
);

376 
ªad_buf
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_Æign
(
u«lig√d_ªad_buf
, 
UNIV_PAGE_SIZE
));

378 
	`¥ötf
("ªad_bu‡: %d\n",*
ªad_buf
);

391 
dbîr_t
 
îr
;

393 
IOReque°
 
	`ªad_ªque°
(IOReque°::
READ
);

394 
ªad_ªque°
.
	`dißbÀ_com¥essi⁄
();

397 
îr
 = 
	`os_fûe_ªad
(
ªad_ªque°
, 
fûe
, 
ªad_buf
,

398 
TRX_SYS_PAGE_NO
 * 
UNIV_PAGE_SIZE
, UNIV_PAGE_SIZE);

407 i‡(
îr
 !
DB_SUCCESS
) {

408 
ib
::
	`îr‹
(
ER_IB_MSG_100
)

410 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

411  (
îr
);

416 
doubÀwrôe
 = 
ªad_buf
 + 
TRX_SYS_DOUBLEWRITE
;

422 i‡(
	`mach_ªad_‰om_4
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_MAGIC
) ==

423 
TRX_SYS_DOUBLEWRITE_MAGIC_N
) {

426 
	`buf_dblwr_öô
(
doubÀwrôe
);

428 
block1
 = 
buf_dblwr
->block1;

429 
block2
 = 
buf_dblwr
->block2;

432 
buf
 = 
buf_dblwr
->
wrôe_buf
;

434 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

435  (
DB_SUCCESS
);

440 i‡(
	`mach_ªad_‰om_4
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_SPACE_ID_STORED
) !=

441 
TRX_SYS_DOUBLEWRITE_SPACE_ID_STORED_N
) {

448 
ª£t_•a˚_ids
 = 
TRUE
;

450 
ib
::
	`öfo
(
ER_IB_MSG_1266
)

456 
	`¥ötf
("je¢k : %s, TRX_SYS_DOBULEWRITE_BLOCK_SIZE: %d, UNIV_PAGE_SIZE: %d\n", 
__func__
, 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
, 
UNIV_PAGE_SIZE
);

463 
îr
 = 
	`os_fûe_ªad
(
ªad_ªque°
, 
fûe
, 
buf
, 
block1
 * 
UNIV_PAGE_SIZE
,

464 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 * 
UNIV_PAGE_SIZE
);

466 i‡(
îr
 !
DB_SUCCESS
) {

467 
ib
::
	`îr‹
(
ER_IB_MSG_101
) << "FailedÅoÑeadÅhe first double write buffer "

470 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

472  (
îr
);

476 
îr
 = 
	`os_fûe_ªad
(

477 
ªad_ªque°
, 
fûe
, 
buf
 + 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 * 
UNIV_PAGE_SIZE
,

478 
block2
 * 
UNIV_PAGE_SIZE
, 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 * UNIV_PAGE_SIZE);

480 i‡(
îr
 !
DB_SUCCESS
) {

481 
ib
::
	`îr‹
(
ER_IB_MSG_102
) << "FailedÅoÑeadÅhe second double write buffer "

484 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

486  (
îr
);

492 
∑ge
 = 
buf
;

507 
∑ge_no_t
 
i
 = 0; i < 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 * 2; i++) {

508 i‡(
ª£t_•a˚_ids
) {

509 
∑ge_no_t
 
sour˚_∑ge_no
;

511 
•a˚_id
 = 0;

512 
	`mach_wrôe_to_4
(
∑ge
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
, 
•a˚_id
);

520 i‡(
i
 < 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

521 
sour˚_∑ge_no
 = 
block1
 + 
i
;

523 
sour˚_∑ge_no
 = 
block2
 + 
i
 - 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
;

528 
IOReque°
 
	`wrôe_ªque°
(IOReque°::
WRITE
);

533 
wrôe_ªque°
.
	`dißbÀ_com¥essi⁄
();

536 
îr
 = 
	`os_fûe_wrôe
(
wrôe_ªque°
, 
∑th
, 
fûe
, 
∑ge
,

537 
sour˚_∑ge_no
 * 
UNIV_PAGE_SIZE
, UNIV_PAGE_SIZE);

540 
	`¥ötf
("%s, sour˚_∑ge_nÿ: %d, UNIV_PAGE_SIZE: %d\n", 
__func__
, 
sour˚_∑ge_no
, 
UNIV_PAGE_SIZE
);

542 i‡(
îr
 !
DB_SUCCESS
) {

543 
ib
::
	`îr‹
(
ER_IB_MSG_103
) << "FailedÅo writeÅoÅhe double write"

546 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

548  (
îr
);

554 
ªcv_dblwr
.
	`add
(
∑ge
);

557 
∑ge
 +
univ_∑ge_size
.
	`physiˇl
();

561 i‡(
ª£t_•a˚_ids
) {

562 
	`os_fûe_Êush
(
fûe
);

565 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

567  (
DB_SUCCESS
);

568 
	}
}

575 
	$buf_dblwr_ªcovî_∑ge
(
∑ge_no_t
 
∑ge_no_dblwr
, 
fû_•a˚_t
 *
•a˚
,

576 
∑ge_no_t
 
∑ge_no
, c⁄° 
∑ge_t
 *
∑ge
) {

577 
byã
 *
±r
;

578 
byã
 *
ªad_buf
;

580 
±r
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_mÆloc_nokey
(2 * 
UNIV_PAGE_SIZE
));

582 
ªad_buf
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_Æign
(
±r
, 
UNIV_PAGE_SIZE
));

584 
	`fû_•a˚_›í_if_√eded
(
•a˚
);

586 i‡(
∑ge_no
 >
•a˚
->
size
) {

589 i‡(
undo
::
	`is_a˘ive
(
•a˚
->
id
)) {

590 
ib
::
	`w¨n
(
ER_IB_MSG_104
Ë<< "Pagê" << 
∑ge_no_dblwr


593 << 
	`∑ge_id_t
(
•a˚
->
id
, 
∑ge_no
);

596 c⁄° 
∑ge_size_t
 
	`∑ge_size
(
•a˚
->
Êags
);

597 c⁄° 
∑ge_id_t
 
	`∑ge_id
(
•a˚
->
id
, 
∑ge_no
);

601 
	`mem£t
(
ªad_buf
, 0x0, 
∑ge_size
.
	`physiˇl
());

603 
IOReque°
 
ªque°
;

605 
ªque°
.
	`dblwr_ªcovî
();

608 
dbîr_t
 
îr
 = 
	`fû_io
(
ªque°
, 
åue
, 
∑ge_id
, 
∑ge_size
, 0,

609 
∑ge_size
.
	`physiˇl
(), 
ªad_buf
, 
NULL
);

611 i‡(
îr
 !
DB_SUCCESS
) {

612 
ib
::
	`w¨n
(
ER_IB_MSG_105
)

613 << "DoubÀ wrôêbuf„∏ªcovîy: " << 
∑ge_id
 << "Ñead failed with "

614 << "îr‹: " << 
	`ut_°ªº
(
îr
);

618 
BlockRï‹ãr
 
	`block
(
åue
, 
ªad_buf
, 
∑ge_size
,

619 
	`f•_is_checksum_dißbÀd
(
•a˚
->
id
));

621 i‡(
block
.
	`is_c‹ru±ed
()) {

622 
ib
::
	`öfo
(
ER_IB_MSG_106
) << "DatabaseÖage corruption or"

623 << "á faûed fûêªad o‡∑gê" << 
∑ge_id


627 
BlockRï‹ãr
 
	`dblwr_buf_∑ge
(
åue
, 
∑ge
, 
∑ge_size
,

628 
	`f•_is_checksum_dißbÀd
(
•a˚
->
id
));

630 i‡(
dblwr_buf_∑ge
.
	`is_c‹ru±ed
()) {

631 
ib
::
	`îr‹
(
ER_IB_MSG_107
) << "Dump ofÅheÖage:";

632 
	`buf_∑ge_¥öt
(
ªad_buf
, 
∑ge_size
, 
BUF_PAGE_PRINT_NO_CRASH
);

634 
ib
::
	`îr‹
(
ER_IB_MSG_108
) << "Dump of corresponding"

637 
	`buf_∑ge_¥öt
(
∑ge
, 
∑ge_size
, 
BUF_PAGE_PRINT_NO_CRASH
);

639 
ib
::
	`Áèl
(
ER_IB_MSG_109
) << "TheÖage inÅhe"

647 
boﬁ
 
t1
 = 
	`buf_∑ge_is_zî€s
(
ªad_buf
, 
∑ge_size
);

649 
boﬁ
 
t2
 = 
	`buf_∑ge_is_zî€s
(
∑ge
, 
∑ge_size
);

651 
BlockRï‹ãr
 
ªp‹ãr
 = 
	`BlockRï‹ãr
(

652 
åue
, 
∑ge
, 
∑ge_size
, 
	`f•_is_checksum_dißbÀd
(
•a˚
->
id
));

654 
boﬁ
 
t3
 = 
ªp‹ãr
.
	`is_c‹ru±ed
();

656 i‡(
t1
 && !(
t2
 || 
t3
)) {

662 
	`ut_‰ì
(
±r
);

670 
IOReque°
 
	`wrôe_ªque°
(IOReque°::
WRITE
);

672 
wrôe_ªque°
.
	`dißbÀ_com¥essi⁄
();

677 
îr
 = 
	`fû_io
(
wrôe_ªque°
, 
åue
, 
∑ge_id
, 
∑ge_size
, 0,

678 
∑ge_size
.
	`physiˇl
(), 
c⁄°_ˇ°
<
byã
 *>(
∑ge
), 
NULL
);

680 
	`ut_a
(
îr
 =
DB_SUCCESS
);

682 
ib
::
	`öfo
(
ER_IB_MSG_110
)

683 << "RecovîedÖagê" << 
∑ge_id
 << " fromÅhe doublewrite buffer.";

686 
	`ut_‰ì
(
±r
);

687 
	}
}

690 
	$buf_dblwr_¥o˚ss
() {

691 
∑ge_no_t
 
∑ge_no_dblwr
 = 0;

692 
ªcv_dblwr_t
 &
dblwr
 = 
ªcv_sys
->dblwr;

694 autÿ
i
 = 
dblwr
.
∑ges
.
	`begö
(); i !dblwr.∑ges.
	`íd
();

695 ++
i
, ++
∑ge_no_dblwr
) {

696 c⁄° 
byã
 *
∑ge
 = *
i
;

697 
∑ge_no_t
 
∑ge_no
 = 
	`∑ge_gë_∑ge_no
(
∑ge
);

698 
•a˚_id_t
 
•a˚_id
 = 
	`∑ge_gë_•a˚_id
(
∑ge
);

700 
fû_•a˚_t
 *
•a˚
 = 
	`fû_•a˚_gë
(
•a˚_id
);

702 i‡(
•a˚
 =
nuŒ±r
) {

707 
usög
 
Page
 = 
ªcv_dblwr_t
::Page;

709 
dblwr
.
de„ºed
.
	`push_back
(
	`Page
(
∑ge_no_dblwr
, 
∑ge
));

711 
	`buf_dblwr_ªcovî_∑ge
(
∑ge_no_dblwr
, 
•a˚
, 
∑ge_no
, 
∑ge
);

715 
dblwr
.
∑ges
.
	`˛ór
();

717 
	`fû_Êush_fûe_•a˚s
(
	`to_öt
(
FIL_TYPE_TABLESPACE
));

718 
	}
}

724 
	$buf_dblwr_ªcovî_∑ges
(
fû_•a˚_t
 *
•a˚
) {

725 
ªcv_dblwr_t
 &
dblwr
 = 
ªcv_sys
->dblwr;

727 autÿ
ô
 = 
dblwr
.
de„ºed
.
	`begö
(); ià!dblwr.de„ºed.
	`íd
();

729 
usög
 
Page
 = 
ªcv_dblwr_t
::Page;

731 
Page
 &
∑ge
 = *
ô
;

732 
•a˚_id_t
 
•a˚_id
 = 
	`∑ge_gë_•a˚_id
(
∑ge
.
m_∑ge
);

734 i‡(
•a˚_id
 =
•a˚
->
id
) {

735 
∑ge_no_t
 
∑ge_no
;

737 
∑ge_no
 = 
	`∑ge_gë_∑ge_no
(
∑ge
.
m_∑ge
);

739 
	`buf_dblwr_ªcovî_∑ge
(0, 
•a˚
, 
∑ge_no
, 
∑ge
.
m_∑ge
);

741 
∑ge
.
	`˛o£
();

743 
ô
 = 
dblwr
.
de„ºed
.
	`îa£
(it);

745 ++
ô
;

749 
	`fû_Êush_fûe_•a˚s
(
	`to_öt
(
FIL_TYPE_TABLESPACE
));

750 
	}
}

753 
	$buf_dblwr_‰ì
() {

755 
	`ut_ad
(
buf_dblwr
->
s_ª£rved
 == 0);

756 
	`ut_ad
(
buf_dblwr
->
b_ª£rved
 == 0);

758 
	`os_evít_de°roy
(
buf_dblwr
->
b_evít
);

759 
	`os_evít_de°roy
(
buf_dblwr
->
s_evít
);

760 
	`ut_‰ì
(
buf_dblwr
->
wrôe_buf_u«lig√d
);

761 
buf_dblwr
->
wrôe_buf_u«lig√d
 = 
NULL
;

763 
	`ut_‰ì
(
buf_dblwr
->
buf_block_¨r
);

764 
buf_dblwr
->
buf_block_¨r
 = 
NULL
;

766 
	`ut_‰ì
(
buf_dblwr
->
ö_u£
);

767 
buf_dblwr
->
ö_u£
 = 
NULL
;

769 
	`muãx_‰ì
(&
buf_dblwr
->
muãx
);

770 
	`ut_‰ì
(
buf_dblwr
);

771 
buf_dblwr
 = 
NULL
;

772 
	}
}

775 
	$buf_dblwr_upd©e
(

776 c⁄° 
buf_∑ge_t
 *
b∑ge
,

777 
buf_Êush_t
 
Êush_ty≥
)

779 i‡(!
§v_u£_doubÀwrôe_buf
 || 
buf_dblwr
 =
NULL
 ||

780 
	`f•_is_sy°em_ãmp‹¨y
(
b∑ge
->
id
.
	`•a˚
())) {

784 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

786 
Êush_ty≥
) {

787 
BUF_FLUSH_LIST
:

788 
BUF_FLUSH_LRU
:

789 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

791 
	`ut_ad
(
buf_dblwr
->
b©ch_ru¬ög
);

792 
	`ut_ad
(
buf_dblwr
->
b_ª£rved
 > 0);

793 
	`ut_ad
(
buf_dblwr
->
b_ª£rved
 <buf_dblwr->
fú°_‰ì
);

795 
buf_dblwr
->
b_ª£rved
--;

797 i‡(
buf_dblwr
->
b_ª£rved
 == 0) {

798 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

801 
	`fû_Êush_fûe_•a˚s
(
	`to_öt
(
FIL_TYPE_TABLESPACE
));

802 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

805 
buf_dblwr
->
fú°_‰ì
 = 0;

806 
buf_dblwr
->
b©ch_ru¬ög
 = 
Ál£
;

807 
	`os_evít_£t
(
buf_dblwr
->
b_evít
);

810 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

812 
BUF_FLUSH_SINGLE_PAGE
: {

813 c⁄° 
ulöt
 
size
 = 2 * 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
;

814 
ulöt
 
i
;

815 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

816 
i
 = 
§v_doubÀwrôe_b©ch_size
; i < 
size
; ++i) {

817 i‡(
buf_dblwr
->
buf_block_¨r
[
i
] =
b∑ge
) {

818 
buf_dblwr
->
s_ª£rved
--;

819 
buf_dblwr
->
buf_block_¨r
[
i
] = 
NULL
;

820 
buf_dblwr
->
ö_u£
[
i
] = 
Ál£
;

827 
	`ut_a
(
i
 < 
size
);

829 
	`os_evít_£t
(
buf_dblwr
->
s_evít
);

830 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

832 
BUF_FLUSH_N_TYPES
:

833 
ut_îr‹
;

835 
	}
}

838 
	$buf_dblwr_check_∑ge_l¢
(

839 c⁄° 
∑ge_t
 *
∑ge
)

841 i‡(
	`memcmp
(
∑ge
 + (
FIL_PAGE_LSN
 + 4),

842 
∑ge
 + (
UNIV_PAGE_SIZE
 - 
FIL_PAGE_END_LSN_OLD_CHKSUM
 + 4), 4)) {

843 c⁄° 
ulöt
 
l¢1
 = 
	`mach_ªad_‰om_4
(
∑ge
 + 
FIL_PAGE_LSN
 + 4);

844 c⁄° 
ulöt
 
l¢2
 = 
	`mach_ªad_‰om_4
(
∑ge
 + 
UNIV_PAGE_SIZE
 -

845 
FIL_PAGE_END_LSN_OLD_CHKSUM
 + 4);

847 
ib
::
	`îr‹
(
ER_IB_MSG_111
) << "TheÖageÅo be written seems corrupt!"

850 << 
l¢1
 << " !" << 
l¢2


854 
	}
}

858 
	$buf_dblwr_as£π_⁄_c‹ru±_block
(

859 c⁄° 
buf_block_t
 *
block
)

861 
	`buf_∑ge_¥öt
(
block
->
‰ame
, 
univ_∑ge_size
, 
BUF_PAGE_PRINT_NO_CRASH
);

863 
ib
::
	`Áèl
(
ER_IB_MSG_112
)

864 << "Aµ¨íàc‹ru±i⁄ o‡™ indexÖagê" << 
block
->
∑ge
.
id


868 
	}
}

872 
	$buf_dblwr_check_block
(

873 c⁄° 
buf_block_t
 *
block
)

875 
	`ut_ad
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

877 
	`fû_∑ge_gë_ty≥
(
block
->
‰ame
)) {

878 
FIL_PAGE_INDEX
:

879 
FIL_PAGE_RTREE
:

880 
FIL_PAGE_SDI
:

881 i‡(
	`∑ge_is_comp
(
block
->
‰ame
)) {

882 i‡(
	`∑ge_sim∂e_vÆid©e_√w
(
block
->
‰ame
)) {

885 } i‡(
	`∑ge_sim∂e_vÆid©e_ﬁd
(
block
->
‰ame
)) {

894 
FIL_PAGE_TYPE_FSP_HDR
:

895 
FIL_PAGE_IBUF_BITMAP
:

896 
FIL_PAGE_TYPE_UNKNOWN
:

898 
FIL_PAGE_UNDO_LOG
:

899 
FIL_PAGE_INODE
:

900 
FIL_PAGE_IBUF_FREE_LIST
:

901 
FIL_PAGE_TYPE_SYS
:

902 
FIL_PAGE_TYPE_TRX_SYS
:

903 
FIL_PAGE_TYPE_XDES
:

904 
FIL_PAGE_TYPE_BLOB
:

905 
FIL_PAGE_TYPE_ZBLOB
:

906 
FIL_PAGE_TYPE_ZBLOB2
:

907 
FIL_PAGE_SDI_BLOB
:

908 
FIL_PAGE_SDI_ZBLOB
:

909 
FIL_PAGE_TYPE_LOB_INDEX
:

910 
FIL_PAGE_TYPE_LOB_DATA
:

911 
FIL_PAGE_TYPE_LOB_FIRST
:

912 
FIL_PAGE_TYPE_ZLOB_FIRST
:

913 
FIL_PAGE_TYPE_ZLOB_DATA
:

914 
FIL_PAGE_TYPE_ZLOB_INDEX
:

915 
FIL_PAGE_TYPE_ZLOB_FRAG
:

916 
FIL_PAGE_TYPE_ZLOB_FRAG_ENTRY
:

917 
FIL_PAGE_TYPE_RSEG_ARRAY
:

920 
FIL_PAGE_TYPE_ALLOCATED
:

925 
	`buf_dblwr_as£π_⁄_c‹ru±_block
(
block
);

926 
	}
}

930 
	$buf_dblwr_wrôe_block_to_d©afûe
(

931 c⁄° 
buf_∑ge_t
 *
b∑ge
,

932 
boﬁ
 
sync
)

935 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

937 
ulöt
 
ty≥
 = 
IOReque°
::
WRITE
;

939 i‡(
sync
) {

940 
ty≥
 |
IOReque°
::
DO_NOT_WAKE
;

943 
dbîr_t
 
îr
;

944 
IOReque°
 
	`ªque°
(
ty≥
);

946 i‡(
b∑ge
->
zù
.
d©a
 !
NULL
) {

947 
	`ut_ad
(
b∑ge
->
size
.
	`is_com¥es£d
());

949 
îr
 =

950 
	`fû_io
(
ªque°
, 
sync
, 
b∑ge
->
id
, b∑ge->
size
, 0, b∑ge->size.
	`physiˇl
(),

951 (*)
b∑ge
->
zù
.
d©a
, (*)bpage);

953 
	`ut_a
(
îr
 =
DB_SUCCESS
);

956 
	`ut_ad
(!
b∑ge
->
size
.
	`is_com¥es£d
());

961 
buf_block_t
 *
block
 =

962 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
c⁄°_ˇ°
<
buf_∑ge_t
 *>(
b∑ge
));

964 
	`ut_a
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

965 
	`buf_dblwr_check_∑ge_l¢
(
block
->
‰ame
);

967 
îr
 = 
	`fû_io
(
ªque°
, 
sync
, 
b∑ge
->
id
, b∑ge->
size
, 0,

968 
b∑ge
->
size
.
	`physiˇl
(), 
block
->
‰ame
, block);

970 
	`ut_a
(
îr
 =
DB_SUCCESS
);

972 
	}
}

979 
	$buf_dblwr_Êush_buf„ªd_wrôes
() {

980 
ulöt
 
Àn
;

981 
dbîr_t
 
îr
;

982 
byã
 *
wrôe_buf
;

983 
ulöt
 
fú°_‰ì
;

985 i‡(!
§v_u£_doubÀwrôe_buf
 || 
buf_dblwr
 =
NULL
) {

987 
	`buf_dblwr_sync_d©afûes
();

991 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

993 
åy_agaö
:

994 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

1000 i‡(
buf_dblwr
->
fú°_‰ì
 == 0) {

1001 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

1007 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

1012 i‡(
buf_dblwr
->
b©ch_ru¬ög
) {

1015 
öt64_t
 
sig_cou¡
 = 
	`os_evít_ª£t
(
buf_dblwr
->
b_evít
);

1016 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

1018 
	`os_evít_waô_low
(
buf_dblwr
->
b_evít
, 
sig_cou¡
);

1019 
åy_agaö
;

1022 
	`ut_a
(!
buf_dblwr
->
b©ch_ru¬ög
);

1023 
	`ut_ad
(
buf_dblwr
->
fú°_‰ì
 =buf_dblwr->
b_ª£rved
);

1027 
buf_dblwr
->
b©ch_ru¬ög
 = 
åue
;

1028 
fú°_‰ì
 = 
buf_dblwr
->first_free;

1034 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

1036 
wrôe_buf
 = 
buf_dblwr
->write_buf;

1038 
ulöt
 
Àn2
 = 0, 
i
 = 0; i < 
buf_dblwr
->
fú°_‰ì
;

1039 
Àn2
 +
UNIV_PAGE_SIZE
, 
i
++) {

1040 c⁄° 
buf_block_t
 *
block
;

1042 
block
 = (
buf_block_t
 *)
buf_dblwr
->
buf_block_¨r
[
i
];

1044 i‡(
	`buf_block_gë_°©e
(
block
Ë!
BUF_BLOCK_FILE_PAGE
 ||

1045 
block
->
∑ge
.
zù
.
d©a
) {

1053 
	`buf_dblwr_check_block
(
block
);

1057 
	`buf_dblwr_check_∑ge_l¢
(
wrôe_buf
 + 
Àn2
);

1061 
Àn
 = 
	`ut_mö
(
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
, 
buf_dblwr
->
fú°_‰ì
) *

1062 
UNIV_PAGE_SIZE
;

1064 
îr
 =

1065 
	`fû_io
(
IOReque°Wrôe
, 
åue
, 
	`∑ge_id_t
(
TRX_SYS_SPACE
, 
buf_dblwr
->
block1
),

1066 
univ_∑ge_size
, 0, 
Àn
, (*)
wrôe_buf
, 
NULL
);

1068 
	`ut_a
(
îr
 =
DB_SUCCESS
);

1070 i‡(
buf_dblwr
->
fú°_‰ì
 <
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

1072 
Êush
;

1076 
Àn
 =

1077 (
buf_dblwr
->
fú°_‰ì
 - 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
Ë* 
UNIV_PAGE_SIZE
;

1079 
wrôe_buf
 =

1080 
buf_dblwr
->
wrôe_buf
 + 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 * 
UNIV_PAGE_SIZE
;

1082 
îr
 =

1083 
	`fû_io
(
IOReque°Wrôe
, 
åue
, 
	`∑ge_id_t
(
TRX_SYS_SPACE
, 
buf_dblwr
->
block2
),

1084 
univ_∑ge_size
, 0, 
Àn
, (*)
wrôe_buf
, 
NULL
);

1086 
	`ut_a
(
îr
 =
DB_SUCCESS
);

1088 
Êush
:

1090 
§v_°©s
.
dblwr_∑ges_wrôãn
.
	`add
(
buf_dblwr
->
fú°_‰ì
);

1091 
§v_°©s
.
dblwr_wrôes
.
	`öc
();

1094 
	`fû_Êush
(
TRX_SYS_SPACE
);

1111 
	`ut_ad
(
fú°_‰ì
 =
buf_dblwr
->first_free);

1112 
ulöt
 
i
 = 0; i < 
fú°_‰ì
; i++) {

1113 
	`buf_dblwr_wrôe_block_to_d©afûe
(
buf_dblwr
->
buf_block_¨r
[
i
], 
Ál£
);

1120 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

1121 
	}
}

1127 
	$buf_dblwr_add_to_b©ch
(
buf_∑ge_t
 *
b∑ge
) {

1128 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1129 
	`ut_ad
(!
	`muãx_own
(&
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
)->
LRU_li°_muãx
));

1131 
åy_agaö
:

1132 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

1134 
	`ut_a
(
buf_dblwr
->
fú°_‰ì
 <
§v_doubÀwrôe_b©ch_size
);

1136 i‡(
buf_dblwr
->
b©ch_ru¬ög
) {

1143 
öt64_t
 
sig_cou¡
 = 
	`os_evít_ª£t
(
buf_dblwr
->
b_evít
);

1144 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

1146 
	`os_evít_waô_low
(
buf_dblwr
->
b_evít
, 
sig_cou¡
);

1147 
åy_agaö
;

1150 i‡(
buf_dblwr
->
fú°_‰ì
 =
§v_doubÀwrôe_b©ch_size
) {

1151 
	`muãx_exô
(&(
buf_dblwr
->
muãx
));

1153 
	`buf_dblwr_Êush_buf„ªd_wrôes
();

1155 
åy_agaö
;

1158 
byã
 *
p
 =

1159 
buf_dblwr
->
wrôe_buf
 + 
univ_∑ge_size
.
	`physiˇl
(Ë* buf_dblwr->
fú°_‰ì
;

1161 i‡(
b∑ge
->
size
.
	`is_com¥es£d
()) {

1162 
	`UNIV_MEM_ASSERT_RW
(
b∑ge
->
zù
.
d©a
, b∑ge->
size
.
	`physiˇl
());

1165 
	`mem˝y
(
p
, 
b∑ge
->
zù
.
d©a
, b∑ge->
size
.
	`physiˇl
());

1167 
	`mem£t
(
p
 + 
b∑ge
->
size
.
	`physiˇl
(), 0x0,

1168 
univ_∑ge_size
.
	`physiˇl
(Ë- 
b∑ge
->
size
.physical());

1170 
	`ut_a
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_FILE_PAGE
);

1172 
	`UNIV_MEM_ASSERT_RW
(((
buf_block_t
 *)
b∑ge
)->
‰ame
, b∑ge->
size
.
	`logiˇl
());

1174 
	`mem˝y
(
p
, ((
buf_block_t
 *)
b∑ge
)->
‰ame
, b∑ge->
size
.
	`logiˇl
());

1177 
buf_dblwr
->
buf_block_¨r
[buf_dblwr->
fú°_‰ì
] = 
b∑ge
;

1186 
buf_dblwr
->
fú°_‰ì
++;

1189 
buf_dblwr
->
b_ª£rved
++;

1191 
	`ut_ad
(!
buf_dblwr
->
b©ch_ru¬ög
);

1192 
	`ut_ad
(
buf_dblwr
->
fú°_‰ì
 =buf_dblwr->
b_ª£rved
);

1193 
	`ut_ad
(
buf_dblwr
->
b_ª£rved
 <
§v_doubÀwrôe_b©ch_size
);

1195 i‡(
buf_dblwr
->
fú°_‰ì
 =
§v_doubÀwrôe_b©ch_size
) {

1196 
	`muãx_exô
(&(
buf_dblwr
->
muãx
));

1198 
	`buf_dblwr_Êush_buf„ªd_wrôes
();

1203 
	`muãx_exô
(&(
buf_dblwr
->
muãx
));

1204 
	}
}

1216 
	$buf_dblwr_wrôe_sögÀ_∑ge
(

1217 
buf_∑ge_t
 *
b∑ge
,

1218 
boﬁ
 
sync
)

1220 
∑ge_no_t
 
i
;

1221 
dbîr_t
 
îr
;

1222 
ulöt
 
n_¶Ÿs
;

1223 
∑ge_no_t
 
size
;

1224 
∑ge_no_t
 
off£t
;

1226 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1227 
	`ut_a
(
§v_u£_doubÀwrôe_buf
);

1228 
	`ut_a
(
buf_dblwr
 !
NULL
);

1236 
size
 = 2 * 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
;

1237 
	`ut_a
(
size
 > 
§v_doubÀwrôe_b©ch_size
);

1238 
n_¶Ÿs
 = 
size
 - 
§v_doubÀwrôe_b©ch_size
;

1240 i‡(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_FILE_PAGE
) {

1243 
	`buf_dblwr_check_block
((
buf_block_t
 *)
b∑ge
);

1247 i‡(!
b∑ge
->
zù
.
d©a
) {

1248 
	`buf_dblwr_check_∑ge_l¢
(((
buf_block_t
 *)
b∑ge
)->
‰ame
);

1252 
ªåy
:

1253 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

1254 i‡(
buf_dblwr
->
s_ª£rved
 =
n_¶Ÿs
) {

1256 
öt64_t
 
sig_cou¡
 = 
	`os_evít_ª£t
(
buf_dblwr
->
s_evít
);

1257 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

1258 
	`os_evít_waô_low
(
buf_dblwr
->
s_evít
, 
sig_cou¡
);

1260 
ªåy
;

1263 
i
 = 
§v_doubÀwrôe_b©ch_size
; i < 
size
; ++i) {

1264 i‡(!
buf_dblwr
->
ö_u£
[
i
]) {

1270 
	`ut_a
(
i
 < 
size
);

1271 
buf_dblwr
->
ö_u£
[
i
] = 
åue
;

1272 
buf_dblwr
->
s_ª£rved
++;

1273 
buf_dblwr
->
buf_block_¨r
[
i
] = 
b∑ge
;

1276 
§v_°©s
.
dblwr_∑ges_wrôãn
.
	`öc
();

1277 
§v_°©s
.
dblwr_wrôes
.
	`öc
();

1279 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

1283 i‡(
i
 < 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

1284 
off£t
 = 
buf_dblwr
->
block1
 + 
i
;

1286 
off£t
 = 
buf_dblwr
->
block2
 + 
i
 - 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
;

1300 i‡(
b∑ge
->
size
.
	`is_com¥es£d
()) {

1301 
	`mem˝y
(
buf_dblwr
->
wrôe_buf
 + 
univ_∑ge_size
.
	`physiˇl
(Ë* 
i
,

1302 
b∑ge
->
zù
.
d©a
, b∑ge->
size
.
	`physiˇl
());

1304 
	`mem£t
(
buf_dblwr
->
wrôe_buf
 + 
univ_∑ge_size
.
	`physiˇl
(Ë* 
i
 +

1305 
b∑ge
->
size
.
	`physiˇl
(),

1306 0x0, 
univ_∑ge_size
.
	`physiˇl
(Ë- 
b∑ge
->
size
.physical());

1308 
îr
 = 
	`fû_io
(
IOReque°Wrôe
, 
åue
, 
	`∑ge_id_t
(
TRX_SYS_SPACE
, 
off£t
),

1309 
univ_∑ge_size
, 0, univ_∑ge_size.
	`physiˇl
(),

1310 (*)(
buf_dblwr
->
wrôe_buf
 + 
univ_∑ge_size
.
	`physiˇl
(Ë* 
i
),

1311 
NULL
);

1316 
îr
 = 
	`fû_io
(
IOReque°Wrôe
, 
åue
, 
	`∑ge_id_t
(
TRX_SYS_SPACE
, 
off£t
),

1317 
univ_∑ge_size
, 0, univ_∑ge_size.
	`physiˇl
(),

1318 (*)((
buf_block_t
 *)
b∑ge
)->
‰ame
, 
NULL
);

1321 
	`ut_a
(
îr
 =
DB_SUCCESS
);

1324 
	`fû_Êush
(
TRX_SYS_SPACE
);

1329 
	`buf_dblwr_wrôe_block_to_d©afûe
(
b∑ge
, 
sync
);

1330 
	}
}

1335 
	gªcv_dblwr_t
::
Page
::
	$Page
(
∑ge_no_t
 
no
, c⁄° 
byã
 *
∑ge
Ë: 
	$m_no
(
no
) {

1336 
m_±r
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_mÆloc_nokey
(
UNIV_PAGE_SIZE
 * 2));

1337 
m_∑ge
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_Æign
(
m_±r
, 
UNIV_PAGE_SIZE
));

1339 
	`ut_a
(
m_±r
 !
nuŒ±r
);

1340 
	`ut_a
(
m_∑ge
 !
nuŒ±r
);

1342 
	`mem˝y
(
m_∑ge
, 
∑ge
, 
UNIV_PAGE_SIZE
);

1343 
	}
}

	@buf0dblwr_back.cc

33 
	~<sys/ty≥s.h
>

35 
	~"buf0buf.h
"

36 
	~"buf0checksum.h
"

37 
	~"buf0dblwr.h
"

38 
	~"ha_¥ŸŸy≥s.h
"

39 
	~"my_compûî.h
"

40 
	~"my_öây≥s.h
"

41 
	~"∑ge0zù.h
"

42 
	~"§v0§v.h
"

43 
	~"§v0°¨t.h
"

44 
	~"åx0purge.h
"

45 
	~"ˇl˛ock.h
"

48 
	gbuf_dblwr_öô_‹_lﬂd_∑ges_time
, 
	gbuf_dblwr_öô_‹_lﬂd_∑ges_cou¡
;

52 
buf_dblwr_t
 *
	gbuf_dblwr
 = 
NULL
;

55 
iboﬁ
 
	gbuf_dblwr_beög_¸óãd
 = 
FALSE
;

60 
iboﬁ
 
	$buf_dblwr_∑ge_öside
(
∑ge_no_t
 
∑ge_no
)

62 i‡(
buf_dblwr
 =
NULL
) {

63  (
FALSE
);

66 i‡(
∑ge_no
 >
buf_dblwr
->
block1
 &&

67 
∑ge_no
 < 
buf_dblwr
->
block1
 + 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

68  (
TRUE
);

71 i‡(
∑ge_no
 >
buf_dblwr
->
block2
 &&

72 
∑ge_no
 < 
buf_dblwr
->
block2
 + 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

73  (
TRUE
);

76  (
FALSE
);

77 
	}
}

83 
UNIV_INLINE


84 
byã
 *
	$buf_dblwr_gë
(
må_t
 *
må
)

86 
buf_block_t
 *
block
;

88 
block
 = 
	`buf_∑ge_gë
(
	`∑ge_id_t
(
TRX_SYS_SPACE
, 
TRX_SYS_PAGE_NO
),

89 
univ_∑ge_size
, 
RW_X_LATCH
, 
må
);

91 
	`buf_block_dbg_add_Àvñ
(
block
, 
SYNC_NO_ORDER_CHECK
);

93  (
	`buf_block_gë_‰ame
(
block
Ë+ 
TRX_SYS_DOUBLEWRITE
);

94 
	}
}

98 
	$buf_dblwr_sync_d©afûes
() {

101 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

105 
	`os_aio_waô_u¡û_no_≥ndög_wrôes
();

108 
	`fû_Êush_fûe_•a˚s
(
	`to_öt
(
FIL_TYPE_TABLESPACE
));

109 
	}
}

112 
	$buf_dblwr_öô
(

113 
byã
 *
doubÀwrôe
)

116 
ulöt
 
buf_size
;

118 
buf_dblwr
 = 
°©ic_ˇ°
<
buf_dblwr_t
 *>(
	`ut_zÆloc_nokey
((buf_dblwr_t)));

122 
buf_size
 = 2 * 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
;

126 
	`ut_a
(
§v_doubÀwrôe_b©ch_size
 > 0 && srv_doubÀwrôe_b©ch_sizê< 
buf_size
);

128 
	`muãx_¸óã
(
LATCH_ID_BUF_DBLWR
, &
buf_dblwr
->
muãx
);

130 
buf_dblwr
->
b_evít
 = 
	`os_evít_¸óã
("dblwr_batch_event");

131 
buf_dblwr
->
s_evít
 = 
	`os_evít_¸óã
("dblwr_single_event");

132 
buf_dblwr
->
fú°_‰ì
 = 0;

133 
buf_dblwr
->
s_ª£rved
 = 0;

134 
buf_dblwr
->
b_ª£rved
 = 0;

136 
buf_dblwr
->
block1
 =

137 
	`mach_ªad_‰om_4
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_BLOCK1
);

138 
buf_dblwr
->
block2
 =

139 
	`mach_ªad_‰om_4
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_BLOCK2
);

141 
buf_dblwr
->
ö_u£
 =

142 
°©ic_ˇ°
<
boﬁ
 *>(
	`ut_zÆloc_nokey
(
buf_size
 * (bool)));

144 
buf_dblwr
->
wrôe_buf_u«lig√d
 =

145 
°©ic_ˇ°
<
byã
 *>(
	`ut_mÆloc_nokey
((1 + 
buf_size
Ë* 
UNIV_PAGE_SIZE
));

147 
buf_dblwr
->
wrôe_buf
 = 
°©ic_ˇ°
<
byã
 *>(

148 
	`ut_Æign
(
buf_dblwr
->
wrôe_buf_u«lig√d
, 
UNIV_PAGE_SIZE
));

150 
buf_dblwr
->
buf_block_¨r
 =

151 
°©ic_ˇ°
<
buf_∑ge_t
 **>(
	`ut_zÆloc_nokey
(
buf_size
 * (*)));

152 
	}
}

157 
MY_ATTRIBUTE
((
w¨n_unu£d_ªsu…
))

158 
boﬁ
 
	$buf_dblwr_¸óã
() {

159 
buf_block_t
 *
block2
;

160 
buf_block_t
 *
√w_block
;

161 
byã
 *
doubÀwrôe
;

162 
byã
 *
f£g_hódî
;

163 
∑ge_no_t
 
∑ge_no
;

164 
∑ge_no_t
 
¥ev_∑ge_no
;

165 
ulöt
 
i
;

166 
må_t
 
må
;

168 c⁄° *
ˇ¬Ÿ_c⁄töue
 =

172 i‡(
buf_dblwr
) {

175  (
åue
);

178 
°¨t_agaö
:

179 
	`må_°¨t
(&
må
);

180 
buf_dblwr_beög_¸óãd
 = 
TRUE
;

182 
doubÀwrôe
 = 
	`buf_dblwr_gë
(&
må
);

184 i‡(
	`mach_ªad_‰om_4
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_MAGIC
) ==

185 
TRX_SYS_DOUBLEWRITE_MAGIC_N
) {

189 
	`buf_dblwr_öô
(
doubÀwrôe
);

191 
	`må_commô
(&
må
);

192 
buf_dblwr_beög_¸óãd
 = 
FALSE
;

193  (
åue
);

196 
ib
::
	`öfo
(
ER_IB_MSG_95
) << "Doublewrite bufferÇot found: creatingÇew";

198 
ulöt
 
mö_doubÀwrôe_size
 =

199 ((2 * 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 + 
FSP_EXTENT_SIZE
 / 2 + 100) *

200 
UNIV_PAGE_SIZE
);

201 i‡(
	`buf_poﬁ_gë_cuº_size
(Ë< 
mö_doubÀwrôe_size
) {

202 
ib
::
	`îr‹
(
ER_IB_MSG_96
Ë<< 
ˇ¬Ÿ_c⁄töue
;

204 
	`må_commô
(&
må
);

205 
buf_dblwr_beög_¸óãd
 = 
FALSE
;

206  (
Ál£
);

209 
block2
 = 
	`f£g_¸óã
(
TRX_SYS_SPACE
, 
TRX_SYS_PAGE_NO
,

210 
TRX_SYS_DOUBLEWRITE
 + 
TRX_SYS_DOUBLEWRITE_FSEG
, &
må
);

215 
	`buf_block_dbg_add_Àvñ
(
block2
, 
SYNC_NO_ORDER_CHECK
);

217 i‡(
block2
 =
NULL
) {

218 
ib
::
	`îr‹
(
ER_IB_MSG_97
Ë<< 
ˇ¬Ÿ_c⁄töue
;

223 
	`må_commô
(&
må
);

224 
buf_dblwr_beög_¸óãd
 = 
FALSE
;

225  (
Ál£
);

228 
f£g_hódî
 = 
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_FSEG
;

229 
¥ev_∑ge_no
 = 0;

231 
i
 = 0; i < 2 * 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 + 
FSP_EXTENT_SIZE
 / 2;

232 
i
++) {

233 
√w_block
 =

234 
	`f£g_Æloc_‰ì_∑ge
(
f£g_hódî
, 
¥ev_∑ge_no
 + 1, 
FSP_UP
, &
må
);

235 i‡(
√w_block
 =
NULL
) {

236 
ib
::
	`îr‹
(
ER_IB_MSG_98
Ë<< 
ˇ¬Ÿ_c⁄töue
;

238 
	`må_commô
(&
må
);

239 
buf_dblwr_beög_¸óãd
 = 
FALSE
;

240  (
Ál£
);

252 
	`ut_ad
(
	`rw_lock_gë_x_lock_cou¡
(&
√w_block
->
lock
) == 1);

253 
∑ge_no
 = 
√w_block
->
∑ge
.
id
.
	`∑ge_no
();

255 i‡(
i
 =
FSP_EXTENT_SIZE
 / 2) {

256 
	`ut_a
(
∑ge_no
 =
FSP_EXTENT_SIZE
);

257 
	`mlog_wrôe_ulöt
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_BLOCK1
, 
∑ge_no
,

258 
MLOG_4BYTES
, &
må
);

259 
	`mlog_wrôe_ulöt
(

260 
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_REPEAT
 + 
TRX_SYS_DOUBLEWRITE_BLOCK1
,

261 
∑ge_no
, 
MLOG_4BYTES
, &
må
);

263 } i‡(
i
 =
FSP_EXTENT_SIZE
 / 2 + 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

264 
	`ut_a
(
∑ge_no
 =2 * 
FSP_EXTENT_SIZE
);

265 
	`mlog_wrôe_ulöt
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_BLOCK2
, 
∑ge_no
,

266 
MLOG_4BYTES
, &
må
);

267 
	`mlog_wrôe_ulöt
(

268 
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_REPEAT
 + 
TRX_SYS_DOUBLEWRITE_BLOCK2
,

269 
∑ge_no
, 
MLOG_4BYTES
, &
må
);

271 } i‡(
i
 > 
FSP_EXTENT_SIZE
 / 2) {

272 
	`ut_a
(
∑ge_no
 =
¥ev_∑ge_no
 + 1);

275 i‡(((
i
 + 1) & 15) == 0) {

285 
	`må_commô
(&
må
);

286 
	`må_°¨t
(&
må
);

287 
doubÀwrôe
 = 
	`buf_dblwr_gë
(&
må
);

288 
f£g_hódî
 = 
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_FSEG
;

291 
¥ev_∑ge_no
 = 
∑ge_no
;

294 
	`mlog_wrôe_ulöt
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_MAGIC
,

295 
TRX_SYS_DOUBLEWRITE_MAGIC_N
, 
MLOG_4BYTES
, &
må
);

296 
	`mlog_wrôe_ulöt
(

297 
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_MAGIC
 + 
TRX_SYS_DOUBLEWRITE_REPEAT
,

298 
TRX_SYS_DOUBLEWRITE_MAGIC_N
, 
MLOG_4BYTES
, &
må
);

300 
	`mlog_wrôe_ulöt
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_SPACE_ID_STORED
,

301 
TRX_SYS_DOUBLEWRITE_SPACE_ID_STORED_N
, 
MLOG_4BYTES
, &
må
);

302 
	`må_commô
(&
må
);

305 
	`log_make_œã°_checkpoöt
();

308 
	`buf_poﬁ_övÆid©e
();

310 
ib
::
	`öfo
(
ER_IB_MSG_99
) << "Doublewrite buffer created";

312 
°¨t_agaö
;

313 
	}
}

327 
dbîr_t
 
buf_dblwr_öô_‹_lﬂd_∑ges_öã∫Æ
(
pfs_os_fûe_t
 
fûe
, c⁄° *
∑th
);

328 
dbîr_t
 
	$buf_dblwr_öô_‹_lﬂd_∑ges
(
pfs_os_fûe_t
 
fûe
, c⁄° *
∑th
) {

330 
	`¥ötf
("jesnk : AT buf_dblwr_init_or_load_pages ... it can call buf_dblwr_init_or_load_pages_internal\n");

331 
dbîr_t
 
ªt
;

333 
time•ec
 
loˇl_time
[2];

335 
	`˛ock_gëtime
(
CLOCK_MONOTONIC
, &
loˇl_time
[0]);

336 
ªt
 = 
	`buf_dblwr_öô_‹_lﬂd_∑ges_öã∫Æ
(
fûe
,
∑th
);

337 
	`˛ock_gëtime
(
CLOCK_MONOTONIC
, &
loˇl_time
[1]);

338 
	`ˇl˛ock
(
loˇl_time
, &
buf_dblwr_öô_‹_lﬂd_∑ges_time
, &
buf_dblwr_öô_‹_lﬂd_∑ges_cou¡
);

340  
ªt
;

342 
	}
}

349 
dbîr_t
 
	$buf_dblwr_öô_‹_lﬂd_∑ges_öã∫Æ
(
pfs_os_fûe_t
 
fûe
, c⁄° *
∑th
) {

350 
byã
 *
buf
;

351 
byã
 *
∑ge
;

352 
∑ge_no_t
 
block1
;

353 
∑ge_no_t
 
block2
;

354 
•a˚_id_t
 
•a˚_id
;

355 
byã
 *
ªad_buf
;

356 
byã
 *
doubÀwrôe
;

357 
byã
 *
u«lig√d_ªad_buf
;

358 
iboﬁ
 
ª£t_•a˚_ids
 = 
FALSE
;

359 
ªcv_dblwr_t
 &
ªcv_dblwr
 = 
ªcv_sys
->
dblwr
;

362 
	`¥ötf
("jesnk : AT buf_dblwr_init_or_load_pages_internal\n");

366 
u«lig√d_ªad_buf
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_mÆloc_nokey
(2 * 
UNIV_PAGE_SIZE
));

368 
ªad_buf
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_Æign
(
u«lig√d_ªad_buf
, 
UNIV_PAGE_SIZE
));

372 
dbîr_t
 
îr
;

374 
IOReque°
 
	`ªad_ªque°
(IOReque°::
READ
);

376 
ªad_ªque°
.
	`dißbÀ_com¥essi⁄
();

378 
îr
 = 
	`os_fûe_ªad
(
ªad_ªque°
, 
fûe
, 
ªad_buf
,

379 
TRX_SYS_PAGE_NO
 * 
UNIV_PAGE_SIZE
, UNIV_PAGE_SIZE);

381 i‡(
îr
 !
DB_SUCCESS
) {

382 
ib
::
	`îr‹
(
ER_IB_MSG_100
)

385 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

387  (
îr
);

390 
doubÀwrôe
 = 
ªad_buf
 + 
TRX_SYS_DOUBLEWRITE
;

392 i‡(
	`mach_ªad_‰om_4
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_MAGIC
) ==

393 
TRX_SYS_DOUBLEWRITE_MAGIC_N
) {

396 
	`buf_dblwr_öô
(
doubÀwrôe
);

398 
block1
 = 
buf_dblwr
->block1;

399 
block2
 = 
buf_dblwr
->block2;

401 
buf
 = 
buf_dblwr
->
wrôe_buf
;

403 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

404  (
DB_SUCCESS
);

407 i‡(
	`mach_ªad_‰om_4
(
doubÀwrôe
 + 
TRX_SYS_DOUBLEWRITE_SPACE_ID_STORED
) !=

408 
TRX_SYS_DOUBLEWRITE_SPACE_ID_STORED_N
) {

415 
ª£t_•a˚_ids
 = 
TRUE
;

417 
ib
::
	`öfo
(
ER_IB_MSG_1266
)

422 
îr
 = 
	`os_fûe_ªad
(
ªad_ªque°
, 
fûe
, 
buf
, 
block1
 * 
UNIV_PAGE_SIZE
,

423 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 * 
UNIV_PAGE_SIZE
);

425 i‡(
îr
 !
DB_SUCCESS
) {

426 
ib
::
	`îr‹
(
ER_IB_MSG_101
) << "FailedÅoÑeadÅhe first double write buffer "

429 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

431  (
îr
);

434 
îr
 = 
	`os_fûe_ªad
(

435 
ªad_ªque°
, 
fûe
, 
buf
 + 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 * 
UNIV_PAGE_SIZE
,

436 
block2
 * 
UNIV_PAGE_SIZE
, 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 * UNIV_PAGE_SIZE);

438 i‡(
îr
 !
DB_SUCCESS
) {

439 
ib
::
	`îr‹
(
ER_IB_MSG_102
) << "FailedÅoÑeadÅhe second double write buffer "

442 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

444  (
îr
);

450 
∑ge
 = 
buf
;

452 
∑ge_no_t
 
i
 = 0; i < 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 * 2; i++) {

453 i‡(
ª£t_•a˚_ids
) {

454 
∑ge_no_t
 
sour˚_∑ge_no
;

456 
•a˚_id
 = 0;

457 
	`mach_wrôe_to_4
(
∑ge
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
, 
•a˚_id
);

462 i‡(
i
 < 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

463 
sour˚_∑ge_no
 = 
block1
 + 
i
;

465 
sour˚_∑ge_no
 = 
block2
 + 
i
 - 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
;

468 
IOReque°
 
	`wrôe_ªque°
(IOReque°::
WRITE
);

473 
wrôe_ªque°
.
	`dißbÀ_com¥essi⁄
();

475 
îr
 = 
	`os_fûe_wrôe
(
wrôe_ªque°
, 
∑th
, 
fûe
, 
∑ge
,

476 
sour˚_∑ge_no
 * 
UNIV_PAGE_SIZE
, UNIV_PAGE_SIZE);

478 i‡(
îr
 !
DB_SUCCESS
) {

479 
ib
::
	`îr‹
(
ER_IB_MSG_103
) << "FailedÅo writeÅoÅhe double write"

482 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

484  (
îr
);

488 
ªcv_dblwr
.
	`add
(
∑ge
);

491 
∑ge
 +
univ_∑ge_size
.
	`physiˇl
();

494 i‡(
ª£t_•a˚_ids
) {

495 
	`os_fûe_Êush
(
fûe
);

498 
	`ut_‰ì
(
u«lig√d_ªad_buf
);

500  (
DB_SUCCESS
);

501 
	}
}

508 
	$buf_dblwr_ªcovî_∑ge
(
∑ge_no_t
 
∑ge_no_dblwr
, 
fû_•a˚_t
 *
•a˚
,

509 
∑ge_no_t
 
∑ge_no
, c⁄° 
∑ge_t
 *
∑ge
) {

510 
byã
 *
±r
;

511 
byã
 *
ªad_buf
;

513 
±r
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_mÆloc_nokey
(2 * 
UNIV_PAGE_SIZE
));

515 
ªad_buf
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_Æign
(
±r
, 
UNIV_PAGE_SIZE
));

517 
	`fû_•a˚_›í_if_√eded
(
•a˚
);

519 i‡(
∑ge_no
 >
•a˚
->
size
) {

522 i‡(
undo
::
	`is_a˘ive
(
•a˚
->
id
)) {

523 
ib
::
	`w¨n
(
ER_IB_MSG_104
Ë<< "Pagê" << 
∑ge_no_dblwr


526 << 
	`∑ge_id_t
(
•a˚
->
id
, 
∑ge_no
);

529 c⁄° 
∑ge_size_t
 
	`∑ge_size
(
•a˚
->
Êags
);

530 c⁄° 
∑ge_id_t
 
	`∑ge_id
(
•a˚
->
id
, 
∑ge_no
);

534 
	`mem£t
(
ªad_buf
, 0x0, 
∑ge_size
.
	`physiˇl
());

536 
IOReque°
 
ªque°
;

538 
ªque°
.
	`dblwr_ªcovî
();

541 
dbîr_t
 
îr
 = 
	`fû_io
(
ªque°
, 
åue
, 
∑ge_id
, 
∑ge_size
, 0,

542 
∑ge_size
.
	`physiˇl
(), 
ªad_buf
, 
NULL
);

544 i‡(
îr
 !
DB_SUCCESS
) {

545 
ib
::
	`w¨n
(
ER_IB_MSG_105
)

546 << "DoubÀ wrôêbuf„∏ªcovîy: " << 
∑ge_id
 << "Ñead failed with "

547 << "îr‹: " << 
	`ut_°ªº
(
îr
);

551 
BlockRï‹ãr
 
	`block
(
åue
, 
ªad_buf
, 
∑ge_size
,

552 
	`f•_is_checksum_dißbÀd
(
•a˚
->
id
));

554 i‡(
block
.
	`is_c‹ru±ed
()) {

555 
ib
::
	`öfo
(
ER_IB_MSG_106
) << "DatabaseÖage corruption or"

556 << "á faûed fûêªad o‡∑gê" << 
∑ge_id


560 
BlockRï‹ãr
 
	`dblwr_buf_∑ge
(
åue
, 
∑ge
, 
∑ge_size
,

561 
	`f•_is_checksum_dißbÀd
(
•a˚
->
id
));

563 i‡(
dblwr_buf_∑ge
.
	`is_c‹ru±ed
()) {

564 
ib
::
	`îr‹
(
ER_IB_MSG_107
) << "Dump ofÅheÖage:";

565 
	`buf_∑ge_¥öt
(
ªad_buf
, 
∑ge_size
, 
BUF_PAGE_PRINT_NO_CRASH
);

567 
ib
::
	`îr‹
(
ER_IB_MSG_108
) << "Dump of corresponding"

570 
	`buf_∑ge_¥öt
(
∑ge
, 
∑ge_size
, 
BUF_PAGE_PRINT_NO_CRASH
);

572 
ib
::
	`Áèl
(
ER_IB_MSG_109
) << "TheÖage inÅhe"

580 
boﬁ
 
t1
 = 
	`buf_∑ge_is_zî€s
(
ªad_buf
, 
∑ge_size
);

582 
boﬁ
 
t2
 = 
	`buf_∑ge_is_zî€s
(
∑ge
, 
∑ge_size
);

584 
BlockRï‹ãr
 
ªp‹ãr
 = 
	`BlockRï‹ãr
(

585 
åue
, 
∑ge
, 
∑ge_size
, 
	`f•_is_checksum_dißbÀd
(
•a˚
->
id
));

587 
boﬁ
 
t3
 = 
ªp‹ãr
.
	`is_c‹ru±ed
();

589 i‡(
t1
 && !(
t2
 || 
t3
)) {

595 
	`ut_‰ì
(
±r
);

603 
IOReque°
 
	`wrôe_ªque°
(IOReque°::
WRITE
);

605 
wrôe_ªque°
.
	`dißbÀ_com¥essi⁄
();

610 
îr
 = 
	`fû_io
(
wrôe_ªque°
, 
åue
, 
∑ge_id
, 
∑ge_size
, 0,

611 
∑ge_size
.
	`physiˇl
(), 
c⁄°_ˇ°
<
byã
 *>(
∑ge
), 
NULL
);

613 
	`ut_a
(
îr
 =
DB_SUCCESS
);

615 
ib
::
	`öfo
(
ER_IB_MSG_110
)

616 << "RecovîedÖagê" << 
∑ge_id
 << " fromÅhe doublewrite buffer.";

619 
	`ut_‰ì
(
±r
);

620 
	}
}

623 
	$buf_dblwr_¥o˚ss
() {

624 
∑ge_no_t
 
∑ge_no_dblwr
 = 0;

625 
ªcv_dblwr_t
 &
dblwr
 = 
ªcv_sys
->dblwr;

627 autÿ
i
 = 
dblwr
.
∑ges
.
	`begö
(); i !dblwr.∑ges.
	`íd
();

628 ++
i
, ++
∑ge_no_dblwr
) {

629 c⁄° 
byã
 *
∑ge
 = *
i
;

630 
∑ge_no_t
 
∑ge_no
 = 
	`∑ge_gë_∑ge_no
(
∑ge
);

631 
•a˚_id_t
 
•a˚_id
 = 
	`∑ge_gë_•a˚_id
(
∑ge
);

633 
fû_•a˚_t
 *
•a˚
 = 
	`fû_•a˚_gë
(
•a˚_id
);

635 i‡(
•a˚
 =
nuŒ±r
) {

640 
usög
 
Page
 = 
ªcv_dblwr_t
::Page;

642 
dblwr
.
de„ºed
.
	`push_back
(
	`Page
(
∑ge_no_dblwr
, 
∑ge
));

644 
	`buf_dblwr_ªcovî_∑ge
(
∑ge_no_dblwr
, 
•a˚
, 
∑ge_no
, 
∑ge
);

648 
dblwr
.
∑ges
.
	`˛ór
();

650 
	`fû_Êush_fûe_•a˚s
(
	`to_öt
(
FIL_TYPE_TABLESPACE
));

651 
	}
}

657 
	$buf_dblwr_ªcovî_∑ges
(
fû_•a˚_t
 *
•a˚
) {

658 
ªcv_dblwr_t
 &
dblwr
 = 
ªcv_sys
->dblwr;

660 autÿ
ô
 = 
dblwr
.
de„ºed
.
	`begö
(); ià!dblwr.de„ºed.
	`íd
();

662 
usög
 
Page
 = 
ªcv_dblwr_t
::Page;

664 
Page
 &
∑ge
 = *
ô
;

665 
•a˚_id_t
 
•a˚_id
 = 
	`∑ge_gë_•a˚_id
(
∑ge
.
m_∑ge
);

667 i‡(
•a˚_id
 =
•a˚
->
id
) {

668 
∑ge_no_t
 
∑ge_no
;

670 
∑ge_no
 = 
	`∑ge_gë_∑ge_no
(
∑ge
.
m_∑ge
);

672 
	`buf_dblwr_ªcovî_∑ge
(0, 
•a˚
, 
∑ge_no
, 
∑ge
.
m_∑ge
);

674 
∑ge
.
	`˛o£
();

676 
ô
 = 
dblwr
.
de„ºed
.
	`îa£
(it);

678 ++
ô
;

682 
	`fû_Êush_fûe_•a˚s
(
	`to_öt
(
FIL_TYPE_TABLESPACE
));

683 
	}
}

686 
	$buf_dblwr_‰ì
() {

688 
	`ut_ad
(
buf_dblwr
->
s_ª£rved
 == 0);

689 
	`ut_ad
(
buf_dblwr
->
b_ª£rved
 == 0);

691 
	`os_evít_de°roy
(
buf_dblwr
->
b_evít
);

692 
	`os_evít_de°roy
(
buf_dblwr
->
s_evít
);

693 
	`ut_‰ì
(
buf_dblwr
->
wrôe_buf_u«lig√d
);

694 
buf_dblwr
->
wrôe_buf_u«lig√d
 = 
NULL
;

696 
	`ut_‰ì
(
buf_dblwr
->
buf_block_¨r
);

697 
buf_dblwr
->
buf_block_¨r
 = 
NULL
;

699 
	`ut_‰ì
(
buf_dblwr
->
ö_u£
);

700 
buf_dblwr
->
ö_u£
 = 
NULL
;

702 
	`muãx_‰ì
(&
buf_dblwr
->
muãx
);

703 
	`ut_‰ì
(
buf_dblwr
);

704 
buf_dblwr
 = 
NULL
;

705 
	}
}

708 
	$buf_dblwr_upd©e
(

709 c⁄° 
buf_∑ge_t
 *
b∑ge
,

710 
buf_Êush_t
 
Êush_ty≥
)

712 i‡(!
§v_u£_doubÀwrôe_buf
 || 
buf_dblwr
 =
NULL
 ||

713 
	`f•_is_sy°em_ãmp‹¨y
(
b∑ge
->
id
.
	`•a˚
())) {

717 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

719 
Êush_ty≥
) {

720 
BUF_FLUSH_LIST
:

721 
BUF_FLUSH_LRU
:

722 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

724 
	`ut_ad
(
buf_dblwr
->
b©ch_ru¬ög
);

725 
	`ut_ad
(
buf_dblwr
->
b_ª£rved
 > 0);

726 
	`ut_ad
(
buf_dblwr
->
b_ª£rved
 <buf_dblwr->
fú°_‰ì
);

728 
buf_dblwr
->
b_ª£rved
--;

730 i‡(
buf_dblwr
->
b_ª£rved
 == 0) {

731 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

734 
	`fû_Êush_fûe_•a˚s
(
	`to_öt
(
FIL_TYPE_TABLESPACE
));

735 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

738 
buf_dblwr
->
fú°_‰ì
 = 0;

739 
buf_dblwr
->
b©ch_ru¬ög
 = 
Ál£
;

740 
	`os_evít_£t
(
buf_dblwr
->
b_evít
);

743 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

745 
BUF_FLUSH_SINGLE_PAGE
: {

746 c⁄° 
ulöt
 
size
 = 2 * 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
;

747 
ulöt
 
i
;

748 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

749 
i
 = 
§v_doubÀwrôe_b©ch_size
; i < 
size
; ++i) {

750 i‡(
buf_dblwr
->
buf_block_¨r
[
i
] =
b∑ge
) {

751 
buf_dblwr
->
s_ª£rved
--;

752 
buf_dblwr
->
buf_block_¨r
[
i
] = 
NULL
;

753 
buf_dblwr
->
ö_u£
[
i
] = 
Ál£
;

760 
	`ut_a
(
i
 < 
size
);

762 
	`os_evít_£t
(
buf_dblwr
->
s_evít
);

763 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

765 
BUF_FLUSH_N_TYPES
:

766 
ut_îr‹
;

768 
	}
}

771 
	$buf_dblwr_check_∑ge_l¢
(

772 c⁄° 
∑ge_t
 *
∑ge
)

774 i‡(
	`memcmp
(
∑ge
 + (
FIL_PAGE_LSN
 + 4),

775 
∑ge
 + (
UNIV_PAGE_SIZE
 - 
FIL_PAGE_END_LSN_OLD_CHKSUM
 + 4), 4)) {

776 c⁄° 
ulöt
 
l¢1
 = 
	`mach_ªad_‰om_4
(
∑ge
 + 
FIL_PAGE_LSN
 + 4);

777 c⁄° 
ulöt
 
l¢2
 = 
	`mach_ªad_‰om_4
(
∑ge
 + 
UNIV_PAGE_SIZE
 -

778 
FIL_PAGE_END_LSN_OLD_CHKSUM
 + 4);

780 
ib
::
	`îr‹
(
ER_IB_MSG_111
) << "TheÖageÅo be written seems corrupt!"

783 << 
l¢1
 << " !" << 
l¢2


787 
	}
}

791 
	$buf_dblwr_as£π_⁄_c‹ru±_block
(

792 c⁄° 
buf_block_t
 *
block
)

794 
	`buf_∑ge_¥öt
(
block
->
‰ame
, 
univ_∑ge_size
, 
BUF_PAGE_PRINT_NO_CRASH
);

796 
ib
::
	`Áèl
(
ER_IB_MSG_112
)

797 << "Aµ¨íàc‹ru±i⁄ o‡™ indexÖagê" << 
block
->
∑ge
.
id


801 
	}
}

805 
	$buf_dblwr_check_block
(

806 c⁄° 
buf_block_t
 *
block
)

808 
	`ut_ad
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

810 
	`fû_∑ge_gë_ty≥
(
block
->
‰ame
)) {

811 
FIL_PAGE_INDEX
:

812 
FIL_PAGE_RTREE
:

813 
FIL_PAGE_SDI
:

814 i‡(
	`∑ge_is_comp
(
block
->
‰ame
)) {

815 i‡(
	`∑ge_sim∂e_vÆid©e_√w
(
block
->
‰ame
)) {

818 } i‡(
	`∑ge_sim∂e_vÆid©e_ﬁd
(
block
->
‰ame
)) {

827 
FIL_PAGE_TYPE_FSP_HDR
:

828 
FIL_PAGE_IBUF_BITMAP
:

829 
FIL_PAGE_TYPE_UNKNOWN
:

831 
FIL_PAGE_UNDO_LOG
:

832 
FIL_PAGE_INODE
:

833 
FIL_PAGE_IBUF_FREE_LIST
:

834 
FIL_PAGE_TYPE_SYS
:

835 
FIL_PAGE_TYPE_TRX_SYS
:

836 
FIL_PAGE_TYPE_XDES
:

837 
FIL_PAGE_TYPE_BLOB
:

838 
FIL_PAGE_TYPE_ZBLOB
:

839 
FIL_PAGE_TYPE_ZBLOB2
:

840 
FIL_PAGE_SDI_BLOB
:

841 
FIL_PAGE_SDI_ZBLOB
:

842 
FIL_PAGE_TYPE_LOB_INDEX
:

843 
FIL_PAGE_TYPE_LOB_DATA
:

844 
FIL_PAGE_TYPE_LOB_FIRST
:

845 
FIL_PAGE_TYPE_ZLOB_FIRST
:

846 
FIL_PAGE_TYPE_ZLOB_DATA
:

847 
FIL_PAGE_TYPE_ZLOB_INDEX
:

848 
FIL_PAGE_TYPE_ZLOB_FRAG
:

849 
FIL_PAGE_TYPE_ZLOB_FRAG_ENTRY
:

850 
FIL_PAGE_TYPE_RSEG_ARRAY
:

853 
FIL_PAGE_TYPE_ALLOCATED
:

858 
	`buf_dblwr_as£π_⁄_c‹ru±_block
(
block
);

859 
	}
}

863 
	$buf_dblwr_wrôe_block_to_d©afûe
(

864 c⁄° 
buf_∑ge_t
 *
b∑ge
,

865 
boﬁ
 
sync
)

868 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

870 
ulöt
 
ty≥
 = 
IOReque°
::
WRITE
;

872 i‡(
sync
) {

873 
ty≥
 |
IOReque°
::
DO_NOT_WAKE
;

876 
dbîr_t
 
îr
;

877 
IOReque°
 
	`ªque°
(
ty≥
);

879 i‡(
b∑ge
->
zù
.
d©a
 !
NULL
) {

880 
	`ut_ad
(
b∑ge
->
size
.
	`is_com¥es£d
());

882 
îr
 =

883 
	`fû_io
(
ªque°
, 
sync
, 
b∑ge
->
id
, b∑ge->
size
, 0, b∑ge->size.
	`physiˇl
(),

884 (*)
b∑ge
->
zù
.
d©a
, (*)bpage);

886 
	`ut_a
(
îr
 =
DB_SUCCESS
);

889 
	`ut_ad
(!
b∑ge
->
size
.
	`is_com¥es£d
());

894 
buf_block_t
 *
block
 =

895 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
c⁄°_ˇ°
<
buf_∑ge_t
 *>(
b∑ge
));

897 
	`ut_a
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

898 
	`buf_dblwr_check_∑ge_l¢
(
block
->
‰ame
);

900 
îr
 = 
	`fû_io
(
ªque°
, 
sync
, 
b∑ge
->
id
, b∑ge->
size
, 0,

901 
b∑ge
->
size
.
	`physiˇl
(), 
block
->
‰ame
, block);

903 
	`ut_a
(
îr
 =
DB_SUCCESS
);

905 
	}
}

912 
	$buf_dblwr_Êush_buf„ªd_wrôes
() {

913 
ulöt
 
Àn
;

914 
dbîr_t
 
îr
;

915 
byã
 *
wrôe_buf
;

916 
ulöt
 
fú°_‰ì
;

918 i‡(!
§v_u£_doubÀwrôe_buf
 || 
buf_dblwr
 =
NULL
) {

920 
	`buf_dblwr_sync_d©afûes
();

924 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

926 
åy_agaö
:

927 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

933 i‡(
buf_dblwr
->
fú°_‰ì
 == 0) {

934 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

940 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

945 i‡(
buf_dblwr
->
b©ch_ru¬ög
) {

948 
öt64_t
 
sig_cou¡
 = 
	`os_evít_ª£t
(
buf_dblwr
->
b_evít
);

949 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

951 
	`os_evít_waô_low
(
buf_dblwr
->
b_evít
, 
sig_cou¡
);

952 
åy_agaö
;

955 
	`ut_a
(!
buf_dblwr
->
b©ch_ru¬ög
);

956 
	`ut_ad
(
buf_dblwr
->
fú°_‰ì
 =buf_dblwr->
b_ª£rved
);

960 
buf_dblwr
->
b©ch_ru¬ög
 = 
åue
;

961 
fú°_‰ì
 = 
buf_dblwr
->first_free;

967 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

969 
wrôe_buf
 = 
buf_dblwr
->write_buf;

971 
ulöt
 
Àn2
 = 0, 
i
 = 0; i < 
buf_dblwr
->
fú°_‰ì
;

972 
Àn2
 +
UNIV_PAGE_SIZE
, 
i
++) {

973 c⁄° 
buf_block_t
 *
block
;

975 
block
 = (
buf_block_t
 *)
buf_dblwr
->
buf_block_¨r
[
i
];

977 i‡(
	`buf_block_gë_°©e
(
block
Ë!
BUF_BLOCK_FILE_PAGE
 ||

978 
block
->
∑ge
.
zù
.
d©a
) {

986 
	`buf_dblwr_check_block
(
block
);

990 
	`buf_dblwr_check_∑ge_l¢
(
wrôe_buf
 + 
Àn2
);

994 
Àn
 = 
	`ut_mö
(
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
, 
buf_dblwr
->
fú°_‰ì
) *

995 
UNIV_PAGE_SIZE
;

997 
îr
 =

998 
	`fû_io
(
IOReque°Wrôe
, 
åue
, 
	`∑ge_id_t
(
TRX_SYS_SPACE
, 
buf_dblwr
->
block1
),

999 
univ_∑ge_size
, 0, 
Àn
, (*)
wrôe_buf
, 
NULL
);

1001 
	`ut_a
(
îr
 =
DB_SUCCESS
);

1003 i‡(
buf_dblwr
->
fú°_‰ì
 <
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

1005 
Êush
;

1009 
Àn
 =

1010 (
buf_dblwr
->
fú°_‰ì
 - 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
Ë* 
UNIV_PAGE_SIZE
;

1012 
wrôe_buf
 =

1013 
buf_dblwr
->
wrôe_buf
 + 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
 * 
UNIV_PAGE_SIZE
;

1015 
îr
 =

1016 
	`fû_io
(
IOReque°Wrôe
, 
åue
, 
	`∑ge_id_t
(
TRX_SYS_SPACE
, 
buf_dblwr
->
block2
),

1017 
univ_∑ge_size
, 0, 
Àn
, (*)
wrôe_buf
, 
NULL
);

1019 
	`ut_a
(
îr
 =
DB_SUCCESS
);

1021 
Êush
:

1023 
§v_°©s
.
dblwr_∑ges_wrôãn
.
	`add
(
buf_dblwr
->
fú°_‰ì
);

1024 
§v_°©s
.
dblwr_wrôes
.
	`öc
();

1027 
	`fû_Êush
(
TRX_SYS_SPACE
);

1044 
	`ut_ad
(
fú°_‰ì
 =
buf_dblwr
->first_free);

1045 
ulöt
 
i
 = 0; i < 
fú°_‰ì
; i++) {

1046 
	`buf_dblwr_wrôe_block_to_d©afûe
(
buf_dblwr
->
buf_block_¨r
[
i
], 
Ál£
);

1053 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

1054 
	}
}

1060 
	$buf_dblwr_add_to_b©ch
(
buf_∑ge_t
 *
b∑ge
) {

1061 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1062 
	`ut_ad
(!
	`muãx_own
(&
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
)->
LRU_li°_muãx
));

1064 
åy_agaö
:

1065 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

1067 
	`ut_a
(
buf_dblwr
->
fú°_‰ì
 <
§v_doubÀwrôe_b©ch_size
);

1069 i‡(
buf_dblwr
->
b©ch_ru¬ög
) {

1076 
öt64_t
 
sig_cou¡
 = 
	`os_evít_ª£t
(
buf_dblwr
->
b_evít
);

1077 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

1079 
	`os_evít_waô_low
(
buf_dblwr
->
b_evít
, 
sig_cou¡
);

1080 
åy_agaö
;

1083 i‡(
buf_dblwr
->
fú°_‰ì
 =
§v_doubÀwrôe_b©ch_size
) {

1084 
	`muãx_exô
(&(
buf_dblwr
->
muãx
));

1086 
	`buf_dblwr_Êush_buf„ªd_wrôes
();

1088 
åy_agaö
;

1091 
byã
 *
p
 =

1092 
buf_dblwr
->
wrôe_buf
 + 
univ_∑ge_size
.
	`physiˇl
(Ë* buf_dblwr->
fú°_‰ì
;

1094 i‡(
b∑ge
->
size
.
	`is_com¥es£d
()) {

1095 
	`UNIV_MEM_ASSERT_RW
(
b∑ge
->
zù
.
d©a
, b∑ge->
size
.
	`physiˇl
());

1098 
	`mem˝y
(
p
, 
b∑ge
->
zù
.
d©a
, b∑ge->
size
.
	`physiˇl
());

1100 
	`mem£t
(
p
 + 
b∑ge
->
size
.
	`physiˇl
(), 0x0,

1101 
univ_∑ge_size
.
	`physiˇl
(Ë- 
b∑ge
->
size
.physical());

1103 
	`ut_a
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_FILE_PAGE
);

1105 
	`UNIV_MEM_ASSERT_RW
(((
buf_block_t
 *)
b∑ge
)->
‰ame
, b∑ge->
size
.
	`logiˇl
());

1107 
	`mem˝y
(
p
, ((
buf_block_t
 *)
b∑ge
)->
‰ame
, b∑ge->
size
.
	`logiˇl
());

1110 
buf_dblwr
->
buf_block_¨r
[buf_dblwr->
fú°_‰ì
] = 
b∑ge
;

1112 
buf_dblwr
->
fú°_‰ì
++;

1113 
buf_dblwr
->
b_ª£rved
++;

1115 
	`ut_ad
(!
buf_dblwr
->
b©ch_ru¬ög
);

1116 
	`ut_ad
(
buf_dblwr
->
fú°_‰ì
 =buf_dblwr->
b_ª£rved
);

1117 
	`ut_ad
(
buf_dblwr
->
b_ª£rved
 <
§v_doubÀwrôe_b©ch_size
);

1119 i‡(
buf_dblwr
->
fú°_‰ì
 =
§v_doubÀwrôe_b©ch_size
) {

1120 
	`muãx_exô
(&(
buf_dblwr
->
muãx
));

1122 
	`buf_dblwr_Êush_buf„ªd_wrôes
();

1127 
	`muãx_exô
(&(
buf_dblwr
->
muãx
));

1128 
	}
}

1137 
	$buf_dblwr_wrôe_sögÀ_∑ge
(

1138 
buf_∑ge_t
 *
b∑ge
,

1139 
boﬁ
 
sync
)

1141 
∑ge_no_t
 
i
;

1142 
dbîr_t
 
îr
;

1143 
ulöt
 
n_¶Ÿs
;

1144 
∑ge_no_t
 
size
;

1145 
∑ge_no_t
 
off£t
;

1147 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1148 
	`ut_a
(
§v_u£_doubÀwrôe_buf
);

1149 
	`ut_a
(
buf_dblwr
 !
NULL
);

1154 
size
 = 2 * 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
;

1155 
	`ut_a
(
size
 > 
§v_doubÀwrôe_b©ch_size
);

1156 
n_¶Ÿs
 = 
size
 - 
§v_doubÀwrôe_b©ch_size
;

1158 i‡(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_FILE_PAGE
) {

1161 
	`buf_dblwr_check_block
((
buf_block_t
 *)
b∑ge
);

1165 i‡(!
b∑ge
->
zù
.
d©a
) {

1166 
	`buf_dblwr_check_∑ge_l¢
(((
buf_block_t
 *)
b∑ge
)->
‰ame
);

1170 
ªåy
:

1171 
	`muãx_íãr
(&
buf_dblwr
->
muãx
);

1172 i‡(
buf_dblwr
->
s_ª£rved
 =
n_¶Ÿs
) {

1174 
öt64_t
 
sig_cou¡
 = 
	`os_evít_ª£t
(
buf_dblwr
->
s_evít
);

1175 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

1176 
	`os_evít_waô_low
(
buf_dblwr
->
s_evít
, 
sig_cou¡
);

1178 
ªåy
;

1181 
i
 = 
§v_doubÀwrôe_b©ch_size
; i < 
size
; ++i) {

1182 i‡(!
buf_dblwr
->
ö_u£
[
i
]) {

1188 
	`ut_a
(
i
 < 
size
);

1189 
buf_dblwr
->
ö_u£
[
i
] = 
åue
;

1190 
buf_dblwr
->
s_ª£rved
++;

1191 
buf_dblwr
->
buf_block_¨r
[
i
] = 
b∑ge
;

1194 
§v_°©s
.
dblwr_∑ges_wrôãn
.
	`öc
();

1195 
§v_°©s
.
dblwr_wrôes
.
	`öc
();

1197 
	`muãx_exô
(&
buf_dblwr
->
muãx
);

1201 i‡(
i
 < 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
) {

1202 
off£t
 = 
buf_dblwr
->
block1
 + 
i
;

1204 
off£t
 = 
buf_dblwr
->
block2
 + 
i
 - 
TRX_SYS_DOUBLEWRITE_BLOCK_SIZE
;

1218 i‡(
b∑ge
->
size
.
	`is_com¥es£d
()) {

1219 
	`mem˝y
(
buf_dblwr
->
wrôe_buf
 + 
univ_∑ge_size
.
	`physiˇl
(Ë* 
i
,

1220 
b∑ge
->
zù
.
d©a
, b∑ge->
size
.
	`physiˇl
());

1222 
	`mem£t
(
buf_dblwr
->
wrôe_buf
 + 
univ_∑ge_size
.
	`physiˇl
(Ë* 
i
 +

1223 
b∑ge
->
size
.
	`physiˇl
(),

1224 0x0, 
univ_∑ge_size
.
	`physiˇl
(Ë- 
b∑ge
->
size
.physical());

1226 
îr
 = 
	`fû_io
(
IOReque°Wrôe
, 
åue
, 
	`∑ge_id_t
(
TRX_SYS_SPACE
, 
off£t
),

1227 
univ_∑ge_size
, 0, univ_∑ge_size.
	`physiˇl
(),

1228 (*)(
buf_dblwr
->
wrôe_buf
 + 
univ_∑ge_size
.
	`physiˇl
(Ë* 
i
),

1229 
NULL
);

1234 
îr
 = 
	`fû_io
(
IOReque°Wrôe
, 
åue
, 
	`∑ge_id_t
(
TRX_SYS_SPACE
, 
off£t
),

1235 
univ_∑ge_size
, 0, univ_∑ge_size.
	`physiˇl
(),

1236 (*)((
buf_block_t
 *)
b∑ge
)->
‰ame
, 
NULL
);

1239 
	`ut_a
(
îr
 =
DB_SUCCESS
);

1242 
	`fû_Êush
(
TRX_SYS_SPACE
);

1247 
	`buf_dblwr_wrôe_block_to_d©afûe
(
b∑ge
, 
sync
);

1248 
	}
}

1253 
	gªcv_dblwr_t
::
Page
::
	$Page
(
∑ge_no_t
 
no
, c⁄° 
byã
 *
∑ge
Ë: 
	$m_no
(
no
) {

1254 
m_±r
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_mÆloc_nokey
(
UNIV_PAGE_SIZE
 * 2));

1255 
m_∑ge
 = 
°©ic_ˇ°
<
byã
 *>(
	`ut_Æign
(
m_±r
, 
UNIV_PAGE_SIZE
));

1257 
	`ut_a
(
m_±r
 !
nuŒ±r
);

1258 
	`ut_a
(
m_∑ge
 !
nuŒ±r
);

1260 
	`mem˝y
(
m_∑ge
, 
∑ge
, 
UNIV_PAGE_SIZE
);

1261 
	}
}

	@buf0dump.cc

33 
	~<î∫o.h
>

34 
	~<°d¨g.h
>

35 
	~<°dio.h
>

36 
	~<Æg‹ôhm
>

38 
	~"buf0buf.h
"

39 
	~"buf0dump.h
"

40 
	~"di˘0di˘.h
"

42 
	~"my_io.h
"

43 
	~"my_psi_c⁄fig.h
"

44 
	~"my_sys.h
"

45 
	~"my_thªad.h
"

46 
	~"mysql/psi/mysql_°age.h
"

47 
	~"os0fûe.h
"

48 
	~"os0thªad-¸óã.h
"

49 
	~"os0thªad.h
"

50 
	~"§v0§v.h
"

51 
	~"§v0°¨t.h
"

52 
	~"sync0rw.h
"

53 
	~"univ.i
"

54 
	~"ut0byã.h
"

56 
	e°©us_£vîôy
 { 
	mSTATUS_VERBOSE
, 
	mSTATUS_INFO
, 
	mSTATUS_ERR
 };

58 
	#SHUTTING_DOWN
(Ë(
§v_shutdown_°©e
 !
SRV_SHUTDOWN_NONE
)

	)

62 
iboﬁ
 
	gbuf_dump_should_°¨t
 = 
FALSE
;

63 
iboﬁ
 
	gbuf_lﬂd_should_°¨t
 = 
FALSE
;

65 
iboﬁ
 
	gbuf_lﬂd_ab‹t_Êag
 = 
FALSE
;

71 
ib_uöt64_t
 
	tbuf_dump_t
;

74 
	#BUF_DUMP_CREATE
(
•a˚
, 
∑ge
Ë
	`ut_uŒ_¸óã
(•a˚,Öage)

	)

75 
	#BUF_DUMP_SPACE
(
a
Ë
°©ic_ˇ°
<
•a˚_id_t
>(◊Ë>> 32)

	)

76 
	#BUF_DUMP_PAGE
(
a
Ë
°©ic_ˇ°
<
∑ge_no_t
>(◊)&0xFFFFFFFFUL)

	)

82 
	$buf_dump_°¨t
() {

83 
buf_dump_should_°¨t
 = 
TRUE
;

84 
	`os_evít_£t
(
§v_buf_dump_evít
);

85 
	}
}

91 
	$buf_lﬂd_°¨t
() {

92 
buf_lﬂd_should_°¨t
 = 
TRUE
;

93 
	`os_evít_£t
(
§v_buf_dump_evít
);

94 
	}
}

104 
MY_ATTRIBUTE
((
	$f‹m©
(
¥ötf
, 2, 3))Ë
	$buf_dump_°©us
(

105 
°©us_£vîôy
 
£vîôy
,

106 c⁄° *
fmt
,

110 
va_li°
 
≠
;

112 
	`va_°¨t
(
≠
, 
fmt
);

114 
	`ut_v¢¥ötf
(
exp‹t_v¨s
.
önodb_buf„r_poﬁ_dump_°©us
,

115 (
exp‹t_v¨s
.
önodb_buf„r_poﬁ_dump_°©us
), 
fmt
, 
≠
);

117 
£vîôy
) {

118 
STATUS_INFO
:

119 
ib
::
	`öfo
(
ER_IB_MSG_119
Ë<< 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_dump_°©us
;

122 
STATUS_ERR
:

123 
ib
::
	`îr‹
(
ER_IB_MSG_120
Ë<< 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_dump_°©us
;

126 
STATUS_VERBOSE
:

130 
	`va_íd
(
≠
);

131 
	}
}

141 
MY_ATTRIBUTE
((
	$f‹m©
(
¥ötf
, 2, 3))Ë
	$buf_lﬂd_°©us
(

142 
°©us_£vîôy
 
£vîôy
,

143 c⁄° *
fmt
,

146 
va_li°
 
≠
;

148 
	`va_°¨t
(
≠
, 
fmt
);

150 
	`ut_v¢¥ötf
(
exp‹t_v¨s
.
önodb_buf„r_poﬁ_lﬂd_°©us
,

151 (
exp‹t_v¨s
.
önodb_buf„r_poﬁ_lﬂd_°©us
), 
fmt
, 
≠
);

153 
£vîôy
) {

154 
STATUS_INFO
:

155 
ib
::
	`öfo
(
ER_IB_MSG_121
Ë<< 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_lﬂd_°©us
;

158 
STATUS_ERR
:

159 
ib
::
	`îr‹
(
ER_IB_MSG_122
Ë<< 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_lﬂd_°©us
;

162 
STATUS_VERBOSE
:

166 
	`va_íd
(
≠
);

167 
	}
}

171 c⁄° *
	$gë_buf_dump_dú
() {

172 c⁄° *
dump_dú
;

176 i‡(
	`°rcmp
(
§v_d©a_home
, "") == 0) {

177 
dump_dú
 = 
MySQL_d©adú_∑th
;

179 
dump_dú
 = 
§v_d©a_home
;

182  (
dump_dú
);

183 
	}
}

188 
	$buf_dump_gíî©e_∑th
(*
∑th
, 
size_t
 
∑th_size
) {

189 
buf
[
FN_REFLEN
];

191 
	`¢¥ötf
(
buf
, (buf), "%s%c%s", 
	`gë_buf_dump_dú
(), 
OS_PATH_SEPARATOR
,

192 
§v_buf_dump_fûíame
);

194 
os_fûe_ty≥_t
 
ty≥
;

195 
boﬁ
 
exi°s
 = 
Ál£
;

196 
boﬁ
 
ªt
;

198 
ªt
 = 
	`os_fûe_°©us
(
buf
, &
exi°s
, &
ty≥
);

202 i‡(
ªt
 && 
exi°s
) {

205 
	`ut_a
(
∑th_size
 >
FN_REFLEN
);

207 
	`my_ªÆ∑th
(
∑th
, 
buf
, 0);

211 
§v_d©a_home_fuŒ
[
FN_REFLEN
];

213 
	`my_ªÆ∑th
(
§v_d©a_home_fuŒ
, 
	`gë_buf_dump_dú
(), 0);

215 i‡(
§v_d©a_home_fuŒ
[
	`°æí
(srv_data_home_full) - 1] ==

216 
OS_PATH_SEPARATOR
) {

217 
	`¢¥ötf
(
∑th
, 
∑th_size
, "%s%s", 
§v_d©a_home_fuŒ
,

218 
§v_buf_dump_fûíame
);

220 
	`¢¥ötf
(
∑th
, 
∑th_size
, "%s%c%s", 
§v_d©a_home_fuŒ
, 
OS_PATH_SEPARATOR
,

221 
§v_buf_dump_fûíame
);

224 
	}
}

232 
	$buf_dump
(
iboﬁ
 
obey_shutdown
) {

233 
	#SHOULD_QUIT
(Ë(
	`SHUTTING_DOWN
(Ë&& 
obey_shutdown
)

	)

235 
fuŒ_fûíame
[
OS_FILE_MAX_PATH
];

236 
tmp_fûíame
[
OS_FILE_MAX_PATH
 + 11];

237 
now
[32];

238 
FILE
 *
f
;

239 
ulöt
 
i
;

240 
ªt
;

242 
	`buf_dump_gíî©e_∑th
(
fuŒ_fûíame
, (full_filename));

244 
	`¢¥ötf
(
tmp_fûíame
, —mp_fûíame), "%s.öcom∂ëe", 
fuŒ_fûíame
);

246 
	`buf_dump_°©us
(
STATUS_INFO
, "Dumpög buf„∏poﬁ(sËtÿ%s", 
fuŒ_fûíame
);

248 
f
 = 
	`f›í
(
tmp_fûíame
, "w");

249 i‡(
f
 =
NULL
) {

250 
	`buf_dump_°©us
(
STATUS_ERR
, "Cannot open '%s' for writing: %s",

251 
tmp_fûíame
, 
	`°ªº‹
(
î∫o
));

257 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
 && !
	`SHOULD_QUIT
(); i++) {

258 
buf_poﬁ_t
 *
buf_poﬁ
;

259 c⁄° 
buf_∑ge_t
 *
b∑ge
;

260 
buf_dump_t
 *
dump
;

261 
ulöt
 
n_∑ges
;

262 
ulöt
 
j
;

264 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

268 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

270 
n_∑ges
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
);

273 i‡(
n_∑ges
 == 0) {

274 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

278 i‡(
§v_buf_poﬁ_dump_p˘
 != 100) {

279 
	`ut_ad
(
§v_buf_poﬁ_dump_p˘
 < 100);

281 
n_∑ges
 =Ç_∑ge†* 
§v_buf_poﬁ_dump_p˘
 / 100;

283 i‡(
n_∑ges
 == 0) {

284 
n_∑ges
 = 1;

288 
dump
 = 
°©ic_ˇ°
<
buf_dump_t
 *>(
	`ut_mÆloc_nokey
(
n_∑ges
 * (*dump)));

290 i‡(
dump
 =
NULL
) {

291 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

292 
	`f˛o£
(
f
);

293 
	`buf_dump_°©us
(
STATUS_ERR
, "C™nŸáŒoˇã " 
ULINTPF
 " bytes: %s",

294 (
ulöt
)(
n_∑ges
 * (*
dump
)), 
	`°ªº‹
(
î∫o
));

299 
b∑ge
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
LRU
), 
j
 = 0;

300 
b∑ge
 !
NULL
 && 
j
 < 
n_∑ges
;

301 
b∑ge
 = 
	`UT_LIST_GET_NEXT
(
LRU
, b∑ge), 
j
++) {

302 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

304 
dump
[
j
] = 
	`BUF_DUMP_CREATE
(
b∑ge
->
id
.
	`•a˚
(), b∑ge->id.
	`∑ge_no
());

307 
	`ut_a
(
j
 =
n_∑ges
);

309 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

311 
j
 = 0; j < 
n_∑ges
 && !
	`SHOULD_QUIT
(); j++) {

312 
ªt
 = 
	`Ârötf
(
f
, 
SPACE_ID_PF
 "," 
PAGE_NO_PF
 "\n", 
	`BUF_DUMP_SPACE
(
dump
[
j
]),

313 
	`BUF_DUMP_PAGE
(
dump
[
j
]));

314 i‡(
ªt
 < 0) {

315 
	`ut_‰ì
(
dump
);

316 
	`f˛o£
(
f
);

317 
	`buf_dump_°©us
(
STATUS_ERR
, "C™nŸ wrôêtÿ'%s': %s", 
tmp_fûíame
,

318 
	`°ªº‹
(
î∫o
));

323 i‡(
j
 % 128 == 0) {

324 
	`buf_dump_°©us
(
STATUS_VERBOSE
,

326 " " 
ULINTPF
 "/" ULINTPF

328 "Öagê" 
ULINTPF
 "/" ULINTPF,

329 
i
 + 1, 
§v_buf_poﬁ_ö°™˚s
, 
j
 + 1, 
n_∑ges
);

333 
	`ut_‰ì
(
dump
);

336 
ªt
 = 
	`f˛o£
(
f
);

337 i‡(
ªt
 != 0) {

338 
	`buf_dump_°©us
(
STATUS_ERR
, "C™nŸ clo£ '%s': %s", 
tmp_fûíame
,

339 
	`°ªº‹
(
î∫o
));

344 
ªt
 = 
	`u∆ök
(
fuŒ_fûíame
);

345 i‡(
ªt
 !0 && 
î∫o
 !
ENOENT
) {

346 
	`buf_dump_°©us
(
STATUS_ERR
, "C™nŸ dñëê'%s': %s", 
fuŒ_fûíame
,

347 
	`°ªº‹
(
î∫o
));

353 
ªt
 = 
	`ª«me
(
tmp_fûíame
, 
fuŒ_fûíame
);

354 i‡(
ªt
 != 0) {

355 
	`buf_dump_°©us
(
STATUS_ERR
, "C™nŸÑíamê'%s'Åÿ'%s': %s", 
tmp_fûíame
,

356 
fuŒ_fûíame
, 
	`°ªº‹
(
î∫o
));

364 
	`ut_•rötf_time°amp
(
now
);

366 
	`buf_dump_°©us
(
STATUS_INFO
, "Buf„∏poﬁ(sËdum∞com∂ëedáà%s", 
now
);

367 
	}
}

379 
UNIV_INLINE


380 
	$buf_lﬂd_thrŸée_if_√eded
(
ulöt
 *
œ°_check_time
,

381 
ulöt
 *
œ°_a˘ivôy_cou¡
, ulöà
n_io
) {

382 i‡(
n_io
 % 
§v_io_ˇ∑côy
 < srv_io_capacity - 1) {

386 i‡(*
œ°_check_time
 =0 || *
œ°_a˘ivôy_cou¡
 == 0) {

387 *
œ°_check_time
 = 
	`ut_time_ms
();

388 *
œ°_a˘ivôy_cou¡
 = 
	`§v_gë_a˘ivôy_cou¡
();

396 i‡(
	`§v_gë_a˘ivôy_cou¡
(Ë=*
œ°_a˘ivôy_cou¡
) {

402 
ulöt
 
now
 = 
	`ut_time_ms
();

403 
ulöt
 
ñ≠£d_time
 = 
now
 - *
œ°_check_time
;

424 i‡(
ñ≠£d_time
 < 1000 ) {

425 
	`os_thªad_¶ìp
((1000 - 
ñ≠£d_time
) * 1000 );

428 *
œ°_check_time
 = 
	`ut_time_ms
();

429 *
œ°_a˘ivôy_cou¡
 = 
	`§v_gë_a˘ivôy_cou¡
();

430 
	}
}

437 
	$buf_lﬂd
() {

438 
fuŒ_fûíame
[
OS_FILE_MAX_PATH
];

439 
now
[32];

440 
FILE
 *
f
;

441 
buf_dump_t
 *
dump
;

442 
ulöt
 
dump_n
;

443 
ulöt
 
tŸÆ_buf„r_poﬁs_∑ges
;

444 
ulöt
 
i
;

445 
ulöt
 
•a˚_id
;

446 
ulöt
 
∑ge_no
;

447 
fsˇnf_ªt
;

450 
buf_lﬂd_ab‹t_Êag
 = 
FALSE
;

452 
	`buf_dump_gíî©e_∑th
(
fuŒ_fûíame
, (full_filename));

454 
	`buf_lﬂd_°©us
(
STATUS_INFO
, "Lﬂdög buf„∏poﬁ(sË‰om %s", 
fuŒ_fûíame
);

456 
f
 = 
	`f›í
(
fuŒ_fûíame
, "r");

457 i‡(
f
 =
NULL
) {

458 
	`buf_lﬂd_°©us
(
STATUS_ERR
, "Cannot open '%s' forÑeading: %s",

459 
fuŒ_fûíame
, 
	`°ªº‹
(
î∫o
));

467 
dump_n
 = 0;

468 
	`fsˇnf
(
f
, 
ULINTPF
 "," ULINTPF, &
•a˚_id
, &
∑ge_no
) == 2 &&

469 !
	`SHUTTING_DOWN
()) {

470 
dump_n
++;

473 i‡(!
	`SHUTTING_DOWN
(Ë&& !
	`„of
(
f
)) {

475 c⁄° *
wh©
;

476 i‡(
	`„º‹
(
f
)) {

477 
wh©
 = "reading";

479 
wh©
 = "parsing";

481 
	`f˛o£
(
f
);

482 
	`buf_lﬂd_°©us
(
STATUS_ERR
,

485 
wh©
, 
fuŒ_fûíame
);

492 
tŸÆ_buf„r_poﬁs_∑ges
 = 
	`buf_poﬁ_gë_n_∑ges
(Ë* 
§v_buf_poﬁ_ö°™˚s
;

493 i‡(
dump_n
 > 
tŸÆ_buf„r_poﬁs_∑ges
) {

494 
dump_n
 = 
tŸÆ_buf„r_poﬁs_∑ges
;

497 i‡(
dump_n
 != 0) {

498 
dump
 = 
°©ic_ˇ°
<
buf_dump_t
 *>(
	`ut_mÆloc_nokey
(
dump_n
 * (*dump)));

500 
	`f˛o£
(
f
);

501 
	`ut_•rötf_time°amp
(
now
);

502 
	`buf_lﬂd_°©us
(
STATUS_INFO
,

505 
now
, 
fuŒ_fûíame
);

509 i‡(
dump
 =
NULL
) {

510 
	`f˛o£
(
f
);

511 
	`buf_lﬂd_°©us
(
STATUS_ERR
, "C™nŸáŒoˇã " 
ULINTPF
 " bytes: %s",

512 (
ulöt
)(
dump_n
 * (*
dump
)), 
	`°ªº‹
(
î∫o
));

516 
	`ªwöd
(
f
);

518 
i
 = 0; i < 
dump_n
 && !
	`SHUTTING_DOWN
(); i++) {

519 
fsˇnf_ªt
 = 
	`fsˇnf
(
f
, 
ULINTPF
 "," ULINTPF, &
•a˚_id
, &
∑ge_no
);

521 i‡(
fsˇnf_ªt
 != 2) {

522 i‡(
	`„of
(
f
)) {

527 
	`ut_‰ì
(
dump
);

528 
	`f˛o£
(
f
);

529 
	`buf_lﬂd_°©us
(
STATUS_ERR
,

532 
fuŒ_fûíame
);

536 i‡(
•a˚_id
 > 
ULINT32_MASK
 || 
∑ge_no
 > ULINT32_MASK) {

537 
	`ut_‰ì
(
dump
);

538 
	`f˛o£
(
f
);

539 
	`buf_lﬂd_°©us
(
STATUS_ERR
,

541 " s∑˚,∑gê" 
ULINTPF
 "," ULINTPF "átÜine " ULINTPF

544 
fuŒ_fûíame
, 
•a˚_id
, 
∑ge_no
, 
i
);

548 
dump
[
i
] = 
	`BUF_DUMP_CREATE
(
•a˚_id
, 
∑ge_no
);

554 
dump_n
 = 
i
;

556 
	`f˛o£
(
f
);

558 i‡(
dump_n
 == 0) {

559 
	`ut_‰ì
(
dump
);

560 
	`ut_•rötf_time°amp
(
now
);

561 
	`buf_lﬂd_°©us
(
STATUS_INFO
,

564 
now
, 
fuŒ_fûíame
);

568 i‡(!
	`SHUTTING_DOWN
()) {

569 
°d
::
	`s‹t
(
dump
, dum∞+ 
dump_n
);

572 
ulöt
 
œ°_check_time
 = 0;

573 
ulöt
 
œ°_a˘ivôy_˙t
 = 0;

578 
•a˚_id_t
 
cur_•a˚_id
 = 
	`BUF_DUMP_SPACE
(
dump
[0]);

579 
fû_•a˚_t
 *
•a˚
 = 
	`fû_•a˚_acquúe_sûít
(
cur_•a˚_id
);

580 
∑ge_size_t
 
	`∑ge_size
(
•a˚
 ? s∑˚->
Êags
 : 0);

582 #ifde‡
HAVE_PSI_STAGE_INTERFACE


583 
PSI_°age_¥ogªss
 *
pfs_°age_¥ogªss
 =

584 
	`mysql_£t_°age
(
§v_°age_buf„r_poﬁ_lﬂd
.
m_key
);

587 
	`mysql_°age_£t_w‹k_e°im©ed
(
pfs_°age_¥ogªss
, 
dump_n
);

588 
	`mysql_°age_£t_w‹k_com∂ëed
(
pfs_°age_¥ogªss
, 0);

590 
i
 = 0; i < 
dump_n
 && !
	`SHUTTING_DOWN
(); i++) {

592 c⁄° 
•a˚_id_t
 
this_•a˚_id
 = 
	`BUF_DUMP_SPACE
(
dump
[
i
]);

594 i‡(
this_•a˚_id
 !
cur_•a˚_id
) {

595 i‡(
•a˚
 !
NULL
) {

596 
	`fû_•a˚_ªÀa£
(
•a˚
);

599 
cur_•a˚_id
 = 
this_•a˚_id
;

600 
•a˚
 = 
	`fû_•a˚_acquúe_sûít
(
cur_•a˚_id
);

602 i‡(
•a˚
 !
NULL
) {

603 c⁄° 
∑ge_size_t
 
	`cur_∑ge_size
(
•a˚
->
Êags
);

604 
∑ge_size
.
	`c›y_‰om
(
cur_∑ge_size
);

608 i‡(
•a˚
 =
NULL
) {

612 
	`buf_ªad_∑ge_background
(
	`∑ge_id_t
(
this_•a˚_id
, 
	`BUF_DUMP_PAGE
(
dump
[
i
])),

613 
∑ge_size
, 
åue
);

615 i‡(
i
 % 64 == 63) {

616 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

621 c⁄° 
ulöt
 
upd©e_°©us_evîy_n_mb
 = 32;

622 c⁄° 
ulöt
 
upd©e_°©us_evîy_n_∑ges
 =

623 
upd©e_°©us_evîy_n_mb
 * 1024 * 1024 / 
∑ge_size
.
	`physiˇl
();

625 i‡(
i
 % 
upd©e_°©us_evîy_n_∑ges
 == 0) {

626 
	`buf_lﬂd_°©us
(
STATUS_VERBOSE
, "Lﬂded " 
ULINTPF
 "/" ULINTPF "Öages",

627 
i
 + 1, 
dump_n
);

628 
	`mysql_°age_£t_w‹k_com∂ëed
(
pfs_°age_¥ogªss
, 
i
);

631 i‡(
buf_lﬂd_ab‹t_Êag
) {

632 i‡(
•a˚
 !
NULL
) {

633 
	`fû_•a˚_ªÀa£
(
•a˚
);

635 
buf_lﬂd_ab‹t_Êag
 = 
FALSE
;

636 
	`ut_‰ì
(
dump
);

637 
	`buf_lﬂd_°©us
(
STATUS_INFO
, "BufferÖool(s)Üoadáborted onÑequest");

640 
	`mysql_°age_£t_w‹k_e°im©ed
(
pfs_°age_¥ogªss
, 
i
);

641 
	`mysql_°age_£t_w‹k_com∂ëed
(
pfs_°age_¥ogªss
, 
i
);

642 #ifde‡
HAVE_PSI_STAGE_INTERFACE


643 
	`mysql_íd_°age
();

648 
	`buf_lﬂd_thrŸée_if_√eded
(&
œ°_check_time
, &
œ°_a˘ivôy_˙t
, 
i
);

651 i‡(
•a˚
 !
NULL
) {

652 
	`fû_•a˚_ªÀa£
(
•a˚
);

655 
	`ut_‰ì
(
dump
);

657 
	`ut_•rötf_time°amp
(
now
);

659 
	`buf_lﬂd_°©us
(
STATUS_INFO
, "Buf„∏poﬁ(sËlﬂd com∂ëedáà%s", 
now
);

662 
	`mysql_°age_£t_w‹k_com∂ëed
(
pfs_°age_¥ogªss
, 
dump_n
);

664 #ifde‡
HAVE_PSI_STAGE_INTERFACE


665 
	`mysql_íd_°age
();

667 
	}
}

672 
	$buf_lﬂd_ab‹t
(Ë{ 
buf_lﬂd_ab‹t_Êag
 = 
TRUE
; 
	}
}

677 
	$buf_dump_thªad
() {

678 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

680 
	`my_thªad_öô
();

682 
	`buf_dump_°©us
(
STATUS_VERBOSE
, "Dumping of bufferÖoolÇot started");

683 
	`buf_lﬂd_°©us
(
STATUS_VERBOSE
, "Loading of bufferÖoolÇot started");

685 i‡(
§v_buf„r_poﬁ_lﬂd_©_°¨tup
) {

686 
	`buf_lﬂd
();

689 !
	`SHUTTING_DOWN
()) {

690 
	`os_evít_waô
(
§v_buf_dump_evít
);

692 i‡(
buf_dump_should_°¨t
) {

693 
buf_dump_should_°¨t
 = 
FALSE
;

694 
	`buf_dump
(
TRUE
 );

697 i‡(
buf_lﬂd_should_°¨t
) {

698 
buf_lﬂd_should_°¨t
 = 
FALSE
;

699 
	`buf_lﬂd
();

702 
	`os_evít_ª£t
(
§v_buf_dump_evít
);

705 i‡(
§v_buf„r_poﬁ_dump_©_shutdown
 && 
§v_Á°_shutdown
 != 2) {

706 
	`buf_dump
(
FALSE


710 
	`my_thªad_íd
();

712 
°d
::
	`©omic_thªad_„n˚
(°d::
mem‹y_‹dî_£q_c°
);

713 
§v_thªads
.
m_buf_dump_thªad_a˘ive
 = 
Ál£
;

714 
	}
}

	@buf0flu.cc

33 
	~<m©h.h
>

34 
	~<my_dbug.h
>

35 
	~<mysql/£rvi˚_thd_waô.h
>

36 
	~<sys/ty≥s.h
>

37 
	~<time.h
>

39 #i‚de‡
UNIV_HOTBACKUP


40 
	~"buf0buf.h
"

41 
	~"buf0checksum.h
"

42 
	~"buf0Êu.h
"

43 
	~"ha_¥ŸŸy≥s.h
"

44 
	~"my_öây≥s.h
"

46 
	~"∑ge0zù.h
"

47 #i‚de‡
UNIV_HOTBACKUP


48 
	~"¨ch0¨ch.h
"

49 
	~"buf0Ãu.h
"

50 
	~"buf0ªa.h
"

51 
	~"fû0fû.h
"

52 
	~"f•0sys•a˚.h
"

53 
	~"ibuf0ibuf.h
"

54 
	~"log0log.h
"

55 
	~"my_compûî.h
"

56 
	~"os0fûe.h
"

57 
	~"os0thªad-¸óã.h
"

58 
	~"∑ge0∑ge.h
"

59 
	~"§v0m⁄.h
"

60 
	~"§v0§v.h
"

61 
	~"§v0°¨t.h
"

62 
	~"åx0sys.h
"

63 
	~"ut0byã.h
"

64 
	~"ut0°age.h
"

66 #ifde‡
UNIV_LINUX


68 
	~<sys/ªsour˚.h
>

69 
	~<sys/sysˇŒ.h
>

70 
	~<sys/time.h
>

71 
	~<uni°d.h
>

73 c⁄° 
	gbuf_Êush_∑ge_˛ó√r_¥i‹ôy
 = -20;

77 
ulöt
 
	gbuf_Ãu_Êush_∑ge_cou¡
 = 0;

85 
boﬁ
 
	gbuf_∑ge_˛ó√r_is_a˘ive
 = 
Ál£
;

87 #i‚de‡
UNIV_HOTBACKUP


90 
ulöt
 
	gbuf_Êush_l¢_sˇn_Á˘‹
 = 3;

93 
l¢_t
 
	gl¢_avg_øã
 = 0;

96 
l¢_t
 
	gbuf_Êush_sync_l¢
 = 0;

98 #ifde‡
UNIV_PFS_THREAD


99 
mysql_pfs_key_t
 
	g∑ge_Êush_thªad_key
;

100 
mysql_pfs_key_t
 
	g∑ge_Êush_co‹dö©‹_thªad_key
;

104 
os_evít_t
 
	gbuf_Êush_evít
;

107 
	e∑ge_˛ó√r_°©e_t
 {

110 
	mPAGE_CLEANER_STATE_NONE
 = 0,

113 
	mPAGE_CLEANER_STATE_REQUESTED
,

116 
	mPAGE_CLEANER_STATE_FLUSHING
,

119 
	mPAGE_CLEANER_STATE_FINISHED


123 
	s∑ge_˛ó√r_¶Ÿ_t
 {

124 
∑ge_˛ó√r_°©e_t
 
	m°©e
;

131 
ulöt
 
	mn_∑ges_ªque°ed
;

137 
ulöt
 
	mn_Êushed_Ãu
;

140 
ulöt
 
	mn_Êushed_li°
;

143 
boﬁ
 
	msuc˚eded_li°
;

146 
ulöt
 
	mÊush_Ãu_time
;

148 
ulöt
 
	mÊush_li°_time
;

151 
ulöt
 
	mÊush_Ãu_∑ss
;

153 
ulöt
 
	mÊush_li°_∑ss
;

159 
	s∑ge_˛ó√r_t
 {

160 
ib_muãx_t
 
	mmuãx
;

163 
os_evít_t
 
	mis_ªque°ed
;

165 
os_evít_t
 
	mis_föished
;

167 vﬁ©ûê
ulöt
 
	mn_w‹kîs
;

169 
boﬁ
 
	mªque°ed
;

171 
l¢_t
 
	ml¢_limô
;

173 
ulöt
 
	mn_¶Ÿs
;

174 
ulöt
 
	mn_¶Ÿs_ªque°ed
;

178 
ulöt
 
	mn_¶Ÿs_Êushög
;

182 
ulöt
 
	mn_¶Ÿs_föished
;

186 
ulöt
 
	mÊush_time
;

188 
ulöt
 
	mÊush_∑ss
;

190 
∑ge_˛ó√r_¶Ÿ_t
 *
	m¶Ÿs
;

191 
boﬁ
 
	mis_ru¬ög
;

194 #ifde‡
UNIV_DEBUG


195 
ulöt
 
	mn_dißbÀd_debug
;

201 
∑ge_˛ó√r_t
 *
	g∑ge_˛ó√r
 = 
NULL
;

203 #ifde‡
UNIV_DEBUG


204 
boﬁ
 
	gönodb_∑ge_˛ó√r_dißbÀd_debug
;

211 
	#BUF_LRU_MIN_LEN
 256

	)

218 
buf_Êush_∑ge_co‹dö©‹_thªad
(
size_t
 
n_∑ge_˛ó√rs
);

221 
buf_Êush_∑ge_˛ó√r_thªad
();

224 
ölöe
 
	$ö¸_Êush_li°_size_ö_byãs
(

225 
buf_block_t
 *
block
,

226 
buf_poﬁ_t
 *
buf_poﬁ
)

228 
	`ut_ad
(
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
));

230 
buf_poﬁ
->
°©
.
Êush_li°_byãs
 +
block
->
∑ge
.
size
.
	`physiˇl
();

232 
	`ut_ad
(
buf_poﬁ
->
°©
.
Êush_li°_byãs
 <buf_poﬁ->
cuº_poﬁ_size
);

233 
	}
}

235 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


238 
iboﬁ
 
buf_Êush_vÆid©e_low
(

239 
buf_poﬁ_t
 *
buf_poﬁ
);

243 
iboﬁ
 
	$buf_Êush_vÆid©e_skù
(

244 
buf_poﬁ_t
 *
buf_poﬁ
)

247 
	#BUF_FLUSH_VALIDATE_SKIP
 23

	)

251 
buf_Êush_vÆid©e_cou¡
 = 
BUF_FLUSH_VALIDATE_SKIP
;

253 
	`DBUG_EXECUTE_IF
("buf_Êush_li°_vÆid©e", 
buf_Êush_vÆid©e_cou¡
 = 1;);

259 i‡(--
buf_Êush_vÆid©e_cou¡
 > 0) {

260  (
TRUE
);

263 
buf_Êush_vÆid©e_cou¡
 = 
BUF_FLUSH_VALIDATE_SKIP
;

264  (
	`buf_Êush_vÆid©e_low
(
buf_poﬁ
));

265 
	}
}

272 
buf_∑ge_t
 *
	$buf_Êush_ö£π_ö_Êush_rbt
(

273 
buf_∑ge_t
 *
b∑ge
)

275 c⁄° 
ib_rbt_node_t
 *
c_node
;

276 c⁄° 
ib_rbt_node_t
 *
p_node
;

277 
buf_∑ge_t
 *
¥ev
 = 
NULL
;

278 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

280 
	`ut_ad
(
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
));

283 
c_node
 = 
	`rbt_ö£π
(
buf_poﬁ
->
Êush_rbt
, &
b∑ge
, &bpage);

284 
	`ut_a
(
c_node
 !
NULL
);

287 
p_node
 = 
	`rbt_¥ev
(
buf_poﬁ
->
Êush_rbt
, 
c_node
);

289 i‡(
p_node
 !
NULL
) {

290 
buf_∑ge_t
 **
vÆue
;

291 
vÆue
 = 
	`rbt_vÆue
(
buf_∑ge_t
 *, 
p_node
);

292 
¥ev
 = *
vÆue
;

293 
	`ut_a
(
¥ev
 !
NULL
);

296  (
¥ev
);

297 
	}
}

300 
	$buf_Êush_dñëe_‰om_Êush_rbt
(

301 
buf_∑ge_t
 *
b∑ge
)

303 #ifde‡
UNIV_DEBUG


304 
iboﬁ
 
ªt
 = 
FALSE
;

306 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

308 
	`ut_ad
(
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
));

310 #ifde‡
UNIV_DEBUG


311 
ªt
 =

313 
	`rbt_dñëe
(
buf_poﬁ
->
Êush_rbt
, &
b∑ge
);

315 
	`ut_ad
(
ªt
);

316 
	}
}

327 
	$buf_Êush_block_cmp
(c⁄° *
p1
,

328 c⁄° *
p2
)

330 
ªt
;

331 c⁄° 
buf_∑ge_t
 *
b1
 = *(c⁄° buf_∑ge_à**)
p1
;

332 c⁄° 
buf_∑ge_t
 *
b2
 = *(c⁄° buf_∑ge_à**)
p2
;

334 
	`ut_ad
(
b1
 !
NULL
);

335 
	`ut_ad
(
b2
 !
NULL
);

337 #ifde‡
UNIV_DEBUG


338 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b1
);

341 
	`ut_ad
(
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
));

343 
	`ut_ad
(
b1
->
ö_Êush_li°
);

344 
	`ut_ad
(
b2
->
ö_Êush_li°
);

346 i‡(
b2
->
ﬁde°_modifiˇti⁄
 > 
b1
->oldest_modification) {

348 } i‡(
b2
->
ﬁde°_modifiˇti⁄
 < 
b1
->oldest_modification) {

353 
ªt
 = ()(
b2
->
id
.
	`•a˚
(Ë- 
b1
->id.space());

356  (
ªt
 ?Ñë : ()(
b2
->
id
.
	`∑ge_no
(Ë- 
b1
->id.page_no()));

357 
	}
}

362 
	$buf_Êush_öô_Êush_rbt
() {

363 
ulöt
 
i
;

365 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

366 
buf_poﬁ_t
 *
buf_poﬁ
;

368 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

370 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

372 
	`ut_ad
(
buf_poﬁ
->
Êush_rbt
 =
NULL
);

375 
buf_poﬁ
->
Êush_rbt
 = 
	`rbt_¸óã
((
buf_∑ge_t
 *), 
buf_Êush_block_cmp
);

377 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

379 
	}
}

382 
	$buf_Êush_‰ì_Êush_rbt
() {

383 
ulöt
 
i
;

385 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

386 
buf_poﬁ_t
 *
buf_poﬁ
;

388 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

390 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

392 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


393 
	`ut_a
(
	`buf_Êush_vÆid©e_low
(
buf_poﬁ
));

396 
	`rbt_‰ì
(
buf_poﬁ
->
Êush_rbt
);

397 
buf_poﬁ
->
Êush_rbt
 = 
NULL
;

399 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

401 
	}
}

403 
boﬁ
 
	$buf_¨e_Êush_li°s_em±y_vÆid©e
() {

407 
size_t
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

408 autÿ
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

410 i‡(
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
Êush_li°
Ë!
nuŒ±r
) {

411  
Ál£
;

415  
åue
;

416 
	}
}

436 
MY_ATTRIBUTE
((
unu£d
))

437 
ölöe
 
boﬁ
 
	$buf_Êush_li°_‹dî_vÆid©e
(
l¢_t
 
óæõr_added_l¢
,

438 
l¢_t
 
√w_added_l¢
) {

439  (
óæõr_added_l¢
 <=

440 
√w_added_l¢
 + 
	`log_buf„r_Êush_‹dî_œg
(*
log_sys
));

441 
	}
}

465 
ölöe
 
l¢_t
 
	$buf_Êush_b‹row_l¢
(c⁄° 
buf_poﬁ_t
 *
buf_poﬁ
) {

466 
	`ut_ad
(
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
));

468 c⁄°áutÿ
∑ge
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
Êush_li°
);

470 i‡(
∑ge
 =
nuŒ±r
) {

474 c⁄° 
l¢_t
 
l¢
 = 
	`log_buf„r_dúty_∑ges_added_up_to_l¢
(*
log_sys
);

476 i‡(
l¢
 < 
LOG_START_LSN
) {

477 
	`ut_ad
(
§v_ªad_⁄ly_mode
);

478  
LOG_START_LSN
 + 
LOG_BLOCK_HDR_SIZE
;

480  
l¢
;

483 
	`ut_ad
(
∑ge
->
ﬁde°_modifiˇti⁄
 != 0);

484 
	`ut_ad
(
∑ge
->
√we°_modifiˇti⁄
 >∑ge->
ﬁde°_modifiˇti⁄
);

486  
∑ge
->
ﬁde°_modifiˇti⁄
;

487 
	}
}

490 
	$buf_Êush_ö£π_öto_Êush_li°
(

491 
buf_poﬁ_t
 *
buf_poﬁ
,

492 
buf_block_t
 *
block
,

493 
l¢_t
 
l¢
)

495 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(&
block
->
∑ge
)));

496 
	`ut_ad
(
log_sys
 !
nuŒ±r
);

498 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

502 i‡(
buf_poﬁ
->
Êush_rbt
 !
NULL
) {

503 
	`ut_ad
(
l¢
 != 0);

504 
	`ut_ad
(
block
->
∑ge
.
√we°_modifiˇti⁄
 != 0);

505 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

506 
	`buf_Êush_ö£π_s‹ãd_öto_Êush_li°
(
buf_poﬁ
, 
block
, 
l¢
);

510 
	`ut_ad
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

511 
	`ut_ad
(!
block
->
∑ge
.
ö_Êush_li°
);

513 
	`ut_d
(
block
->
∑ge
.
ö_Êush_li°
 = 
TRUE
);

515 i‡(
l¢
 == 0) {

517 
l¢
 = 
	`buf_Êush_b‹row_l¢
(
buf_poﬁ
);

519 
	`ut_ad
(
	`log_l¢_vÆid©e
(
l¢
));

545 
block
->
∑ge
.
√we°_modifiˇti⁄
 =

546 
°d
::
	`max
(
l¢
, 
log_sys
->
Êushed_to_disk_l¢
.
	`lﬂd
());

549 
	`ut_ad
(
	`log_l¢_vÆid©e
(
l¢
));

550 
	`ut_ad
(
block
->
∑ge
.
ﬁde°_modifiˇti⁄
 == 0);

551 
	`ut_ad
(
block
->
∑ge
.
√we°_modifiˇti⁄
 >
l¢
);

553 
	`ut_ad
(
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
Êush_li°
Ë=
NULL
 ||

554 
	`buf_Êush_li°_‹dî_vÆid©e
(

555 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
Êush_li°
)->
ﬁde°_modifiˇti⁄
, 
l¢
));

557 
block
->
∑ge
.
ﬁde°_modifiˇti⁄
 = 
l¢
;

559 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
Êush_li°
, &
block
->
∑ge
);

561 
	`ö¸_Êush_li°_size_ö_byãs
(
block
, 
buf_poﬁ
);

563 #ifde‡
UNIV_DEBUG_VALGRIND


564 *
p
;

566 i‡(
block
->
∑ge
.
size
.
	`is_com¥es£d
()) {

567 
p
 = 
block
->
∑ge
.
zù
.
d©a
;

569 
p
 = 
block
->
‰ame
;

572 
	`UNIV_MEM_ASSERT_RW
(
p
, 
block
->
∑ge
.
size
.
	`physiˇl
());

575 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


576 
	`ut_a
(
	`buf_Êush_vÆid©e_skù
(
buf_poﬁ
));

579 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

580 
	}
}

585 
	$buf_Êush_ö£π_s‹ãd_öto_Êush_li°
(

586 
buf_poﬁ_t
 *
buf_poﬁ
,

587 
buf_block_t
 *
block
,

588 
l¢_t
 
l¢
)

590 
buf_∑ge_t
 *
¥ev_b
;

591 
buf_∑ge_t
 *
b
;

593 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(&
block
->
∑ge
)));

594 
	`ut_ad
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

596 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

608 
	`ut_ad
(
block
->
∑ge
.
ö_LRU_li°
);

609 
	`ut_ad
(
block
->
∑ge
.
ö_∑ge_hash
);

612 
	`ut_ad
(!
block
->
∑ge
.
ö_zù_hash
);

614 
	`ut_ad
(!
block
->
∑ge
.
ö_Êush_li°
);

615 
	`ut_d
(
block
->
∑ge
.
ö_Êush_li°
 = 
TRUE
);

616 
block
->
∑ge
.
ﬁde°_modifiˇti⁄
 = 
l¢
;

618 #ifde‡
UNIV_DEBUG_VALGRIND


619 *
p
;

621 i‡(
block
->
∑ge
.
size
.
	`is_com¥es£d
()) {

622 
p
 = 
block
->
∑ge
.
zù
.
d©a
;

624 
p
 = 
block
->
‰ame
;

627 
	`UNIV_MEM_ASSERT_RW
(
p
, 
block
->
∑ge
.
size
.
	`physiˇl
());

630 
¥ev_b
 = 
NULL
;

638 i‡(
buf_poﬁ
->
Êush_rbt
 !
NULL
) {

639 
¥ev_b
 = 
	`buf_Êush_ö£π_ö_Êush_rbt
(&
block
->
∑ge
);

642 
b
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
Êush_li°
);

644 
b
 !
NULL
 &&

645 
b
->
ﬁde°_modifiˇti⁄
 > 
block
->
∑ge
.oldest_modification) {

646 
	`ut_ad
(
b
->
ö_Êush_li°
);

647 
¥ev_b
 = 
b
;

648 
b
 = 
	`UT_LIST_GET_NEXT
(
li°
, b);

652 i‡(
¥ev_b
 =
NULL
) {

653 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
Êush_li°
, &
block
->
∑ge
);

655 
	`UT_LIST_INSERT_AFTER
(
buf_poﬁ
->
Êush_li°
, 
¥ev_b
, &
block
->
∑ge
);

658 
	`ö¸_Êush_li°_size_ö_byãs
(
block
, 
buf_poﬁ
);

660 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


661 
	`ut_a
(
	`buf_Êush_vÆid©e_low
(
buf_poﬁ
));

664 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

665 
	}
}

673 
iboﬁ
 
	$buf_Êush_ªady_f‹_ª∂a˚
(
buf_∑ge_t
 *
b∑ge
) {

674 #ifde‡
UNIV_DEBUG


675 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

676 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

678 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(
b∑ge
)));

679 
	`ut_ad
(
b∑ge
->
ö_LRU_li°
);

681 i‡(
	`buf_∑ge_ö_fûe
(
b∑ge
)) {

682  (
b∑ge
->
ﬁde°_modifiˇti⁄
 =0 && b∑ge->
buf_fix_cou¡
 == 0 &&

683 
	`buf_∑ge_gë_io_fix
(
b∑ge
Ë=
BUF_IO_NONE
);

686 
ib
::
	`Áèl
(
ER_IB_MSG_123
Ë<< "Buf„∏block " << 
b∑ge
 << " state "

687 << 
b∑ge
->
°©e
 << " inÅhe LRUÜist!";

689  (
FALSE
);

690 
	}
}

696 
boﬁ
 
	$buf_Êush_ªady_f‹_Êush
(
buf_∑ge_t
 *
b∑ge
, 
buf_Êush_t
 
Êush_ty≥
) {

697 #ifde‡
UNIV_DEBUG


698 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

700 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
) ||

701 (
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_REMOVE_HASH
 &&

702 !
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
)));

704 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
) ||

705 
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_REMOVE_HASH
);

707 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(
b∑ge
)) ||

708 (
Êush_ty≥
 =
BUF_FLUSH_LIST
 && 
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
)));

709 
	`ut_ad
(
Êush_ty≥
 < 
BUF_FLUSH_N_TYPES
);

711 i‡(
b∑ge
->
ﬁde°_modifiˇti⁄
 == 0 ||

712 
	`buf_∑ge_gë_io_fix_u∆ocked
(
b∑ge
Ë!
BUF_IO_NONE
) {

713  (
Ál£
);

716 
	`ut_ad
(
b∑ge
->
ö_Êush_li°
);

718 
Êush_ty≥
) {

719 
BUF_FLUSH_LIST
:

720  (
	`buf_∑ge_gë_°©e
(
b∑ge
Ë!
BUF_BLOCK_REMOVE_HASH
);

721 
BUF_FLUSH_LRU
:

722 
BUF_FLUSH_SINGLE_PAGE
:

723  (
åue
);

725 
BUF_FLUSH_N_TYPES
:

729 
ut_îr‹
;

730 
	}
}

734 
	$buf_Êush_ªmove
(
buf_∑ge_t
 *
b∑ge
) {

735 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

737 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(
b∑ge
)));

738 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


739 
	`ut_ad
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë!
BUF_BLOCK_ZIP_DIRTY
 ||

740 
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

742 
	`ut_ad
(
b∑ge
->
ö_Êush_li°
);

744 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

748 
buf_poﬁ
->
Êush_hp
.
	`adju°
(
b∑ge
);

750 
	`buf_∑ge_gë_°©e
(
b∑ge
)) {

751 
BUF_BLOCK_POOL_WATCH
:

752 
BUF_BLOCK_ZIP_PAGE
:

754 
BUF_BLOCK_NOT_USED
:

755 
BUF_BLOCK_READY_FOR_USE
:

756 
BUF_BLOCK_MEMORY
:

757 
BUF_BLOCK_REMOVE_HASH
:

758 
ut_îr‹
;

760 
BUF_BLOCK_ZIP_DIRTY
:

761 
	`buf_∑ge_£t_°©e
(
b∑ge
, 
BUF_BLOCK_ZIP_PAGE
);

762 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
Êush_li°
, 
b∑ge
);

763 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


764 
	`buf_LRU_ö£π_zù_˛ón
(
b∑ge
);

767 
BUF_BLOCK_FILE_PAGE
:

768 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
Êush_li°
, 
b∑ge
);

773 i‡(
buf_poﬁ
->
Êush_rbt
 !
NULL
) {

774 
	`buf_Êush_dñëe_‰om_Êush_rbt
(
b∑ge
);

779 
	`ut_d
(
b∑ge
->
ö_Êush_li°
 = 
FALSE
);

781 
buf_poﬁ
->
°©
.
Êush_li°_byãs
 -
b∑ge
->
size
.
	`physiˇl
();

783 
b∑ge
->
ﬁde°_modifiˇti⁄
 = 0;

785 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


786 
	`ut_a
(
	`buf_Êush_vÆid©e_skù
(
buf_poﬁ
));

791 i‡(
b∑ge
->
Êush_ob£rvî
 !
NULL
) {

792 
b∑ge
->
Êush_ob£rvî
->
	`nŸify_ªmove
(
buf_poﬁ
, bpage);

794 
b∑ge
->
Êush_ob£rvî
 = 
NULL
;

797 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

798 
	}
}

810 
	$buf_Êush_ªloˇã_⁄_Êush_li°
(

811 
buf_∑ge_t
 *
b∑ge
,

812 
buf_∑ge_t
 *
d∑ge
)

814 
buf_∑ge_t
 *
¥ev
;

815 
buf_∑ge_t
 *
¥ev_b
 = 
NULL
;

816 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

819 
	`ut_ad
(
buf_poﬁ
 =
	`buf_poﬁ_‰om_b∑ge
(
d∑ge
));

821 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(
b∑ge
)));

823 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

825 
	`ut_ad
(
b∑ge
->
ö_Êush_li°
);

826 
	`ut_ad
(
d∑ge
->
ö_Êush_li°
);

830 i‡(
buf_poﬁ
->
Êush_rbt
 !
NULL
) {

831 
	`buf_Êush_dñëe_‰om_Êush_rbt
(
b∑ge
);

832 
¥ev_b
 = 
	`buf_Êush_ö£π_ö_Êush_rbt
(
d∑ge
);

837 
buf_poﬁ
->
Êush_hp
.
	`adju°
(
b∑ge
);

841 
	`ut_d
(
b∑ge
->
ö_Êush_li°
 = 
FALSE
);

843 
¥ev
 = 
	`UT_LIST_GET_PREV
(
li°
, 
b∑ge
);

844 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
Êush_li°
, 
b∑ge
);

846 i‡(
¥ev
) {

847 
	`ut_ad
(
¥ev
->
ö_Êush_li°
);

848 
	`UT_LIST_INSERT_AFTER
(
buf_poﬁ
->
Êush_li°
, 
¥ev
, 
d∑ge
);

850 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
Êush_li°
, 
d∑ge
);

855 
	`ut_a
(
buf_poﬁ
->
Êush_rbt
 =
NULL
 || 
¥ev_b
 =
¥ev
);

857 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


858 
	`ut_a
(
	`buf_Êush_vÆid©e_low
(
buf_poﬁ
));

861 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

862 
	}
}

866 
	$buf_Êush_wrôe_com∂ëe
(
buf_∑ge_t
 *
b∑ge
) {

867 
	`ut_ad
(
b∑ge
 !
NULL
);

868 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(
b∑ge
)));

870 c⁄° 
buf_Êush_t
 
Êush_ty≥
 = 
	`buf_∑ge_gë_Êush_ty≥
(
b∑ge
);

871 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

873 
	`muãx_íãr
(&
buf_poﬁ
->
Êush_°©e_muãx
);

875 
	`buf_Êush_ªmove
(
b∑ge
);

877 
	`buf_∑ge_£t_io_fix
(
b∑ge
, 
BUF_IO_NONE
);

879 
buf_poﬁ
->
n_Êush
[
Êush_ty≥
]--;

881 i‡(
buf_poﬁ
->
n_Êush
[
Êush_ty≥
] == 0 &&

882 
buf_poﬁ
->
öô_Êush
[
Êush_ty≥
] =
FALSE
) {

885 
	`os_evít_£t
(
buf_poﬁ
->
no_Êush
[
Êush_ty≥
]);

888 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

890 
	`buf_dblwr_upd©e
(
b∑ge
, 
Êush_ty≥
);

891 
	}
}

900 
	$buf_Êush_upd©e_zù_checksum
(
buf_‰ame_t
 *
∑ge
, 
ulöt
 
size
, 
l¢_t
 
l¢
,

901 
boﬁ
 
skù_l¢_check
) {

902 
	`ut_a
(
size
 > 0);

904 
BlockRï‹ãr
 
ªp‹ãr
 = 
	`BlockRï‹ãr
(
Ál£
, 
NULL
, 
univ_∑ge_size
, false);

906 c⁄° 
uöt32_t
 
checksum
 = 
ªp‹ãr
.
	`ˇlc_zù_checksum
(

907 
∑ge
, 
size
,

908 
°©ic_ˇ°
<
§v_checksum_Æg‹ôhm_t
>(
§v_checksum_Æg‹ôhm
));

910 
	`ut_ad
(
skù_l¢_check
 || 
	`mach_ªad_‰om_8
(
∑ge
 + 
FIL_PAGE_LSN
Ë<
l¢
);

912 
	`mach_wrôe_to_8
(
∑ge
 + 
FIL_PAGE_LSN
, 
l¢
);

913 
	`mach_wrôe_to_4
(
∑ge
 + 
FIL_PAGE_SPACE_OR_CHKSUM
, 
checksum
);

914 
	}
}

923 
	$buf_Êush_öô_f‹_wrôög
(c⁄° 
buf_block_t
 *
block
, 
byã
 *
∑ge
,

924 *
∑ge_zù_
, 
l¢_t
 
√we°_l¢
,

925 
boﬁ
 
skù_checksum
, boﬁ 
skù_l¢_check
) {

926 
ib_uöt32_t
 
checksum
 = 
BUF_NO_CHECKSUM_MAGIC
;

928 
	`ut_ad
(
block
 =
NULL
 || block->
‰ame
 =
∑ge
);

929 
	`ut_ad
(
block
 =
NULL
 || 
∑ge_zù_
 =NULL || &block->
∑ge
.
zù
 ==Öage_zip_);

930 
	`ut_ad
(
∑ge
);

932 i‡(
∑ge_zù_
) {

933 
∑ge_zù_des_t
 *
∑ge_zù
;

934 
ulöt
 
size
;

936 
∑ge_zù
 = 
°©ic_ˇ°
<
∑ge_zù_des_t
 *>(
∑ge_zù_
);

937 
size
 = 
	`∑ge_zù_gë_size
(
∑ge_zù
);

939 
	`ut_ad
(
size
);

940 
	`ut_ad
(
	`ut_is_2pow
(
size
));

941 
	`ut_ad
(
size
 <
UNIV_ZIP_SIZE_MAX
);

943 
	`fû_∑ge_gë_ty≥
(
∑ge
)) {

944 
FIL_PAGE_TYPE_ALLOCATED
:

945 
FIL_PAGE_INODE
:

946 
FIL_PAGE_IBUF_BITMAP
:

947 
FIL_PAGE_TYPE_FSP_HDR
:

948 
FIL_PAGE_TYPE_XDES
:

949 
FIL_PAGE_TYPE_ZLOB_FIRST
:

950 
FIL_PAGE_TYPE_ZLOB_DATA
:

951 
FIL_PAGE_TYPE_ZLOB_INDEX
:

952 
FIL_PAGE_TYPE_ZLOB_FRAG
:

953 
FIL_PAGE_TYPE_ZLOB_FRAG_ENTRY
:

955 
	`mem˝y
(
∑ge_zù
->
d©a
, 
∑ge
, 
size
);

957 
FIL_PAGE_TYPE_ZBLOB
:

958 
FIL_PAGE_TYPE_ZBLOB2
:

959 
FIL_PAGE_SDI_ZBLOB
:

960 
FIL_PAGE_INDEX
:

961 
FIL_PAGE_SDI
:

962 
FIL_PAGE_RTREE
:

964 
	`buf_Êush_upd©e_zù_checksum
(
∑ge_zù
->
d©a
, 
size
, 
√we°_l¢
,

965 
skù_l¢_check
);

970 
ib
::
	`îr‹
(
ER_IB_MSG_124
) << "The compressedÖageÅo be written"

972 
	`ut_¥öt_buf
(
°dîr
, 
∑ge
, 
size
);

973 
	`Âuts
("\nI¬oDB: Possibly oldî vîsi⁄ o‡thê∑ge:", 
°dîr
);

974 
	`ut_¥öt_buf
(
°dîr
, 
∑ge_zù
->
d©a
, 
size
);

975 
	`putc
('\n', 
°dîr
);

976 
ut_îr‹
;

980 
	`ut_ad
(
skù_l¢_check
 || 
	`mach_ªad_‰om_8
(
∑ge
 + 
FIL_PAGE_LSN
Ë<
√we°_l¢
);

982 
	`mach_wrôe_to_8
(
∑ge
 + 
FIL_PAGE_LSN
, 
√we°_l¢
);

984 
	`mach_wrôe_to_8
(
∑ge
 + 
UNIV_PAGE_SIZE
 - 
FIL_PAGE_END_LSN_OLD_CHKSUM
,

985 
√we°_l¢
);

987 i‡(
skù_checksum
) {

988 
	`mach_wrôe_to_4
(
∑ge
 + 
FIL_PAGE_SPACE_OR_CHKSUM
, 
checksum
);

990 i‡(
block
 !
NULL
 && 
UNIV_PAGE_SIZE
 == 16384) {

994 
ulöt
 
∑ge_ty≥
 = 
	`fû_∑ge_gë_ty≥
(
∑ge
);

995 
ulöt
 
ª£t_ty≥
 = 
∑ge_ty≥
;

997 
block
->
∑ge
.
id
.
	`∑ge_no
() % 16384) {

999 
ª£t_ty≥
 = 
block
->
∑ge
.
id
.
	`∑ge_no
(Ë=0 ? 
FIL_PAGE_TYPE_FSP_HDR


1000 : 
FIL_PAGE_TYPE_XDES
;

1003 
ª£t_ty≥
 = 
FIL_PAGE_IBUF_BITMAP
;

1006 
∑ge_ty≥
) {

1007 
FIL_PAGE_INDEX
:

1008 
FIL_PAGE_RTREE
:

1009 
FIL_PAGE_SDI
:

1010 
FIL_PAGE_UNDO_LOG
:

1011 
FIL_PAGE_INODE
:

1012 
FIL_PAGE_IBUF_FREE_LIST
:

1013 
FIL_PAGE_TYPE_ALLOCATED
:

1014 
FIL_PAGE_TYPE_SYS
:

1015 
FIL_PAGE_TYPE_TRX_SYS
:

1016 
FIL_PAGE_TYPE_BLOB
:

1017 
FIL_PAGE_TYPE_ZBLOB
:

1018 
FIL_PAGE_TYPE_ZBLOB2
:

1019 
FIL_PAGE_SDI_BLOB
:

1020 
FIL_PAGE_SDI_ZBLOB
:

1021 
FIL_PAGE_TYPE_LOB_INDEX
:

1022 
FIL_PAGE_TYPE_LOB_DATA
:

1023 
FIL_PAGE_TYPE_LOB_FIRST
:

1024 
FIL_PAGE_TYPE_ZLOB_FIRST
:

1025 
FIL_PAGE_TYPE_ZLOB_DATA
:

1026 
FIL_PAGE_TYPE_ZLOB_INDEX
:

1027 
FIL_PAGE_TYPE_ZLOB_FRAG
:

1028 
FIL_PAGE_TYPE_ZLOB_FRAG_ENTRY
:

1029 
FIL_PAGE_TYPE_RSEG_ARRAY
:

1031 
FIL_PAGE_TYPE_FSP_HDR
:

1032 
FIL_PAGE_TYPE_XDES
:

1033 
FIL_PAGE_IBUF_BITMAP
:

1038 
ª£t_ty≥
 = 
FIL_PAGE_TYPE_UNKNOWN
;

1043 i‡(
	`UNIV_UNLIKELY
(
∑ge_ty≥
 !
ª£t_ty≥
)) {

1044 
ib
::
	`öfo
(
ER_IB_MSG_125
)

1045 << "Re£âög invÆidÖagê" << 
block
->
∑ge
.
id
 << "Åype "

1046 << 
∑ge_ty≥
 << "Åÿ" << 
ª£t_ty≥
 << " when flushing.";

1047 
	`fû_∑ge_£t_ty≥
(
∑ge
, 
ª£t_ty≥
);

1051 (
§v_checksum_Æg‹ôhm_t
)
§v_checksum_Æg‹ôhm
) {

1052 
SRV_CHECKSUM_ALGORITHM_CRC32
:

1053 
SRV_CHECKSUM_ALGORITHM_STRICT_CRC32
:

1054 
checksum
 = 
	`buf_ˇlc_∑ge_¸c32
(
∑ge
);

1055 
	`mach_wrôe_to_4
(
∑ge
 + 
FIL_PAGE_SPACE_OR_CHKSUM
, 
checksum
);

1057 
SRV_CHECKSUM_ALGORITHM_INNODB
:

1058 
SRV_CHECKSUM_ALGORITHM_STRICT_INNODB
:

1059 
checksum
 = (
ib_uöt32_t
)
	`buf_ˇlc_∑ge_√w_checksum
(
∑ge
);

1060 
	`mach_wrôe_to_4
(
∑ge
 + 
FIL_PAGE_SPACE_OR_CHKSUM
, 
checksum
);

1061 
checksum
 = (
ib_uöt32_t
)
	`buf_ˇlc_∑ge_ﬁd_checksum
(
∑ge
);

1063 
SRV_CHECKSUM_ALGORITHM_NONE
:

1064 
SRV_CHECKSUM_ALGORITHM_STRICT_NONE
:

1065 
	`mach_wrôe_to_4
(
∑ge
 + 
FIL_PAGE_SPACE_OR_CHKSUM
, 
checksum
);

1085 
	`mach_wrôe_to_4
(
∑ge
 + 
UNIV_PAGE_SIZE
 - 
FIL_PAGE_END_LSN_OLD_CHKSUM
,

1086 
checksum
);

1087 
	}
}

1089 #i‚de‡
UNIV_HOTBACKUP


1096 
	$buf_Êush_wrôe_block_low
(
buf_∑ge_t
 *
b∑ge
, 
buf_Êush_t
 
Êush_ty≥
,

1097 
boﬁ
 
sync
) {

1098 
∑ge_t
 *
‰ame
 = 
NULL
;

1100 #ifde‡
UNIV_DEBUG


1101 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

1102 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1105 
	`DBUG_PRINT
("ib_buf", ("Êush %†%uÖagê" 
UINT32PF
 ":" UINT32PF,

1106 
sync
 ? "sync" : "async", ()
Êush_ty≥
,

1107 
b∑ge
->
id
.
	`•a˚
(), b∑ge->id.
	`∑ge_no
()));

1109 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1115 
	`ut_ad
(!
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
));

1116 
	`ut_ad
(!
	`buf_∑ge_gë_muãx
(
b∑ge
)->
	`is_ow√d
());

1117 
	`ut_ad
(
	`buf_∑ge_gë_io_fix_u∆ocked
(
b∑ge
Ë=
BUF_IO_WRITE
);

1118 
	`ut_ad
(
b∑ge
->
ﬁde°_modifiˇti⁄
 != 0);

1120 #ifde‡
UNIV_IBUF_COUNT_DEBUG


1121 
	`ut_a
(
	`ibuf_cou¡_gë
(
b∑ge
->
id
) == 0);

1124 
	`ut_ad
(
b∑ge
->
√we°_modifiˇti⁄
 != 0);

1127 i‡(!
§v_ªad_⁄ly_mode
) {

1128 
Waô_°©s
 
waô_°©s
;

1130 
waô_°©s
 = 
	`log_wrôe_up_to
(*
log_sys
, 
b∑ge
->
√we°_modifiˇti⁄
, 
åue
);

1132 
	`MONITOR_INC_WAIT_STATS_EX
(
MONITOR_ON_LOG_
, 
_PAGE_WRITTEN
, 
waô_°©s
);

1135 
	`buf_∑ge_gë_°©e
(
b∑ge
)) {

1136 
BUF_BLOCK_POOL_WATCH
:

1137 
BUF_BLOCK_ZIP_PAGE
:

1138 
BUF_BLOCK_NOT_USED
:

1139 
BUF_BLOCK_READY_FOR_USE
:

1140 
BUF_BLOCK_MEMORY
:

1141 
BUF_BLOCK_REMOVE_HASH
:

1142 
ut_îr‹
;

1144 
BUF_BLOCK_ZIP_DIRTY
: {

1145 
‰ame
 = 
b∑ge
->
zù
.
d©a
;

1146 
BlockRï‹ãr
 
ªp‹ãr
 =

1147 
	`BlockRï‹ãr
(
Ál£
, 
‰ame
, 
b∑ge
->
size
,

1148 
	`f•_is_checksum_dißbÀd
(
b∑ge
->
id
.
	`•a˚
()));

1150 
	`mach_wrôe_to_8
(
‰ame
 + 
FIL_PAGE_LSN
, 
b∑ge
->
√we°_modifiˇti⁄
);

1152 
	`ut_a
(
ªp‹ãr
.
	`vîify_zù_checksum
());

1155 
BUF_BLOCK_FILE_PAGE
:

1156 
‰ame
 = 
b∑ge
->
zù
.
d©a
;

1157 i‡(!
‰ame
) {

1158 
‰ame
 = ((
buf_block_t
 *)
b∑ge
)->frame;

1161 
	`buf_Êush_öô_f‹_wrôög
(

1162 
ªöãΩªt_ˇ°
<c⁄° 
buf_block_t
 *>(
b∑ge
),

1163 
ªöãΩªt_ˇ°
<c⁄° 
buf_block_t
 *>(
b∑ge
)->
‰ame
,

1164 
b∑ge
->
zù
.
d©a
 ? &b∑ge->zù : 
NULL
, b∑ge->
√we°_modifiˇti⁄
,

1165 
	`f•_is_checksum_dißbÀd
(
b∑ge
->
id
.
	`•a˚
()),

1166 
Ál£
 );

1174 i‡(!
§v_u£_doubÀwrôe_buf
 || 
buf_dblwr
 =
NULL
 || 
§v_ªad_⁄ly_mode
 ||

1175 
	`f•_is_sy°em_ãmp‹¨y
(
b∑ge
->
id
.
	`•a˚
())) {

1176 
	`ut_ad
(!
§v_ªad_⁄ly_mode
 || 
	`f•_is_sy°em_ãmp‹¨y
(
b∑ge
->
id
.
	`•a˚
()));

1178 
ulöt
 
ty≥
 = 
IOReque°
::
WRITE
 | IOReque°::
DO_NOT_WAKE
;

1180 
dbîr_t
 
îr
;

1181 
IOReque°
 
	`ªque°
(
ty≥
);

1183 
îr
 = 
	`fû_io
(
ªque°
, 
sync
, 
b∑ge
->
id
, b∑ge->
size
, 0,

1184 
b∑ge
->
size
.
	`physiˇl
(), 
‰ame
, bpage);

1186 
	`ut_a
(
îr
 =
DB_SUCCESS
);

1188 } i‡(
Êush_ty≥
 =
BUF_FLUSH_SINGLE_PAGE
) {

1189 
	`buf_dblwr_wrôe_sögÀ_∑ge
(
b∑ge
, 
sync
);

1191 
	`ut_ad
(!
sync
);

1192 
	`buf_dblwr_add_to_b©ch
(
b∑ge
);

1198 i‡(
sync
) {

1199 
	`ut_ad
(
Êush_ty≥
 =
BUF_FLUSH_SINGLE_PAGE
);

1200 
	`fû_Êush
(
b∑ge
->
id
.
	`•a˚
());

1204 
	`buf_∑ge_io_com∂ëe
(
b∑ge
, 
åue
);

1209 
	`buf_LRU_°©_öc_io
();

1210 
	}
}

1223 
iboﬁ
 
	$buf_Êush_∑ge
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_∑ge_t
 *
b∑ge
,

1224 
buf_Êush_t
 
Êush_ty≥
, 
boﬁ
 
sync
) {

1225 
BPageMuãx
 *
block_muãx
;

1227 
	`ut_ad
(
Êush_ty≥
 < 
BUF_FLUSH_N_TYPES
);

1233 
	`ut_ad
(
Êush_ty≥
 =
BUF_FLUSH_SINGLE_PAGE
 ||

1234 !
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1235 
	`ut_ad
(
Êush_ty≥
 !
BUF_FLUSH_SINGLE_PAGE
 ||

1236 
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1237 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1238 
	`ut_ad
(!
sync
 || 
Êush_ty≥
 =
BUF_FLUSH_SINGLE_PAGE
);

1240 
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

1241 
	`ut_ad
(
	`muãx_own
(
block_muãx
));

1243 
	`ut_ad
(
	`buf_Êush_ªady_f‹_Êush
(
b∑ge
, 
Êush_ty≥
));

1245 
boﬁ
 
is_uncom¥es£d
;

1247 
is_uncom¥es£d
 = (
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_FILE_PAGE
);

1248 
	`ut_ad
(
is_uncom¥es£d
 =(
block_muãx
 !&
buf_poﬁ
->
zù_muãx
));

1250 
iboﬁ
 
Êush
;

1251 
rw_lock_t
 *
rw_lock
 = 
NULL
;

1252 
boﬁ
 
no_fix_cou¡
 = 
b∑ge
->
buf_fix_cou¡
 == 0;

1254 i‡(!
is_uncom¥es£d
) {

1255 
Êush
 = 
TRUE
;

1256 
rw_lock
 = 
NULL
;

1257 } i‡(!(
no_fix_cou¡
 || 
Êush_ty≥
 =
BUF_FLUSH_LIST
) ||

1258 (!
no_fix_cou¡
 && 
§v_shutdown_°©e
 <
SRV_SHUTDOWN_CLEANUP
 &&

1259 
	`f•_is_sy°em_ãmp‹¨y
(
b∑ge
->
id
.
	`•a˚
()))) {

1264 
Êush
 = 
FALSE
;

1266 
rw_lock
 = &
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
b∑ge
)->
lock
;

1267 i‡(
Êush_ty≥
 !
BUF_FLUSH_LIST
) {

1268 
Êush
 = 
	`rw_lock_sx_lock_nowaô
(
rw_lock
, 
BUF_IO_WRITE
);

1271 
Êush
 = 
TRUE
;

1275 i‡(
Êush
) {

1278 
	`muãx_íãr
(&
buf_poﬁ
->
Êush_°©e_muãx
);

1280 
	`buf_∑ge_£t_io_fix
(
b∑ge
, 
BUF_IO_WRITE
);

1282 
	`buf_∑ge_£t_Êush_ty≥
(
b∑ge
, 
Êush_ty≥
);

1284 i‡(
buf_poﬁ
->
n_Êush
[
Êush_ty≥
] == 0) {

1285 
	`os_evít_ª£t
(
buf_poﬁ
->
no_Êush
[
Êush_ty≥
]);

1288 ++
buf_poﬁ
->
n_Êush
[
Êush_ty≥
];

1290 i‡(
b∑ge
->
ﬁde°_modifiˇti⁄
 > 
buf_poﬁ
->
max_l¢_io
) {

1291 
buf_poﬁ
->
max_l¢_io
 = 
b∑ge
->
ﬁde°_modifiˇti⁄
;

1294 i‡(!
	`f•_is_sy°em_ãmp‹¨y
(
b∑ge
->
id
.
	`•a˚
()) &&

1295 
buf_poﬁ
->
åack_∑ge_l¢
 !
LSN_MAX
) {

1296 
∑ge_t
 *
‰ame
;

1297 
l¢_t
 
‰ame_l¢
;

1299 
‰ame
 = 
b∑ge
->
zù
.
d©a
;

1301 i‡(!
‰ame
) {

1302 
‰ame
 = ((
buf_block_t
 *)
b∑ge
)->frame;

1304 
‰ame_l¢
 = 
	`mach_ªad_‰om_8
(
‰ame
 + 
FIL_PAGE_LSN
);

1306 
¨ch_∑ge_sys
->
	`åack_∑ge
(
b∑ge
, 
buf_poﬁ
->
åack_∑ge_l¢
, 
‰ame_l¢
,

1307 
Ál£
);

1310 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

1312 
	`muãx_exô
(
block_muãx
);

1314 i‡(
Êush_ty≥
 =
BUF_FLUSH_SINGLE_PAGE
) {

1315 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

1318 i‡(
Êush_ty≥
 =
BUF_FLUSH_LIST
 && 
is_uncom¥es£d
 &&

1319 !
	`rw_lock_sx_lock_nowaô
(
rw_lock
, 
BUF_IO_WRITE
)) {

1320 i‡(!
	`f•_is_sy°em_ãmp‹¨y
(
b∑ge
->
id
.
	`•a˚
())) {

1324 
	`buf_dblwr_Êush_buf„ªd_wrôes
();

1326 
	`buf_dblwr_sync_d©afûes
();

1329 
	`rw_lock_sx_lock_gí
(
rw_lock
, 
BUF_IO_WRITE
);

1337 i‡(
b∑ge
->
Êush_ob£rvî
 !
NULL
) {

1338 
b∑ge
->
Êush_ob£rvî
->
	`nŸify_Êush
(
buf_poﬁ
, bpage);

1346 
	`buf_Êush_wrôe_block_low
(
b∑ge
, 
Êush_ty≥
, 
sync
);

1349  (
Êush
);

1350 
	}
}

1352 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_IBUF_DEBUG


1360 
iboﬁ
 
	$buf_Êush_∑ge_åy
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_block_t
 *
block
) {

1361 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1362 
	`ut_ad
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

1363 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(&
block
->
∑ge
)));

1365 i‡(!
	`buf_Êush_ªady_f‹_Êush
(&
block
->
∑ge
, 
BUF_FLUSH_SINGLE_PAGE
)) {

1366  (
FALSE
);

1370  (
	`buf_Êush_∑ge
(
buf_poﬁ
, &
block
->
∑ge
, 
BUF_FLUSH_SINGLE_PAGE
, 
åue
));

1371 
	}
}

1378 
boﬁ
 
	$buf_Êush_check_√ighb‹
(c⁄° 
∑ge_id_t
 &
∑ge_id
,

1379 
buf_Êush_t
 
Êush_ty≥
) {

1380 
buf_∑ge_t
 *
b∑ge
;

1381 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

1382 
boﬁ
 
ªt
;

1383 
rw_lock_t
 *
hash_lock
;

1384 
BPageMuãx
 *
block_muãx
;

1386 
	`ut_ad
(
Êush_ty≥
 =
BUF_FLUSH_LRU
 || flush_ty≥ =
BUF_FLUSH_LIST
);

1389 
b∑ge
 = 
	`buf_∑ge_hash_gë_s_locked
(
buf_poﬁ
, 
∑ge_id
, &
hash_lock
);

1391 i‡(!
b∑ge
) {

1392  (
Ál£
);

1395 
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

1397 
	`muãx_íãr
(
block_muãx
);

1399 
	`rw_lock_s_u∆ock
(
hash_lock
);

1401 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1406 
ªt
 = 
Ál£
;

1407 i‡(
Êush_ty≥
 !
BUF_FLUSH_LRU
 || 
	`buf_∑ge_is_ﬁd
(
b∑ge
)) {

1408 i‡(
	`buf_Êush_ªady_f‹_Êush
(
b∑ge
, 
Êush_ty≥
)) {

1409 
ªt
 = 
åue
;

1413 
	`muãx_exô
(
block_muãx
);

1415  (
ªt
);

1416 
	}
}

1424 
ulöt
 
	$buf_Êush_åy_√ighb‹s
(c⁄° 
∑ge_id_t
 &
∑ge_id
,

1425 
buf_Êush_t
 
Êush_ty≥
, 
ulöt
 
n_Êushed
,

1426 
ulöt
 
n_to_Êush
) {

1427 
∑ge_no_t
 
i
;

1428 
∑ge_no_t
 
low
;

1429 
∑ge_no_t
 
high
;

1430 
ulöt
 
cou¡
 = 0;

1431 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

1433 
	`ut_ad
(
Êush_ty≥
 =
BUF_FLUSH_LRU
 || flush_ty≥ =
BUF_FLUSH_LIST
);

1434 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1435 
	`ut_ad
(!
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
));

1437 i‡(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë< 
BUF_LRU_OLD_MIN_LEN
 ||

1438 
§v_Êush_√ighb‹s
 == 0) {

1441 
low
 = 
∑ge_id
.
	`∑ge_no
();

1442 
high
 = 
∑ge_id
.
	`∑ge_no
() + 1;

1448 
∑ge_no_t
 
buf_Êush_¨ó
;

1450 
buf_Êush_¨ó
 = 
°d
::
	`mö
(
	`BUF_READ_AHEAD_AREA
(
buf_poﬁ
),

1451 
°©ic_ˇ°
<
∑ge_no_t
>(
buf_poﬁ
->
cuº_size
 / 16));

1453 
low
 = (
∑ge_id
.
	`∑ge_no
(Ë/ 
buf_Êush_¨ó
) * buf_flush_area;

1454 
high
 = (
∑ge_id
.
	`∑ge_no
(Ë/ 
buf_Êush_¨ó
 + 1) * buf_flush_area;

1456 i‡(
§v_Êush_√ighb‹s
 == 1) {

1459 i‡(
∑ge_id
.
	`∑ge_no
(Ë> 
low
) {

1460 
i
 = 
∑ge_id
.
	`∑ge_no
(Ë- 1; i >
low
; i--) {

1461 i‡(!
	`buf_Êush_check_√ighb‹
(
	`∑ge_id_t
(
∑ge_id
.
	`•a˚
(), 
i
),

1462 
Êush_ty≥
)) {

1466 i‡(
i
 =
low
) {

1471 
i
--;

1475 
low
 = 
i
 + 1;

1478 
i
 = 
∑ge_id
.
	`∑ge_no
() + 1;

1479 
i
 < 
high
 &&

1480 
	`buf_Êush_check_√ighb‹
(
	`∑ge_id_t
(
∑ge_id
.
	`•a˚
(), 
i
), 
Êush_ty≥
);

1481 
i
++) {

1484 
high
 = 
i
;

1488 c⁄° 
∑ge_no_t
 
•a˚_size
 = 
	`fû_•a˚_gë_size
(
∑ge_id
.
	`•a˚
());

1489 i‡(
high
 > 
•a˚_size
) {

1490 
high
 = 
•a˚_size
;

1493 
	`DBUG_PRINT
("ib_buf", ("Êush " 
UINT32PF
 ":%u..%u", 
∑ge_id
.
	`•a˚
(),

1494 ()
low
, ()
high
));

1496 
i
 = 
low
; i < 
high
; i++) {

1497 
buf_∑ge_t
 *
b∑ge
;

1498 
rw_lock_t
 *
hash_lock
;

1499 
BPageMuãx
 *
block_muãx
;

1501 i‡((
cou¡
 + 
n_Êushed
Ë>
n_to_Êush
) {

1508 i‡(
i
 <
∑ge_id
.
	`∑ge_no
()) {

1509 
i
 = 
∑ge_id
.
	`∑ge_no
();

1515 c⁄° 
∑ge_id_t
 
	`cur_∑ge_id
(
∑ge_id
.
	`•a˚
(), 
i
);

1517 
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
cur_∑ge_id
);

1520 
b∑ge
 = 
	`buf_∑ge_hash_gë_s_locked
(
buf_poﬁ
, 
cur_∑ge_id
, &
hash_lock
);

1522 i‡(
b∑ge
 =
NULL
) {

1526 
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

1528 
	`muãx_íãr
(
block_muãx
);

1530 
	`rw_lock_s_u∆ock
(
hash_lock
);

1532 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1537 i‡(
Êush_ty≥
 !
BUF_FLUSH_LRU
 || 
i
 =
∑ge_id
.
	`∑ge_no
() ||

1538 
	`buf_∑ge_is_ﬁd
(
b∑ge
)) {

1539 i‡(
	`buf_Êush_ªady_f‹_Êush
(
b∑ge
, 
Êush_ty≥
) &&

1540 (
i
 =
∑ge_id
.
	`∑ge_no
(Ë|| 
b∑ge
->
buf_fix_cou¡
 == 0)) {

1544 i‡(
	`buf_Êush_∑ge
(
buf_poﬁ
, 
b∑ge
, 
Êush_ty≥
, 
Ál£
)) {

1545 ++
cou¡
;

1547 
	`muãx_exô
(
block_muãx
);

1554 
	`muãx_exô
(
block_muãx
);

1557 i‡(
cou¡
 > 1) {

1558 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_FLUSH_NEIGHBOR_TOTAL_PAGE
,

1559 
MONITOR_FLUSH_NEIGHBOR_COUNT
,

1560 
MONITOR_FLUSH_NEIGHBOR_PAGES
, (
cou¡
 - 1));

1563  (
cou¡
);

1564 
	}
}

1576 
boﬁ
 
	$buf_Êush_∑ge_™d_åy_√ighb‹s
(
buf_∑ge_t
 *
b∑ge
,

1577 
buf_Êush_t
 
Êush_ty≥
,

1578 
ulöt
 
n_to_Êush
, ulöà*
cou¡
) {

1579 #ifde‡
UNIV_DEBUG


1580 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

1583 
boﬁ
 
Êushed
;

1584 
BPageMuãx
 *
block_muãx
 = 
NULL
;

1586 
	`ut_ad
(
Êush_ty≥
 !
BUF_FLUSH_SINGLE_PAGE
);

1588 
	`ut_ad
((
Êush_ty≥
 =
BUF_FLUSH_LRU
 && 
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
)) ||

1589 (
Êush_ty≥
 =
BUF_FLUSH_LIST
 && 
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
)));

1591 i‡(
Êush_ty≥
 =
BUF_FLUSH_LRU
) {

1592 
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

1593 
	`muãx_íãr
(
block_muãx
);

1596 #ifde‡
UNIV_DEBUG


1597 i‡(!
	`buf_∑ge_ö_fûe
(
b∑ge
)) {

1598 
	`ut_ad
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_REMOVE_HASH
);

1599 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1602 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
) ||

1603 
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_REMOVE_HASH
);

1606 i‡(
	`buf_Êush_ªady_f‹_Êush
(
b∑ge
, 
Êush_ty≥
)) {

1607 
buf_poﬁ_t
 *
buf_poﬁ
;

1609 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

1611 i‡(
Êush_ty≥
 =
BUF_FLUSH_LRU
) {

1612 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

1615 c⁄° 
∑ge_id_t
 
∑ge_id
 = 
b∑ge
->
id
;

1617 i‡(
Êush_ty≥
 =
BUF_FLUSH_LRU
) {

1618 
	`muãx_exô
(
block_muãx
);

1620 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

1624 *
cou¡
 +
	`buf_Êush_åy_√ighb‹s
(
∑ge_id
, 
Êush_ty≥
, *cou¡, 
n_to_Êush
);

1626 i‡(
Êush_ty≥
 =
BUF_FLUSH_LRU
) {

1627 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

1629 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

1631 
Êushed
 = 
åue
;

1633 } i‡(
Êush_ty≥
 =
BUF_FLUSH_LRU
) {

1634 
	`muãx_exô
(
block_muãx
);

1636 
Êushed
 = 
Ál£
;

1638 
Êushed
 = 
Ál£
;

1641 
	`ut_ad
((
Êush_ty≥
 =
BUF_FLUSH_LRU
 && 
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
)) ||

1642 (
Êush_ty≥
 =
BUF_FLUSH_LIST
 && 
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
)));

1644  (
Êushed
);

1645 
	}
}

1657 
ulöt
 
	$buf_‰ì_‰om_unzù_LRU_li°_b©ch
(
buf_poﬁ_t
 *
buf_poﬁ
,

1658 
ulöt
 
max
) {

1659 
ulöt
 
sˇ¬ed
 = 0;

1660 
ulöt
 
cou¡
 = 0;

1661 
ulöt
 
‰ì_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
);

1662 
ulöt
 
Ãu_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
unzù_LRU
);

1664 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1666 
buf_block_t
 *
block
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
unzù_LRU
);

1668 
block
 !
NULL
 && 
cou¡
 < 
max
 && 
‰ì_Àn
 < 
§v_LRU_sˇn_dïth
 &&

1669 
Ãu_Àn
 > 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
) / 10) {

1670 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(&
block
->
∑ge
);

1672 ++
sˇ¬ed
;

1674 
	`muãx_íãr
(
block_muãx
);

1676 i‡(
	`buf_LRU_‰ì_∑ge
(&
block
->
∑ge
, 
Ál£
)) {

1678 ++
cou¡
;

1679 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

1680 
block
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
unzù_LRU
);

1683 
	`muãx_exô
(
block_muãx
);

1684 
block
 = 
	`UT_LIST_GET_PREV
(
unzù_LRU
, block);

1687 
‰ì_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
);

1688 
Ãu_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
unzù_LRU
);

1691 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1693 i‡(
sˇ¬ed
) {

1694 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_LRU_BATCH_SCANNED
,

1695 
MONITOR_LRU_BATCH_SCANNED_NUM_CALL
,

1696 
MONITOR_LRU_BATCH_SCANNED_PER_CALL
, 
sˇ¬ed
);

1699  (
cou¡
);

1700 
	}
}

1710 
ulöt
 
	$buf_Êush_LRU_li°_b©ch
(
buf_poﬁ_t
 *
buf_poﬁ
, 
ulöt
 
max
) {

1711 
buf_∑ge_t
 *
b∑ge
;

1712 
ulöt
 
sˇ¬ed
 = 0;

1713 
ulöt
 
evi˘_cou¡
 = 0;

1714 
ulöt
 
cou¡
 = 0;

1715 
ulöt
 
‰ì_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
);

1716 
ulöt
 
Ãu_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
);

1717 
ulöt
 
wôhdøw_dïth
;

1719 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1721 
wôhdøw_dïth
 = 
	`buf_gë_wôhdøw_dïth
(
buf_poﬁ
);

1723 
b∑ge
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
LRU
);

1724 
b∑ge
 !
NULL
 && 
cou¡
 + 
evi˘_cou¡
 < 
max
 &&

1725 
‰ì_Àn
 < 
§v_LRU_sˇn_dïth
 + 
wôhdøw_dïth
 &&

1726 
Ãu_Àn
 > 
BUF_LRU_MIN_LEN
;

1727 ++
sˇ¬ed
, 
b∑ge
 = 
buf_poﬁ
->
Ãu_hp
.
	`gë
()) {

1728 
buf_∑ge_t
 *
¥ev
 = 
	`UT_LIST_GET_PREV
(
LRU
, 
b∑ge
);

1729 
buf_poﬁ
->
Ãu_hp
.
	`£t
(
¥ev
);

1731 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

1733 
boﬁ
 
acquúed
 = 
	`muãx_íãr_nowaô
(
block_muãx
) == 0;

1735 i‡(
acquúed
 && 
	`buf_Êush_ªady_f‹_ª∂a˚
(
b∑ge
)) {

1738 i‡(
	`buf_LRU_‰ì_∑ge
(
b∑ge
, 
åue
)) {

1739 ++
evi˘_cou¡
;

1740 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

1742 
	`muãx_exô
(
block_muãx
);

1744 } i‡(
acquúed
 && 
	`buf_Êush_ªady_f‹_Êush
(
b∑ge
, 
BUF_FLUSH_LRU
)) {

1748 
	`muãx_exô
(
block_muãx
);

1749 
	`buf_Êush_∑ge_™d_åy_√ighb‹s
(
b∑ge
, 
BUF_FLUSH_LRU
, 
max
, &
cou¡
);

1750 } i‡(!
acquúed
) {

1751 
	`ut_ad
(
buf_poﬁ
->
Ãu_hp
.
	`is_hp
(
¥ev
));

1755 
	`muãx_exô
(
block_muãx
);

1756 
	`ut_ad
(
buf_poﬁ
->
Ãu_hp
.
	`is_hp
(
¥ev
));

1759 
	`ut_ad
(!
	`muãx_own
(
block_muãx
));

1760 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1762 
‰ì_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
);

1763 
Ãu_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
);

1766 
buf_poﬁ
->
Ãu_hp
.
	`£t
(
NULL
);

1771 
buf_Ãu_Êush_∑ge_cou¡
 +
cou¡
;

1773 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1775 i‡(
evi˘_cou¡
) {

1776 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_LRU_BATCH_EVICT_TOTAL_PAGE
,

1777 
MONITOR_LRU_BATCH_EVICT_COUNT
,

1778 
MONITOR_LRU_BATCH_EVICT_PAGES
, 
evi˘_cou¡
);

1781 i‡(
sˇ¬ed
) {

1782 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_LRU_BATCH_SCANNED
,

1783 
MONITOR_LRU_BATCH_SCANNED_NUM_CALL
,

1784 
MONITOR_LRU_BATCH_SCANNED_PER_CALL
, 
sˇ¬ed
);

1787  (
cou¡
);

1788 
	}
}

1797 
ulöt
 
	$buf_do_LRU_b©ch
(
buf_poﬁ_t
 *
buf_poﬁ
, 
ulöt
 
max
) {

1798 
ulöt
 
cou¡
 = 0;

1800 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1802 i‡(
	`buf_LRU_evi˘_‰om_unzù_LRU
(
buf_poﬁ
)) {

1803 
cou¡
 +
	`buf_‰ì_‰om_unzù_LRU_li°_b©ch
(
buf_poﬁ
, 
max
);

1806 i‡(
max
 > 
cou¡
) {

1807 
cou¡
 +
	`buf_Êush_LRU_li°_b©ch
(
buf_poﬁ
, 
max
 - count);

1810  (
cou¡
);

1811 
	}
}

1823 
ulöt
 
	$buf_do_Êush_li°_b©ch
(
buf_poﬁ_t
 *
buf_poﬁ
, 
ulöt
 
mö_n
,

1824 
l¢_t
 
l¢_limô
) {

1825 
ulöt
 
cou¡
 = 0;

1826 
ulöt
 
sˇ¬ed
 = 0;

1830 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

1831 
ulöt
 
Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
Êush_li°
);

1838 
buf_∑ge_t
 *
b∑ge
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
Êush_li°
);

1839 
cou¡
 < 
mö_n
 && 
b∑ge
 !
NULL
 && 
Àn
 > 0 &&

1840 
b∑ge
->
ﬁde°_modifiˇti⁄
 < 
l¢_limô
;

1841 
b∑ge
 = 
buf_poﬁ
->
Êush_hp
.
	`gë
(), ++
sˇ¬ed
) {

1842 
buf_∑ge_t
 *
¥ev
;

1844 
	`ut_a
(
b∑ge
->
ﬁde°_modifiˇti⁄
 > 0);

1845 
	`ut_ad
(
b∑ge
->
ö_Êush_li°
);

1847 
¥ev
 = 
	`UT_LIST_GET_PREV
(
li°
, 
b∑ge
);

1848 
buf_poﬁ
->
Êush_hp
.
	`£t
(
¥ev
);

1850 #ifde‡
UNIV_DEBUG


1851 
boﬁ
 
Êushed
 =

1853 
	`buf_Êush_∑ge_™d_åy_√ighb‹s
(
b∑ge
, 
BUF_FLUSH_LIST
, 
mö_n
, &
cou¡
);

1855 
	`ut_ad
(
Êushed
 || 
buf_poﬁ
->
Êush_hp
.
	`is_hp
(
¥ev
));

1857 --
Àn
;

1860 
buf_poﬁ
->
Êush_hp
.
	`£t
(
NULL
);

1861 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

1863 i‡(
sˇ¬ed
) {

1864 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_FLUSH_BATCH_SCANNED
,

1865 
MONITOR_FLUSH_BATCH_SCANNED_NUM_CALL
,

1866 
MONITOR_FLUSH_BATCH_SCANNED_PER_CALL
, 
sˇ¬ed
);

1869 i‡(
cou¡
) {

1870 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_FLUSH_BATCH_TOTAL_PAGE
,

1871 
MONITOR_FLUSH_BATCH_COUNT
,

1872 
MONITOR_FLUSH_BATCH_PAGES
, 
cou¡
);

1875  (
cou¡
);

1876 
	}
}

1893 
ulöt
 
	$buf_Êush_b©ch
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_Êush_t
 
Êush_ty≥
,

1894 
ulöt
 
mö_n
, 
l¢_t
 
l¢_limô
) {

1895 
	`ut_ad
(
Êush_ty≥
 =
BUF_FLUSH_LRU
 || flush_ty≥ =
BUF_FLUSH_LIST
);

1897 #ifde‡
UNIV_DEBUG


1899 
di˘_sync_check
 
	`check
(
åue
);

1901 
	`ut_ad
(
Êush_ty≥
 !
BUF_FLUSH_LIST
 || !
	`sync_check_ôî©e
(
check
));

1905 
ulöt
 
cou¡
 = 0;

1909 
Êush_ty≥
) {

1910 
BUF_FLUSH_LRU
:

1911 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

1912 
cou¡
 = 
	`buf_do_LRU_b©ch
(
buf_poﬁ
, 
mö_n
);

1913 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

1915 
BUF_FLUSH_LIST
:

1916 
cou¡
 = 
	`buf_do_Êush_li°_b©ch
(
buf_poﬁ
, 
mö_n
, 
l¢_limô
);

1919 
ut_îr‹
;

1922 
	`DBUG_PRINT
("ib_buf", ("Êush %u com∂ëed, %uÖages", (
Êush_ty≥
),

1923 (
cou¡
)));

1925  (
cou¡
);

1926 
	}
}

1933 
	$buf_Êush_°©s
(
ulöt
 
∑ge_cou¡_Êush
, ulöà
∑ge_cou¡_LRU
) {

1934 
	`DBUG_PRINT
("ib_buf", ("flush completed, from flush_list %uÖages, "

1936 (
∑ge_cou¡_Êush
), (
∑ge_cou¡_LRU
)));

1938 
§v_°©s
.
buf_poﬁ_Êushed
.
	`add
(
∑ge_cou¡_Êush
 + 
∑ge_cou¡_LRU
);

1939 
	}
}

1944 
iboﬁ
 
	$buf_Êush_°¨t
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_Êush_t
 
Êush_ty≥
) {

1945 
	`ut_ad
(
Êush_ty≥
 =
BUF_FLUSH_LRU
 || flush_ty≥ =
BUF_FLUSH_LIST
);

1947 
	`muãx_íãr
(&
buf_poﬁ
->
Êush_°©e_muãx
);

1949 i‡(
buf_poﬁ
->
n_Êush
[
Êush_ty≥
] > 0 ||

1950 
buf_poﬁ
->
öô_Êush
[
Êush_ty≥
] =
TRUE
) {

1953 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

1955  (
FALSE
);

1958 
buf_poﬁ
->
öô_Êush
[
Êush_ty≥
] = 
TRUE
;

1960 
	`os_evít_ª£t
(
buf_poﬁ
->
no_Êush
[
Êush_ty≥
]);

1962 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

1964  (
TRUE
);

1965 
	}
}

1970 
	$buf_Êush_íd
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_Êush_t
 
Êush_ty≥
) {

1971 
	`muãx_íãr
(&
buf_poﬁ
->
Êush_°©e_muãx
);

1973 
buf_poﬁ
->
öô_Êush
[
Êush_ty≥
] = 
FALSE
;

1975 
buf_poﬁ
->
åy_LRU_sˇn
 = 
TRUE
;

1977 i‡(
buf_poﬁ
->
n_Êush
[
Êush_ty≥
] == 0) {

1980 
	`os_evít_£t
(
buf_poﬁ
->
no_Êush
[
Êush_ty≥
]);

1983 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

1985 i‡(!
§v_ªad_⁄ly_mode
) {

1986 
	`buf_dblwr_Êush_buf„ªd_wrôes
();

1988 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

1990 
	}
}

1993 
	$buf_Êush_waô_b©ch_íd
(
buf_poﬁ_t
 *
buf_poﬁ
,

1994 
buf_Êush_t
 
ty≥
)

1997 
	`ut_ad
(
ty≥
 =
BUF_FLUSH_LRU
 ||Åy≥ =
BUF_FLUSH_LIST
);

1999 i‡(
buf_poﬁ
 =
NULL
) {

2000 
ulöt
 
i
;

2002 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

2003 
buf_poﬁ_t
 *
buf_poﬁ
;

2005 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2007 
	`thd_waô_begö
(
NULL
, 
THD_WAIT_DISKIO
);

2008 
	`os_evít_waô
(
buf_poﬁ
->
no_Êush
[
ty≥
]);

2009 
	`thd_waô_íd
(
NULL
);

2012 
	`thd_waô_begö
(
NULL
, 
THD_WAIT_DISKIO
);

2013 
	`os_evít_waô
(
buf_poﬁ
->
no_Êush
[
ty≥
]);

2014 
	`thd_waô_íd
(
NULL
);

2016 
	}
}

2031 
boﬁ
 
	$buf_Êush_do_b©ch
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_Êush_t
 
ty≥
, 
ulöt
 
mö_n
,

2032 
l¢_t
 
l¢_limô
, 
ulöt
 *
n_¥o˚s£d
) {

2033 
	`ut_ad
(
ty≥
 =
BUF_FLUSH_LRU
 ||Åy≥ =
BUF_FLUSH_LIST
);

2035 i‡(
n_¥o˚s£d
 !
NULL
) {

2036 *
n_¥o˚s£d
 = 0;

2039 i‡(!
	`buf_Êush_°¨t
(
buf_poﬁ
, 
ty≥
)) {

2040  (
Ál£
);

2043 
ulöt
 
∑ge_cou¡
 = 
	`buf_Êush_b©ch
(
buf_poﬁ
, 
ty≥
, 
mö_n
, 
l¢_limô
);

2045 
	`buf_Êush_íd
(
buf_poﬁ
, 
ty≥
);

2047 i‡(
n_¥o˚s£d
 !
NULL
) {

2048 *
n_¥o˚s£d
 = 
∑ge_cou¡
;

2051  (
åue
);

2052 
	}
}

2070 
boﬁ
 
	$buf_Êush_li°s
(
ulöt
 
mö_n
, 
l¢_t
 
l¢_limô
, ulöà*
n_¥o˚s£d
) {

2071 
ulöt
 
n_Êushed
 = 0;

2072 
boﬁ
 
suc˚ss
 = 
åue
;

2074 i‡(
n_¥o˚s£d
) {

2075 *
n_¥o˚s£d
 = 0;

2078 i‡(
mö_n
 !
ULINT_MAX
) {

2083 
mö_n
 = (mö_¿+ 
§v_buf_poﬁ_ö°™˚s
 - 1) / srv_buf_pool_instances;

2087 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

2088 
buf_poﬁ_t
 *
buf_poﬁ
;

2089 
ulöt
 
∑ge_cou¡
 = 0;

2091 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2093 i‡(!
	`buf_Êush_do_b©ch
(
buf_poﬁ
, 
BUF_FLUSH_LIST
, 
mö_n
, 
l¢_limô
,

2094 &
∑ge_cou¡
)) {

2105 
suc˚ss
 = 
Ál£
;

2110 
n_Êushed
 +
∑ge_cou¡
;

2113 i‡(
n_Êushed
) {

2114 
	`buf_Êush_°©s
(
n_Êushed
, 0);

2117 i‡(
n_¥o˚s£d
) {

2118 *
n_¥o˚s£d
 = 
n_Êushed
;

2121  (
suc˚ss
);

2122 
	}
}

2132 
boﬁ
 
	$buf_Êush_sögÀ_∑ge_‰om_LRU
(
buf_poﬁ_t
 *
buf_poﬁ
) {

2133 
ulöt
 
sˇ¬ed
;

2134 
buf_∑ge_t
 *
b∑ge
;

2135 
iboﬁ
 
‰ìd
;

2137 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

2139 
b∑ge
 = 
buf_poﬁ
->
sögÀ_sˇn_ôr
.
	`°¨t
(), 
sˇ¬ed
 = 0, 
‰ìd
 = 
Ál£
;

2140 
b∑ge
 !
NULL
; ++
sˇ¬ed
, b∑gê
buf_poﬁ
->
sögÀ_sˇn_ôr
.
	`gë
()) {

2141 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

2143 
buf_∑ge_t
 *
¥ev
 = 
	`UT_LIST_GET_PREV
(
LRU
, 
b∑ge
);

2145 
buf_poﬁ
->
sögÀ_sˇn_ôr
.
	`£t
(
¥ev
);

2147 
BPageMuãx
 *
block_muãx
;

2149 
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

2151 
	`muãx_íãr
(
block_muãx
);

2153 i‡(
	`buf_Êush_ªady_f‹_ª∂a˚
(
b∑ge
)) {

2157 i‡(
	`buf_LRU_‰ì_∑ge
(
b∑ge
, 
åue
)) {

2158 
‰ìd
 = 
åue
;

2161 
	`muãx_exô
(
block_muãx
);

2164 } i‡(
	`buf_Êush_ªady_f‹_Êush
(
b∑ge
, 
BUF_FLUSH_SINGLE_PAGE
)) {

2173 
‰ìd
 = 
	`buf_Êush_∑ge
(
buf_poﬁ
, 
b∑ge
, 
BUF_FLUSH_SINGLE_PAGE
, 
åue
);

2175 i‡(
‰ìd
) {

2179 
	`muãx_exô
(
block_muãx
);

2181 
	`muãx_exô
(
block_muãx
);

2184 
	`ut_ad
(!
	`muãx_own
(
block_muãx
));

2187 i‡(!
‰ìd
) {

2189 
	`ut_ad
(!
b∑ge
);

2190 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

2193 i‡(
sˇ¬ed
) {

2194 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_LRU_SINGLE_FLUSH_SCANNED
,

2195 
MONITOR_LRU_SINGLE_FLUSH_SCANNED_NUM_CALL
,

2196 
MONITOR_LRU_SINGLE_FLUSH_SCANNED_PER_CALL
,

2197 
sˇ¬ed
);

2200 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

2202  (
‰ìd
);

2203 
	}
}

2213 
ulöt
 
	$buf_Êush_LRU_li°
(
buf_poﬁ_t
 *
buf_poﬁ
) {

2214 
ulöt
 
sˇn_dïth
, 
wôhdøw_dïth
;

2215 
ulöt
 
n_Êushed
 = 0;

2217 
	`ut_ad
(
buf_poﬁ
);

2221 
sˇn_dïth
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
);

2222 
wôhdøw_dïth
 = 
	`buf_gë_wôhdøw_dïth
(
buf_poﬁ
);

2224 i‡(
wôhdøw_dïth
 > 
§v_LRU_sˇn_dïth
) {

2225 
sˇn_dïth
 = 
	`ut_mö
(
wôhdøw_dïth
, scan_depth);

2227 
sˇn_dïth
 = 
	`ut_mö
(
°©ic_ˇ°
<
ulöt
>(
§v_LRU_sˇn_dïth
), scan_depth);

2234 
	`buf_Êush_do_b©ch
(
buf_poﬁ
, 
BUF_FLUSH_LRU
, 
sˇn_dïth
, 0, &
n_Êushed
);

2236  (
n_Êushed
);

2237 
	}
}

2240 
	$buf_Êush_waô_LRU_b©ch_íd
() {

2241 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

2242 
buf_poﬁ_t
 *
buf_poﬁ
;

2244 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2246 
	`muãx_íãr
(&
buf_poﬁ
->
Êush_°©e_muãx
);

2248 i‡(
buf_poﬁ
->
n_Êush
[
BUF_FLUSH_LRU
] > 0 ||

2249 
buf_poﬁ
->
öô_Êush
[
BUF_FLUSH_LRU
]) {

2250 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

2251 
	`buf_Êush_waô_b©ch_íd
(
buf_poﬁ
, 
BUF_FLUSH_LRU
);

2253 
	`muãx_exô
(&
buf_poﬁ
->
Êush_°©e_muãx
);

2256 
	}
}

2261 
ulöt
 
	$af_gë_p˘_f‹_dúty
() {

2262 
dúty_p˘
 = 
	`buf_gë_modifõd_øtio_p˘
();

2264 i‡(
dúty_p˘
 == 0.0) {

2269 
	`ut_a
(
§v_max_dúty_∑ges_p˘_lwm
 <
§v_max_buf_poﬁ_modifõd_p˘
);

2271 i‡(
§v_max_dúty_∑ges_p˘_lwm
 == 0) {

2274 i‡(
dúty_p˘
 >
§v_max_buf_poﬁ_modifõd_p˘
) {

2280 } i‡(
dúty_p˘
 >
§v_max_dúty_∑ges_p˘_lwm
) {

2282  (
°©ic_ˇ°
<
ulöt
>((
dúty_p˘
 * 100) /

2283 (
§v_max_buf_poﬁ_modifõd_p˘
 + 1)));

2287 
	}
}

2291 
ulöt
 
	$af_gë_p˘_f‹_l¢
(
l¢_t
 
age
)

2293 c⁄° 
l¢_t
 
log_m¨gö
 =

2294 
	`log_å™¶©e_¢_to_l¢
(
	`log_‰ì_check_m¨gö
(*
log_sys
));

2296 
	`ut_a
(
log_sys
->
l¢_ˇ∑côy_f‹_‰ì_check
 > 
log_m¨gö
);

2298 c⁄° 
l¢_t
 
log_ˇ∑côy
 = 
log_sys
->
l¢_ˇ∑côy_f‹_‰ì_check
 - 
log_m¨gö
;

2300 
l¢_t
 
l¢_age_Á˘‹
;

2301 
l¢_t
 
af_lwm
 = (
§v_ad≠tive_Êushög_lwm
 * 
log_ˇ∑côy
) / 100;

2303 i‡(
age
 < 
af_lwm
) {

2308 autÿ
limô_f‹_age
 = 
	`log_gë_max_modifõd_age_async
();

2309 
	`ut_a
(
limô_f‹_age
 >
log_m¨gö
);

2310 
limô_f‹_age
 -
log_m¨gö
;

2312 i‡(
age
 < 
limô_f‹_age
 && !
§v_ad≠tive_Êushög
) {

2322 
l¢_age_Á˘‹
 = (
age
 * 100Ë/ 
limô_f‹_age
;

2324 
	`ut_ad
(
§v_max_io_ˇ∑côy
 >
§v_io_ˇ∑côy
);

2325  (
°©ic_ˇ°
<
ulöt
>(((
§v_max_io_ˇ∑côy
 / 
§v_io_ˇ∑côy
) *

2326 (
l¢_age_Á˘‹
 * 
	`sqπ
(()lsn_age_factor))) /

2328 
	}
}

2337 
ulöt
 
	$∑ge_˛ó√r_Êush_∑ges_ªcommíd©i⁄
(
l¢_t
 *
l¢_limô
,

2338 
ulöt
 
œ°_∑ges_ö
) {

2339 
l¢_t
 
¥ev_l¢
 = 0;

2340 
ulöt
 
sum_∑ges
 = 0;

2341 
ulöt
 
avg_∑ge_øã
 = 0;

2342 
ulöt
 
n_ôî©i⁄s
 = 0;

2343 
time_t
 
¥ev_time
;

2344 
l¢_t
 
ﬁde°_l¢
;

2345 
l¢_t
 
cur_l¢
;

2346 
l¢_t
 
age
;

2347 
l¢_t
 
l¢_øã
;

2348 
ulöt
 
n_∑ges
 = 0;

2349 
ulöt
 
p˘_f‹_dúty
 = 0;

2350 
ulöt
 
p˘_f‹_l¢
 = 0;

2351 
ulöt
 
p˘_tŸÆ
 = 0;

2353 
cur_l¢
 = 
	`log_buf„r_dúty_∑ges_added_up_to_l¢
(*
log_sys
);

2355 i‡(
¥ev_l¢
 == 0) {

2357 
¥ev_l¢
 = 
cur_l¢
;

2358 
¥ev_time
 = 
	`ut_time
();

2362 i‡(
¥ev_l¢
 =
cur_l¢
) {

2366 
sum_∑ges
 +
œ°_∑ges_ö
;

2368 
time_t
 
cuº_time
 = 
	`ut_time
();

2369 
time_ñ≠£d
 = 
	`dif·ime
(
cuº_time
, 
¥ev_time
);

2373 i‡(++
n_ôî©i⁄s
 >
§v_Êushög_avg_lo›s
 ||

2374 
time_ñ≠£d
 >
§v_Êushög_avg_lo›s
) {

2375 i‡(
time_ñ≠£d
 < 1) {

2376 
time_ñ≠£d
 = 1;

2379 
avg_∑ge_øã
 = 
°©ic_ˇ°
<
ulöt
>(

2380 ((
°©ic_ˇ°
<>(
sum_∑ges
Ë/ 
time_ñ≠£d
Ë+ 
avg_∑ge_øã
) / 2);

2383 
l¢_øã
 = 
°©ic_ˇ°
<
l¢_t
>(°©ic_ˇ°<>(
cur_l¢
 - 
¥ev_l¢
) /

2384 
time_ñ≠£d
);

2386 
l¢_avg_øã
 = (l¢_avg_øã + 
l¢_øã
) / 2;

2389 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2391 
ulöt
 
Êush_tm
 = 
∑ge_˛ó√r
->
Êush_time
;

2392 
ulöt
 
Êush_∑ss
 = 
∑ge_˛ó√r
->flush_pass;

2394 
∑ge_˛ó√r
->
Êush_time
 = 0;

2395 
∑ge_˛ó√r
->
Êush_∑ss
 = 0;

2397 
ulöt
 
Ãu_tm
 = 0;

2398 
ulöt
 
li°_tm
 = 0;

2399 
ulöt
 
Ãu_∑ss
 = 0;

2400 
ulöt
 
li°_∑ss
 = 0;

2402 
ulöt
 
i
 = 0; i < 
∑ge_˛ó√r
->
n_¶Ÿs
; i++) {

2403 
∑ge_˛ó√r_¶Ÿ_t
 *
¶Ÿ
;

2405 
¶Ÿ
 = &
∑ge_˛ó√r
->
¶Ÿs
[
i
];

2407 
Ãu_tm
 +
¶Ÿ
->
Êush_Ãu_time
;

2408 
Ãu_∑ss
 +
¶Ÿ
->
Êush_Ãu_∑ss
;

2409 
li°_tm
 +
¶Ÿ
->
Êush_li°_time
;

2410 
li°_∑ss
 +
¶Ÿ
->
Êush_li°_∑ss
;

2412 
¶Ÿ
->
Êush_Ãu_time
 = 0;

2413 
¶Ÿ
->
Êush_Ãu_∑ss
 = 0;

2414 
¶Ÿ
->
Êush_li°_time
 = 0;

2415 
¶Ÿ
->
Êush_li°_∑ss
 = 0;

2418 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2421 i‡(
Ãu_tm
 < 1) {

2422 
Ãu_tm
 = 1;

2424 i‡(
li°_tm
 < 1) {

2425 
li°_tm
 = 1;

2427 i‡(
Êush_tm
 < 1) {

2428 
Êush_tm
 = 1;

2431 i‡(
Ãu_∑ss
 < 1) {

2432 
Ãu_∑ss
 = 1;

2434 i‡(
li°_∑ss
 < 1) {

2435 
li°_∑ss
 = 1;

2437 i‡(
Êush_∑ss
 < 1) {

2438 
Êush_∑ss
 = 1;

2441 
	`MONITOR_SET
(
MONITOR_FLUSH_ADAPTIVE_AVG_TIME_SLOT
, 
li°_tm
 / 
li°_∑ss
);

2442 
	`MONITOR_SET
(
MONITOR_LRU_BATCH_FLUSH_AVG_TIME_SLOT
, 
Ãu_tm
 / 
Ãu_∑ss
);

2444 
	`MONITOR_SET
(
MONITOR_FLUSH_ADAPTIVE_AVG_TIME_THREAD
,

2445 
li°_tm
 / (
§v_n_∑ge_˛ó√rs
 * 
Êush_∑ss
));

2446 
	`MONITOR_SET
(
MONITOR_LRU_BATCH_FLUSH_AVG_TIME_THREAD
,

2447 
Ãu_tm
 / (
§v_n_∑ge_˛ó√rs
 * 
Êush_∑ss
));

2448 
	`MONITOR_SET
(
MONITOR_FLUSH_ADAPTIVE_AVG_TIME_EST
,

2449 
Êush_tm
 * 
li°_tm
 / 
Êush_∑ss
 / (li°_tm + 
Ãu_tm
));

2450 
	`MONITOR_SET
(
MONITOR_LRU_BATCH_FLUSH_AVG_TIME_EST
,

2451 
Êush_tm
 * 
Ãu_tm
 / 
Êush_∑ss
 / (
li°_tm
 +Üru_tm));

2452 
	`MONITOR_SET
(
MONITOR_FLUSH_AVG_TIME
, 
Êush_tm
 / 
Êush_∑ss
);

2454 
	`MONITOR_SET
(
MONITOR_FLUSH_ADAPTIVE_AVG_PASS
,

2455 
li°_∑ss
 / 
∑ge_˛ó√r
->
n_¶Ÿs
);

2456 
	`MONITOR_SET
(
MONITOR_LRU_BATCH_FLUSH_AVG_PASS
,

2457 
Ãu_∑ss
 / 
∑ge_˛ó√r
->
n_¶Ÿs
);

2458 
	`MONITOR_SET
(
MONITOR_FLUSH_AVG_PASS
, 
Êush_∑ss
);

2460 
¥ev_l¢
 = 
cur_l¢
;

2461 
¥ev_time
 = 
cuº_time
;

2463 
n_ôî©i⁄s
 = 0;

2465 
sum_∑ges
 = 0;

2468 
ﬁde°_l¢
 = 
	`buf_poﬁ_gë_ﬁde°_modifiˇti⁄_≠¥ox
();

2470 
	`ut_ad
(
ﬁde°_l¢
 <
	`log_gë_l¢
(*
log_sys
));

2472 
age
 = 
cur_l¢
 > 
ﬁde°_l¢
 ? cur_lsn - oldest_lsn : 0;

2474 
p˘_f‹_dúty
 = 
	`af_gë_p˘_f‹_dúty
();

2475 
p˘_f‹_l¢
 = 
	`af_gë_p˘_f‹_l¢
(
age
);

2477 
p˘_tŸÆ
 = 
	`ut_max
(
p˘_f‹_dúty
, 
p˘_f‹_l¢
);

2480 
ulöt
 
sum_∑ges_f‹_l¢
 = 0;

2481 
l¢_t
 
èrgë_l¢
 = 
ﬁde°_l¢
 + 
l¢_avg_øã
 * 
buf_Êush_l¢_sˇn_Á˘‹
;

2483 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

2484 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2485 
ulöt
 
∑ges_f‹_l¢
 = 0;

2487 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

2488 
buf_∑ge_t
 *
b
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
Êush_li°
); b !
NULL
;

2489 
b
 = 
	`UT_LIST_GET_PREV
(
li°
, b)) {

2490 i‡(
b
->
ﬁde°_modifiˇti⁄
 > 
èrgë_l¢
) {

2493 ++
∑ges_f‹_l¢
;

2495 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

2497 
sum_∑ges_f‹_l¢
 +
∑ges_f‹_l¢
;

2499 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2500 
	`ut_ad
(
∑ge_˛ó√r
->
¶Ÿs
[
i
].
°©e
 =
PAGE_CLEANER_STATE_NONE
);

2501 
∑ge_˛ó√r
->
¶Ÿs
[
i
].
n_∑ges_ªque°ed
 =

2502 
∑ges_f‹_l¢
 / 
buf_Êush_l¢_sˇn_Á˘‹
 + 1;

2503 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2506 
sum_∑ges_f‹_l¢
 /
buf_Êush_l¢_sˇn_Á˘‹
;

2507 i‡(
sum_∑ges_f‹_l¢
 < 1) {

2508 
sum_∑ges_f‹_l¢
 = 1;

2513 
ulöt
 
∑ges_f‹_l¢
 =

2514 
°d
::
mö
<
ulöt
>(
sum_∑ges_f‹_l¢
, 
§v_max_io_ˇ∑côy
 * 2);

2516 
n_∑ges
 = (
	`PCT_IO
(
p˘_tŸÆ
Ë+ 
avg_∑ge_øã
 + 
∑ges_f‹_l¢
) / 3;

2518 i‡(
n_∑ges
 > 
§v_max_io_ˇ∑côy
) {

2519 
n_∑ges
 = 
§v_max_io_ˇ∑côy
;

2523 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2524 
	`ut_ad
(
∑ge_˛ó√r
->
n_¶Ÿs_ªque°ed
 == 0);

2525 
	`ut_ad
(
∑ge_˛ó√r
->
n_¶Ÿs_Êushög
 == 0);

2526 
	`ut_ad
(
∑ge_˛ó√r
->
n_¶Ÿs_föished
 == 0);

2528 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

2531 
∑ge_˛ó√r
->
¶Ÿs
[
i
].
n_∑ges_ªque°ed
 =

2532 
p˘_f‹_l¢
 > 30 ? 
∑ge_˛ó√r
->
¶Ÿs
[
i
].
n_∑ges_ªque°ed
 * 
n_∑ges
 /

2533 
sum_∑ges_f‹_l¢
 +

2535 : 
n_∑ges
 / 
§v_buf_poﬁ_ö°™˚s
;

2537 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2539 
	`MONITOR_SET
(
MONITOR_FLUSH_N_TO_FLUSH_REQUESTED
, 
n_∑ges
);

2541 
	`MONITOR_SET
(
MONITOR_FLUSH_N_TO_FLUSH_BY_AGE
, 
sum_∑ges_f‹_l¢
);

2543 
	`MONITOR_SET
(
MONITOR_FLUSH_AVG_PAGE_RATE
, 
avg_∑ge_øã
);

2544 
	`MONITOR_SET
(
MONITOR_FLUSH_LSN_AVG_RATE
, 
l¢_avg_øã
);

2545 
	`MONITOR_SET
(
MONITOR_FLUSH_PCT_FOR_DIRTY
, 
p˘_f‹_dúty
);

2546 
	`MONITOR_SET
(
MONITOR_FLUSH_PCT_FOR_LSN
, 
p˘_f‹_l¢
);

2548 *
l¢_limô
 = 
LSN_MAX
;

2550  (
n_∑ges
);

2551 
	}
}

2560 
ulöt
 
	$pc_¶ìp_if_√eded
(
ulöt
 
√xt_lo›_time
, 
öt64_t
 
sig_cou¡
) {

2561 
ulöt
 
cur_time
 = 
	`ut_time_ms
();

2563 i‡(
√xt_lo›_time
 > 
cur_time
) {

2566 
ulöt
 
¶ìp_us
;

2568 
¶ìp_us
 =

2569 
	`ut_mö
(
°©ic_ˇ°
<
ulöt
>(1000000), (
√xt_lo›_time
 - 
cur_time
) * 1000);

2571  (
	`os_evít_waô_time_low
(
buf_Êush_evít
, 
¶ìp_us
, 
sig_cou¡
));

2574  (
OS_SYNC_TIME_EXCEEDED
);

2575 
	}
}

2579 
	$buf_Êush_∑ge_˛ó√r_öô
(
size_t
 
n_∑ge_˛ó√rs
) {

2580 
	`ut_ad
(
∑ge_˛ó√r
 =
NULL
);

2582 
∑ge_˛ó√r
 =

2583 
°©ic_ˇ°
<
∑ge_˛ó√r_t
 *>(
	`ut_zÆloc_nokey
((*
∑ge_˛ó√r
)));

2585 
	`muãx_¸óã
(
LATCH_ID_PAGE_CLEANER
, &
∑ge_˛ó√r
->
muãx
);

2587 
∑ge_˛ó√r
->
is_ªque°ed
 = 
	`os_evít_¸óã
("pc_is_requested");

2588 
∑ge_˛ó√r
->
is_föished
 = 
	`os_evít_¸óã
("pc_is_finished");

2590 
∑ge_˛ó√r
->
n_¶Ÿs
 = 
°©ic_ˇ°
<
ulöt
>(
§v_buf_poﬁ_ö°™˚s
);

2592 
∑ge_˛ó√r
->
¶Ÿs
 = 
°©ic_ˇ°
<
∑ge_˛ó√r_¶Ÿ_t
 *>(

2593 
	`ut_zÆloc_nokey
(
∑ge_˛ó√r
->
n_¶Ÿs
 * (*∑ge_˛ó√r->
¶Ÿs
)));

2595 
	`ut_d
(
∑ge_˛ó√r
->
n_dißbÀd_debug
 = 0);

2597 
∑ge_˛ó√r
->
is_ru¬ög
 = 
åue
;

2599 
	`os_thªad_¸óã
(
∑ge_Êush_co‹dö©‹_thªad_key
,

2600 
buf_Êush_∑ge_co‹dö©‹_thªad
, 
n_∑ge_˛ó√rs
);

2604 !
buf_∑ge_˛ó√r_is_a˘ive
) {

2605 
	`os_thªad_¶ìp
(10000);

2607 
	}
}

2611 
	$buf_Êush_∑ge_˛ó√r_˛o£
() {

2613 
∑ge_˛ó√r
->
n_w‹kîs
 > 0) {

2614 
	`os_thªad_¶ìp
(10000);

2617 
	`muãx_de°roy
(&
∑ge_˛ó√r
->
muãx
);

2619 
	`ut_‰ì
(
∑ge_˛ó√r
->
¶Ÿs
);

2621 
	`os_evít_de°roy
(
∑ge_˛ó√r
->
is_föished
);

2622 
	`os_evít_de°roy
(
∑ge_˛ó√r
->
is_ªque°ed
);

2624 
	`ut_‰ì
(
∑ge_˛ó√r
);

2626 
∑ge_˛ó√r
 = 
NULL
;

2627 
	}
}

2637 
	$pc_ªque°
(
ulöt
 
mö_n
, 
l¢_t
 
l¢_limô
) {

2638 i‡(
mö_n
 !
ULINT_MAX
) {

2643 
mö_n
 = (mö_¿+ 
§v_buf_poﬁ_ö°™˚s
 - 1) / srv_buf_pool_instances;

2646 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2648 
	`ut_ad
(
∑ge_˛ó√r
->
n_¶Ÿs_ªque°ed
 == 0);

2649 
	`ut_ad
(
∑ge_˛ó√r
->
n_¶Ÿs_Êushög
 == 0);

2650 
	`ut_ad
(
∑ge_˛ó√r
->
n_¶Ÿs_föished
 == 0);

2652 
∑ge_˛ó√r
->
ªque°ed
 = (
mö_n
 > 0);

2653 
∑ge_˛ó√r
->
l¢_limô
 =Üsn_limit;

2655 
ulöt
 
i
 = 0; i < 
∑ge_˛ó√r
->
n_¶Ÿs
; i++) {

2656 
∑ge_˛ó√r_¶Ÿ_t
 *
¶Ÿ
 = &
∑ge_˛ó√r
->
¶Ÿs
[
i
];

2658 
	`ut_ad
(
¶Ÿ
->
°©e
 =
PAGE_CLEANER_STATE_NONE
);

2660 i‡(
mö_n
 =
ULINT_MAX
) {

2661 
¶Ÿ
->
n_∑ges_ªque°ed
 = 
ULINT_MAX
;

2662 } i‡(
mö_n
 == 0) {

2663 
¶Ÿ
->
n_∑ges_ªque°ed
 = 0;

2669 
¶Ÿ
->
°©e
 = 
PAGE_CLEANER_STATE_REQUESTED
;

2672 
∑ge_˛ó√r
->
n_¶Ÿs_ªque°ed
 =Öage_˛ó√r->
n_¶Ÿs
;

2673 
∑ge_˛ó√r
->
n_¶Ÿs_Êushög
 = 0;

2674 
∑ge_˛ó√r
->
n_¶Ÿs_föished
 = 0;

2676 
	`os_evít_£t
(
∑ge_˛ó√r
->
is_ªque°ed
);

2678 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2679 
	}
}

2684 
ulöt
 
	$pc_Êush_¶Ÿ
() {

2685 
ulöt
 
Ãu_tm
 = 0;

2686 
ulöt
 
li°_tm
 = 0;

2687 
Ãu_∑ss
 = 0;

2688 
li°_∑ss
 = 0;

2690 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2692 i‡(
∑ge_˛ó√r
->
n_¶Ÿs_ªque°ed
 > 0) {

2693 
∑ge_˛ó√r_¶Ÿ_t
 *
¶Ÿ
 = 
NULL
;

2694 
ulöt
 
i
;

2696 
i
 = 0; i < 
∑ge_˛ó√r
->
n_¶Ÿs
; i++) {

2697 
¶Ÿ
 = &
∑ge_˛ó√r
->
¶Ÿs
[
i
];

2699 i‡(
¶Ÿ
->
°©e
 =
PAGE_CLEANER_STATE_REQUESTED
) {

2706 
	`ut_a
(
i
 < 
∑ge_˛ó√r
->
n_¶Ÿs
);

2708 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2710 
∑ge_˛ó√r
->
n_¶Ÿs_ªque°ed
--;

2711 
∑ge_˛ó√r
->
n_¶Ÿs_Êushög
++;

2712 
¶Ÿ
->
°©e
 = 
PAGE_CLEANER_STATE_FLUSHING
;

2714 i‡(
∑ge_˛ó√r
->
n_¶Ÿs_ªque°ed
 == 0) {

2715 
	`os_evít_ª£t
(
∑ge_˛ó√r
->
is_ªque°ed
);

2718 i‡(!
∑ge_˛ó√r
->
is_ru¬ög
) {

2719 
¶Ÿ
->
n_Êushed_Ãu
 = 0;

2720 
¶Ÿ
->
n_Êushed_li°
 = 0;

2721 
föish_muãx
;

2724 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2726 
Ãu_tm
 = 
	`ut_time_ms
();

2729 
¶Ÿ
->
n_Êushed_Ãu
 = 
	`buf_Êush_LRU_li°
(
buf_poﬁ
);

2731 
Ãu_tm
 = 
	`ut_time_ms
() -Üru_tm;

2732 
Ãu_∑ss
++;

2734 i‡(!
∑ge_˛ó√r
->
is_ru¬ög
) {

2735 
¶Ÿ
->
n_Êushed_li°
 = 0;

2736 
föish
;

2740 i‡(
∑ge_˛ó√r
->
ªque°ed
) {

2741 
li°_tm
 = 
	`ut_time_ms
();

2743 
¶Ÿ
->
suc˚eded_li°
 =

2744 
	`buf_Êush_do_b©ch
(
buf_poﬁ
, 
BUF_FLUSH_LIST
, 
¶Ÿ
->
n_∑ges_ªque°ed
,

2745 
∑ge_˛ó√r
->
l¢_limô
, &
¶Ÿ
->
n_Êushed_li°
);

2747 
li°_tm
 = 
	`ut_time_ms
() -Üist_tm;

2748 
li°_∑ss
++;

2750 
¶Ÿ
->
n_Êushed_li°
 = 0;

2751 
¶Ÿ
->
suc˚eded_li°
 = 
åue
;

2753 
föish
:

2754 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2755 
föish_muãx
:

2756 
∑ge_˛ó√r
->
n_¶Ÿs_Êushög
--;

2757 
∑ge_˛ó√r
->
n_¶Ÿs_föished
++;

2758 
¶Ÿ
->
°©e
 = 
PAGE_CLEANER_STATE_FINISHED
;

2760 
¶Ÿ
->
Êush_Ãu_time
 +
Ãu_tm
;

2761 
¶Ÿ
->
Êush_li°_time
 +
li°_tm
;

2762 
¶Ÿ
->
Êush_Ãu_∑ss
 +
Ãu_∑ss
;

2763 
¶Ÿ
->
Êush_li°_∑ss
 +
li°_∑ss
;

2765 i‡(
∑ge_˛ó√r
->
n_¶Ÿs_ªque°ed
 == 0 &&

2766 
∑ge_˛ó√r
->
n_¶Ÿs_Êushög
 == 0) {

2767 
	`os_evít_£t
(
∑ge_˛ó√r
->
is_föished
);

2771 
ulöt
 
ªt
 = 
∑ge_˛ó√r
->
n_¶Ÿs_ªque°ed
;

2773 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2775  (
ªt
);

2776 
	}
}

2784 
boﬁ
 
	$pc_waô_föished
(
ulöt
 *
n_Êushed_Ãu
, ulöà*
n_Êushed_li°
) {

2785 
boﬁ
 
Æl_suc˚eded
 = 
åue
;

2787 *
n_Êushed_Ãu
 = 0;

2788 *
n_Êushed_li°
 = 0;

2790 
	`os_evít_waô
(
∑ge_˛ó√r
->
is_föished
);

2792 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2794 
	`ut_ad
(
∑ge_˛ó√r
->
n_¶Ÿs_ªque°ed
 == 0);

2795 
	`ut_ad
(
∑ge_˛ó√r
->
n_¶Ÿs_Êushög
 == 0);

2796 
	`ut_ad
(
∑ge_˛ó√r
->
n_¶Ÿs_föished
 =∑ge_˛ó√r->
n_¶Ÿs
);

2798 
ulöt
 
i
 = 0; i < 
∑ge_˛ó√r
->
n_¶Ÿs
; i++) {

2799 
∑ge_˛ó√r_¶Ÿ_t
 *
¶Ÿ
 = &
∑ge_˛ó√r
->
¶Ÿs
[
i
];

2801 
	`ut_ad
(
¶Ÿ
->
°©e
 =
PAGE_CLEANER_STATE_FINISHED
);

2803 *
n_Êushed_Ãu
 +
¶Ÿ
->n_flushed_lru;

2804 *
n_Êushed_li°
 +
¶Ÿ
->n_flushed_list;

2805 
Æl_suc˚eded
 &
¶Ÿ
->
suc˚eded_li°
;

2807 
¶Ÿ
->
°©e
 = 
PAGE_CLEANER_STATE_NONE
;

2809 
¶Ÿ
->
n_∑ges_ªque°ed
 = 0;

2812 
∑ge_˛ó√r
->
n_¶Ÿs_föished
 = 0;

2814 
	`os_evít_ª£t
(
∑ge_˛ó√r
->
is_föished
);

2816 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2818  (
Æl_suc˚eded
);

2819 
	}
}

2821 #ifde‡
UNIV_LINUX


2826 
boﬁ
 
	$buf_Êush_∑ge_˛ó√r_£t_¥i‹ôy
(
¥i‹ôy
) {

2827 
	`£çri‹ôy
(
PRIO_PROCESS
, (
pid_t
)
	`sysˇŒ
(
SYS_gëtid
), 
¥i‹ôy
);

2828  (
	`gë¥i‹ôy
(
PRIO_PROCESS
, (
pid_t
)
	`sysˇŒ
(
SYS_gëtid
)Ë=
¥i‹ôy
);

2829 
	}
}

2832 #ifde‡
UNIV_DEBUG


2834 
	$buf_Êush_∑ge_˛ó√r_dißbÀd_lo›
() {

2835 
	`ut_ad
(
∑ge_˛ó√r
 !
NULL
);

2837 i‡(!
önodb_∑ge_˛ó√r_dißbÀd_debug
) {

2842 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2843 
∑ge_˛ó√r
->
n_dißbÀd_debug
++;

2844 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2846 
önodb_∑ge_˛ó√r_dißbÀd_debug
 &&

2847 
§v_shutdown_°©e
 =
SRV_SHUTDOWN_NONE
 && 
∑ge_˛ó√r
->
is_ru¬ög
) {

2848 
	`os_thªad_¶ìp
(100000);

2864 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2865 
∑ge_˛ó√r
->
n_dißbÀd_debug
--;

2866 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2867 
	}
}

2875 
	$buf_Êush_∑ge_˛ó√r_dißbÀd_debug_upd©e
(
THD
 *
thd
, 
SYS_VAR
 *
v¨
,

2876 *
v¨_±r
,

2877 c⁄° *
ßve
) {

2878 i‡(
∑ge_˛ó√r
 =
NULL
) {

2882 i‡(!*
°©ic_ˇ°
<c⁄° 
boﬁ
 *>(
ßve
)) {

2883 i‡(!
önodb_∑ge_˛ó√r_dißbÀd_debug
) {

2887 
önodb_∑ge_˛ó√r_dißbÀd_debug
 = 
Ál£
;

2890 
§v_shutdown_°©e
 =
SRV_SHUTDOWN_NONE
) {

2891 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2892 c⁄° 
ulöt
 
n
 = 
∑ge_˛ó√r
->
n_dißbÀd_debug
;

2893 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2896 i‡(
n
 == 0) {

2903 i‡(
önodb_∑ge_˛ó√r_dißbÀd_debug
) {

2907 
önodb_∑ge_˛ó√r_dißbÀd_debug
 = 
åue
;

2909 
§v_shutdown_°©e
 =
SRV_SHUTDOWN_NONE
) {

2918 
	`os_evít_£t
(
∑ge_˛ó√r
->
is_ªque°ed
);

2920 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

2922 
	`ut_ad
(
∑ge_˛ó√r
->
n_dißbÀd_debug
 <
§v_n_∑ge_˛ó√rs
);

2924 i‡(
∑ge_˛ó√r
->
n_dißbÀd_debug
 =
§v_n_∑ge_˛ó√rs
) {

2925 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2929 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

2931 
	`os_thªad_¶ìp
(100000);

2933 
	}
}

2939 
	$buf_Êush_∑ge_co‹dö©‹_thªad
(
size_t
 
n_∑ge_˛ó√rs
) {

2940 
ulöt
 
√xt_lo›_time
 = 
	`ut_time_ms
() + 1000;

2941 
ulöt
 
n_Êushed
 = 0;

2942 
ulöt
 
œ°_a˘ivôy
 = 
	`§v_gë_a˘ivôy_cou¡
();

2943 
ulöt
 
œ°_∑ges
 = 0;

2945 
	`my_thªad_öô
();

2947 #ifde‡
UNIV_LINUX


2950 i‡(
	`buf_Êush_∑ge_˛ó√r_£t_¥i‹ôy
(
buf_Êush_∑ge_˛ó√r_¥i‹ôy
)) {

2951 
ib
::
	`öfo
(
ER_IB_MSG_126
) << "page_cleaner coordinatorÖriority: "

2952 << 
buf_Êush_∑ge_˛ó√r_¥i‹ôy
;

2954 
ib
::
	`öfo
(
ER_IB_MSG_127
) << "IfÅhe mysqldÉxecution user isáuthorized,"

2960 
buf_∑ge_˛ó√r_is_a˘ive
 = 
åue
;

2965 
size_t
 
i
 = 1; i < 
n_∑ge_˛ó√rs
; ++i) {

2966 
	`os_thªad_¸óã
(
∑ge_Êush_thªad_key
, 
buf_Êush_∑ge_˛ó√r_thªad
);

2969 !
§v_ªad_⁄ly_mode
 && 
§v_shutdown_°©e
 =
SRV_SHUTDOWN_NONE
 &&

2970 
ªcv_sys
->
•a˚s
 !
NULL
) {

2972 
ulöt
 
n_Êushed_Ãu
 = 0;

2973 
ulöt
 
n_Êushed_li°
 = 0;

2975 
	`os_evít_waô
(
ªcv_sys
->
Êush_°¨t
);

2977 i‡(
§v_shutdown_°©e
 !
SRV_SHUTDOWN_NONE
 || 
ªcv_sys
->
•a˚s
 =
NULL
) {

2981 
ªcv_sys
->
Êush_ty≥
) {

2982 
BUF_FLUSH_LRU
:

2984 
	`pc_ªque°
(0, 
LSN_MAX
);

2985 
	`pc_Êush_¶Ÿ
() > 0) {

2987 
	`pc_waô_föished
(&
n_Êushed_Ãu
, &
n_Êushed_li°
);

2990 
BUF_FLUSH_LIST
:

2993 
	`pc_ªque°
(
ULINT_MAX
, 
LSN_MAX
);

2994 
	`pc_Êush_¶Ÿ
() > 0) {

2996 } !
	`pc_waô_föished
(&
n_Êushed_Ãu
, &
n_Êushed_li°
));

3000 
	`ut_ad
(0);

3003 
	`os_evít_ª£t
(
ªcv_sys
->
Êush_°¨t
);

3004 
	`os_evít_£t
(
ªcv_sys
->
Êush_íd
);

3007 
	`os_evít_waô
(
buf_Êush_evít
);

3009 
ulöt
 
ªt_¶ìp
 = 0;

3010 
ulöt
 
n_evi˘ed
 = 0;

3011 
ulöt
 
n_Êushed_œ°
 = 0;

3012 
ulöt
 
w¨n_öãrvÆ
 = 1;

3013 
ulöt
 
w¨n_cou¡
 = 0;

3014 
öt64_t
 
sig_cou¡
 = 
	`os_evít_ª£t
(
buf_Êush_evít
);

3016 
§v_shutdown_°©e
 =
SRV_SHUTDOWN_NONE
) {

3020 i‡(
	`§v_check_a˘ivôy
(
œ°_a˘ivôy
Ë|| 
	`buf_gë_n_≥ndög_ªad_ios
() ||

3021 
n_Êushed
 == 0) {

3022 
ªt_¶ìp
 = 
	`pc_¶ìp_if_√eded
(
√xt_lo›_time
, 
sig_cou¡
);

3024 i‡(
§v_shutdown_°©e
 !
SRV_SHUTDOWN_NONE
) {

3027 } i‡(
	`ut_time_ms
(Ë> 
√xt_lo›_time
) {

3028 
ªt_¶ìp
 = 
OS_SYNC_TIME_EXCEEDED
;

3030 
ªt_¶ìp
 = 0;

3033 
sig_cou¡
 = 
	`os_evít_ª£t
(
buf_Êush_evít
);

3035 i‡(
ªt_¶ìp
 =
OS_SYNC_TIME_EXCEEDED
) {

3036 
ulöt
 
cuº_time
 = 
	`ut_time_ms
();

3038 i‡(
cuº_time
 > 
√xt_lo›_time
 + 3000) {

3039 i‡(
w¨n_cou¡
 == 0) {

3040 
ulöt
 
us
;

3042 
us
 = 1000 + 
cuº_time
 - 
√xt_lo›_time
;

3044 
ib
::
	`öfo
(
ER_IB_MSG_128
)

3045 << "Pagê˛ó√∏took " << 
us
 << "m†tÿÊush " << 
n_Êushed_œ°


3046 << "ándÉvi˘ " << 
n_evi˘ed
 << "Öages";

3048 i‡(
w¨n_öãrvÆ
 > 300) {

3049 
w¨n_öãrvÆ
 = 600;

3051 
w¨n_öãrvÆ
 *= 2;

3054 
w¨n_cou¡
 = 
w¨n_öãrvÆ
;

3056 --
w¨n_cou¡
;

3060 
w¨n_öãrvÆ
 = 1;

3061 
w¨n_cou¡
 = 0;

3064 
√xt_lo›_time
 = 
cuº_time
 + 1000;

3065 
n_Êushed_œ°
 = 
n_evi˘ed
 = 0;

3068 i‡(
ªt_¶ìp
 !
OS_SYNC_TIME_EXCEEDED
 && 
§v_Êush_sync
 &&

3069 
buf_Êush_sync_l¢
 > 0) {

3071 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

3072 
l¢_t
 
l¢_limô
 = 
buf_Êush_sync_l¢
;

3073 
buf_Êush_sync_l¢
 = 0;

3074 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

3077 
	`pc_ªque°
(
ULINT_MAX
, 
l¢_limô
);

3079 
ulöt
 
tm
 = 
	`ut_time_ms
();

3082 
	`pc_Êush_¶Ÿ
() > 0) {

3087 
∑ge_˛ó√r
->
Êush_time
 +
	`ut_time_ms
(Ë- 
tm
;

3088 
∑ge_˛ó√r
->
Êush_∑ss
++;

3091 
ulöt
 
n_Êushed_Ãu
 = 0;

3092 
ulöt
 
n_Êushed_li°
 = 0;

3093 
	`pc_waô_föished
(&
n_Êushed_Ãu
, &
n_Êushed_li°
);

3095 i‡(
n_Êushed_li°
 > 0 || 
n_Êushed_Ãu
 > 0) {

3096 
	`buf_Êush_°©s
(
n_Êushed_li°
, 
n_Êushed_Ãu
);

3098 
	`MONITOR_INC_VALUE_CUMULATIVE
(

3099 
MONITOR_FLUSH_SYNC_TOTAL_PAGE
, 
MONITOR_FLUSH_SYNC_COUNT
,

3100 
MONITOR_FLUSH_SYNC_PAGES
, 
n_Êushed_Ãu
 + 
n_Êushed_li°
);

3103 
n_Êushed
 = 
n_Êushed_Ãu
 + 
n_Êushed_li°
;

3105 } i‡(
	`§v_check_a˘ivôy
(
œ°_a˘ivôy
)) {

3106 
ulöt
 
n_to_Êush
;

3107 
l¢_t
 
l¢_limô
 = 0;

3110 i‡(
ªt_¶ìp
 =
OS_SYNC_TIME_EXCEEDED
) {

3111 
œ°_a˘ivôy
 = 
	`§v_gë_a˘ivôy_cou¡
();

3112 
n_to_Êush
 =

3113 
	`∑ge_˛ó√r_Êush_∑ges_ªcommíd©i⁄
(&
l¢_limô
, 
œ°_∑ges
);

3115 
n_to_Êush
 = 0;

3119 
	`pc_ªque°
(
n_to_Êush
, 
l¢_limô
);

3121 
ulöt
 
tm
 = 
	`ut_time_ms
();

3124 
	`pc_Êush_¶Ÿ
() > 0) {

3130 
∑ge_˛ó√r
->
Êush_time
 +
	`ut_time_ms
(Ë- 
tm
;

3131 
∑ge_˛ó√r
->
Êush_∑ss
++;

3134 
ulöt
 
n_Êushed_Ãu
 = 0;

3135 
ulöt
 
n_Êushed_li°
 = 0;

3137 
	`pc_waô_föished
(&
n_Êushed_Ãu
, &
n_Êushed_li°
);

3139 i‡(
n_Êushed_li°
 > 0 || 
n_Êushed_Ãu
 > 0) {

3140 
	`buf_Êush_°©s
(
n_Êushed_li°
, 
n_Êushed_Ãu
);

3143 i‡(
ªt_¶ìp
 =
OS_SYNC_TIME_EXCEEDED
) {

3144 
œ°_∑ges
 = 
n_Êushed_li°
;

3147 
n_evi˘ed
 +
n_Êushed_Ãu
;

3148 
n_Êushed_œ°
 +
n_Êushed_li°
;

3150 
n_Êushed
 = 
n_Êushed_Ãu
 + 
n_Êushed_li°
;

3152 i‡(
n_Êushed_Ãu
) {

3153 
	`MONITOR_INC_VALUE_CUMULATIVE
(

3154 
MONITOR_LRU_BATCH_FLUSH_TOTAL_PAGE
, 
MONITOR_LRU_BATCH_FLUSH_COUNT
,

3155 
MONITOR_LRU_BATCH_FLUSH_PAGES
, 
n_Êushed_Ãu
);

3158 i‡(
n_Êushed_li°
) {

3159 
	`MONITOR_INC_VALUE_CUMULATIVE
(

3160 
MONITOR_FLUSH_ADAPTIVE_TOTAL_PAGE
, 
MONITOR_FLUSH_ADAPTIVE_COUNT
,

3161 
MONITOR_FLUSH_ADAPTIVE_PAGES
, 
n_Êushed_li°
);

3164 } i‡(
ªt_¶ìp
 =
OS_SYNC_TIME_EXCEEDED
) {

3166 
	`buf_Êush_li°s
(
	`PCT_IO
(100), 
LSN_MAX
, &
n_Êushed
);

3168 
n_Êushed_œ°
 +
n_Êushed
;

3170 i‡(
n_Êushed
) {

3171 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_FLUSH_BACKGROUND_TOTAL_PAGE
,

3172 
MONITOR_FLUSH_BACKGROUND_COUNT
,

3173 
MONITOR_FLUSH_BACKGROUND_PAGES
, 
n_Êushed
);

3178 
n_Êushed
 = 0;

3181 
	`ut_d
(
	`buf_Êush_∑ge_˛ó√r_dißbÀd_lo›
());

3184 
	`ut_ad
(
§v_shutdown_°©e
 > 0);

3185 i‡(
§v_Á°_shutdown
 == 2 ||

3186 
§v_shutdown_°©e
 =
SRV_SHUTDOWN_EXIT_THREADS
) {

3190 
thªad_exô
;

3206 
	`pc_ªque°
(
ULINT_MAX
, 
LSN_MAX
);

3208 
	`pc_Êush_¶Ÿ
() > 0) {

3211 
ulöt
 
n_Êushed_Ãu
 = 0;

3212 
ulöt
 
n_Êushed_li°
 = 0;

3213 
	`pc_waô_föished
(&
n_Êushed_Ãu
, &
n_Êushed_li°
);

3215 
n_Êushed
 = 
n_Êushed_Ãu
 + 
n_Êushed_li°
;

3218 i‡(
n_Êushed
 == 0) {

3219 
	`os_thªad_¶ìp
(100000);

3221 } 
§v_shutdown_°©e
 =
SRV_SHUTDOWN_CLEANUP
);

3225 
	`ut_a
(!
	`§v_ma°î_thªad_a˘ive
());

3226 
	`ut_a
(
§v_shutdown_°©e
 =
SRV_SHUTDOWN_FLUSH_PHASE
);

3235 
	`buf_Êush_waô_b©ch_íd
(
NULL
, 
BUF_FLUSH_LIST
);

3236 
	`buf_Êush_waô_LRU_b©ch_íd
();

3238 
boﬁ
 
suc˚ss
;

3241 
	`pc_ªque°
(
ULINT_MAX
, 
LSN_MAX
);

3243 
	`pc_Êush_¶Ÿ
() > 0) {

3246 
ulöt
 
n_Êushed_Ãu
 = 0;

3247 
ulöt
 
n_Êushed_li°
 = 0;

3248 
suc˚ss
 = 
	`pc_waô_föished
(&
n_Êushed_Ãu
, &
n_Êushed_li°
);

3250 
n_Êushed
 = 
n_Êushed_Ãu
 + 
n_Êushed_li°
;

3252 
	`buf_Êush_waô_b©ch_íd
(
NULL
, 
BUF_FLUSH_LIST
);

3253 
	`buf_Êush_waô_LRU_b©ch_íd
();

3255 } !
suc˚ss
 || 
n_Êushed
 > 0);

3258 
	`ut_a
(!
	`§v_ma°î_thªad_a˘ive
());

3259 
	`ut_a
(
§v_shutdown_°©e
 =
SRV_SHUTDOWN_FLUSH_PHASE
);

3261 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

3262 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

3263 
	`ut_a
(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
Êush_li°
) == 0);

3268 
thªad_exô
:

3272 
∑ge_˛ó√r
->
is_ru¬ög
 = 
Ál£
;

3273 
	`os_evít_£t
(
∑ge_˛ó√r
->
is_ªque°ed
);

3275 
	`buf_Êush_∑ge_˛ó√r_˛o£
();

3277 
buf_∑ge_˛ó√r_is_a˘ive
 = 
Ál£
;

3279 
	`my_thªad_íd
();

3280 
	}
}

3283 
	$buf_Êush_∑ge_˛ó√r_thªad
() {

3284 
	`my_thªad_öô
();

3285 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

3286 ++
∑ge_˛ó√r
->
n_w‹kîs
;

3287 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

3289 #ifde‡
UNIV_LINUX


3292 i‡(
	`buf_Êush_∑ge_˛ó√r_£t_¥i‹ôy
(
buf_Êush_∑ge_˛ó√r_¥i‹ôy
)) {

3293 
ib
::
	`öfo
(
ER_IB_MSG_129
)

3294 << "∑ge_˛ó√∏w‹kîÖri‹ôy: " << 
buf_Êush_∑ge_˛ó√r_¥i‹ôy
;

3299 
	`os_evít_waô
(
∑ge_˛ó√r
->
is_ªque°ed
);

3301 
	`ut_d
(
	`buf_Êush_∑ge_˛ó√r_dißbÀd_lo›
());

3303 i‡(!
∑ge_˛ó√r
->
is_ru¬ög
) {

3307 
	`pc_Êush_¶Ÿ
();

3310 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

3311 --
∑ge_˛ó√r
->
n_w‹kîs
;

3312 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

3313 
	`my_thªad_íd
();

3314 
	}
}

3319 
	$buf_Êush_sync_Æl_buf_poﬁs
() {

3320 
boﬁ
 
suc˚ss
;

3321 
ulöt
 
n_∑ges
;

3323 
n_∑ges
 = 0;

3324 
suc˚ss
 = 
	`buf_Êush_li°s
(
ULINT_MAX
, 
LSN_MAX
, &
n_∑ges
);

3325 
	`buf_Êush_waô_b©ch_íd
(
NULL
, 
BUF_FLUSH_LIST
);

3327 i‡(!
suc˚ss
) {

3328 
	`MONITOR_INC
(
MONITOR_FLUSH_SYNC_WAITS
);

3331 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_FLUSH_SYNC_TOTAL_PAGE
,

3332 
MONITOR_FLUSH_SYNC_COUNT
,

3333 
MONITOR_FLUSH_SYNC_PAGES
, 
n_∑ges
);

3334 } !
suc˚ss
);

3336 
	`ut_a
(
suc˚ss
);

3337 
	}
}

3341 
	$buf_Êush_ªque°_f‹˚
(
l¢_t
 
l¢_limô
) {

3342 
	`ut_a
(
buf_∑ge_˛ó√r_is_a˘ive
);

3345 
l¢_t
 
l¢_èrgë
 = 
l¢_limô
 + 
l¢_avg_øã
 * 3;

3347 
	`muãx_íãr
(&
∑ge_˛ó√r
->
muãx
);

3348 i‡(
l¢_èrgë
 > 
buf_Êush_sync_l¢
) {

3349 
buf_Êush_sync_l¢
 = 
l¢_èrgë
;

3351 
	`muãx_exô
(&
∑ge_˛ó√r
->
muãx
);

3353 
	`os_evít_£t
(
buf_Êush_evít
);

3354 
	}
}

3355 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


3358 
	sCheck
 {

3359 
›î©‹
()(c⁄° 
buf_∑ge_t
 *
	mñem
Ë{ 
ut_a
(
ñem
->
ö_Êush_li°
); }

3364 
iboﬁ
 
	$buf_Êush_vÆid©e_low
(

3365 
buf_poﬁ_t
 *
buf_poﬁ
)

3367 
buf_∑ge_t
 *
b∑ge
;

3368 c⁄° 
ib_rbt_node_t
 *
∫ode
 = 
NULL
;

3369 
Check
 
check
;

3371 
	`ut_ad
(
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
));

3373 
	`ut_li°_vÆid©e
(
buf_poﬁ
->
Êush_li°
, 
check
);

3375 
b∑ge
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
Êush_li°
);

3380 i‡(
buf_poﬁ
->
Êush_rbt
 !
NULL
) {

3381 
∫ode
 = 
	`rbt_fú°
(
buf_poﬁ
->
Êush_rbt
);

3384 
b∑ge
 !
NULL
) {

3385 c⁄° 
l¢_t
 
om
 = 
b∑ge
->
ﬁde°_modifiˇti⁄
;

3387 
	`ut_ad
(
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
Ë=
buf_poﬁ
);

3389 
	`ut_ad
(
b∑ge
->
ö_Êush_li°
);

3397 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
) ||

3398 
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_REMOVE_HASH
);

3399 
	`ut_a
(
om
 > 0);

3401 i‡(
buf_poﬁ
->
Êush_rbt
 !
NULL
) {

3402 
buf_∑ge_t
 **
¥∑ge
;

3404 
	`ut_a
(
∫ode
 !
NULL
);

3405 
¥∑ge
 = 
	`rbt_vÆue
(
buf_∑ge_t
 *, 
∫ode
);

3407 
	`ut_a
(*
¥∑ge
 !
NULL
);

3408 
	`ut_a
(*
¥∑ge
 =
b∑ge
);

3409 
∫ode
 = 
	`rbt_√xt
(
buf_poﬁ
->
Êush_rbt
,Ñnode);

3412 
b∑ge
 = 
	`UT_LIST_GET_NEXT
(
li°
, bpage);

3414 
	`ut_a
(
b∑ge
 =
NULL
 ||

3415 
	`buf_Êush_li°_‹dî_vÆid©e
(
b∑ge
->
ﬁde°_modifiˇti⁄
, 
om
));

3420 
	`ut_a
(
∫ode
 =
NULL
);

3422  (
TRUE
);

3423 
	}
}

3427 
iboﬁ
 
	$buf_Êush_vÆid©e
(
buf_poﬁ_t
 *
buf_poﬁ
)

3429 
iboﬁ
 
ªt
;

3431 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

3433 
ªt
 = 
	`buf_Êush_vÆid©e_low
(
buf_poﬁ
);

3435 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

3437  (
ªt
);

3438 
	}
}

3444 
ulöt
 
	$buf_poﬁ_gë_dúty_∑ges_cou¡
(

3445 
buf_poﬁ_t
 *
buf_poﬁ
,

3446 
•a˚_id_t
 
id
,

3447 
FlushOb£rvî
 *
ob£rvî
)

3450 
ulöt
 
cou¡
 = 0;

3452 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

3454 
buf_∑ge_t
 *
b∑ge
;

3456 
b∑ge
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
Êush_li°
); bpage != 0;

3457 
b∑ge
 = 
	`UT_LIST_GET_NEXT
(
li°
, bpage)) {

3458 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
) ||

3459 
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_REMOVE_HASH
);

3460 
	`ut_ad
(
b∑ge
->
ö_Êush_li°
);

3461 
	`ut_ad
(
b∑ge
->
ﬁde°_modifiˇti⁄
 > 0);

3463 i‡((
ob£rvî
 !
NULL
 && ob£rvî =
b∑ge
->
Êush_ob£rvî
) ||

3464 (
ob£rvî
 =
NULL
 && 
id
 =
b∑ge
->id.
	`•a˚
())) {

3465 ++
cou¡
;

3469 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

3471  (
cou¡
);

3472 
	}
}

3477 
ulöt
 
	$buf_Êush_gë_dúty_∑ges_cou¡
(

3478 
•a˚_id_t
 
id
,

3479 
FlushOb£rvî
 *
ob£rvî
)

3481 
ulöt
 
cou¡
 = 0;

3483 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; ++i) {

3484 
buf_poﬁ_t
 *
buf_poﬁ
;

3486 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

3488 
cou¡
 +
	`buf_poﬁ_gë_dúty_∑ges_cou¡
(
buf_poﬁ
, 
id
, 
ob£rvî
);

3491  (
cou¡
);

3492 
	}
}

3500 
	gFlushOb£rvî
::
	$FlushOb£rvî
(
•a˚_id_t
 
•a˚_id
, 
åx_t
 *
åx
,

3501 
ut_°age_Æãr_t
 *
°age
)

3502 : 
	`m_•a˚_id
(
•a˚_id
), 
	`m_åx
(
åx
), 
	`m_°age
(
°age
), 
	$m_öãºu±ed
(
Ál£
) {

3503 
m_Êushed
 = 
	`UT_NEW_NOKEY
(
°d
::
ve˘‹
<
ulöt
>(
§v_buf_poﬁ_ö°™˚s
));

3504 
m_ªmoved
 = 
	`UT_NEW_NOKEY
(
°d
::
ve˘‹
<
ulöt
>(
§v_buf_poﬁ_ö°™˚s
));

3506 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

3507 
m_Êushed
->
	`©
(
i
) = 0;

3508 
m_ªmoved
->
	`©
(
i
) = 0;

3511 #ifde‡
FLUSH_LIST_OBSERVER_DEBUG


3512 
ib
::
	`öfo
(
ER_IB_MSG_130
Ë<< "FlushOb£rvî c⁄°ru˘‹: " << 
m_åx
->
id
;

3514 
	}
}

3517 
	gFlushOb£rvî
::~
	$FlushOb£rvî
() {

3518 
	`ut_ad
(
	`buf_Êush_gë_dúty_∑ges_cou¡
(
m_•a˚_id
, 
this
) == 0);

3520 
	`UT_DELETE
(
m_Êushed
);

3521 
	`UT_DELETE
(
m_ªmoved
);

3523 #ifde‡
FLUSH_LIST_OBSERVER_DEBUG


3524 
ib
::
	`öfo
(
ER_IB_MSG_131
Ë<< "FlushOb£rvî dec⁄°ru˘‹: " << 
m_åx
->
id
;

3526 
	}
}

3530 
boﬁ
 
	gFlushOb£rvî
::
	$check_öãºu±ed
() {

3531 i‡(
	`åx_is_öãºu±ed
(
m_åx
)) {

3532 
	`öãºu±ed
();

3534  (
åue
);

3537  (
Ál£
);

3538 
	}
}

3543 
	gFlushOb£rvî
::
	$nŸify_Êush
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_∑ge_t
 *
b∑ge
) {

3544 
	`os_©omic_ö¸emít_ulöt
(&
m_Êushed
->
	`©
(
buf_poﬁ
->
ö°™˚_no
), 1);

3546 i‡(
m_°age
 !
NULL
) {

3547 
m_°age
->
	`öc
();

3549 
	}
}

3554 
	gFlushOb£rvî
::
	$nŸify_ªmove
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_∑ge_t
 *
b∑ge
) {

3555 
	`os_©omic_ö¸emít_ulöt
(&
m_ªmoved
->
	`©
(
buf_poﬁ
->
ö°™˚_no
), 1);

3556 
	}
}

3559 
	gFlushOb£rvî
::
	$Êush
() {

3560 
buf_ªmove_t
 
buf_ªmove
;

3562 i‡(
m_öãºu±ed
) {

3563 
buf_ªmove
 = 
BUF_REMOVE_FLUSH_NO_WRITE
;

3565 
buf_ªmove
 = 
BUF_REMOVE_FLUSH_WRITE
;

3567 i‡(
m_°age
 !
NULL
) {

3568 
ulöt
 
∑ges_to_Êush
 = 
	`buf_Êush_gë_dúty_∑ges_cou¡
(
m_•a˚_id
, 
this
);

3570 
m_°age
->
	`begö_pha£_Êush
(
∑ges_to_Êush
);

3575 
	`buf_LRU_Êush_‹_ªmove_∑ges
(
m_•a˚_id
, 
buf_ªmove
, 
m_åx
);

3578 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

3579 !
	`is_com∂ëe
(
i
)) {

3580 
	`os_thªad_¶ìp
(2000);

3583 
	}
}

	@buf0lru.cc

33 
	~"buf0Ãu.h
"

35 
	~"bå0bå.h
"

36 
	~"bå0£a.h
"

37 
	~"buf0buddy.h
"

38 
	~"buf0buf.h
"

39 
	~"buf0dblwr.h
"

40 
	~"buf0Êu.h
"

41 
	~"buf0ªa.h
"

42 
	~"buf0°©s.h
"

43 
	~"fû0fû.h
"

44 
	~"hash0hash.h
"

45 
	~"ibuf0ibuf.h
"

46 
	~"log0ªcv.h
"

47 
	~"my_dbug.h
"

48 
	~"os0evít.h
"

49 
	~"os0fûe.h
"

50 
	~"∑ge0zù.h
"

51 
	~"§v0m⁄.h
"

52 
	~"§v0§v.h
"

53 
	~"sync0rw.h
"

54 
	~"åx0åx.h
"

55 
	~"ut0byã.h
"

56 
	~"ut0∫d.h
"

65 
	#BUF_LRU_OLD_TOLERANCE
 20

66 

	)

70 
	#BUF_LRU_NON_OLD_MIN_LEN
 5

	)

71 #i‡
BUF_LRU_NON_OLD_MIN_LEN
 >
BUF_LRU_OLD_MIN_LEN


82 c⁄° 
ulöt
 
	gBUF_LRU_DROP_SEARCH_SIZE
 = 1024;

86 c⁄° 
ulöt
 
	gBUF_LRU_SEARCH_SCAN_THRESHOLD
 = 100;

90 
boﬁ
 
	gbuf_Ãu_swôched_⁄_önodb_m⁄
 = 
Ál£
;

105 c⁄° 
ulöt
 
	gBUF_LRU_STAT_N_INTERVAL
 = 50;

109 c⁄° 
ulöt
 
	gBUF_LRU_IO_TO_UNZIP_FACTOR
 = 50;

113 
buf_LRU_°©_t
 
	gbuf_LRU_°©_¨r
[
BUF_LRU_STAT_N_INTERVAL
];

116 
ulöt
 
	gbuf_LRU_°©_¨r_öd
;

120 
buf_LRU_°©_t
 
	gbuf_LRU_°©_cur
;

124 
buf_LRU_°©_t
 
	gbuf_LRU_°©_sum
;

131 
uöt
 
	gbuf_LRU_ﬁd_thªshﬁd_ms
;

155 
MY_ATTRIBUTE
((
w¨n_unu£d_ªsu…
)Ë
boﬁ
 
buf_LRU_block_ªmove_hashed
(

156 
buf_∑ge_t
 *
b∑ge
, 
boﬁ
 
zù
, boﬁ 
ign‹e_c⁄ã¡
);

159 
buf_LRU_block_‰ì_hashed_∑ge
(

160 
buf_block_t
 *
block
);

166 
ölöe
 
	$ö¸_LRU_size_ö_byãs
(
buf_∑ge_t
 *
b∑ge
,

167 
buf_poﬁ_t
 *
buf_poﬁ
) {

168 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

170 
buf_poﬁ
->
°©
.
LRU_byãs
 +
b∑ge
->
size
.
	`physiˇl
();

172 
	`ut_ad
(
buf_poﬁ
->
°©
.
LRU_byãs
 <buf_poﬁ->
cuº_poﬁ_size
);

173 
	}
}

179 
iboﬁ
 
	$buf_LRU_evi˘_‰om_unzù_LRU
(
buf_poﬁ_t
 *
buf_poﬁ
) {

180 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

183 i‡(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
unzù_LRU
) == 0) {

184  (
FALSE
);

190 i‡(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
unzù_LRU
) <=

191 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
) / 10) {

192  (
FALSE
);

197 i‡(
buf_poﬁ
->
‰ìd_∑ge_˛ock
 == 0) {

198  (
TRUE
);

203 
ulöt
 
io_avg
 =

204 
buf_LRU_°©_sum
.
io
 / 
BUF_LRU_STAT_N_INTERVAL
 + 
buf_LRU_°©_cur
.io;

206 
ulöt
 
unzù_avg
 =

207 
buf_LRU_°©_sum
.
unzù
 / 
BUF_LRU_STAT_N_INTERVAL
 + 
buf_LRU_°©_cur
.unzip;

213  (
unzù_avg
 <
io_avg
 * 
BUF_LRU_IO_TO_UNZIP_FACTOR
);

214 
	}
}

222 
	$buf_LRU_dr›_∑ge_hash_b©ch
(
•a˚_id_t
 
•a˚_id
,

223 c⁄° 
∑ge_size_t
 &
∑ge_size
,

224 c⁄° 
∑ge_no_t
 *
¨r
, 
ulöt
 
cou¡
) {

225 
	`ut_ad
(
cou¡
 <
BUF_LRU_DROP_SEARCH_SIZE
);

227 
ulöt
 
i
 = 0; i < 
cou¡
; ++i, ++
¨r
) {

236 
	`bå_£¨ch_dr›_∑ge_hash_whí_‰ìd
(
	`∑ge_id_t
(
•a˚_id
, *
¨r
), 
∑ge_size
);

238 
	}
}

246 
	$buf_LRU_dr›_∑ge_hash_f‹_èbÀ•a˚
(
buf_poﬁ_t
 *
buf_poﬁ
,

247 
•a˚_id_t
 
•a˚_id
) {

248 
boﬁ
 
found
;

249 c⁄° 
∑ge_size_t
 
	`∑ge_size
(
	`fû_•a˚_gë_∑ge_size
(
•a˚_id
, &
found
));

251 i‡(!
found
) {

253 
	`ut_ad
(0);

257 
∑ge_no_t
 *
∑ge_¨r
 = 
°©ic_ˇ°
<page_no_t *>(

258 
	`ut_mÆloc_nokey
((
∑ge_no_t
Ë* 
BUF_LRU_DROP_SEARCH_SIZE
));

260 
ulöt
 
num_íåõs
 = 0;

262 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

264 
sˇn_agaö
:

265 
buf_∑ge_t
 *
b∑ge
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
LRU
); b∑gê!
NULL
;

267 
buf_∑ge_t
 *
¥ev_b∑ge
 = 
	`UT_LIST_GET_PREV
(
LRU
, 
b∑ge
);

269 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

271 i‡(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë!
BUF_BLOCK_FILE_PAGE
 ||

272 
b∑ge
->
id
.
	`•a˚
(Ë!
•a˚_id
 || b∑ge->
io_fix
 !
BUF_IO_NONE
) {

276 
√xt_∑ge
:

277 
b∑ge
 = 
¥ev_b∑ge
;

281 
buf_block_t
 *
block
 = 
ªöãΩªt_ˇ°
<buf_block_à*>(
b∑ge
);

283 
	`muãx_íãr
(&
block
->
muãx
);

292 
	`as£π_block_ahi_vÆid
(
block
);

294 
boﬁ
 
skù
 = 
b∑ge
->
buf_fix_cou¡
 > 0 || !
block
->
ödex
;

296 
	`muãx_exô
(&
block
->
muãx
);

298 i‡(
skù
) {

303 
√xt_∑ge
;

308 
∑ge_¨r
[
num_íåõs
] = 
b∑ge
->
id
.
	`∑ge_no
();

309 
	`ut_a
(
num_íåõs
 < 
BUF_LRU_DROP_SEARCH_SIZE
);

310 ++
num_íåõs
;

312 i‡(
num_íåõs
 < 
BUF_LRU_DROP_SEARCH_SIZE
) {

313 
√xt_∑ge
;

318 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

320 
	`buf_LRU_dr›_∑ge_hash_b©ch
(
•a˚_id
, 
∑ge_size
, 
∑ge_¨r
, 
num_íåõs
);

322 
num_íåõs
 = 0;

324 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

341 i‡(
b∑ge
 !
NULL
 && 
	`buf_∑ge_gë_°©e
(b∑geË!
BUF_BLOCK_FILE_PAGE
) {

342 
sˇn_agaö
;

346 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

349 
	`buf_LRU_dr›_∑ge_hash_b©ch
(
•a˚_id
, 
∑ge_size
, 
∑ge_¨r
, 
num_íåõs
);

350 
	`ut_‰ì
(
∑ge_¨r
);

351 
	}
}

360 
	$buf_Êush_yõld
(
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_∑ge_t
 *
b∑ge
) {

361 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

363 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

364 
	`ut_ad
(
	`muãx_own
(
block_muãx
));

365 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

370 
	`buf_∑ge_£t_°icky
(
b∑ge
);

373 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

375 
	`muãx_exô
(
block_muãx
);

377 
	`os_thªad_yõld
();

379 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

381 
	`muãx_íãr
(
block_muãx
);

385 
	`buf_∑ge_un£t_°icky
(
b∑ge
);

386 
	`muãx_exô
(
block_muãx
);

387 
	}
}

393 
MY_ATTRIBUTE
((
w¨n_unu£d_ªsu…
)Ë
boﬁ
 
	$buf_Êush_åy_yõld
(

394 
buf_poﬁ_t
 *
buf_poﬁ
,

395 
buf_∑ge_t
 *
b∑ge
,

396 
ulöt
 
¥o˚s£d
,

397 
boﬁ
 *
mu°_ª°¨t
)

406 i‡(
b∑ge
 !
NULL
 && 
¥o˚s£d
 >
BUF_LRU_DROP_SEARCH_SIZE
 &&

407 
	`buf_∑ge_gë_io_fix_u∆ocked
(
b∑ge
Ë=
BUF_IO_NONE
) {

408 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

410 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

417 
	`muãx_íãr
(
block_muãx
);

420 i‡(
	`buf_∑ge_gë_io_fix
(
b∑ge
Ë!
BUF_IO_NONE
 ||

421 
b∑ge
->
ﬁde°_modifiˇti⁄
 == 0) {

422 
	`muãx_exô
(
block_muãx
);

424 *
mu°_ª°¨t
 = 
åue
;

426 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

428  
Ál£
;

431 *
mu°_ª°¨t
 = 
Ál£
;

436 
	`buf_Êush_yõld
(
buf_poﬁ
, 
b∑ge
);

438 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

444 
	`ut_ad
(
b∑ge
->
ö_Êush_li°
);

446  (
åue
);

449  (
Ál£
);

450 
	}
}

460 
MY_ATTRIBUTE
((
w¨n_unu£d_ªsu…
)Ë
boﬁ
 
	$buf_Êush_‹_ªmove_∑ge
(

461 
buf_poﬁ_t
 *
buf_poﬁ
, 
buf_∑ge_t
 *
b∑ge
, 
boﬁ
 
Êush
, boﬁ *
mu°_ª°¨t
) {

462 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

463 
	`ut_ad
(
	`buf_Êush_li°_muãx_own
(
buf_poﬁ
));

468 i‡(
	`buf_∑ge_gë_io_fix_u∆ocked
(
b∑ge
Ë!
BUF_IO_NONE
) {

472  (
Ál£
);

475 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

476 
boﬁ
 
¥o˚s£d
 = 
Ál£
;

483 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

485 
	`muãx_íãr
(
block_muãx
);

489 i‡(
	`buf_∑ge_gë_io_fix
(
b∑ge
Ë!
BUF_IO_NONE
 ||

490 
b∑ge
->
ﬁde°_modifiˇti⁄
 == 0) {

495 
	`muãx_exô
(
block_muãx
);

497 *
mu°_ª°¨t
 = 
åue
;

498 
¥o˚s£d
 = 
Ál£
;

500 } i‡(!
Êush
) {

501 
	`buf_Êush_ªmove
(
b∑ge
);

503 
	`muãx_exô
(
block_muãx
);

505 
¥o˚s£d
 = 
åue
;

507 } i‡(
	`buf_Êush_ªady_f‹_Êush
(
b∑ge
, 
BUF_FLUSH_SINGLE_PAGE
)) {

510 
¥o˚s£d
 = 
	`buf_Êush_∑ge
(
buf_poﬁ
, 
b∑ge
, 
BUF_FLUSH_SINGLE_PAGE
, 
Ál£
);

512 i‡(
¥o˚s£d
) {

515 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

516 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

518 
	`muãx_exô
(
block_muãx
);

521 
	`muãx_exô
(
block_muãx
);

524 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

526 
	`ut_ad
(!
	`muãx_own
(
block_muãx
));

527 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

529  (
¥o˚s£d
);

530 
	}
}

546 
MY_ATTRIBUTE
((
w¨n_unu£d_ªsu…
)Ë
dbîr_t


547 
	$buf_Êush_‹_ªmove_∑ges
(
buf_poﬁ_t
 *
buf_poﬁ
, 
•a˚_id_t
 
id
,

548 
FlushOb£rvî
 *
ob£rvî
, 
boﬁ
 
Êush
,

549 c⁄° 
åx_t
 *
åx
) {

550 
buf_∑ge_t
 *
¥ev
;

551 
buf_∑ge_t
 *
b∑ge
;

552 
ulöt
 
¥o˚s£d
 = 0;

554 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

556 
	`buf_Êush_li°_muãx_íãr
(
buf_poﬁ
);

558 
ªsˇn
:

559 
boﬁ
 
mu°_ª°¨t
 = 
Ál£
;

560 
boﬁ
 
Æl_‰ìd
 = 
åue
;

562 
b∑ge
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
Êush_li°
); b∑gê!
NULL
;

563 
b∑ge
 = 
¥ev
) {

564 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

569 
¥ev
 = 
	`UT_LIST_GET_PREV
(
li°
, 
b∑ge
);

573 i‡((
ob£rvî
 !
NULL
 && ob£rvî !
b∑ge
->
Êush_ob£rvî
) ||

574 (
ob£rvî
 =
NULL
 && 
id
 !
b∑ge
->id.
	`•a˚
())) {

578 } i‡(!
	`buf_Êush_‹_ªmove_∑ge
(
buf_poﬁ
, 
b∑ge
, 
Êush
,

579 &
mu°_ª°¨t
)) {

600 
Æl_‰ìd
 = 
Ál£
;

601 } i‡(
Êush
) {

606 
ªsˇn
;

607 } i‡(
mu°_ª°¨t
) {

608 
	`ut_ad
(!
Æl_‰ìd
);

612 ++
¥o˚s£d
;

615 i‡(
	`buf_Êush_åy_yõld
(
buf_poﬁ
, 
¥ev
, 
¥o˚s£d
, &
mu°_ª°¨t
)) {

616 
	`ut_ad
(!
mu°_ª°¨t
);

619 
¥o˚s£d
 = 0;

624 i‡(!
¥o˚s£d
 && 
åx
 && 
	`åx_is_öãºu±ed
(trx)) {

625 i‡(
åx
->
Êush_ob£rvî
 !
NULL
) {

626 i‡(
Êush
) {

627 
åx
->
Êush_ob£rvî
->
	`öãºu±ed
();

635 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

636  (
DB_INTERRUPTED
);

640 
	`buf_Êush_li°_muãx_exô
(
buf_poﬁ
);

642  (
Æl_‰ìd
 ? 
DB_SUCCESS
 : 
DB_FAIL
);

643 
	}
}

658 
	$buf_Êush_dúty_∑ges
(
buf_poﬁ_t
 *
buf_poﬁ
, 
•a˚_id_t
 
id
,

659 
FlushOb£rvî
 *
ob£rvî
, 
boﬁ
 
Êush
,

660 c⁄° 
åx_t
 *
åx
, 
boﬁ
 
°ri˘
) {

661 
dbîr_t
 
îr
;

666 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

668 
îr
 = 
	`buf_Êush_‹_ªmove_∑ges
(
buf_poﬁ
, 
id
, 
ob£rvî
, 
Êush
, 
åx
);

670 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

672 
	`ut_ad
(
	`buf_Êush_vÆid©e
(
buf_poﬁ
));

674 i‡(
îr
 =
DB_FAIL
) {

675 
	`os_thªad_¶ìp
(2000);

678 i‡(
îr
 =
DB_INTERRUPTED
 && 
ob£rvî
 !
NULL
) {

679 
	`ut_a
(
Êush
);

681 
Êush
 = 
Ál£
;

682 
îr
 = 
DB_FAIL
;

688 
	`ut_ad
(
	`buf_Êush_vÆid©e
(
buf_poﬁ
));

690 } 
îr
 =
DB_FAIL
);

692 
	`ut_ad
(
îr
 =
DB_INTERRUPTED
 || !
°ri˘
 ||

693 
	`buf_poﬁ_gë_dúty_∑ges_cou¡
(
buf_poﬁ
, 
id
, 
ob£rvî
) == 0);

694 
	}
}

700 
	$buf_LRU_ªmove_Æl_∑ges
(
buf_poﬁ_t
 *
buf_poﬁ
, 
ulöt
 
id
) {

701 
buf_∑ge_t
 *
b∑ge
;

702 
iboﬁ
 
Æl_‰ìd
;

704 
sˇn_agaö
:

705 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

707 
Æl_‰ìd
 = 
TRUE
;

709 
b∑ge
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
LRU
); b∑gê!
NULL
;

711 
rw_lock_t
 *
hash_lock
;

712 
buf_∑ge_t
 *
¥ev_b∑ge
;

713 
BPageMuãx
 *
block_muãx
;

715 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

716 
	`ut_ad
(
b∑ge
->
ö_LRU_li°
);

718 
¥ev_b∑ge
 = 
	`UT_LIST_GET_PREV
(
LRU
, 
b∑ge
);

724 i‡(
b∑ge
->
id
.
	`•a˚
() != id) {

727 
√xt_∑ge
;

728 } i‡(
	`buf_∑ge_gë_io_fix_u∆ocked
(
b∑ge
Ë!
BUF_IO_NONE
) {

733 
Æl_‰ìd
 = 
FALSE
;

734 
√xt_∑ge
;

736 
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
b∑ge
->
id
);

738 
	`rw_lock_x_lock
(
hash_lock
);

740 
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

742 
	`muãx_íãr
(
block_muãx
);

744 i‡(
b∑ge
->
id
.
	`•a˚
(Ë!id || b∑ge->
buf_fix_cou¡
 > 0 ||

745 (
	`buf_∑ge_gë_io_fix
(
b∑ge
Ë!
BUF_IO_NONE
)) {

746 
	`muãx_exô
(
block_muãx
);

748 
	`rw_lock_x_u∆ock
(
hash_lock
);

755 
Æl_‰ìd
 = 
FALSE
;

757 
√xt_∑ge
;

761 
	`ut_ad
(
	`muãx_own
(
block_muãx
));

763 
	`DBUG_PRINT
("ib_buf",

764 ("evi˘Öagê" 
UINT32PF
 ":" UINT32PF " state %u",

765 
b∑ge
->
id
.
	`•a˚
(), b∑ge->id.
	`∑ge_no
(), b∑ge->
°©e
));

767 i‡(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë!
BUF_BLOCK_FILE_PAGE
) {

770 } i‡(((
buf_block_t
 *)
b∑ge
)->
ödex
) {

771 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

773 
	`rw_lock_x_u∆ock
(
hash_lock
);

775 
	`muãx_exô
(
block_muãx
);

783 
	`bå_£¨ch_dr›_∑ge_hash_whí_‰ìd
(
b∑ge
->
id
, b∑ge->
size
);

785 
sˇn_agaö
;

796 
	`as£π_block_ahi_em±y
((
buf_block_t
 *)
b∑ge
);

799 i‡(
b∑ge
->
ﬁde°_modifiˇti⁄
 != 0) {

800 
	`buf_Êush_ªmove
(
b∑ge
);

803 
	`ut_ad
(!
b∑ge
->
ö_Êush_li°
);

807 i‡(
	`buf_LRU_block_ªmove_hashed
(
b∑ge
, 
åue
, 
Ál£
)) {

808 
	`buf_LRU_block_‰ì_hashed_∑ge
((
buf_block_t
 *)
b∑ge
);

810 
	`ut_ad
(
block_muãx
 =&
buf_poﬁ
->
zù_muãx
);

813 
	`ut_ad
(!
	`muãx_own
(
block_muãx
));

816 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
));

817 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_S
));

819 
√xt_∑ge
:

820 
b∑ge
 = 
¥ev_b∑ge
;

823 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

825 i‡(!
Æl_‰ìd
) {

826 
	`os_thªad_¶ìp
(20000);

828 
sˇn_agaö
;

830 
	}
}

837 
	$buf_LRU_ªmove_∑ges
(

838 
buf_poﬁ_t
 *
buf_poﬁ
,

839 
•a˚_id_t
 
id
,

840 
buf_ªmove_t
 
buf_ªmove
,

841 c⁄° 
åx_t
 *
åx
,

843 
boﬁ
 
°ri˘
)

846 
FlushOb£rvî
 *
ob£rvî
 = (
åx
 =
NULL
Ë? NULL :Årx->
Êush_ob£rvî
;

848 
buf_ªmove
) {

849 
BUF_REMOVE_ALL_NO_WRITE
:

850 
	`buf_LRU_ªmove_Æl_∑ges
(
buf_poﬁ
, 
id
);

853 
BUF_REMOVE_FLUSH_NO_WRITE
:

855 
	`buf_Êush_dúty_∑ges
(
buf_poﬁ
, 
id
, 
ob£rvî
, 
Ál£
, 
NULL
, 
°ri˘
);

858 
BUF_REMOVE_FLUSH_WRITE
:

859 
	`buf_Êush_dúty_∑ges
(
buf_poﬁ
, 
id
, 
ob£rvî
, 
åue
, 
åx
, 
°ri˘
);

861 i‡(
ob£rvî
 =
NULL
) {

863 
	`os_aio_waô_u¡û_no_≥ndög_wrôes
();

864 
	`fû_Êush
(
id
);

869 
	}
}

875 
	$buf_LRU_Êush_‹_ªmove_∑ges
(

876 
•a˚_id_t
 
id
,

877 
buf_ªmove_t
 
buf_ªmove
,

878 c⁄° 
åx_t
 *
åx
,

880 
boﬁ
 
°ri˘
)

883 
ulöt
 
i
;

891 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

892 
buf_poﬁ_t
 *
buf_poﬁ
;

894 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

896 
buf_ªmove
) {

897 
BUF_REMOVE_ALL_NO_WRITE
:

898 
	`buf_LRU_dr›_∑ge_hash_f‹_èbÀ•a˚
(
buf_poﬁ
, 
id
);

901 
BUF_REMOVE_FLUSH_NO_WRITE
:

906 
BUF_REMOVE_FLUSH_WRITE
:

912 
	`buf_LRU_ªmove_∑ges
(
buf_poﬁ
, 
id
, 
buf_ªmove
, 
åx
, 
°ri˘
);

914 
	}
}

916 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


919 
	$buf_LRU_ö£π_zù_˛ón
(
buf_∑ge_t
 *
b∑ge
) {

920 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

922 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

923 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
zù_muãx
));

924 
	`ut_ad
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_ZIP_PAGE
);

928 
buf_∑ge_t
 *
b
 = 
b∑ge
;

931 
b
 = 
	`UT_LIST_GET_NEXT
(
LRU
, b);

932 } 
b
 && 
	`buf_∑ge_gë_°©e
(bË!
BUF_BLOCK_ZIP_PAGE
);

935 i‡(
b
 !
NULL
) {

936 
b
 = 
	`UT_LIST_GET_PREV
(
li°
, b);

939 i‡(
b
 !
NULL
) {

940 
	`UT_LIST_INSERT_AFTER
(
buf_poﬁ
->
zù_˛ón
, 
b
, 
b∑ge
);

942 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
zù_˛ón
, 
b∑ge
);

944 
	}
}

953 
boﬁ
 
	$buf_LRU_‰ì_‰om_unzù_LRU_li°
(
buf_poﬁ_t
 *
buf_poﬁ
,

954 
boﬁ
 
sˇn_Æl
) {

955 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

957 i‡(!
	`buf_LRU_evi˘_‰om_unzù_LRU
(
buf_poﬁ
)) {

958  (
Ál£
);

961 
ulöt
 
sˇ¬ed
 = 0;

962 
boﬁ
 
‰ìd
 = 
Ál£
;

964 
buf_block_t
 *
block
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
unzù_LRU
);

965 
block
 !
NULL
 && !
‰ìd
 && (
sˇn_Æl
 || 
sˇ¬ed
 < 
§v_LRU_sˇn_dïth
);

966 ++
sˇ¬ed
) {

967 
buf_block_t
 *
¥ev_block
;

969 
¥ev_block
 = 
	`UT_LIST_GET_PREV
(
unzù_LRU
, 
block
);

971 
	`muãx_íãr
(&
block
->
muãx
);

973 
	`ut_ad
(
	`buf_block_gë_°©e
(
block
Ë=
BUF_BLOCK_FILE_PAGE
);

974 
	`ut_ad
(
block
->
ö_unzù_LRU_li°
);

975 
	`ut_ad
(
block
->
∑ge
.
ö_LRU_li°
);

977 
‰ìd
 = 
	`buf_LRU_‰ì_∑ge
(&
block
->
∑ge
, 
Ál£
);

979 i‡(!
‰ìd
Ë
	`muãx_exô
(&
block
->
muãx
);

981 
block
 = 
¥ev_block
;

984 i‡(
sˇ¬ed
) {

985 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_LRU_UNZIP_SEARCH_SCANNED
,

986 
MONITOR_LRU_UNZIP_SEARCH_SCANNED_NUM_CALL
,

987 
MONITOR_LRU_UNZIP_SEARCH_SCANNED_PER_CALL
,

988 
sˇ¬ed
);

991  (
‰ìd
);

992 
	}
}

999 
boﬁ
 
	$buf_LRU_‰ì_‰om_comm⁄_LRU_li°
(
buf_poﬁ_t
 *
buf_poﬁ
,

1000 
boﬁ
 
sˇn_Æl
) {

1001 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1003 
ulöt
 
sˇ¬ed
 = 0;

1004 
boﬁ
 
‰ìd
 = 
Ál£
;

1006 
buf_∑ge_t
 *
b∑ge
 = 
buf_poﬁ
->
Ãu_sˇn_ôr
.
	`°¨t
();

1007 
b∑ge
 !
NULL
 && !
‰ìd
 &&

1008 (
sˇn_Æl
 || 
sˇ¬ed
 < 
BUF_LRU_SEARCH_SCAN_THRESHOLD
);

1009 ++
sˇ¬ed
, 
b∑ge
 = 
buf_poﬁ
->
Ãu_sˇn_ôr
.
	`gë
()) {

1010 
buf_∑ge_t
 *
¥ev
 = 
	`UT_LIST_GET_PREV
(
LRU
, 
b∑ge
);

1011 
BPageMuãx
 *
muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

1013 
buf_poﬁ
->
Ãu_sˇn_ôr
.
	`£t
(
¥ev
);

1015 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1016 
	`ut_ad
(
b∑ge
->
ö_LRU_li°
);

1018 
ac˚s£d
 = 
	`buf_∑ge_is_ac˚s£d
(
b∑ge
);

1020 
	`muãx_íãr
(
muãx
);

1022 i‡(
	`buf_Êush_ªady_f‹_ª∂a˚
(
b∑ge
)) {

1023 
‰ìd
 = 
	`buf_LRU_‰ì_∑ge
(
b∑ge
, 
åue
);

1026 i‡(!
‰ìd
Ë
	`muãx_exô
(
muãx
);

1028 i‡(
‰ìd
 && !
ac˚s£d
) {

1032 ++
buf_poﬁ
->
°©
.
n_ø_∑ges_evi˘ed
;

1035 
	`ut_ad
(!
	`muãx_own
(
muãx
));

1037 i‡(
‰ìd
) ;

1040 i‡(
sˇ¬ed
) {

1041 
	`MONITOR_INC_VALUE_CUMULATIVE
(
MONITOR_LRU_SEARCH_SCANNED
,

1042 
MONITOR_LRU_SEARCH_SCANNED_NUM_CALL
,

1043 
MONITOR_LRU_SEARCH_SCANNED_PER_CALL
, 
sˇ¬ed
);

1046  (
‰ìd
);

1047 
	}
}

1054 
boﬁ
 
	$buf_LRU_sˇn_™d_‰ì_block
(
buf_poﬁ_t
 *
buf_poﬁ
, 
boﬁ
 
sˇn_Æl
) {

1055 
boﬁ
 
‰ìd
 = 
Ál£
;

1056 
boﬁ
 
u£_unzù_li°
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
unzù_LRU
) > 0;

1058 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

1060 i‡(
u£_unzù_li°
) {

1061 
‰ìd
 = 
	`buf_LRU_‰ì_‰om_unzù_LRU_li°
(
buf_poﬁ
, 
sˇn_Æl
);

1064 i‡(!
‰ìd
) {

1065 
‰ìd
 = 
	`buf_LRU_‰ì_‰om_comm⁄_LRU_li°
(
buf_poﬁ
, 
sˇn_Æl
);

1068 i‡(!
‰ìd
) {

1069 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

1072  (
‰ìd
);

1073 
	}
}

1079 
iboﬁ
 
	$buf_LRU_buf_poﬁ_ru¬ög_out
() {

1080 
iboﬁ
 
ªt
 = 
FALSE
;

1082 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
 && !
ªt
; i++) {

1083 
buf_poﬁ_t
 *
buf_poﬁ
;

1085 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

1087 i‡(!
	`ªcv_ªcovîy_is_⁄
() &&

1088 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
Ë+ UT_LIST_GET_LEN(buf_poﬁ->
LRU
) <

1089 
	`ut_mö
(
buf_poﬁ
->
cuº_size
, buf_poﬁ->
ﬁd_size
) / 4) {

1090 
ªt
 = 
TRUE
;

1094  (
ªt
);

1095 
	}
}

1101 
buf_block_t
 *
	$buf_LRU_gë_‰ì_⁄ly
(
buf_poﬁ_t
 *
buf_poﬁ
) {

1102 
buf_block_t
 *
block
;

1104 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1106 
block
 = 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
‰ì
));

1108 
block
 !
NULL
) {

1109 
	`ut_ad
(
block
->
∑ge
.
ö_‰ì_li°
);

1110 
	`ut_d
(
block
->
∑ge
.
ö_‰ì_li°
 = 
FALSE
);

1111 
	`ut_ad
(!
block
->
∑ge
.
ö_Êush_li°
);

1112 
	`ut_ad
(!
block
->
∑ge
.
ö_LRU_li°
);

1113 
	`ut_a
(!
	`buf_∑ge_ö_fûe
(&
block
->
∑ge
));

1114 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
‰ì
, &
block
->
∑ge
);

1115 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1117 i‡(!
	`buf_gë_wôhdøw_dïth
(
buf_poﬁ
) ||

1118 !
	`buf_block_wûl_wôhdøwn
(
buf_poﬁ
, 
block
)) {

1122 
	`as£π_block_ahi_em±y
(
block
);

1124 
	`buf_block_£t_°©e
(
block
, 
BUF_BLOCK_READY_FOR_USE
);

1126 
	`UNIV_MEM_ALLOC
(
block
->
‰ame
, 
UNIV_PAGE_SIZE
);

1128 
	`ut_ad
(
	`buf_poﬁ_‰om_block
(
block
Ë=
buf_poﬁ
);

1130  (
block
);

1134 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1135 
	`UT_LIST_ADD_LAST
(
buf_poﬁ
->
wôhdøw
, &
block
->
∑ge
);

1136 
	`ut_d
(
block
->
ö_wôhdøw_li°
 = 
TRUE
);

1138 
block
 = 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
‰ì
));

1141 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1143  (
block
);

1144 
	}
}

1150 
	$buf_LRU_check_size_of_n⁄_d©a_obje˘s
(

1151 c⁄° 
buf_poﬁ_t
 *
buf_poﬁ
)

1153 i‡(!
	`ªcv_ªcovîy_is_⁄
(Ë&& 
buf_poﬁ
->
cuº_size
 =buf_poﬁ->
ﬁd_size
 &&

1154 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
Ë+ UT_LIST_GET_LEN(buf_poﬁ->
LRU
) <

1155 
buf_poﬁ
->
cuº_size
 / 20) {

1156 
ib
::
	`Áèl
(
ER_IB_MSG_132
)

1161 << (
buf_poﬁ
->
cuº_size
 / (1024 * 1024 / 
UNIV_PAGE_SIZE
))

1167 } i‡(!
	`ªcv_ªcovîy_is_⁄
() &&

1168 
buf_poﬁ
->
cuº_size
 =buf_poﬁ->
ﬁd_size
 &&

1169 (
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
‰ì
) +

1170 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
)Ë< buf_poﬁ->
cuº_size
 / 3) {

1171 i‡(!
buf_Ãu_swôched_⁄_önodb_m⁄
) {

1176 
ib
::
	`w¨n
(
ER_IB_MSG_133
)

1182 << (
buf_poﬁ
->
cuº_size
 / (1024 * 1024 / 
UNIV_PAGE_SIZE
))

1188 
buf_Ãu_swôched_⁄_önodb_m⁄
 = 
åue
;

1189 
§v_¥öt_önodb_m⁄ô‹
 = 
TRUE
;

1190 
	`os_evít_£t
(
§v_m⁄ô‹_evít
);

1193 } i‡(
buf_Ãu_swôched_⁄_önodb_m⁄
) {

1199 
buf_Ãu_swôched_⁄_önodb_m⁄
 = 
Ál£
;

1200 
§v_¥öt_önodb_m⁄ô‹
 = 
FALSE
;

1202 
	}
}

1228 
buf_block_t
 *
	$buf_LRU_gë_‰ì_block
(
buf_poﬁ_t
 *
buf_poﬁ
) {

1229 
buf_block_t
 *
block
 = 
NULL
;

1230 
boﬁ
 
‰ìd
 = 
Ál£
;

1231 
ulöt
 
n_ôî©i⁄s
 = 0;

1232 
ulöt
 
Êush_Áûuªs
 = 0;

1233 
boﬁ
 
m⁄_vÆue_was
 = 
Ál£
;

1234 
boﬁ
 
°¨ãd_m⁄ô‹
 = 
Ál£
;

1236 
	`ut_ad
(!
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1238 
	`MONITOR_INC
(
MONITOR_LRU_GET_FREE_SEARCH
);

1239 
lo›
:

1240 
	`buf_LRU_check_size_of_n⁄_d©a_obje˘s
(
buf_poﬁ
);

1243 
block
 = 
	`buf_LRU_gë_‰ì_⁄ly
(
buf_poﬁ
);

1245 i‡(
block
 !
NULL
) {

1246 
	`ut_ad
(
	`buf_poﬁ_‰om_block
(
block
Ë=
buf_poﬁ
);

1247 
	`mem£t
(&
block
->
∑ge
.
zù
, 0,  block->page.zip);

1249 i‡(
°¨ãd_m⁄ô‹
) {

1250 
§v_¥öt_önodb_m⁄ô‹
 = 
°©ic_ˇ°
<
boﬁ
>(
m⁄_vÆue_was
);

1253 
block
->
∑ge
.
Êush_ob£rvî
 = 
NULL
;

1254  (
block
);

1257 
	`MONITOR_INC
(
MONITOR_LRU_GET_FREE_LOOPS
);

1259 
‰ìd
 = 
Ál£
;

1260 
os_rmb
;

1261 i‡(
buf_poﬁ
->
åy_LRU_sˇn
 || 
n_ôî©i⁄s
 > 0) {

1267 
‰ìd
 = 
	`buf_LRU_sˇn_™d_‰ì_block
(
buf_poﬁ
, 
n_ôî©i⁄s
 > 0);

1269 i‡(!
‰ìd
 && 
n_ôî©i⁄s
 == 0) {

1274 
buf_poﬁ
->
åy_LRU_sˇn
 = 
FALSE
;

1275 
os_wmb
;

1279 i‡(
‰ìd
) {

1280 
lo›
;

1283 i‡(
n_ôî©i⁄s
 > 20 && 
§v_buf_poﬁ_ﬁd_size
 =
§v_buf_poﬁ_size
) {

1284 
ib
::
	`w¨n
(
ER_IB_MSG_134
)

1287 << 
n_ôî©i⁄s
 << " sórch iãøti⁄s)! " << 
Êush_Áûuªs


1296 << 
fû_n_≥ndög_log_Êushes


1297 << "; buf„∏poﬁ: " << 
fû_n_≥ndög_èbÀ•a˚_Êushes
 << ". "

1298 << 
os_n_fûe_ªads
 << " OS fûêªads, " << 
os_n_fûe_wrôes


1299 << " OS fûêwrôes, " << 
os_n_fsyncs


1303 
m⁄_vÆue_was
 = 
§v_¥öt_önodb_m⁄ô‹
;

1304 
°¨ãd_m⁄ô‹
 = 
åue
;

1305 
§v_¥öt_önodb_m⁄ô‹
 = 
åue
;

1306 
	`os_evít_£t
(
§v_m⁄ô‹_evít
);

1313 i‡(!
§v_ªad_⁄ly_mode
) {

1314 
	`os_evít_£t
(
buf_Êush_evít
);

1317 i‡(
n_ôî©i⁄s
 > 1) {

1318 
	`MONITOR_INC
(
MONITOR_LRU_GET_FREE_WAITS
);

1319 
	`os_thªad_¶ìp
(10000);

1333 i‡(!
	`buf_Êush_sögÀ_∑ge_‰om_LRU
(
buf_poﬁ
)) {

1334 
	`MONITOR_INC
(
MONITOR_LRU_SINGLE_FLUSH_FAILURE_COUNT
);

1335 ++
Êush_Áûuªs
;

1338 
§v_°©s
.
buf_poﬁ_waô_‰ì
.
	`add
(
n_ôî©i⁄s
, 1);

1340 
n_ôî©i⁄s
++;

1342 
lo›
;

1343 
	}
}

1348 
UNIV_INLINE


1349 
	$buf_LRU_ﬁd_adju°_Àn
(
buf_poﬁ_t
 *
buf_poﬁ
) {

1350 
ulöt
 
ﬁd_Àn
;

1351 
ulöt
 
√w_Àn
;

1353 
	`ut_a
(
buf_poﬁ
->
LRU_ﬁd
);

1354 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1355 
	`ut_ad
(
buf_poﬁ
->
LRU_ﬁd_øtio
 >
BUF_LRU_OLD_RATIO_MIN
);

1356 
	`ut_ad
(
buf_poﬁ
->
LRU_ﬁd_øtio
 <
BUF_LRU_OLD_RATIO_MAX
);

1357 #i‡
BUF_LRU_OLD_RATIO_MIN
 * 
BUF_LRU_OLD_MIN_LEN
 <= \

1358 
BUF_LRU_OLD_RATIO_DIV
 * (
BUF_LRU_OLD_TOLERANCE
 + 5)

1362 #ifde‡
UNIV_LRU_DEBUG


1365 
	`ut_a
(
buf_poﬁ
->
LRU_ﬁd
->
ﬁd
);

1366 
	`ut_a
(!
	`UT_LIST_GET_PREV
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
) ||

1367 !
	`UT_LIST_GET_PREV
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
)->
ﬁd
);

1368 
	`ut_a
(!
	`UT_LIST_GET_NEXT
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
) ||

1369 
	`UT_LIST_GET_NEXT
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
)->
ﬁd
);

1372 
ﬁd_Àn
 = 
buf_poﬁ
->
LRU_ﬁd_Àn
;

1373 
√w_Àn
 = 
	`ut_mö
(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë* buf_poﬁ->
LRU_ﬁd_øtio
 /

1374 
BUF_LRU_OLD_RATIO_DIV
,

1375 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
) -

1376 (
BUF_LRU_OLD_TOLERANCE
 + 
BUF_LRU_NON_OLD_MIN_LEN
));

1379 
buf_∑ge_t
 *
LRU_ﬁd
 = 
buf_poﬁ
->LRU_old;

1381 
	`ut_a
(
LRU_ﬁd
);

1382 
	`ut_ad
(
LRU_ﬁd
->
ö_LRU_li°
);

1383 #ifde‡
UNIV_LRU_DEBUG


1384 
	`ut_a
(
LRU_ﬁd
->
ﬁd
);

1389 i‡(
ﬁd_Àn
 + 
BUF_LRU_OLD_TOLERANCE
 < 
√w_Àn
) {

1390 
buf_poﬁ
->
LRU_ﬁd
 = LRU_ﬁd = 
	`UT_LIST_GET_PREV
(
LRU
, LRU_old);

1391 #ifde‡
UNIV_LRU_DEBUG


1392 
	`ut_a
(!
LRU_ﬁd
->
ﬁd
);

1394 
ﬁd_Àn
 = ++
buf_poﬁ
->
LRU_ﬁd_Àn
;

1395 
	`buf_∑ge_£t_ﬁd
(
LRU_ﬁd
, 
TRUE
);

1397 } i‡(
ﬁd_Àn
 > 
√w_Àn
 + 
BUF_LRU_OLD_TOLERANCE
) {

1398 
buf_poﬁ
->
LRU_ﬁd
 = 
	`UT_LIST_GET_NEXT
(
LRU
, LRU_old);

1399 
ﬁd_Àn
 = --
buf_poﬁ
->
LRU_ﬁd_Àn
;

1400 
	`buf_∑ge_£t_ﬁd
(
LRU_ﬁd
, 
FALSE
);

1405 
	}
}

1410 
	$buf_LRU_ﬁd_öô
(
buf_poﬁ_t
 *
buf_poﬁ
) {

1411 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1412 
	`ut_a
(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë=
BUF_LRU_OLD_MIN_LEN
);

1418 
buf_∑ge_t
 *
b∑ge
 = 
	`UT_LIST_GET_LAST
(
buf_poﬁ
->
LRU
); b∑gê!
NULL
;

1419 
b∑ge
 = 
	`UT_LIST_GET_PREV
(
LRU
, bpage)) {

1420 
	`ut_ad
(
b∑ge
->
ö_LRU_li°
);

1421 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1425 
b∑ge
->
ﬁd
 = 
TRUE
;

1428 
buf_poﬁ
->
LRU_ﬁd
 = 
	`UT_LIST_GET_FIRST
(buf_poﬁ->
LRU
);

1429 
buf_poﬁ
->
LRU_ﬁd_Àn
 = 
	`UT_LIST_GET_LEN
(buf_poﬁ->
LRU
);

1431 
	`buf_LRU_ﬁd_adju°_Àn
(
buf_poﬁ
);

1432 
	}
}

1436 
	$buf_unzù_LRU_ªmove_block_if_√eded
(
buf_∑ge_t
 *
b∑ge
) {

1437 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

1439 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1440 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1442 i‡(
	`buf_∑ge_bñ⁄gs_to_unzù_LRU
(
b∑ge
)) {

1443 
buf_block_t
 *
block
 = 
ªöãΩªt_ˇ°
<buf_block_à*>(
b∑ge
);

1445 
	`ut_ad
(
block
->
ö_unzù_LRU_li°
);

1446 
	`ut_d
(
block
->
ö_unzù_LRU_li°
 = 
FALSE
);

1448 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
unzù_LRU
, 
block
);

1450 
	}
}

1453 
	$buf_LRU_adju°_hp
(
buf_poﬁ_t
 *
buf_poﬁ
,

1454 c⁄° 
buf_∑ge_t
 *
b∑ge
)

1456 
buf_poﬁ
->
Ãu_hp
.
	`adju°
(
b∑ge
);

1457 
buf_poﬁ
->
Ãu_sˇn_ôr
.
	`adju°
(
b∑ge
);

1458 
buf_poﬁ
->
sögÀ_sˇn_ôr
.
	`adju°
(
b∑ge
);

1459 
	}
}

1463 
UNIV_INLINE


1464 
	$buf_LRU_ªmove_block
(
buf_∑ge_t
 *
b∑ge
) {

1465 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

1467 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1469 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1471 
	`ut_ad
(
b∑ge
->
ö_LRU_li°
);

1475 
	`buf_LRU_adju°_hp
(
buf_poﬁ
, 
b∑ge
);

1480 i‡(
b∑ge
 =
buf_poﬁ
->
LRU_ﬁd
) {

1486 
buf_∑ge_t
 *
¥ev_b∑ge
 = 
	`UT_LIST_GET_PREV
(
LRU
, 
b∑ge
);

1488 
	`ut_a
(
¥ev_b∑ge
);

1489 #ifde‡
UNIV_LRU_DEBUG


1490 
	`ut_a
(!
¥ev_b∑ge
->
ﬁd
);

1492 
buf_poﬁ
->
LRU_ﬁd
 = 
¥ev_b∑ge
;

1493 
	`buf_∑ge_£t_ﬁd
(
¥ev_b∑ge
, 
TRUE
);

1495 
buf_poﬁ
->
LRU_ﬁd_Àn
++;

1499 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
LRU
, 
b∑ge
);

1500 
	`ut_d
(
b∑ge
->
ö_LRU_li°
 = 
FALSE
);

1502 
buf_poﬁ
->
°©
.
LRU_byãs
 -
b∑ge
->
size
.
	`physiˇl
();

1504 
	`buf_unzù_LRU_ªmove_block_if_√eded
(
b∑ge
);

1508 i‡(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë< 
BUF_LRU_OLD_MIN_LEN
) {

1509 
buf_∑ge_t
 *
b∑ge
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
LRU
); b∑gê!
NULL
;

1510 
b∑ge
 = 
	`UT_LIST_GET_NEXT
(
LRU
, bpage)) {

1513 
b∑ge
->
ﬁd
 = 
FALSE
;

1516 
buf_poﬁ
->
LRU_ﬁd
 = 
NULL
;

1517 
buf_poﬁ
->
LRU_ﬁd_Àn
 = 0;

1522 
	`ut_ad
(
buf_poﬁ
->
LRU_ﬁd
);

1525 i‡(
	`buf_∑ge_is_ﬁd
(
b∑ge
)) {

1526 
buf_poﬁ
->
LRU_ﬁd_Àn
--;

1530 
	`buf_LRU_ﬁd_adju°_Àn
(
buf_poﬁ
);

1531 
	}
}

1537 
	$buf_unzù_LRU_add_block
(
buf_block_t
 *
block
, 
iboﬁ
 
ﬁd
) {

1538 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_block
(
block
);

1540 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1542 
	`ut_a
(
	`buf_∑ge_bñ⁄gs_to_unzù_LRU
(&
block
->
∑ge
));

1544 
	`ut_ad
(!
block
->
ö_unzù_LRU_li°
);

1545 
	`ut_d
(
block
->
ö_unzù_LRU_li°
 = 
TRUE
);

1547 i‡(
ﬁd
) {

1548 
	`UT_LIST_ADD_LAST
(
buf_poﬁ
->
unzù_LRU
, 
block
);

1550 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
unzù_LRU
, 
block
);

1552 
	}
}

1562 
UNIV_INLINE


1563 
	$buf_LRU_add_block_low
(
buf_∑ge_t
 *
b∑ge
, 
iboﬁ
 
ﬁd
) {

1564 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

1566 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1568 
	`ut_a
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1569 
	`ut_ad
(!
b∑ge
->
ö_LRU_li°
);

1571 i‡(!
ﬁd
 || (
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë< 
BUF_LRU_OLD_MIN_LEN
)) {

1572 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
LRU
, 
b∑ge
);

1574 
b∑ge
->
‰ìd_∑ge_˛ock
 = 
buf_poﬁ
->freed_page_clock;

1576 #ifde‡
UNIV_LRU_DEBUG


1579 
	`ut_a
(
buf_poﬁ
->
LRU_ﬁd
->
ﬁd
);

1580 
	`ut_a
(!
	`UT_LIST_GET_PREV
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
) ||

1581 !
	`UT_LIST_GET_PREV
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
)->
ﬁd
);

1582 
	`ut_a
(!
	`UT_LIST_GET_NEXT
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
) ||

1583 
	`UT_LIST_GET_NEXT
(
LRU
, 
buf_poﬁ
->
LRU_ﬁd
)->
ﬁd
);

1585 
	`UT_LIST_INSERT_AFTER
(
buf_poﬁ
->
LRU
, buf_poﬁ->
LRU_ﬁd
, 
b∑ge
);

1587 
buf_poﬁ
->
LRU_ﬁd_Àn
++;

1590 
	`ut_d
(
b∑ge
->
ö_LRU_li°
 = 
TRUE
);

1592 
	`ö¸_LRU_size_ö_byãs
(
b∑ge
, 
buf_poﬁ
);

1594 i‡(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë> 
BUF_LRU_OLD_MIN_LEN
) {

1595 
	`ut_ad
(
buf_poﬁ
->
LRU_ﬁd
);

1599 
	`buf_∑ge_£t_ﬁd
(
b∑ge
, 
ﬁd
);

1600 
	`buf_LRU_ﬁd_adju°_Àn
(
buf_poﬁ
);

1602 } i‡(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë=
BUF_LRU_OLD_MIN_LEN
) {

1606 
	`buf_LRU_ﬁd_öô
(
buf_poﬁ
);

1608 
	`buf_∑ge_£t_ﬁd
(
b∑ge
, 
buf_poﬁ
->
LRU_ﬁd
 !
NULL
);

1613 i‡(
	`buf_∑ge_bñ⁄gs_to_unzù_LRU
(
b∑ge
)) {

1614 
	`buf_unzù_LRU_add_block
((
buf_block_t
 *)
b∑ge
, 
ﬁd
);

1616 
	}
}

1621 
	$buf_LRU_add_block
(
buf_∑ge_t
 *
b∑ge
,

1622 
iboﬁ
 
ﬁd
)

1628 
	`buf_LRU_add_block_low
(
b∑ge
, 
ﬁd
);

1629 
	}
}

1633 
	$buf_LRU_make_block_young
(
buf_∑ge_t
 *
b∑ge
) {

1634 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

1636 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1638 i‡(
b∑ge
->
ﬁd
) {

1639 
buf_poﬁ
->
°©
.
n_∑ges_made_young
++;

1642 
	`buf_LRU_ªmove_block
(
b∑ge
);

1643 
	`buf_LRU_add_block_low
(
b∑ge
, 
FALSE
);

1644 
	}
}

1657 
boﬁ
 
	$buf_LRU_‰ì_∑ge
(
buf_∑ge_t
 *
b∑ge
, 
boﬁ
 
zù
) {

1658 
buf_∑ge_t
 *
b
 = 
NULL
;

1659 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

1661 
rw_lock_t
 *
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
b∑ge
->
id
);

1663 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

1665 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1666 
	`ut_ad
(
	`muãx_own
(
block_muãx
));

1667 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1668 
	`ut_ad
(
b∑ge
->
ö_LRU_li°
);

1670 i‡(!
	`buf_∑ge_ˇn_ªloˇã
(
b∑ge
)) {

1672  (
Ál£
);

1675 #ifde‡
UNIV_IBUF_COUNT_DEBUG


1676 
	`ut_a
(
	`ibuf_cou¡_gë
(
b∑ge
->
id
) == 0);

1679 i‡(
zù
 || !
b∑ge
->zù.
d©a
) {

1683 i‡(
b∑ge
->
ﬁde°_modifiˇti⁄
) {

1684  (
Ál£
);

1686 } i‡(
b∑ge
->
ﬁde°_modifiˇti⁄
 > 0 &&

1687 
	`buf_∑ge_gë_°©e
(
b∑ge
Ë!
BUF_BLOCK_FILE_PAGE
) {

1688 
	`ut_ad
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_ZIP_DIRTY
);

1690  (
Ál£
);

1692 } i‡(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_FILE_PAGE
) {

1693 
b
 = 
	`buf_∑ge_Æloc_des¸ùt‹
();

1694 
	`ut_a
(
b
);

1697 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

1698 
	`ut_ad
(
b∑ge
->
ö_LRU_li°
);

1699 
	`ut_ad
(!
b∑ge
->
ö_Êush_li°
 =!b∑ge->
ﬁde°_modifiˇti⁄
);

1701 
	`DBUG_PRINT
("ib_buf", ("‰ìÖagê" 
UINT32PF
 ":" UINT32PF, 
b∑ge
->
id
.
	`•a˚
(),

1702 
b∑ge
->
id
.
	`∑ge_no
()));

1704 
	`muãx_exô
(
block_muãx
);

1706 
	`rw_lock_x_lock
(
hash_lock
);

1707 
	`muãx_íãr
(
block_muãx
);

1709 i‡(!
	`buf_∑ge_ˇn_ªloˇã
(
b∑ge
) ||

1710 ((
zù
 || 
b∑ge
->zù.
d©a
 =
NULL
Ë&& b∑ge->
ﬁde°_modifiˇti⁄
 > 0)) {

1711 
nŸ_‰ìd
:

1712 
	`rw_lock_x_u∆ock
(
hash_lock
);

1714 i‡(
b
 !
NULL
) {

1715 
	`buf_∑ge_‰ì_des¸ùt‹
(
b
);

1718  (
Ál£
);

1720 } i‡(
b∑ge
->
ﬁde°_modifiˇti⁄
 > 0 &&

1721 
	`buf_∑ge_gë_°©e
(
b∑ge
Ë!
BUF_BLOCK_FILE_PAGE
) {

1722 
	`ut_ad
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_ZIP_DIRTY
);

1724 
nŸ_‰ìd
;

1726 } i‡(
b
 !
NULL
) {

1727 
	`√w
 (
b
Ë
	`buf_∑ge_t
(*
b∑ge
);

1730 
	`ut_ad
(
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
));

1731 
	`ut_ad
(
	`buf_∑ge_ˇn_ªloˇã
(
b∑ge
));

1733 i‡(!
	`buf_LRU_block_ªmove_hashed
(
b∑ge
, 
zù
, 
Ál£
)) {

1734 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

1736 i‡(
b
 !
NULL
) {

1737 
	`buf_∑ge_‰ì_des¸ùt‹
(
b
);

1740  (
åue
);

1744 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
) &&

1745 !
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_S
));

1754 i‡(
b
 !
NULL
) {

1755 
buf_∑ge_t
 *
¥ev_b
 = 
	`UT_LIST_GET_PREV
(
LRU
, 
b
);

1757 
	`rw_lock_x_lock
(
hash_lock
);

1759 
	`muãx_íãr
(
block_muãx
);

1761 
	`ut_a
(!
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
b
->
id
));

1763 
b
->
°©e
 =

1764 
b
->
ﬁde°_modifiˇti⁄
 ? 
BUF_BLOCK_ZIP_DIRTY
 : 
BUF_BLOCK_ZIP_PAGE
;

1766 
	`ut_ad
(
b
->
size
.
	`is_com¥es£d
());

1768 
	`UNIV_MEM_DESC
(
b
->
zù
.
d©a
, b->
size
.
	`physiˇl
());

1775 
	`ut_ad
(!
b∑ge
->
ö_∑ge_hash
);

1776 
	`ut_ad
(!
b∑ge
->
ö_LRU_li°
);

1780 
	`ut_ad
(!((
buf_block_t
 *)
b∑ge
)->
ö_unzù_LRU_li°
);

1784 
	`ut_ad
(!
b
->
ö_zù_hash
);

1785 
	`ut_ad
(
b
->
ö_∑ge_hash
);

1786 
	`ut_ad
(
b
->
ö_LRU_li°
);

1788 
	`HASH_INSERT
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
b
->
id
.
	`fﬁd
(), b);

1791 i‡(
¥ev_b
 !
NULL
) {

1792 
ulöt
 
Ãu_Àn
;

1794 
	`ut_ad
(
¥ev_b
->
ö_LRU_li°
);

1795 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
¥ev_b
));

1797 
	`UT_LIST_INSERT_AFTER
(
buf_poﬁ
->
LRU
, 
¥ev_b
, 
b
);

1799 
	`ö¸_LRU_size_ö_byãs
(
b
, 
buf_poﬁ
);

1801 i‡(
	`buf_∑ge_is_ﬁd
(
b
)) {

1802 
buf_poﬁ
->
LRU_ﬁd_Àn
++;

1803 i‡(
buf_poﬁ
->
LRU_ﬁd
 =
	`UT_LIST_GET_NEXT
(
LRU
, 
b
)) {

1804 
buf_poﬁ
->
LRU_ﬁd
 = 
b
;

1808 
Ãu_Àn
 = 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
);

1810 i‡(
Ãu_Àn
 > 
BUF_LRU_OLD_MIN_LEN
) {

1811 
	`ut_ad
(
buf_poﬁ
->
LRU_ﬁd
);

1814 
	`buf_LRU_ﬁd_adju°_Àn
(
buf_poﬁ
);

1815 } i‡(
Ãu_Àn
 =
BUF_LRU_OLD_MIN_LEN
) {

1819 
	`buf_LRU_ﬁd_öô
(
buf_poﬁ
);

1821 #ifde‡
UNIV_LRU_DEBUG


1824 
	`buf_∑ge_£t_ﬁd
(
b
, 
	`buf_∑ge_is_ﬁd
(b));

1827 
	`ut_d
(
b
->
ö_LRU_li°
 = 
FALSE
);

1828 
	`buf_LRU_add_block_low
(
b
, 
	`buf_∑ge_is_ﬁd
(b));

1831 
	`muãx_íãr
(&
buf_poﬁ
->
zù_muãx
);

1832 
	`rw_lock_x_u∆ock
(
hash_lock
);

1833 i‡(
b
->
°©e
 =
BUF_BLOCK_ZIP_PAGE
) {

1834 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


1835 
	`buf_LRU_ö£π_zù_˛ón
(
b
);

1839 
	`buf_Êush_ªloˇã_⁄_Êush_li°
(
b∑ge
, 
b
);

1842 
b∑ge
->
zù
.
d©a
 = 
NULL
;

1844 
	`∑ge_zù_£t_size
(&
b∑ge
->
zù
, 0);

1846 
b∑ge
->
size
.
	`c›y_‰om
(

1847 
	`∑ge_size_t
(
b∑ge
->
size
.
	`logiˇl
(), b∑ge->size.logiˇl(), 
Ál£
));

1852 
	`buf_∑ge_£t_°icky
(
b
);

1854 
	`muãx_exô
(&
buf_poﬁ
->
zù_muãx
);

1856 
	`muãx_exô
(
block_muãx
);

1859 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

1867 
	`UNIV_MEM_VALID
(((
buf_block_t
 *)
b∑ge
)->
‰ame
, 
UNIV_PAGE_SIZE
);

1868 
	`bå_£¨ch_dr›_∑ge_hash_ödex
((
buf_block_t
 *)
b∑ge
);

1869 
	`UNIV_MEM_INVALID
(((
buf_block_t
 *)
b∑ge
)->
‰ame
, 
UNIV_PAGE_SIZE
);

1871 i‡(
b
 !
NULL
) {

1879 
	`ut_ad
(
b
->
size
.
	`is_com¥es£d
());

1881 
BlockRï‹ãr
 
ªp‹ãr
 = 
	`BlockRï‹ãr
(
Ál£
, 
b
->
zù
.
d©a
, b->
size
, false);

1883 c⁄° 
uöt32_t
 
checksum
 = 
ªp‹ãr
.
	`ˇlc_zù_checksum
(

1884 
°©ic_ˇ°
<
§v_checksum_Æg‹ôhm_t
>(
§v_checksum_Æg‹ôhm
));

1886 
	`mach_wrôe_to_4
(
b
->
zù
.
d©a
 + 
FIL_PAGE_SPACE_OR_CHKSUM
, 
checksum
);

1889 i‡(
b
 !
NULL
) {

1890 
	`muãx_íãr
(&
buf_poﬁ
->
zù_muãx
);

1892 
	`buf_∑ge_un£t_°icky
(
b
);

1894 
	`muãx_exô
(&
buf_poﬁ
->
zù_muãx
);

1897 
	`buf_LRU_block_‰ì_hashed_∑ge
((
buf_block_t
 *)
b∑ge
);

1899  (
åue
);

1900 
	}
}

1904 
	$buf_LRU_block_‰ì_n⁄_fûe_∑ge
(
buf_block_t
 *
block
) {

1905 *
d©a
;

1906 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_block
(
block
);

1908 
	`buf_block_gë_°©e
(
block
)) {

1909 
BUF_BLOCK_MEMORY
:

1910 
BUF_BLOCK_READY_FOR_USE
:

1913 
ut_îr‹
;

1916 
	`as£π_block_ahi_em±y
(
block
);

1917 
	`ut_ad
(!
block
->
∑ge
.
ö_‰ì_li°
);

1918 
	`ut_ad
(!
block
->
∑ge
.
ö_Êush_li°
);

1919 
	`ut_ad
(!
block
->
∑ge
.
ö_LRU_li°
);

1921 #ifde‡
UNIV_DEBUG


1923 
	`mem£t
(
block
->
‰ame
, '\0', 
UNIV_PAGE_SIZE
);

1926 
	`mem£t
(
block
->
‰ame
 + 
FIL_PAGE_OFFSET
, 0xfe, 4);

1927 
	`mem£t
(
block
->
‰ame
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
, 0xfe, 4);

1929 
	`UNIV_MEM_ASSERT_AND_FREE
(
block
->
‰ame
, 
UNIV_PAGE_SIZE
);

1930 
d©a
 = 
block
->
∑ge
.
zù
.data;

1932 i‡(
d©a
 !
NULL
) {

1933 
block
->
∑ge
.
zù
.
d©a
 = 
NULL
;

1935 
	`ut_ad
(
block
->
∑ge
.
size
.
	`is_com¥es£d
());

1937 
	`buf_buddy_‰ì
(
buf_poﬁ
, 
d©a
, 
block
->
∑ge
.
size
.
	`physiˇl
());

1939 
	`∑ge_zù_£t_size
(&
block
->
∑ge
.
zù
, 0);

1941 
block
->
∑ge
.
size
.
	`c›y_‰om
(
	`∑ge_size_t
(block->∑ge.size.
	`logiˇl
(),

1942 
block
->
∑ge
.
size
.
	`logiˇl
(), 
Ál£
));

1945 i‡(
	`buf_gë_wôhdøw_dïth
(
buf_poﬁ
) &&

1946 
	`buf_block_wûl_wôhdøwn
(
buf_poﬁ
, 
block
)) {

1948 
	`buf_block_£t_°©e
(
block
, 
BUF_BLOCK_NOT_USED
);

1949 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1950 
	`UT_LIST_ADD_LAST
(
buf_poﬁ
->
wôhdøw
, &
block
->
∑ge
);

1951 
	`ut_d
(
block
->
ö_wôhdøw_li°
 = 
TRUE
);

1952 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1954 
	`buf_block_£t_°©e
(
block
, 
BUF_BLOCK_NOT_USED
);

1955 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1956 
	`UT_LIST_ADD_FIRST
(
buf_poﬁ
->
‰ì
, &
block
->
∑ge
);

1957 
	`ut_d
(
block
->
∑ge
.
ö_‰ì_li°
 = 
TRUE
);

1958 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

1960 
	}
}

1983 
boﬁ
 
	$buf_LRU_block_ªmove_hashed
(
buf_∑ge_t
 *
b∑ge
, 
boﬁ
 
zù
,

1984 
boﬁ
 
ign‹e_c⁄ã¡
) {

1985 c⁄° 
buf_∑ge_t
 *
hashed_b∑ge
;

1986 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

1987 
rw_lock_t
 *
hash_lock
;

1989 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

1990 
	`ut_ad
(
	`muãx_own
(
	`buf_∑ge_gë_muãx
(
b∑ge
)));

1992 
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
b∑ge
->
id
);

1994 
	`ut_ad
(
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
));

1996 
	`ut_a
(
	`buf_∑ge_gë_io_fix
(
b∑ge
Ë=
BUF_IO_NONE
);

1997 
	`ut_a
(
b∑ge
->
buf_fix_cou¡
 == 0);

1999 
	`buf_LRU_ªmove_block
(
b∑ge
);

2001 
buf_poﬁ
->
‰ìd_∑ge_˛ock
 += 1;

2003 
	`buf_∑ge_gë_°©e
(
b∑ge
)) {

2004 
BUF_BLOCK_FILE_PAGE
: {

2005 
	`UNIV_MEM_ASSERT_W
(
b∑ge
, (
buf_block_t
));

2006 
	`UNIV_MEM_ASSERT_W
(((
buf_block_t
 *)
b∑ge
)->
‰ame
, 
UNIV_PAGE_SIZE
);

2008 
	`buf_block_modify_˛ock_öc
((
buf_block_t
 *)
b∑ge
);

2010 i‡(
b∑ge
->
zù
.
d©a
 !
NULL
) {

2011 c⁄° 
∑ge_t
 *
∑ge
 = ((
buf_block_t
 *)
b∑ge
)->
‰ame
;

2013 
	`ut_a
(!
zù
 || 
b∑ge
->
ﬁde°_modifiˇti⁄
 == 0);

2014 
	`ut_ad
(
b∑ge
->
size
.
	`is_com¥es£d
());

2016 
	`fû_∑ge_gë_ty≥
(
∑ge
)) {

2017 
FIL_PAGE_TYPE_ALLOCATED
:

2018 
FIL_PAGE_INODE
:

2019 
FIL_PAGE_IBUF_BITMAP
:

2020 
FIL_PAGE_TYPE_FSP_HDR
:

2021 
FIL_PAGE_TYPE_XDES
:

2022 
FIL_PAGE_TYPE_ZLOB_FIRST
:

2023 
FIL_PAGE_TYPE_ZLOB_DATA
:

2024 
FIL_PAGE_TYPE_ZLOB_INDEX
:

2025 
FIL_PAGE_TYPE_ZLOB_FRAG
:

2026 
FIL_PAGE_TYPE_ZLOB_FRAG_ENTRY
:

2028 i‡(!
zù
) {

2033 
	`mem˝y
(
b∑ge
->
zù
.
d©a
, 
∑ge
, b∑ge->
size
.
	`physiˇl
());

2036 
FIL_PAGE_TYPE_ZBLOB
:

2037 
FIL_PAGE_TYPE_ZBLOB2
:

2038 
FIL_PAGE_SDI_ZBLOB
:

2040 
FIL_PAGE_INDEX
:

2041 
FIL_PAGE_SDI
:

2042 
FIL_PAGE_RTREE
:

2043 #ifde‡
UNIV_ZIP_DEBUG


2044 
	`ut_a
(
	`∑ge_zù_vÆid©e
(&
b∑ge
->
zù
, 
∑ge
,

2045 ((
buf_block_t
 *)
b∑ge
)->
ödex
));

2049 
ib
::
	`îr‹
(
ER_IB_MSG_135
) << "The compressedÖageÅo be"

2051 
	`ut_¥öt_buf
(
°dîr
, 
∑ge
, 
b∑ge
->
size
.
	`logiˇl
());

2053 
ib
::
	`îr‹
(
ER_IB_MSG_136
) << "Possibly older version of"

2056 
	`ut_¥öt_buf
(
°dîr
, 
b∑ge
->
zù
.
d©a
, b∑ge->
size
.
	`physiˇl
());

2057 
	`putc
('\n', 
°dîr
);

2058 
ut_îr‹
;

2064 i‡(!
ign‹e_c⁄ã¡
) {

2068 c⁄° 
byã
 *
‰ame
 = 
b∑ge
->
zù
.
d©a
 !
NULL


2069 ? 
b∑ge
->
zù
.
d©a


2070 : 
ªöãΩªt_ˇ°
<
buf_block_t
 *>(
b∑ge
)->
‰ame
;

2072 c⁄° 
ulöt
 
ty≥
 = 
	`fû_∑ge_gë_ty≥
(
‰ame
);

2074 i‡((
ty≥
 =
FIL_PAGE_INDEX
 ||Åy≥ =
FIL_PAGE_RTREE
) &&

2075 
	`∑ge_is_Àaf
(
‰ame
)) {

2076 
uöt32_t
 
•a˚_id
 = 
b∑ge
->
id
.
	`•a˚
();

2078 
•a˚_ödex_t
 
idx_id
 = 
	`bå_∑ge_gë_ödex_id
(
‰ame
);

2080 
buf_°©_≥r_ödex
->
	`dec
(
	`ödex_id_t
(
•a˚_id
, 
idx_id
));

2085 
BUF_BLOCK_ZIP_PAGE
:

2086 
	`ut_a
(
b∑ge
->
ﬁde°_modifiˇti⁄
 == 0);

2087 i‡(
b∑ge
->
size
.
	`is_com¥es£d
()) {

2088 
	`UNIV_MEM_ASSERT_W
(
b∑ge
->
zù
.
d©a
, b∑ge->
size
.
	`physiˇl
());

2091 
BUF_BLOCK_POOL_WATCH
:

2092 
BUF_BLOCK_ZIP_DIRTY
:

2093 
BUF_BLOCK_NOT_USED
:

2094 
BUF_BLOCK_READY_FOR_USE
:

2095 
BUF_BLOCK_MEMORY
:

2096 
BUF_BLOCK_REMOVE_HASH
:

2097 
ut_îr‹
;

2101 
hashed_b∑ge
 = 
	`buf_∑ge_hash_gë_low
(
buf_poﬁ
, 
b∑ge
->
id
);

2103 i‡(
b∑ge
 !
hashed_b∑ge
) {

2104 
ib
::
	`îr‹
(
ER_IB_MSG_137
)

2105 << "Pagê" << 
b∑ge
->
id
 << "Çot found inÅhe hashÅable";

2107 i‡(
hashed_b∑ge
) {

2108 
ib
::
	`îr‹
(
ER_IB_MSG_138
)

2109 << "I¿hashÅabÀ wêföd block " << 
hashed_b∑ge
 << " of "

2110 << 
hashed_b∑ge
->
id
 << " which i†nŸ " << 
b∑ge
;

2113 
	`ut_d
(
	`muãx_exô
(
	`buf_∑ge_gë_muãx
(
b∑ge
)));

2114 
	`ut_d
(
	`rw_lock_x_u∆ock
(
hash_lock
));

2115 
	`ut_d
(
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
));

2116 
	`ut_d
(
	`buf_¥öt
());

2117 
	`ut_d
(
	`buf_LRU_¥öt
());

2118 
	`ut_d
(
	`buf_vÆid©e
());

2119 
	`ut_d
(
	`buf_LRU_vÆid©e
());

2120 
	`ut_ad
(0);

2123 
	`ut_ad
(!
b∑ge
->
ö_zù_hash
);

2124 
	`ut_ad
(
b∑ge
->
ö_∑ge_hash
);

2125 
	`ut_d
(
b∑ge
->
ö_∑ge_hash
 = 
FALSE
);

2127 
	`HASH_DELETE
(
buf_∑ge_t
, 
hash
, 
buf_poﬁ
->
∑ge_hash
, 
b∑ge
->
id
.
	`fﬁd
(), bpage);

2129 
	`buf_∑ge_gë_°©e
(
b∑ge
)) {

2130 
BUF_BLOCK_ZIP_PAGE
:

2131 
	`ut_ad
(!
b∑ge
->
ö_‰ì_li°
);

2132 
	`ut_ad
(!
b∑ge
->
ö_Êush_li°
);

2133 
	`ut_ad
(!
b∑ge
->
ö_LRU_li°
);

2134 
	`ut_a
(
b∑ge
->
zù
.
d©a
);

2135 
	`ut_a
(
b∑ge
->
size
.
	`is_com¥es£d
());

2137 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


2138 
	`UT_LIST_REMOVE
(
buf_poﬁ
->
zù_˛ón
, 
b∑ge
);

2141 
	`muãx_exô
(&
buf_poﬁ
->
zù_muãx
);

2142 
	`rw_lock_x_u∆ock
(
hash_lock
);

2144 
	`buf_buddy_‰ì
(
buf_poﬁ
, 
b∑ge
->
zù
.
d©a
, b∑ge->
size
.
	`physiˇl
());

2146 
	`buf_∑ge_‰ì_des¸ùt‹
(
b∑ge
);

2147  (
Ál£
);

2149 
BUF_BLOCK_FILE_PAGE
:

2150 
	`mem£t
(((
buf_block_t
 *)
b∑ge
)->
‰ame
 + 
FIL_PAGE_OFFSET
, 0xff, 4);

2151 
	`mem£t
(((
buf_block_t
 *)
b∑ge
)->
‰ame
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
,

2153 
	`UNIV_MEM_INVALID
(((
buf_block_t
 *)
b∑ge
)->
‰ame
, 
UNIV_PAGE_SIZE
);

2154 
	`buf_∑ge_£t_°©e
(
b∑ge
, 
BUF_BLOCK_REMOVE_HASH
);

2175 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

2176 
	`rw_lock_x_u∆ock
(
hash_lock
);

2177 
	`muãx_exô
(&((
buf_block_t
 *)
b∑ge
)->
muãx
);

2179 i‡(
zù
 && 
b∑ge
->zù.
d©a
) {

2181 *
d©a
 = 
b∑ge
->
zù
.data;

2182 
b∑ge
->
zù
.
d©a
 = 
NULL
;

2184 
	`ut_ad
(!
b∑ge
->
ö_‰ì_li°
);

2185 
	`ut_ad
(!
b∑ge
->
ö_Êush_li°
);

2186 
	`ut_ad
(!
b∑ge
->
ö_LRU_li°
);

2188 
	`buf_buddy_‰ì
(
buf_poﬁ
, 
d©a
, 
b∑ge
->
size
.
	`physiˇl
());

2190 
	`∑ge_zù_£t_size
(&
b∑ge
->
zù
, 0);

2192 
b∑ge
->
size
.
	`c›y_‰om
(

2193 
	`∑ge_size_t
(
b∑ge
->
size
.
	`logiˇl
(), b∑ge->size.logiˇl(), 
Ál£
));

2196  (
åue
);

2198 
BUF_BLOCK_POOL_WATCH
:

2199 
BUF_BLOCK_ZIP_DIRTY
:

2200 
BUF_BLOCK_NOT_USED
:

2201 
BUF_BLOCK_READY_FOR_USE
:

2202 
BUF_BLOCK_MEMORY
:

2203 
BUF_BLOCK_REMOVE_HASH
:

2207 
ut_îr‹
;

2208 
	}
}

2211 
	$buf_LRU_block_‰ì_hashed_∑ge
(

2212 
buf_block_t
 *
block
)

2215 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_block
(
block
);

2217 i‡(
buf_poﬁ
->
Êush_rbt
 =
NULL
) {

2218 
block
->
∑ge
.
id
.
	`ª£t
(
ULINT32_UNDEFINED
, ULINT32_UNDEFINED);

2221 
	`buf_block_£t_°©e
(
block
, 
BUF_BLOCK_MEMORY
);

2223 
	`buf_LRU_block_‰ì_n⁄_fûe_∑ge
(
block
);

2224 
	}
}

2236 
	$buf_LRU_‰ì_⁄e_∑ge
(
buf_∑ge_t
 *
b∑ge
, 
boﬁ
 
zù
, boﬁ 
ign‹e_c⁄ã¡
) {

2237 #ifde‡
UNIV_DEBUG


2238 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
);

2239 
BPageMuãx
 *
block_muãx
 = 
	`buf_∑ge_gë_muãx
(
b∑ge
);

2240 
rw_lock_t
 *
hash_lock
 = 
	`buf_∑ge_hash_lock_gë
(
buf_poﬁ
, 
b∑ge
->
id
);

2242 
	`ut_ad
(
	`muãx_own
(&
buf_poﬁ
->
LRU_li°_muãx
));

2243 
	`ut_ad
(
	`muãx_own
(
block_muãx
));

2244 
	`ut_ad
(
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
));

2247 i‡(
	`buf_LRU_block_ªmove_hashed
(
b∑ge
, 
åue
, 
ign‹e_c⁄ã¡
)) {

2248 
	`buf_LRU_block_‰ì_hashed_∑ge
((
buf_block_t
 *)
b∑ge
);

2252 
	`ut_ad
(!
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_X
) &&

2253 !
	`rw_lock_own
(
hash_lock
, 
RW_LOCK_S
));

2255 
	`ut_ad
(!
	`muãx_own
(
block_muãx
));

2256 
	}
}

2266 
uöt
 
	$buf_LRU_ﬁd_øtio_upd©e_ö°™˚
(
buf_poﬁ_t
 *
buf_poﬁ
,

2267 
uöt
 
ﬁd_p˘
, 
iboﬁ
 
adju°
) {

2268 
uöt
 
øtio
;

2270 
øtio
 = 
ﬁd_p˘
 * 
BUF_LRU_OLD_RATIO_DIV
 / 100;

2271 i‡(
øtio
 < 
BUF_LRU_OLD_RATIO_MIN
) {

2272 
øtio
 = 
BUF_LRU_OLD_RATIO_MIN
;

2273 } i‡(
øtio
 > 
BUF_LRU_OLD_RATIO_MAX
) {

2274 
øtio
 = 
BUF_LRU_OLD_RATIO_MAX
;

2277 i‡(
adju°
) {

2278 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

2280 i‡(
øtio
 !
buf_poﬁ
->
LRU_ﬁd_øtio
) {

2281 
buf_poﬁ
->
LRU_ﬁd_øtio
 = 
øtio
;

2283 i‡(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë>
BUF_LRU_OLD_MIN_LEN
) {

2284 
	`buf_LRU_ﬁd_adju°_Àn
(
buf_poﬁ
);

2288 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

2290 
buf_poﬁ
->
LRU_ﬁd_øtio
 = 
øtio
;

2294  ((
uöt
)(
øtio
 * 100 / ()
BUF_LRU_OLD_RATIO_DIV
 + 0.5));

2295 
	}
}

2299 
uöt
 
	$buf_LRU_ﬁd_øtio_upd©e
(

2300 
uöt
 
ﬁd_p˘
,

2302 
iboﬁ
 
adju°
)

2306 
uöt
 
√w_øtio
 = 0;

2308 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

2309 
buf_poﬁ_t
 *
buf_poﬁ
;

2311 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2313 
√w_øtio
 = 
	`buf_LRU_ﬁd_øtio_upd©e_ö°™˚
(
buf_poﬁ
, 
ﬁd_p˘
, 
adju°
);

2316  (
√w_øtio
);

2317 
	}
}

2321 
	$buf_LRU_°©_upd©e
() {

2322 
buf_LRU_°©_t
 *
ôem
;

2323 
buf_poﬁ_t
 *
buf_poﬁ
;

2324 
boﬁ
 
evi˘_°¨ãd
 = 
FALSE
;

2325 
buf_LRU_°©_t
 
cur_°©
;

2328 
os_rmb
;

2329 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

2330 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2332 i‡(
buf_poﬁ
->
‰ìd_∑ge_˛ock
 != 0) {

2333 
evi˘_°¨ãd
 = 
åue
;

2338 i‡(!
evi˘_°¨ãd
) {

2339 
func_exô
;

2343 
ôem
 = &
buf_LRU_°©_¨r
[
buf_LRU_°©_¨r_öd
];

2344 
buf_LRU_°©_¨r_öd
++;

2345 
buf_LRU_°©_¨r_öd
 %
BUF_LRU_STAT_N_INTERVAL
;

2353 
cur_°©
 = 
buf_LRU_°©_cur
;

2355 
buf_LRU_°©_sum
.
io
 +
cur_°©
.iÿ- 
ôem
->io;

2356 
buf_LRU_°©_sum
.
unzù
 +
cur_°©
.unzù - 
ôem
->unzip;

2359 
	`mem˝y
(
ôem
, &
cur_°©
,  *item);

2361 
func_exô
:

2363 
	`mem£t
(&
buf_LRU_°©_cur
, 0,  buf_LRU_stat_cur);

2364 
os_wmb
;

2365 
	}
}

2367 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


2370 
	$buf_LRU_vÆid©e_ö°™˚
(
buf_poﬁ_t
 *
buf_poﬁ
) {

2371 
ulöt
 
ﬁd_Àn
;

2372 
ulöt
 
√w_Àn
;

2374 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

2376 i‡(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë>
BUF_LRU_OLD_MIN_LEN
) {

2377 
	`ut_a
(
buf_poﬁ
->
LRU_ﬁd
);

2378 
ﬁd_Àn
 = 
buf_poﬁ
->
LRU_ﬁd_Àn
;

2380 
√w_Àn
 = 
	`ut_mö
(
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
Ë* buf_poﬁ->
LRU_ﬁd_øtio
 /

2381 
BUF_LRU_OLD_RATIO_DIV
,

2382 
	`UT_LIST_GET_LEN
(
buf_poﬁ
->
LRU
) -

2383 (
BUF_LRU_OLD_TOLERANCE
 + 
BUF_LRU_NON_OLD_MIN_LEN
));

2385 
	`ut_a
(
ﬁd_Àn
 >
√w_Àn
 - 
BUF_LRU_OLD_TOLERANCE
);

2386 
	`ut_a
(
ﬁd_Àn
 <
√w_Àn
 + 
BUF_LRU_OLD_TOLERANCE
);

2389 
CheckInLRULi°
::
	`vÆid©e
(
buf_poﬁ
);

2391 
ﬁd_Àn
 = 0;

2393 
buf_∑ge_t
 *
b∑ge
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
LRU
); b∑gê!
NULL
;

2394 
b∑ge
 = 
	`UT_LIST_GET_NEXT
(
LRU
, bpage)) {

2395 
	`buf_∑ge_gë_°©e
(
b∑ge
)) {

2396 
BUF_BLOCK_POOL_WATCH
:

2397 
BUF_BLOCK_NOT_USED
:

2398 
BUF_BLOCK_READY_FOR_USE
:

2399 
BUF_BLOCK_MEMORY
:

2400 
BUF_BLOCK_REMOVE_HASH
:

2401 
ut_îr‹
;

2403 
BUF_BLOCK_FILE_PAGE
:

2404 
	`ut_ad
(((
buf_block_t
 *)
b∑ge
)->
ö_unzù_LRU_li°
 ==

2405 
	`buf_∑ge_bñ⁄gs_to_unzù_LRU
(
b∑ge
));

2406 
BUF_BLOCK_ZIP_PAGE
:

2407 
BUF_BLOCK_ZIP_DIRTY
:

2411 i‡(
	`buf_∑ge_is_ﬁd
(
b∑ge
)) {

2412 c⁄° 
buf_∑ge_t
 *
¥ev
 = 
	`UT_LIST_GET_PREV
(
LRU
, 
b∑ge
);

2413 c⁄° 
buf_∑ge_t
 *
√xt
 = 
	`UT_LIST_GET_NEXT
(
LRU
, 
b∑ge
);

2415 i‡(!
ﬁd_Àn
++) {

2416 
	`ut_a
(
buf_poﬁ
->
LRU_ﬁd
 =
b∑ge
);

2418 
	`ut_a
(!
¥ev
 || 
	`buf_∑ge_is_ﬁd
(prev));

2421 
	`ut_a
(!
√xt
 || 
	`buf_∑ge_is_ﬁd
(next));

2425 
	`ut_a
(
buf_poﬁ
->
LRU_ﬁd_Àn
 =
ﬁd_Àn
);

2427 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

2429 
	`muãx_íãr
(&
buf_poﬁ
->
‰ì_li°_muãx
);

2431 
CheckInFªeLi°
::
	`vÆid©e
(
buf_poﬁ
);

2433 
buf_∑ge_t
 *
b∑ge
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
‰ì
); b∑gê!
NULL
;

2434 
b∑ge
 = 
	`UT_LIST_GET_NEXT
(
li°
, bpage)) {

2435 
	`ut_a
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_NOT_USED
);

2438 
	`muãx_exô
(&
buf_poﬁ
->
‰ì_li°_muãx
);

2440 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

2442 
CheckUnzùLRUAndLRULi°
::
	`vÆid©e
(
buf_poﬁ
);

2444 
buf_block_t
 *
block
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
unzù_LRU
);

2445 
block
 !
NULL
; block = 
	`UT_LIST_GET_NEXT
(
unzù_LRU
, block)) {

2446 
	`ut_ad
(
block
->
ö_unzù_LRU_li°
);

2447 
	`ut_ad
(
block
->
∑ge
.
ö_LRU_li°
);

2448 
	`ut_a
(
	`buf_∑ge_bñ⁄gs_to_unzù_LRU
(&
block
->
∑ge
));

2451 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

2452 
	}
}

2456 
iboﬁ
 
	$buf_LRU_vÆid©e
() {

2457 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

2458 
buf_poﬁ_t
 *
buf_poﬁ
;

2460 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2461 
	`buf_LRU_vÆid©e_ö°™˚
(
buf_poﬁ
);

2464  (
TRUE
);

2465 
	}
}

2468 #i‡
deföed
 
UNIV_DEBUG_PRINT
 || deföed 
UNIV_DEBUG
 || deföed 
UNIV_BUF_DEBUG


2471 
	$buf_LRU_¥öt_ö°™˚
(
buf_poﬁ_t
 *
buf_poﬁ
) {

2472 
	`muãx_íãr
(&
buf_poﬁ
->
LRU_li°_muãx
);

2474 c⁄° 
buf_∑ge_t
 *
b∑ge
 = 
	`UT_LIST_GET_FIRST
(
buf_poﬁ
->
LRU
);

2475 
b∑ge
 !
NULL
; b∑gê
	`UT_LIST_GET_NEXT
(
LRU
, bpage)) {

2476 
	`muãx_íãr
(
	`buf_∑ge_gë_muãx
(
b∑ge
));

2478 
	`Ârötf
(
°dîr
, "BLOCK s∑˚ " 
UINT32PF
 "Öage " UINT32PF " ",

2479 
b∑ge
->
id
.
	`•a˚
(), b∑ge->id.
	`∑ge_no
());

2481 i‡(
	`buf_∑ge_is_ﬁd
(
b∑ge
)) {

2482 
	`Âuts
("ﬁd ", 
°dîr
);

2485 i‡(
b∑ge
->
buf_fix_cou¡
) {

2486 
	`Ârötf
(
°dîr
, "buffix cou¡ %lu ", (
ul⁄g
)
b∑ge
->
buf_fix_cou¡
);

2489 i‡(
	`buf_∑ge_gë_io_fix
(
b∑ge
)) {

2490 
	`Ârötf
(
°dîr
, "io_fix %lu ", (
ul⁄g
)
	`buf_∑ge_gë_io_fix
(
b∑ge
));

2493 i‡(
b∑ge
->
ﬁde°_modifiˇti⁄
) {

2494 
	`Âuts
("modif. ", 
°dîr
);

2497 
	`buf_∑ge_gë_°©e
(
b∑ge
)) {

2498 c⁄° 
byã
 *
‰ame
;

2499 
BUF_BLOCK_FILE_PAGE
:

2500 
‰ame
 = 
	`buf_block_gë_‰ame
((
buf_block_t
 *)
b∑ge
);

2501 
	`Ârötf
(
°dîr
,

2503 " index id " 
IB_ID_FMT
 "\n",

2504 (
ul⁄g
)
	`fû_∑ge_gë_ty≥
(
‰ame
), 
	`bå_∑ge_gë_ödex_id
(frame));

2506 
BUF_BLOCK_ZIP_PAGE
:

2507 
‰ame
 = 
b∑ge
->
zù
.
d©a
;

2508 
	`Ârötf
(
°dîr
,

2510 " index id " 
IB_ID_FMT
 "\n",

2511 (
ul⁄g
)
	`fû_∑ge_gë_ty≥
(
‰ame
), (ul⁄g)
b∑ge
->
size
.
	`physiˇl
(),

2512 
	`bå_∑ge_gë_ödex_id
(
‰ame
));

2516 
	`Ârötf
(
°dîr
, "\n!°©ê%lu!\n", (
ul⁄g
)
	`buf_∑ge_gë_°©e
(
b∑ge
));

2520 
	`muãx_exô
(
	`buf_∑ge_gë_muãx
(
b∑ge
));

2523 
	`muãx_exô
(&
buf_poﬁ
->
LRU_li°_muãx
);

2524 
	}
}

2527 
	$buf_LRU_¥öt
() {

2528 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

2529 
buf_poﬁ_t
 *
buf_poﬁ
;

2531 
buf_poﬁ
 = 
	`buf_poﬁ_‰om_¨øy
(
i
);

2532 
	`buf_LRU_¥öt_ö°™˚
(
buf_poﬁ
);

2534 
	}
}

	@buf0rea.cc

33 
	~<mysql/£rvi˚_thd_waô.h
>

34 
	~<°ddef.h
>

36 
	~"buf0buf.h
"

37 
	~"buf0dblwr.h
"

38 
	~"buf0Êu.h
"

39 
	~"buf0Ãu.h
"

40 
	~"buf0ªa.h
"

41 
	~"fû0fû.h
"

42 
	~"ha_¥ŸŸy≥s.h
"

43 
	~"ibuf0ibuf.h
"

44 
	~"log0ªcv.h
"

45 
	~"må0må.h
"

46 
	~"my_dbug.h
"

47 
	~"my_öây≥s.h
"

48 
	~"os0fûe.h
"

49 
	~"§v0§v.h
"

50 
	~"§v0°¨t.h
"

51 
	~"åx0sys.h
"

55 
	#BUF_READ_AHEAD_RANDOM_THRESHOLD
(
b
Ë(5 + 
	`BUF_READ_AHEAD_AREA
(bË/ 8)

	)

60 
	#BUF_READ_AHEAD_PEND_LIMIT
 2

	)

80 
ulöt
 
	$buf_ªad_∑ge_low
(
dbîr_t
 *
îr
, 
boﬁ
 
sync
, 
ulöt
 
ty≥
, ulöà
mode
,

81 c⁄° 
∑ge_id_t
 &
∑ge_id
,

82 c⁄° 
∑ge_size_t
 &
∑ge_size
, 
boﬁ
 
unzù
) {

83 
buf_∑ge_t
 *
b∑ge
;

85 *
îr
 = 
DB_SUCCESS
;

87 i‡(
∑ge_id
.
	`•a˚
(Ë=
TRX_SYS_SPACE
 &&

88 
	`buf_dblwr_∑ge_öside
(
∑ge_id
.
	`∑ge_no
())) {

89 
ib
::
	`îr‹
(
ER_IB_MSG_139
)

90 << "TryögÅÿªad doubÀwrôêbuf„∏∑gê" << 
∑ge_id
;

94 i‡(
	`ibuf_bôm≠_∑ge
(
∑ge_id
, 
∑ge_size
Ë|| 
	`åx_sys_hdr_∑ge
(page_id)) {

101 
sync
 = 
åue
;

108 
b∑ge
 = 
	`buf_∑ge_öô_f‹_ªad
(
îr
, 
mode
, 
∑ge_id
, 
∑ge_size
, 
unzù
);

110 i‡(
b∑ge
 =
NULL
) {

114 
	`DBUG_PRINT
("ib_buf",

115 ("ªadÖagê%u:%u size=%u unzù=%u,%s", ()
∑ge_id
.
	`•a˚
(),

116 ()
∑ge_id
.
	`∑ge_no
(), ()
∑ge_size
.
	`physiˇl
(),

117 ()
unzù
, 
sync
 ? "sync" : "async"));

119 
	`ut_ad
(
	`buf_∑ge_ö_fûe
(
b∑ge
));

120 
	`ut_ad
(!
	`muãx_own
(&
	`buf_poﬁ_‰om_b∑ge
(
b∑ge
)->
LRU_li°_muãx
));

122 i‡(
sync
) {

123 
	`thd_waô_begö
(
NULL
, 
THD_WAIT_DISKIO
);

126 *
d°
;

128 i‡(
∑ge_size
.
	`is_com¥es£d
()) {

129 
d°
 = 
b∑ge
->
zù
.
d©a
;

131 
	`ut_a
(
	`buf_∑ge_gë_°©e
(
b∑ge
Ë=
BUF_BLOCK_FILE_PAGE
);

133 
d°
 = ((
buf_block_t
 *)
b∑ge
)->
‰ame
;

136 
IOReque°
 
	`ªque°
(
ty≥
 | IOReque°::
READ
);

138 *
îr
 = 
	`fû_io
(
ªque°
, 
sync
, 
∑ge_id
, 
∑ge_size
, 0,Öage_size.
	`physiˇl
(), 
d°
,

139 
b∑ge
);

141 i‡(
sync
) {

142 
	`thd_waô_íd
(
NULL
);

145 i‡(*
îr
 !
DB_SUCCESS
) {

146 i‡(
IOReque°
::
	`ign‹e_missög
(
ty≥
Ë|| *
îr
 =
DB_TABLESPACE_DELETED
) {

147 
	`buf_ªad_∑ge_h™dÀ_îr‹
(
b∑ge
);

151 
ut_îr‹
;

154 i‡(
sync
) {

157 i‡(!
	`buf_∑ge_io_com∂ëe
(
b∑ge
)) {

163 
	}
}

181 
ulöt
 
	$buf_ªad_ahód_øndom
(c⁄° 
∑ge_id_t
 &
∑ge_id
,

182 c⁄° 
∑ge_size_t
 &
∑ge_size
, 
iboﬁ
 
öside_ibuf
) {

183 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

184 
ulöt
 
ª˚¡_blocks
 = 0;

185 
ulöt
 
ibuf_mode
;

186 
ulöt
 
cou¡
;

187 
∑ge_no_t
 
low
, 
high
;

188 
dbîr_t
 
îr
;

189 
∑ge_no_t
 
i
;

190 c⁄° 
∑ge_no_t
 
buf_ªad_ahód_øndom_¨ó
 = 
	`BUF_READ_AHEAD_AREA
(
buf_poﬁ
);

192 i‡(!
§v_øndom_ªad_ahód
) {

197 i‡(
§v_°¨tup_is_bef‹e_åx_rﬁlback_pha£
) {

202 i‡(
	`ibuf_bôm≠_∑ge
(
∑ge_id
, 
∑ge_size
Ë|| 
	`åx_sys_hdr_∑ge
(page_id)) {

210 
low
 = (
∑ge_id
.
	`∑ge_no
(Ë/ 
buf_ªad_ahód_øndom_¨ó
) *

211 
buf_ªad_ahód_øndom_¨ó
;

213 
high
 = (
∑ge_id
.
	`∑ge_no
(Ë/ 
buf_ªad_ahód_øndom_¨ó
 + 1) *

214 
buf_ªad_ahód_øndom_¨ó
;

219 i‡(
fû_•a˚_t
 *
•a˚
 = 
	`fû_•a˚_acquúe
(
∑ge_id
.
	`•a˚
())) {

220 i‡(
high
 > 
•a˚
->
size
) {

221 
high
 = 
•a˚
->
size
;

223 
	`fû_•a˚_ªÀa£
(
•a˚
);

228 
os_rmb
;

229 i‡(
buf_poﬁ
->
n_≥nd_ªads
 >

230 
buf_poﬁ
->
cuº_size
 / 
BUF_READ_AHEAD_PEND_LIMIT
) {

237 
i
 = 
low
; i < 
high
; i++) {

238 
rw_lock_t
 *
hash_lock
;

239 c⁄° 
buf_∑ge_t
 *
b∑ge
;

241 
b∑ge
 = 
	`buf_∑ge_hash_gë_s_locked
(
buf_poﬁ
, 
	`∑ge_id_t
(
∑ge_id
.
	`•a˚
(), 
i
),

242 &
hash_lock
);

244 i‡(
b∑ge
 !
NULL
 && 
	`buf_∑ge_is_ac˚s£d
(bpage) &&

245 
	`buf_∑ge_≥ek_if_young
(
b∑ge
)) {

246 
ª˚¡_blocks
++;

248 i‡(
ª˚¡_blocks
 >
	`BUF_READ_AHEAD_RANDOM_THRESHOLD
(
buf_poﬁ
)) {

249 
	`rw_lock_s_u∆ock
(
hash_lock
);

250 
ªad_ahód
;

254 i‡(
b∑ge
 !
NULL
) {

255 
	`rw_lock_s_u∆ock
(
hash_lock
);

262 
ªad_ahód
:

265 i‡(
öside_ibuf
) {

266 
ibuf_mode
 = 
BUF_READ_IBUF_PAGES_ONLY
;

268 
ibuf_mode
 = 
BUF_READ_ANY_PAGE
;

271 
cou¡
 = 0;

273 
i
 = 
low
; i < 
high
; i++) {

277 c⁄° 
∑ge_id_t
 
	`cur_∑ge_id
(
∑ge_id
.
	`•a˚
(), 
i
);

279 i‡(!
	`ibuf_bôm≠_∑ge
(
cur_∑ge_id
, 
∑ge_size
)) {

280 
cou¡
 +
	`buf_ªad_∑ge_low
(&
îr
, 
Ál£
, 
IOReque°
::
DO_NOT_WAKE
, 
ibuf_mode
,

281 
cur_∑ge_id
, 
∑ge_size
, 
Ál£
);

283 i‡(
îr
 =
DB_TABLESPACE_DELETED
) {

284 
ib
::
	`w¨n
(
ER_IB_MSG_140
) << "RandomÑeadaheadÅryingÅo"

286 << 
cur_∑ge_id


298 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

300 i‡(
cou¡
) {

301 
	`DBUG_PRINT
("ib_buf",

302 ("øndomÑód-ahód %uÖages, %u:%u", ()
cou¡
,

303 ()
∑ge_id
.
	`•a˚
(), (Ìage_id.
	`∑ge_no
()));

308 
	`buf_LRU_°©_öc_io
();

310 
buf_poﬁ
->
°©
.
n_ø_∑ges_ªad_∫d
 +
cou¡
;

311 
§v_°©s
.
buf_poﬁ_ªads
.
	`add
(
cou¡
);

312  (
cou¡
);

313 
	}
}

322 
iboﬁ
 
	$buf_ªad_∑ge
(c⁄° 
∑ge_id_t
 &
∑ge_id
, c⁄° 
∑ge_size_t
 &
∑ge_size
) {

323 
ulöt
 
cou¡
;

324 
dbîr_t
 
îr
;

326 
cou¡
 = 
	`buf_ªad_∑ge_low
(&
îr
, 
åue
, 0, 
BUF_READ_ANY_PAGE
, 
∑ge_id
,

327 
∑ge_size
, 
Ál£
);

329 
§v_°©s
.
buf_poﬁ_ªads
.
	`add
(
cou¡
);

331 i‡(
îr
 =
DB_TABLESPACE_DELETED
) {

332 
ib
::
	`îr‹
(
ER_IB_MSG_141
Ë<< "åyögÅÿªadÖagê" << 
∑ge_id


337 
	`buf_LRU_°©_öc_io
();

339  (
cou¡
 > 0);

340 
	}
}

350 
iboﬁ
 
	$buf_ªad_∑ge_background
(c⁄° 
∑ge_id_t
 &
∑ge_id
,

351 c⁄° 
∑ge_size_t
 &
∑ge_size
, 
boﬁ
 
sync
) {

352 
ulöt
 
cou¡
;

353 
dbîr_t
 
îr
;

355 
cou¡
 = 
	`buf_ªad_∑ge_low
(&
îr
, 
sync
,

356 
IOReque°
::
DO_NOT_WAKE
 | IOReque°::
IGNORE_MISSING
,

357 
BUF_READ_ANY_PAGE
, 
∑ge_id
, 
∑ge_size
, 
Ál£
);

359 
§v_°©s
.
buf_poﬁ_ªads
.
	`add
(
cou¡
);

368  (
cou¡
 > 0);

369 
	}
}

397 
ulöt
 
	$buf_ªad_ahód_löór
(c⁄° 
∑ge_id_t
 &
∑ge_id
,

398 c⁄° 
∑ge_size_t
 &
∑ge_size
, 
iboﬁ
 
öside_ibuf
) {

399 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

400 
buf_∑ge_t
 *
b∑ge
;

401 
buf_‰ame_t
 *
‰ame
;

402 
buf_∑ge_t
 *
¥ed_b∑ge
 = 
NULL
;

403 
¥ed_b∑ge_is_ac˚s£d
 = 0;

404 
∑ge_no_t
 
¥ed_off£t
;

405 
∑ge_no_t
 
succ_off£t
;

406 
asc_‹_desc
;

407 
∑ge_no_t
 
√w_off£t
;

408 
ulöt
 
Áû_cou¡
;

409 
∑ge_no_t
 
low
, 
high
;

410 
dbîr_t
 
îr
;

411 
∑ge_no_t
 
i
;

412 c⁄° 
∑ge_no_t
 
buf_ªad_ahód_löór_¨ó
 = 
	`BUF_READ_AHEAD_AREA
(
buf_poﬁ
);

413 
∑ge_no_t
 
thªshﬁd
;

416 i‡(!
§v_ªad_ahód_thªshﬁd
) {

420 i‡(
§v_°¨tup_is_bef‹e_åx_rﬁlback_pha£
) {

425 
low
 = (
∑ge_id
.
	`∑ge_no
(Ë/ 
buf_ªad_ahód_löór_¨ó
) *

426 
buf_ªad_ahód_löór_¨ó
;

427 
high
 = (
∑ge_id
.
	`∑ge_no
(Ë/ 
buf_ªad_ahód_löór_¨ó
 + 1) *

428 
buf_ªad_ahód_löór_¨ó
;

430 i‡((
∑ge_id
.
	`∑ge_no
(Ë!
low
Ë&& (∑ge_id.∑ge_no(Ë!
high
 - 1)) {

436 i‡(
	`ibuf_bôm≠_∑ge
(
∑ge_id
, 
∑ge_size
Ë|| 
	`åx_sys_hdr_∑ge
(page_id)) {

447 
ulöt
 
•a˚_size
;

449 i‡(
fû_•a˚_t
 *
•a˚
 = 
	`fû_•a˚_acquúe
(
∑ge_id
.
	`•a˚
())) {

450 
•a˚_size
 = 
•a˚
->
size
;

452 
	`fû_•a˚_ªÀa£
(
•a˚
);

454 i‡(
high
 > 
•a˚_size
) {

464 
os_rmb
;

466 i‡(
buf_poﬁ
->
n_≥nd_ªads
 >

467 
buf_poﬁ
->
cuº_size
 / 
BUF_READ_AHEAD_PEND_LIMIT
) {

475 
asc_‹_desc
 = 1;

477 i‡(
∑ge_id
.
	`∑ge_no
(Ë=
low
) {

478 
asc_‹_desc
 = -1;

483 
thªshﬁd
 = 
°d
::
	`mö
(
°©ic_ˇ°
<
∑ge_no_t
>(64 - 
§v_ªad_ahód_thªshﬁd
),

484 
	`BUF_READ_AHEAD_AREA
(
buf_poﬁ
));

486 
Áû_cou¡
 = 0;

488 
rw_lock_t
 *
hash_lock
;

490 
i
 = 
low
; i < 
high
; i++) {

491 
b∑ge
 = 
	`buf_∑ge_hash_gë_s_locked
(
buf_poﬁ
, 
	`∑ge_id_t
(
∑ge_id
.
	`•a˚
(), 
i
),

492 &
hash_lock
);

494 i‡(
b∑ge
 =
NULL
 || !
	`buf_∑ge_is_ac˚s£d
(bpage)) {

496 
Áû_cou¡
++;

498 } i‡(
¥ed_b∑ge
) {

507 
ªs
 =

508 
	`ut_ulöt_cmp
(
	`buf_∑ge_is_ac˚s£d
(
b∑ge
), 
¥ed_b∑ge_is_ac˚s£d
);

510 i‡(
ªs
 !0 &&Ñe†!
asc_‹_desc
) {

511 
Áû_cou¡
++;

515 i‡(
Áû_cou¡
 > 
thªshﬁd
) {

517 i‡(
b∑ge
) {

518 
	`rw_lock_s_u∆ock
(
hash_lock
);

523 i‡(
b∑ge
) {

524 i‡(
	`buf_∑ge_is_ac˚s£d
(
b∑ge
)) {

525 
¥ed_b∑ge
 = 
b∑ge
;

526 
¥ed_b∑ge_is_ac˚s£d
 = 
	`buf_∑ge_is_ac˚s£d
(
b∑ge
);

529 
	`rw_lock_s_u∆ock
(
hash_lock
);

536 
b∑ge
 = 
	`buf_∑ge_hash_gë_s_locked
(
buf_poﬁ
, 
∑ge_id
, &
hash_lock
);

538 i‡(
b∑ge
 =
NULL
) {

542 
	`buf_∑ge_gë_°©e
(
b∑ge
)) {

543 
BUF_BLOCK_ZIP_PAGE
:

544 
‰ame
 = 
b∑ge
->
zù
.
d©a
;

546 
BUF_BLOCK_FILE_PAGE
:

547 
‰ame
 = ((
buf_block_t
 *)
b∑ge
)->frame;

550 
ut_îr‹
;

560 
¥ed_off£t
 = 
	`fû_∑ge_gë_¥ev
(
‰ame
);

561 
succ_off£t
 = 
	`fû_∑ge_gë_√xt
(
‰ame
);

563 
	`rw_lock_s_u∆ock
(
hash_lock
);

565 i‡((
∑ge_id
.
	`∑ge_no
(Ë=
low
Ë&& (
succ_off£t
 ==Öage_id.page_no() + 1)) {

567 
√w_off£t
 = 
¥ed_off£t
;

569 } i‡((
∑ge_id
.
	`∑ge_no
(Ë=
high
 - 1) &&

570 (
¥ed_off£t
 =
∑ge_id
.
	`∑ge_no
() - 1)) {

572 
√w_off£t
 = 
succ_off£t
;

579 
low
 = (
√w_off£t
 / 
buf_ªad_ahód_löór_¨ó
) * buf_read_ahead_linear_area;

580 
high
 = (
√w_off£t
 / 
buf_ªad_ahód_löór_¨ó
 + 1) *

581 
buf_ªad_ahód_löór_¨ó
;

583 i‡((
√w_off£t
 !
low
Ë&& (√w_off£à!
high
 - 1)) {

589 i‡(
high
 > 
•a˚_size
) {

595 
ulöt
 
cou¡
 = 0;

599 
ulöt
 
ibuf_mode
;

601 
ibuf_mode
 = 
öside_ibuf
 ? 
BUF_READ_IBUF_PAGES_ONLY
 : 
BUF_READ_ANY_PAGE
;

607 
	`os_aio_simuœãd_put_ªad_thªads_to_¶ìp
();

609 
i
 = 
low
; i < 
high
; i++) {

613 c⁄° 
∑ge_id_t
 
	`cur_∑ge_id
(
∑ge_id
.
	`•a˚
(), 
i
);

615 i‡(!
	`ibuf_bôm≠_∑ge
(
cur_∑ge_id
, 
∑ge_size
)) {

616 
cou¡
 +
	`buf_ªad_∑ge_low
(&
îr
, 
Ál£
, 
IOReque°
::
DO_NOT_WAKE
, 
ibuf_mode
,

617 
cur_∑ge_id
, 
∑ge_size
, 
Ál£
);

619 i‡(
îr
 =
DB_TABLESPACE_DELETED
) {

620 
ib
::
	`w¨n
(
ER_IB_MSG_142
) << "linearÑeadaheadÅryingÅo"

622 << 
	`∑ge_id_t
(
∑ge_id
.
	`•a˚
(), 
i
)

633 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

635 i‡(
cou¡
) {

636 
	`DBUG_PRINT
("ib_buf", ("löó∏ªad-ahód %luÖages, " 
UINT32PF
 ":" UINT32PF,

637 
cou¡
, 
∑ge_id
.
	`•a˚
(),Öage_id.
	`∑ge_no
()));

642 
	`buf_LRU_°©_öc_io
();

644 
buf_poﬁ
->
°©
.
n_ø_∑ges_ªad
 +
cou¡
;

645  (
cou¡
);

646 
	}
}

651 
	$buf_ªad_ibuf_mîge_∑ges
(

652 
boﬁ
 
sync
,

657 c⁄° 
•a˚_id_t
 *
•a˚_ids
,

658 c⁄° 
∑ge_no_t
 *
∑ge_nos
,

662 
ulöt
 
n_°‹ed
)

665 #ifde‡
UNIV_IBUF_DEBUG


666 
	`ut_a
(
n_°‹ed
 < 
UNIV_PAGE_SIZE
);

669 
ulöt
 
i
 = 0; i < 
n_°‹ed
; i++) {

670 c⁄° 
∑ge_id_t
 
	`∑ge_id
(
•a˚_ids
[
i
], 
∑ge_nos
[i]);

672 
buf_poﬁ_t
 *
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
∑ge_id
);

674 
boﬁ
 
found
;

675 c⁄° 
∑ge_size_t
 
	`∑ge_size
(
	`fû_•a˚_gë_∑ge_size
(
•a˚_ids
[
i
], &
found
));

677 i‡(!
found
) {

680 
	`ibuf_mîge_‹_dñëe_f‹_∑ge
(
NULL
, 
∑ge_id
, NULL, 
FALSE
);

684 
os_rmb
;

685 
buf_poﬁ
->
n_≥nd_ªads
 >

686 
buf_poﬁ
->
cuº_size
 / 
BUF_READ_AHEAD_PEND_LIMIT
) {

687 
	`os_thªad_¶ìp
(500000);

690 
dbîr_t
 
îr
;

692 
	`buf_ªad_∑ge_low
(&
îr
, 
sync
 && (
i
 + 1 =
n_°‹ed
),

693 
IOReque°
::
IGNORE_MISSING
, 
BUF_READ_ANY_PAGE
, 
∑ge_id
,

694 
∑ge_size
, 
åue
);

696 i‡(
îr
 =
DB_TABLESPACE_DELETED
) {

699 
	`ibuf_mîge_‹_dñëe_f‹_∑ge
(
NULL
, 
∑ge_id
, &
∑ge_size
, 
FALSE
);

703 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

705 i‡(
n_°‹ed
) {

706 
	`DBUG_PRINT
("ib_buf", ("ibuf mergeÑead-ahead %uÖages, space %u",

707 (
n_°‹ed
), (
•a˚_ids
[0])));

709 
	}
}

719 
	$buf_ªad_ªcv_∑ges
(
boﬁ
 
sync
, 
•a˚_id_t
 
•a˚_id
,

720 c⁄° 
∑ge_no_t
 *
∑ge_nos
, 
ulöt
 
n_°‹ed
) {

721 
ulöt
 
cou¡
;

722 
fû_•a˚_t
 *
•a˚
 = 
	`fû_•a˚_gë
(
•a˚_id
);

724 i‡(
•a˚
 =
NULL
) {

729 
	`fû_•a˚_›í_if_√eded
(
•a˚
);

731 autÿ
ªq_size
 = 
∑ge_nos
[
n_°‹ed
 - 1] + 1;

735 i‡(
ªcv_sys
->
is_˛⁄ed_db
 && 
•a˚
->
size
 < 
ªq_size
) {

737 i‡(
ªq_size
 > 
FSP_EXTENT_SIZE
) {

738 
ªq_size
 = 
	`ut_ˇlc_Æign
‘eq_size, 
FSP_EXTENT_SIZE
);

741 
ib
::
	`öfo
(
ER_IB_MSG_143
Ë<< "ExãndögÅabÀ•a˚ : " << 
•a˚
->
id


742 << " s∑˚Çame: " << 
•a˚
->
«me


743 << " fromÖagênumbî: " << 
•a˚
->
size
 << "Öages"

744 << "Åÿ" << 
ªq_size
 << "Öages"

745 << " f‹Öagênumbî: " << 
∑ge_nos
[
n_°‹ed
 - 1]

748 i‡(!
	`fû_•a˚_exãnd
(
•a˚
, 
ªq_size
)) {

749 
ib
::
	`îr‹
(
ER_IB_MSG_144
)

750 << "CouldÇŸÉxãndÅabÀ•a˚: " << 
•a˚
->
id


751 << " s∑˚Çame: " << 
•a˚
->
«me
 << "Åÿ" << 
ªq_size
 << "Öages"

756 c⁄° 
∑ge_size_t
 
	`∑ge_size
(
•a˚
->
Êags
);

758 
ulöt
 
i
 = 0; i < 
n_°‹ed
; i++) {

759 
buf_poﬁ_t
 *
buf_poﬁ
;

760 c⁄° 
∑ge_id_t
 
	`cur_∑ge_id
(
•a˚_id
, 
∑ge_nos
[
i
]);

762 
cou¡
 = 0;

764 
buf_poﬁ
 = 
	`buf_poﬁ_gë
(
cur_∑ge_id
);

765 
os_rmb
;

767 
buf_poﬁ
->
n_≥nd_ªads
 >
ªcv_n_poﬁ_‰ì_‰ames
 / 2) {

768 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

769 
	`os_thªad_¶ìp
(10000);

771 
cou¡
++;

773 i‡(!(
cou¡
 % 1000)) {

774 
ib
::
	`îr‹
(
ER_IB_MSG_145
)

775 << "Waôed f‹ " << 
cou¡
 / 100 << " seconds for "

776 << 
buf_poﬁ
->
n_≥nd_ªads
 << "ÖendingÑeads";

780 
dbîr_t
 
îr
;

782 i‡((
i
 + 1 =
n_°‹ed
Ë&& 
sync
) {

783 
	`buf_ªad_∑ge_low
(&
îr
, 
åue
, 0, 
BUF_READ_ANY_PAGE
, 
cur_∑ge_id
,

784 
∑ge_size
, 
åue
);

786 
	`buf_ªad_∑ge_low
(&
îr
, 
Ál£
, 
IOReque°
::
DO_NOT_WAKE
, 
BUF_READ_ANY_PAGE
,

787 
cur_∑ge_id
, 
∑ge_size
, 
åue
);

791 
	`os_aio_simuœãd_wake_h™dÀr_thªads
();

793 
	`DBUG_PRINT
("ib_buf", ("ªcovîyÑód-ahód (%uÖages)", (
n_°‹ed
)));

794 
	}
}

	@calclock.h

1 #i‚de‡
CALCLOCK_H


2 
	#CALCLOCK_H


	)

3 
	#BILLION
 1000000000

	)

4 
	#ˇl˛ock
(
timevÆue
, 
tŸÆ_time
, 
tŸÆ_cou¡
) do {\

5 
timedñay
, 
ãmp
, 
ãmp_n
;\

6 
time•ec
 *
my˛ock
 = (time•ec*)
timevÆue
;\

7 if(
my˛ock
[1].
tv_n£c
 >= myclock[0].tv_nsec){\

8 
ãmp
 = 
my˛ock
[1].
tv_£c
 - myclock[0].tv_sec;\

9 
ãmp_n
 = 
my˛ock
[1].
tv_n£c
 - myclock[0].tv_nsec;\

10 
timedñay
 = 
BILLION
 * 
ãmp
 + 
ãmp_n
;\

12 
ãmp
 = 
my˛ock
[1].
tv_£c
 - myclock[0].tv_sec - 1;\

13 
ãmp_n
 = 
BILLION
 + 
my˛ock
[1].
tv_n£c
 - myclock[0].tv_nsec;\

14 
timedñay
 = 
BILLION
 * 
ãmp
 + 
ãmp_n
; \

16 
	`__sync_„tch_™d_add
(
tŸÆ_time
, 
timedñay
); \

17 
	`__sync_„tch_™d_add
(
tŸÆ_cou¡
, 1); \

18 } 0)

	)

	@checksum.cc

33 
	~<sys/ty≥s.h
>

34 
	~<zlib.h
>

36 
	~"buf0buf.h
"

37 
	~"buf0ty≥s.h
"

38 
	~"fû0fû.h
"

39 
	~"mach0d©a.h
"

40 
	~"my_dbug.h
"

41 
	~"∑ge0size.h
"

42 
	~"§v0§v.h
"

43 
	~"univ.i
"

44 
	~"ut0¸c32.h
"

45 
	~"ut0∫d.h
"

46 #ifde‡
UNIV_HOTBACKUP


47 
	~"buf0checksum.h
"

54 
ul⁄g
 
	g§v_checksum_Æg‹ôhm
 = 
SRV_CHECKSUM_ALGORITHM_INNODB
;

57 
boﬁ
 
	gÀgacy_big_ídün_checksum
 = 
Ál£
;

68 
uöt32_t
 
	$buf_ˇlc_∑ge_¸c32
(c⁄° 
byã
 *
∑ge
,

69 
boﬁ
 
u£_Àgacy_big_ídün
 ) {

78 
ut_¸c32_func_t
 
¸c32_func
 =

79 
u£_Àgacy_big_ídün
 ? 
ut_¸c32_Àgacy_big_ídün
 : 
ut_¸c32
;

81 c⁄° 
uöt32_t
 
c1
 = 
	`¸c32_func
(
∑ge
 + 
FIL_PAGE_OFFSET
,

82 
FIL_PAGE_FILE_FLUSH_LSN
 - 
FIL_PAGE_OFFSET
);

84 c⁄° 
uöt32_t
 
c2
 =

85 
	`¸c32_func
(
∑ge
 + 
FIL_PAGE_DATA
,

86 
UNIV_PAGE_SIZE
 - 
FIL_PAGE_DATA
 - 
FIL_PAGE_END_LSN_OLD_CHKSUM
);

88  (
c1
 ^ 
c2
);

89 
	}
}

95 
ulöt
 
	$buf_ˇlc_∑ge_√w_checksum
(c⁄° 
byã
 *
∑ge
)

97 
ulöt
 
checksum
;

107 
checksum
 =

108 
	`ut_fﬁd_bö¨y
(
∑ge
 + 
FIL_PAGE_OFFSET
,

109 
FIL_PAGE_FILE_FLUSH_LSN
 - 
FIL_PAGE_OFFSET
) +

110 
	`ut_fﬁd_bö¨y
(
∑ge
 + 
FIL_PAGE_DATA
, 
UNIV_PAGE_SIZE
 - FIL_PAGE_DATA -

111 
FIL_PAGE_END_LSN_OLD_CHKSUM
);

112 
checksum
 = checksum & 0xFFFFFFFFUL;

114  (
checksum
);

115 
	}
}

124 
ulöt
 
	$buf_ˇlc_∑ge_ﬁd_checksum
(c⁄° 
byã
 *
∑ge
)

126 
ulöt
 
checksum
;

128 
checksum
 = 
	`ut_fﬁd_bö¨y
(
∑ge
, 
FIL_PAGE_FILE_FLUSH_LSN
);

130 
checksum
 = checksum & 0xFFFFFFFFUL;

132  (
checksum
);

133 
	}
}

137 c⁄° *
	$buf_checksum_Æg‹ôhm_«me
(

138 
§v_checksum_Æg‹ôhm_t
 
Ægo
)

140 
Ægo
) {

141 
SRV_CHECKSUM_ALGORITHM_CRC32
:

143 
SRV_CHECKSUM_ALGORITHM_STRICT_CRC32
:

145 
SRV_CHECKSUM_ALGORITHM_INNODB
:

147 
SRV_CHECKSUM_ALGORITHM_STRICT_INNODB
:

149 
SRV_CHECKSUM_ALGORITHM_NONE
:

151 
SRV_CHECKSUM_ALGORITHM_STRICT_NONE
:

155 
ut_îr‹
;

156 
	}
}

162 
ölöe
 
	$buf_∑ge_l¢_check
(
boﬁ
 
check_l¢
, c⁄° 
byã
 *
ªad_buf
) {

163 #i‡!
	`deföed
(
UNIV_HOTBACKUP
Ë&& !deföed(
UNIV_LIBRARY
)

164 i‡(
check_l¢
 && 
ªcv_l¢_checks_⁄
) {

165 
l¢_t
 
cuºít_l¢
;

166 c⁄° 
l¢_t
 
∑ge_l¢
 = 
	`mach_ªad_‰om_8
(
ªad_buf
 + 
FIL_PAGE_LSN
);

170 
cuºít_l¢
 = 
	`log_gë_l¢
(*
log_sys
);

172 i‡(
cuºít_l¢
 < 
∑ge_l¢
) {

173 c⁄° 
•a˚_id_t
 
•a˚_id
 =

174 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
FIL_PAGE_SPACE_ID
);

175 c⁄° 
∑ge_no_t
 
∑ge_no
 = 
	`mach_ªad_‰om_4
(
ªad_buf
 + 
FIL_PAGE_OFFSET
);

177 autÿ
•a˚
 = 
	`fû_•a˚_gë
(
•a˚_id
);

179 #ifde‡
UNIV_NO_ERR_MSGS


180 
ib
::
	`îr‹
()

182 
ib
::
	`îr‹
(
ER_IB_MSG_146
)

184 << "TabÀ•a˚ '" << 
•a˚
->
«me
 << "'"

185 << " Pagê" << 
	`∑ge_id_t
(
•a˚_id
, 
∑ge_no
) << "Üog sequenceÇumber "

186 << 
∑ge_l¢
 << " is inÅhe future! Current system"

187 << "Üog sequí˚Çumbî " << 
cuºít_l¢
 << ".";

189 #ifde‡
UNIV_NO_ERR_MSGS


190 
ib
::
	`îr‹
()

192 
ib
::
	`îr‹
(
ER_IB_MSG_147
)

195 << "ÅabÀ•a˚ buànŸÅhêI¬oDBÜog fûes. " << 
FORCE_RECOVERY_MSG
;

199 
	}
}

206 
boﬁ
 
	gBlockRï‹ãr
::
	$is_checksum_vÆid_önodb
(

207 
ulöt
 
checksum_fõld1
, ulöà
checksum_fõld2
,

208 c⁄° 
§v_checksum_Æg‹ôhm_t
 
Ægo
) const {

219 
ulöt
 
ﬁd_checksum
 = 
	`buf_ˇlc_∑ge_ﬁd_checksum
(
m_ªad_buf
);

220 
ulöt
 
√w_checksum
 = 
	`buf_ˇlc_∑ge_√w_checksum
(
m_ªad_buf
);

222 
	`¥öt_önodb_checksum
(
ﬁd_checksum
, 
√w_checksum
, 
checksum_fõld1
,

223 
checksum_fõld2
, 
Ægo
);

225 i‡(
checksum_fõld2
 !
	`mach_ªad_‰om_4
(
m_ªad_buf
 + 
FIL_PAGE_LSN
) &&

226 
checksum_fõld2
 !
ﬁd_checksum
) {

227  (
Ál£
);

235  (
checksum_fõld1
 =0 || checksum_fõld1 =
√w_checksum
);

236 
	}
}

243 
boﬁ
 
	gBlockRï‹ãr
::
	$is_checksum_vÆid_n⁄e
(

244 
ulöt
 
checksum_fõld1
, ulöà
checksum_fõld2
,

245 c⁄° 
§v_checksum_Æg‹ôhm_t
 
Ægo
) const {

246 
	`¥öt_°ri˘_n⁄e
(
checksum_fõld1
, 
checksum_fõld2
, 
Ægo
);

248  (
checksum_fõld1
 =
checksum_fõld2
 &&

249 
checksum_fõld1
 =
BUF_NO_CHECKSUM_MAGIC
);

250 
	}
}

258 
boﬁ
 
	gBlockRï‹ãr
::
	$is_checksum_vÆid_¸c32
(
ulöt
 
checksum_fõld1
,

259 
ulöt
 
checksum_fõld2
,

260 c⁄° 
§v_checksum_Æg‹ôhm_t
 
Ægo
,

261 
boﬁ
 
u£_Àgacy_big_ídün
) const {

262 i‡(
checksum_fõld1
 !
checksum_fõld2
) {

263  (
Ál£
);

266 
uöt32_t
 
¸c32
 = 
	`buf_ˇlc_∑ge_¸c32
(
m_ªad_buf
, 
u£_Àgacy_big_ídün
);

268 
	`¥öt_°ri˘_¸c32
(
checksum_fõld1
, 
checksum_fõld2
, 
¸c32
, 
Ægo
);

270  (
checksum_fõld1
 =
¸c32
);

271 
	}
}

276 
boﬁ
 
	gBlockRï‹ãr
::
	$is_c‹ru±ed
() const {

277 
ulöt
 
checksum_fõld1
;

278 
ulöt
 
checksum_fõld2
;

280 i‡(!
m_∑ge_size
.
	`is_com¥es£d
() &&

281 
	`memcmp
(

282 
m_ªad_buf
 + 
FIL_PAGE_LSN
 + 4,

283 
m_ªad_buf
 + 
m_∑ge_size
.
	`logiˇl
(Ë- 
FIL_PAGE_END_LSN_OLD_CHKSUM
 + 4,

288  (
åue
);

291 
	`buf_∑ge_l¢_check
(
m_check_l¢
, 
m_ªad_buf
);

295 i‡(
§v_checksum_Æg‹ôhm
 =
SRV_CHECKSUM_ALGORITHM_NONE
 ||

296 
m_skù_checksum
) {

297  (
Ál£
);

300 i‡(
m_∑ge_size
.
	`is_com¥es£d
()) {

301  (!
	`vîify_zù_checksum
());

304 
checksum_fõld1
 = 
	`mach_ªad_‰om_4
(
m_ªad_buf
 + 
FIL_PAGE_SPACE_OR_CHKSUM
);

306 
checksum_fõld2
 = 
	`mach_ªad_‰om_4
(
m_ªad_buf
 + 
m_∑ge_size
.
	`logiˇl
() -

307 
FIL_PAGE_END_LSN_OLD_CHKSUM
);

309 #i‡
FIL_PAGE_LSN
 % 8

314 i‡(
checksum_fõld1
 =0 && 
checksum_fõld2
 == 0 &&

315 *
ªöãΩªt_ˇ°
<c⁄° 
ib_uöt64_t
 *>(
m_ªad_buf
 + 
FIL_PAGE_LSN
) == 0) {

318 
boﬁ
 
em±y
 = 
åue
;

319 #i‚de‡
UNIV_HOTBACKUP


320 
ulöt
 
i
 = 0; i < 
m_∑ge_size
.
	`logiˇl
(); i++) {

325 i‡((
i
 < 
FIL_PAGE_FILE_FLUSH_LSN
 ||

326 
i
 >
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
) &&

327 
m_ªad_buf
[
i
] != 0) {

328 
em±y
 = 
Ál£
;

333 
	`ªp‹t_em±y_∑ge
(
em±y
);

336  (!
em±y
);

339 c⁄° 
∑ge_id_t
 
	`∑ge_id
(
	`mach_ªad_‰om_4
(
m_ªad_buf
 + 
FIL_PAGE_SPACE_ID
),

340 
	`mach_ªad_‰om_4
(
m_ªad_buf
 + 
FIL_PAGE_OFFSET
));

342 
	`DBUG_EXECUTE_IF
("buf_∑ge_imp‹t_c‹ru±_Áûuª",  (
åue
););

343 c⁄° 
§v_checksum_Æg‹ôhm_t
 
cuº_Ægo
 =

344 
°©ic_ˇ°
<
§v_checksum_Æg‹ôhm_t
>(
§v_checksum_Æg‹ôhm
);

346 
boﬁ
 
Àgacy_checksum_checked
 = 
Ál£
;

348 
cuº_Ægo
) {

349 
SRV_CHECKSUM_ALGORITHM_CRC32
:

350 
SRV_CHECKSUM_ALGORITHM_STRICT_CRC32
:

352 i‡(
	`is_checksum_vÆid_¸c32
(
checksum_fõld1
, 
checksum_fõld2
, 
cuº_Ægo
,

353 
Ál£
)) {

354  (
Ál£
);

357 i‡(
	`is_checksum_vÆid_n⁄e
(
checksum_fõld1
, 
checksum_fõld2
, 
cuº_Ægo
)) {

358 #i‚de‡
UNIV_HOTBACKUP


359 i‡(
cuº_Ægo
 =
SRV_CHECKSUM_ALGORITHM_STRICT_CRC32
) {

360 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_NONE
,

361 
∑ge_id
);

364 
	`¥öt_¸c32_checksum
(
checksum_fõld1
, 
checksum_fõld2
);

366  (
Ál£
);

374 i‡(
Àgacy_big_ídün_checksum
) {

375 i‡(
	`is_checksum_vÆid_¸c32
(
checksum_fõld1
, 
checksum_fõld2
, 
cuº_Ægo
,

376 
åue
)) {

377  (
Ál£
);

379 
Àgacy_checksum_checked
 = 
åue
;

382 i‡(
	`is_checksum_vÆid_önodb
(
checksum_fõld1
, 
checksum_fõld2
,

383 
cuº_Ægo
)) {

384 #i‚de‡
UNIV_HOTBACKUP


385 i‡(
cuº_Ægo
 =
SRV_CHECKSUM_ALGORITHM_STRICT_CRC32
) {

386 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_INNODB
,

387 
∑ge_id
);

390  (
Ál£
);

394 i‡(!
Àgacy_checksum_checked
 &&

395 
	`is_checksum_vÆid_¸c32
(
checksum_fõld1
, 
checksum_fõld2
, 
cuº_Ægo
,

396 
åue
)) {

397 
Àgacy_big_ídün_checksum
 = 
åue
;

398  (
Ál£
);

401 
	`¥öt_¸c32_Áû
();

402  (
åue
);

404 
SRV_CHECKSUM_ALGORITHM_INNODB
:

405 
SRV_CHECKSUM_ALGORITHM_STRICT_INNODB
:

407 i‡(
	`is_checksum_vÆid_önodb
(
checksum_fõld1
, 
checksum_fõld2
,

408 
cuº_Ægo
)) {

409  (
Ál£
);

412 i‡(
	`is_checksum_vÆid_n⁄e
(
checksum_fõld1
, 
checksum_fõld2
, 
cuº_Ægo
)) {

413 #i‚de‡
UNIV_HOTBACKUP


414 i‡(
cuº_Ægo
 =
SRV_CHECKSUM_ALGORITHM_STRICT_INNODB
) {

415 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_NONE
,

416 
∑ge_id
);

419 
	`¥öt_°ri˘_önodb
(
checksum_fõld1
, 
checksum_fõld2
);

421  (
Ál£
);

424 i‡(
	`is_checksum_vÆid_¸c32
(
checksum_fõld1
, 
checksum_fõld2
, 
cuº_Ægo
,

425 
Ál£
) ||

426 
	`is_checksum_vÆid_¸c32
(
checksum_fõld1
, 
checksum_fõld2
, 
cuº_Ægo
,

427 
åue
)) {

428 #i‚de‡
UNIV_HOTBACKUP


429 i‡(
cuº_Ægo
 =
SRV_CHECKSUM_ALGORITHM_STRICT_INNODB
) {

430 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_CRC32
,

431 
∑ge_id
);

435  (
Ál£
);

438 
	`¥öt_önodb_Áû
();

439  (
åue
);

441 
SRV_CHECKSUM_ALGORITHM_STRICT_NONE
:

443 i‡(
	`is_checksum_vÆid_n⁄e
(
checksum_fõld1
, 
checksum_fõld2
, 
cuº_Ægo
)) {

444  (
Ál£
);

447 i‡(
	`is_checksum_vÆid_¸c32
(
checksum_fõld1
, 
checksum_fõld2
, 
cuº_Ægo
,

448 
Ál£
) ||

449 
	`is_checksum_vÆid_¸c32
(
checksum_fõld1
, 
checksum_fõld2
, 
cuº_Ægo
,

450 
åue
)) {

451 #i‚de‡
UNIV_HOTBACKUP


452 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_CRC32
,

453 
∑ge_id
);

455  (
Ál£
);

458 i‡(
	`is_checksum_vÆid_önodb
(
checksum_fõld1
, 
checksum_fõld2
,

459 
cuº_Ægo
)) {

460 #i‚de‡
UNIV_HOTBACKUP


461 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_INNODB
,

462 
∑ge_id
);

464  (
Ál£
);

467 
	`¥öt_n⁄e_Áû
();

468  (
åue
);

470 
SRV_CHECKSUM_ALGORITHM_NONE
:

477 
ut_îr‹
;

478  (
Ál£
);

479 
	}
}

488 
uöt32_t
 
	gBlockRï‹ãr
::
	$ˇlc_zù_checksum
(

489 
§v_checksum_Æg‹ôhm_t
 
Ægo
,

490 
boﬁ
 
u£_Àgacy_big_ídün
 ) const {

491  (
	`ˇlc_zù_checksum
(
m_ªad_buf
, 
m_∑ge_size
.
	`physiˇl
(), 
Ægo
,

492 
u£_Àgacy_big_ídün
));

493 
	}
}

506 
uöt32_t
 
	gBlockRï‹ãr
::
	$ˇlc_zù_checksum
(

507 c⁄° 
byã
 *
ªad_buf
, 
ulöt
 
phys_∑ge_size
, 
§v_checksum_Æg‹ôhm_t
 
Ægo
,

508 
boﬁ
 
u£_Àgacy_big_ídün
 ) const {

509 
uL⁄g
 
adÀr
;

510 
ib_uöt32_t
 
¸c32
;

511 c⁄° 
Byãf
 *
s
 = 
ªad_buf
;

512 c⁄° 
ulöt
 
size
 = 
phys_∑ge_size
;

517 
Ægo
) {

518 
SRV_CHECKSUM_ALGORITHM_CRC32
:

519 
SRV_CHECKSUM_ALGORITHM_STRICT_CRC32
:

521 
	`ut_ad
(
size
 > 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
);

523 
¸c32
 = 
	`ut_¸c32
(
s
 + 
FIL_PAGE_OFFSET
, 
FIL_PAGE_LSN
 - FIL_PAGE_OFFSET) ^

524 
	`ut_¸c32
(
s
 + 
FIL_PAGE_TYPE
, 2) ^

525 
	`ut_¸c32
(
s
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
,

526 
size
 - 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
);

528  (
¸c32
);

529 
SRV_CHECKSUM_ALGORITHM_INNODB
:

530 
SRV_CHECKSUM_ALGORITHM_STRICT_INNODB
:

531 
	`ut_ad
(
size
 > 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
);

533 
adÀr
 = 
	`adÀr32
(0L, 
s
 + 
FIL_PAGE_OFFSET
, 
FIL_PAGE_LSN
 - FIL_PAGE_OFFSET);

534 
adÀr
 = 
	`adÀr32
◊dÀr, 
s
 + 
FIL_PAGE_TYPE
, 2);

535 
adÀr
 =

536 
	`adÀr32
(
adÀr
, 
s
 + 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
,

537 
°©ic_ˇ°
<
uI¡
>(
size
Ë- 
FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID
);

539  ((
ib_uöt32_t
)
adÀr
);

540 
SRV_CHECKSUM_ALGORITHM_NONE
:

541 
SRV_CHECKSUM_ALGORITHM_STRICT_NONE
:

542  (
BUF_NO_CHECKSUM_MAGIC
);

547 
ut_îr‹
;

548 
	}
}

555 
boﬁ
 
	gBlockRï‹ãr
::
	$vîify_zù_checksum
() const {

556 c⁄° 
uöt32_t
 
°‹ed
 = 
°©ic_ˇ°
<uint32_t>(

557 
	`mach_ªad_‰om_4
(
m_ªad_buf
 + 
FIL_PAGE_SPACE_OR_CHKSUM
));

559 #i‡
FIL_PAGE_LSN
 % 8

564 i‡(
°‹ed
 == 0 &&

565 *
ªöãΩªt_ˇ°
<c⁄° 
ib_uöt64_t
 *>(
m_ªad_buf
 + 
FIL_PAGE_LSN
) == 0) {

568 
ulöt
 
i
;

569 
boﬁ
 
em±y
 = 
åue
;

570 
i
 = 0; i < 
m_∑ge_size
.
	`physiˇl
(); i++) {

571 i‡(*((c⁄° *)
m_ªad_buf
 + 
i
) != 0) {

572 
em±y
 = 
Ál£
;

577 
	`ªp‹t_em±y_∑ge
(
em±y
);

580  (
em±y
);

583 c⁄° 
§v_checksum_Æg‹ôhm_t
 
cuº_Ægo
 =

584 
°©ic_ˇ°
<
§v_checksum_Æg‹ôhm_t
>(
§v_checksum_Æg‹ôhm
);

585 i‡(
cuº_Ægo
 =
SRV_CHECKSUM_ALGORITHM_NONE
) {

586  (
åue
);

589 
∑ge_no_t
 
∑ge_no
 = 
	`mach_ªad_‰om_4
(
m_ªad_buf
 + 
FIL_PAGE_OFFSET
);

590 
•a˚_id_t
 
•a˚_id
 = 
	`mach_ªad_‰om_4
(
m_ªad_buf
 + 
FIL_PAGE_SPACE_ID
);

591 c⁄° 
∑ge_id_t
 
	`∑ge_id
(
•a˚_id
, 
∑ge_no
);

593 c⁄° 
uöt32_t
 
ˇlc
 = 
	`ˇlc_zù_checksum
(
cuº_Ægo
);

595 
	`¥öt_com¥es£d_checksum
(
ˇlc
, 
°‹ed
);

597 i‡(
°‹ed
 =
ˇlc
) {

598  (
åue
);

601 
boﬁ
 
Àgacy_checksum_checked
 = 
Ál£
;

603 
cuº_Ægo
) {

604 
SRV_CHECKSUM_ALGORITHM_STRICT_CRC32
:

605 
SRV_CHECKSUM_ALGORITHM_CRC32
:

607 i‡(
°‹ed
 =
BUF_NO_CHECKSUM_MAGIC
) {

608 i‡(
cuº_Ægo
 =
SRV_CHECKSUM_ALGORITHM_STRICT_CRC32
) {

609 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_NONE
,

610 
∑ge_id
);

613  (
åue
);

621 i‡(
Àgacy_big_ídün_checksum
) {

622 i‡(
°‹ed
 =
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_CRC32
, 
åue
)) {

623  (
åue
);

625 
Àgacy_checksum_checked
 = 
åue
;

628 i‡(
°‹ed
 =
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_INNODB
)) {

629 i‡(
cuº_Ægo
 =
SRV_CHECKSUM_ALGORITHM_STRICT_CRC32
) {

630 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_INNODB
,

631 
∑ge_id
);

634  (
åue
);

638 i‡(!
Àgacy_checksum_checked
 &&

639 
°‹ed
 =
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_CRC32
, 
åue
)) {

644 
Àgacy_big_ídün_checksum
 = 
åue
;

645  (
åue
);

649 
SRV_CHECKSUM_ALGORITHM_STRICT_INNODB
:

650 
SRV_CHECKSUM_ALGORITHM_INNODB
:

652 i‡(
°‹ed
 =
BUF_NO_CHECKSUM_MAGIC
) {

653 i‡(
cuº_Ægo
 =
SRV_CHECKSUM_ALGORITHM_STRICT_INNODB
) {

654 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_NONE
,

655 
∑ge_id
);

657  (
åue
);

660 i‡(
°‹ed
 =
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_CRC32
) ||

661 
°‹ed
 =
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_CRC32
, 
åue
)) {

662 i‡(
cuº_Ægo
 =
SRV_CHECKSUM_ALGORITHM_STRICT_INNODB
) {

663 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_CRC32
,

664 
∑ge_id
);

666  (
åue
);

670 
SRV_CHECKSUM_ALGORITHM_STRICT_NONE
:

672 i‡(
°‹ed
 =
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_CRC32
) ||

673 
°‹ed
 =
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_CRC32
, 
åue
)) {

674 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_CRC32
,

675 
∑ge_id
);

676  (
åue
);

679 i‡(
°‹ed
 =
	`ˇlc_zù_checksum
(
SRV_CHECKSUM_ALGORITHM_INNODB
)) {

680 
	`∑ge_w¨n_°ri˘_checksum
(
cuº_Ægo
, 
SRV_CHECKSUM_ALGORITHM_INNODB
,

681 
∑ge_id
);

682  (
åue
);

686 
SRV_CHECKSUM_ALGORITHM_NONE
:

687 
ut_îr‹
;

692  (
Ál£
);

693 
	}
}

700 
	gBlockRï‹ãr
::
	$∑ge_w¨n_°ri˘_checksum
(

701 
§v_checksum_Æg‹ôhm_t
 
cuº_Ægo
, srv_checksum_Æg‹ôhm_à
∑ge_checksum
,

702 c⁄° 
∑ge_id_t
 &
∑ge_id
) const {

703 
§v_checksum_Æg‹ôhm_t
 
cuº_Ægo_n⁄°ri˘
;

704 
cuº_Ægo
) {

705 
SRV_CHECKSUM_ALGORITHM_STRICT_CRC32
:

706 
cuº_Ægo_n⁄°ri˘
 = 
SRV_CHECKSUM_ALGORITHM_CRC32
;

708 
SRV_CHECKSUM_ALGORITHM_STRICT_INNODB
:

709 
cuº_Ægo_n⁄°ri˘
 = 
SRV_CHECKSUM_ALGORITHM_INNODB
;

711 
SRV_CHECKSUM_ALGORITHM_STRICT_NONE
:

712 
cuº_Ægo_n⁄°ri˘
 = 
SRV_CHECKSUM_ALGORITHM_NONE
;

715 
ut_îr‹
;

718 #ifde‡
UNIV_NO_ERR_MSGS


719 
ib
::
	`w¨n
()

721 
ib
::
	`w¨n
(
ER_IB_MSG_148
)

725 << 
	`buf_checksum_Æg‹ôhm_«me
(
cuº_Ægo
) << "\""

726 << " buàthê∑gê" << 
∑ge_id
 << " containsá valid checksum \""

727 << 
	`buf_checksum_Æg‹ôhm_«me
(
∑ge_checksum
) << "\". "

730 << 
	`buf_checksum_Æg‹ôhm_«me
(
cuº_Ægo_n⁄°ri˘
)

733 << 
	`buf_checksum_Æg‹ôhm_«me
(
cuº_Ægo_n⁄°ri˘
) << "\" checksum.";

734 
	}
}

740 
	g°d
::
o°ªam
 &
›î©‹
<<(
°d
::o°ªam &
out
, c⁄° 
	g∑ge_id_t
 &
	g∑ge_id
) {

741 
	gout
 << "[∑gêid: s∑˚=" << 
	g∑ge_id
.
	gm_•a˚


742 << ",Öagênumbî=" << 
	g∑ge_id
.
	gm_∑ge_no
 << "]";

743  (
	gout
);

	@/usr/include/errno.h

22 #i‚def 
_ERRNO_H


26 #i‚def 
__√ed_Em©h


27 
	#_ERRNO_H
 1

	)

28 
	~<„©uªs.h
>

31 
	g__BEGIN_DECLS


35 
	~<bôs/î∫o.h
>

36 #unde‡
__√ed_Em©h


38 #ifdef 
_ERRNO_H


45 #i‚def 
î∫o


46 
î∫o
;

49 #ifde‡
__USE_GNU


54 *
¥ogøm_övoˇti⁄_«me
, *
¥ogøm_övoˇti⁄_sh‹t_«me
;

58 
	g__END_DECLS


66 #i‡
deföed
 
__USE_GNU
 || deföed 
__√ed_îr‹_t


67 #i‚de‡
__îr‹_t_deföed


68 
	tîr‹_t
;

69 
	#__îr‹_t_deföed
 1

	)

71 #unde‡
__√ed_îr‹_t


	@/usr/include/math.h

23 #i‚def 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


31 
	~<bôs/m©h-ve˘‹.h
>

35 
	~<bôs/huge_vÆ.h
>

36 #ifde‡
__USE_ISOC99


37 
	~<bôs/huge_vÆf.h
>

38 
	~<bôs/huge_vÆl.h
>

41 
	~<bôs/öf.h
>

44 
	~<bôs/«n.h
>

48 
	~<bôs/m©hdef.h
>

55 
	#__SIMD_DECL
(
fun˘i⁄
Ë
	`__CONCAT
 (
__DECL_SIMD_
, fun˘i⁄)

	)

57 
	#__MATHCALL_VEC
(
fun˘i⁄
, 
suffix
, 
¨gs
) \

58 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
fun˘i⁄
, 
suffix
)) \

59 
	`__MATHCALL
 (
fun˘i⁄
, 
suffix
, 
¨gs
)

	)

61 
	#__MATHDECL_VEC
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

62 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
fun˘i⁄
, 
suffix
)) \

63 
	`__MATHDECL
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
)

	)

65 
	#__MATHCALL
(
fun˘i⁄
,
suffix
, 
¨gs
) \

66 
	`__MATHDECL
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
)

	)

67 
	#__MATHDECL
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

68 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
); \

69 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
)

	)

70 
	#__MATHCALLX
(
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

71 
	`__MATHDECLX
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
)

	)

72 
	#__MATHDECLX
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

73 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
); \

74 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
)

	)

75 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

76 
ty≥
 
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
Ë
¨gs
 
__THROW


	)

78 
	#_MdoubÀ_
 

	)

79 
	#__MATH_PRECNAME
(
«me
,
r
Ë
	`__CONCAT
“ame,r)

	)

80 
	#__MATH_DECLARING_DOUBLE
 1

	)

81 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

82 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

83 
	~<bôs/m©hˇŒs.h
>

84 #unde‡
_MdoubÀ_


85 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


86 #unde‡
_MdoubÀ_END_NAMESPACE


87 #unde‡
__MATH_PRECNAME


88 #unde‡
__MATH_DECLARING_DOUBLE


90 #ifde‡
__USE_ISOC99


96 #i‚de‡
_MÊﬂt_


97 
	#_MÊﬂt_
 

	)

99 
	#_MdoubÀ_
 
_MÊﬂt_


	)

100 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f
##
	)
r

101 
	#__MATH_DECLARING_DOUBLE
 0

	)

102 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

103 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

104 
	~<bôs/m©hˇŒs.h
>

105 #unde‡
_MdoubÀ_


106 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


107 #unde‡
_MdoubÀ_END_NAMESPACE


108 #unde‡
__MATH_PRECNAME


109 #unde‡
__MATH_DECLARING_DOUBLE


111 #i‡!(
deföed
 
__NO_LONG_DOUBLE_MATH
 && deföed 
_LIBC
) \

112 || 
deföed
 
__LDBL_COMPAT
 \

113 || 
deföed
 
_LIBC_TEST


114 #ifde‡
__LDBL_COMPAT


116 #ifde‡
__USE_ISOC99


117 
	$__∆dbl_√xâow¨df
 (
__x
, 
__y
)

118 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

119 #ifde‡
__REDIRECT_NTH


120 
	`__REDIRECT_NTH
 (
√xâow¨df
, (
__x
, 
__y
),

121 
__∆dbl_√xâow¨df
)

122 
	`__©åibuã__
 ((
__c⁄°__
));

123 
	`__REDIRECT_NTH
 (
√xâow¨d
, (
__x
, 
__y
),

124 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

125 
	`__REDIRECT_NTH
 (
√xâow¨dl
,

126 (
__x
, 
__y
),

127 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

131 #unde‡
__MATHDECL_1


132 
	#__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
Æüs
) \

133 
ty≥
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
), \

134 
¨gs
, 
Æüs
)

	)

135 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

136 
	`__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
	`__CONCAT
(fun˘i⁄,suffix))

	)

142 #i‚de‡
_Ml⁄g_doubÀ_


143 
	#_Ml⁄g_doubÀ_
 

	)

145 
	#_MdoubÀ_
 
_Ml⁄g_doubÀ_


	)

146 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
l
##
	)
r

147 
	#__MATH_DECLARING_DOUBLE
 0

	)

148 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

149 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

150 
	#__MATH_DECLARE_LDOUBLE
 1

	)

151 
	~<bôs/m©hˇŒs.h
>

152 #unde‡
_MdoubÀ_


153 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


154 #unde‡
_MdoubÀ_END_NAMESPACE


155 #unde‡
__MATH_PRECNAME


156 #unde‡
__MATH_DECLARING_DOUBLE


161 #unde‡
__MATHDECL_1


162 #unde‡
__MATHDECL


163 #unde‡
__MATHCALL


166 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


168 
signgam
;

173 #ifde‡
__USE_ISOC99


211 
FP_NAN
 =

212 
	#FP_NAN
 0

	)

213 
FP_NAN
,

214 
FP_INFINITE
 =

215 
	#FP_INFINITE
 1

	)

216 
FP_INFINITE
,

217 
FP_ZERO
 =

218 
	#FP_ZERO
 2

	)

219 
FP_ZERO
,

220 
FP_SUBNORMAL
 =

221 
	#FP_SUBNORMAL
 3

	)

222 
FP_SUBNORMAL
,

223 
FP_NORMAL
 =

224 
	#FP_NORMAL
 4

	)

225 
FP_NORMAL


233 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__
 \

234 && !
deföed
 
__OPTIMIZE_SIZE__


235 
	#Â˛assify
(
x
Ë
	`__buûtö_Â˛assify
 (
FP_NAN
, 
FP_INFINITE
, \

236 
FP_NORMAL
, 
FP_SUBNORMAL
, 
FP_ZERO
, 
x
)

	)

237 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


238 
	#Â˛assify
(
x
) \

239 ( (
x
Ë= (Ë? 
	`__Â˛assifyf
 (xË: 
	`__Â˛assify
 (x))

	)

241 
	#Â˛assify
(
x
) \

242 ( (
x
) ==  () \

243 ? 
	`__Â˛assifyf
 (
x
) \

244 :  (
x
) ==  () \

245 ? 
	`__Â˛assify
 (
x
Ë: 
	`__Â˛assifyl
 (x))

	)

249 #i‡
	`__GNUC_PREREQ
 (4,0)

250 
	#signbô
(
x
) \

251 ( (
x
) ==  () \

252 ? 
	`__buûtö_signbôf
 (
x
) \

253 :  (
x
) ==  () \

254 ? 
	`__buûtö_signbô
 (
x
Ë: 
	`__buûtö_signbôl
 (x))

	)

256 #ifde‡
__NO_LONG_DOUBLE_MATH


257 
	#signbô
(
x
) \

258 ( (
x
Ë= (Ë? 
	`__signbôf
 (xË: 
	`__signbô
 (x))

	)

260 
	#signbô
(
x
) \

261 ( (
x
) ==  () \

262 ? 
	`__signbôf
 (
x
) \

263 :  (
x
) ==  () \

264 ? 
	`__signbô
 (
x
Ë: 
	`__signbôl
 (x))

	)

269 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


270 
	#isföôe
(
x
Ë
	`__buûtö_isföôe
 (x)

	)

271 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


272 
	#isföôe
(
x
) \

273 ( (
x
Ë= (Ë? 
	`__föôef
 (xË: 
	`__föôe
 (x))

	)

275 
	#isföôe
(
x
) \

276 ( (
x
) ==  () \

277 ? 
	`__föôef
 (
x
) \

278 :  (
x
) ==  () \

279 ? 
	`__föôe
 (
x
Ë: 
	`__föôñ
 (x))

	)

283 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


284 
	#i¢‹mÆ
(
x
Ë
	`__buûtö_i¢‹mÆ
 (x)

	)

286 
	#i¢‹mÆ
(
x
Ë(
	`Â˛assify
 (xË=
FP_NORMAL
)

	)

291 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


292 
	#i¢™
(
x
Ë
	`__buûtö_i¢™
 (x)

	)

293 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


294 
	#i¢™
(
x
) \

295 ( (
x
Ë= (Ë? 
	`__i¢™f
 (xË: 
	`__i¢™
 (x))

	)

297 
	#i¢™
(
x
) \

298 ( (
x
) ==  () \

299 ? 
	`__i¢™f
 (
x
) \

300 :  (
x
) ==  () \

301 ? 
	`__i¢™
 (
x
Ë: 
	`__i¢™l
 (x))

	)

305 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


306 
	#isöf
(
x
Ë
	`__buûtö_isöf_sign
 (x)

	)

307 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


308 
	#isöf
(
x
) \

309 ( (
x
Ë= (Ë? 
	`__isöff
 (xË: 
	`__isöf
 (x))

	)

311 
	#isöf
(
x
) \

312 ( (
x
) ==  () \

313 ? 
	`__isöff
 (
x
) \

314 :  (
x
) ==  () \

315 ? 
	`__isöf
 (
x
Ë: 
	`__isöÊ
 (x))

	)

319 
	#MATH_ERRNO
 1

	)

320 
	#MATH_ERREXCEPT
 2

	)

325 #i‚de‡
__FAST_MATH__


326 
	#m©h_îrh™dlög
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

331 #ifde‡
__USE_GNU


333 #ifde‡
__NO_LONG_DOUBLE_MATH


334 
	#issig«lög
(
x
) \

335 ( (
x
Ë= (Ë? 
	`__issig«lögf
 (xË: 
	`__issig«lög
 (x))

	)

337 
	#issig«lög
(
x
) \

338 ( (
x
) ==  () \

339 ? 
	`__issig«lögf
 (
x
) \

340 :  (
x
) ==  () \

341 ? 
	`__issig«lög
 (
x
Ë: 
	`__issig«lögl
 (x))

	)

345 #ifdef 
__USE_MISC


349 
_IEEE_
 = -1,

350 
_SVID_
,

351 
_XOPEN_
,

352 
_POSIX_
,

353 
_ISOC_


354 } 
	t_LIB_VERSION_TYPE
;

359 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

363 #ifde‡
__USE_MISC


369 #ifde‡
__˝lu•lus


370 
__ex˚±i⁄


372 
ex˚±i⁄


375 
ty≥
;

376 *
«me
;

377 
¨g1
;

378 
¨g2
;

379 
ªtvÆ
;

380 
	}
};

382 #ifde‡
__˝lu•lus


383 
	$m©hîr
 (
__ex˚±i⁄
 *
__exc
Ë
	`throw
 ();

385 
	`m©hîr
 (
ex˚±i⁄
 *
__exc
);

388 
	#X_TLOSS
 1.41484755040568800000e+16

	)

391 
	#DOMAIN
 1

	)

392 
	#SING
 2

	)

393 
	#OVERFLOW
 3

	)

394 
	#UNDERFLOW
 4

	)

395 
	#TLOSS
 5

	)

396 
	#PLOSS
 6

	)

399 
	#HUGE
 3.40282347e+38F

	)

403 #ifde‡
__USE_XOPEN


405 
	#MAXFLOAT
 3.40282347e+38F

	)

412 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


413 
	#M_E
 2.7182818284590452354

	)

414 
	#M_LOG2E
 1.4426950408889634074

	)

415 
	#M_LOG10E
 0.43429448190325182765

	)

416 
	#M_LN2
 0.69314718055994530942

	)

417 
	#M_LN10
 2.30258509299404568402

	)

418 
	#M_PI
 3.14159265358979323846

	)

419 
	#M_PI_2
 1.57079632679489661923

	)

420 
	#M_PI_4
 0.78539816339744830962

	)

421 
	#M_1_PI
 0.31830988618379067154

	)

422 
	#M_2_PI
 0.63661977236758134308

	)

423 
	#M_2_SQRTPI
 1.12837916709551257390

	)

424 
	#M_SQRT2
 1.41421356237309504880

	)

425 
	#M_SQRT1_2
 0.70710678118654752440

	)

431 #ifde‡
__USE_GNU


432 
	#M_El
 2.718281828459045235360287471352662498L

	)

433 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

434 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

435 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

436 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

437 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

438 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

439 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

440 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

441 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

442 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

443 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

444 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

451 #i‡
deföed
 
__STRICT_ANSI__
 && !deföed 
__NO_MATH_INLINES


452 
	#__NO_MATH_INLINES
 1

	)

455 #i‡
deföed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

462 
	#isgª©î
(
x
, 
y
Ë
	`__buûtö_isgª©î
(x, y)

	)

463 
	#isgª©îequÆ
(
x
, 
y
Ë
	`__buûtö_isgª©îequÆ
(x, y)

	)

464 
	#i¶ess
(
x
, 
y
Ë
	`__buûtö_i¶ess
(x, y)

	)

465 
	#i¶es£quÆ
(
x
, 
y
Ë
	`__buûtö_i¶es£quÆ
(x, y)

	)

466 
	#i¶essgª©î
(
x
, 
y
Ë
	`__buûtö_i¶essgª©î
(x, y)

	)

467 
	#isun‹dîed
(
u
, 
v
Ë
	`__buûtö_isun‹dîed
(u, v)

	)

471 #ifde‡
__USE_EXTERN_INLINES


472 
	~<bôs/m©hölöe.h
>

477 #i‡
deföed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

478 
	~<bôs/m©h-föôe.h
>

481 #ifde‡
__USE_ISOC99


485 #i‚de‡
isgª©î


486 
	#isgª©î
(
x
, 
y
) \

487 (
__exãnsi⁄__
 \

488 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

489 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x > __y; 
	}
}))

	)

493 #i‚de‡
isgª©îequÆ


494 
	#isgª©îequÆ
(
x
, 
y
) \

495 (
__exãnsi⁄__
 \

496 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

497 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x >__y; }))

	)

501 #i‚de‡
i¶ess


502 
	#i¶ess
(
x
, 
y
) \

503 (
__exãnsi⁄__
 \

504 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

505 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x < __y; }))

	)

509 #i‚de‡
i¶es£quÆ


510 
	#i¶es£quÆ
(
x
, 
y
) \

511 (
__exãnsi⁄__
 \

512 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

513 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x <__y; }))

	)

517 #i‚de‡
i¶essgª©î


518 
	#i¶essgª©î
(
x
, 
y
) \

519 (
__exãnsi⁄__
 \

520 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

521 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& (__x < __y || __y < __x); }))

	)

525 #i‚de‡
isun‹dîed


526 
	#isun‹dîed
(
u
, 
v
) \

527 (
__exãnsi⁄__
 \

528 ({ 
	`__ty≥of__
(
u
Ë
__u
 = (u); __ty≥of__(
v
Ë
__v
 = (v); \

529 
	`Â˛assify
 (
__u
Ë=
FP_NAN
 || fp˛assify (
__v
Ë=FP_NAN; }))

	)

534 
	g__END_DECLS


	@/usr/include/stdio.h

23 #i‚de‡
_STDIO_H


25 #i‡!
deföed
 
__√ed_FILE
 && !deföed 
__√ed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


31 
	#__√ed_size_t


	)

32 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

35 
	~<bôs/ty≥s.h
>

36 
	#__√ed_FILE


	)

37 
	#__√ed___FILE


	)

41 #i‡!
deföed
 
__FILE_deföed
 && deföed 
__√ed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #i‡
deföed
 
__USE_LARGEFILE64
 || deföed 
__USE_POSIX
 \

51 || 
deföed
 
	g__USE_ISOC99
 || deföed 
	g__USE_XOPEN
 \

52 || 
deföed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_deföed
 1

	)

58 #unde‡
__√ed_FILE


61 #i‡!
deföed
 
____FILE_deföed
 && deföed 
__√ed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_deföed
 1

	)

68 #unde‡
__√ed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


77 #ifde‡
__GNUC__


78 #i‚de‡
_VA_LIST_DEFINED


79 
_G_va_li°
 
	tva_li°
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<°d¨g.h
>

87 #ifde‡
__USE_XOPEN2K8


88 #i‚de‡
__off_t_deföed


89 #i‚de‡
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_deföed


	)

96 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_deföed


	)

101 #i‚de‡
__ssize_t_deföed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_deföed


	)

108 
__BEGIN_NAMESPACE_STD


109 #i‚de‡
__USE_FILE_OFFSET64


110 
_G_Âos_t
 
	tÂos_t
;

112 
_G_Âos64_t
 
	tÂos_t
;

114 
__END_NAMESPACE_STD


115 #ifde‡
__USE_LARGEFILE64


116 
_G_Âos64_t
 
	tÂos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #i‚de‡
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #i‚de‡
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifde‡
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


151 
	#P_tmpdú
 "/tmp"

	)

164 
	~<bôs/°dio_lim.h
>

168 
_IO_FILE
 *
°dö
;

169 
_IO_FILE
 *
°dout
;

170 
_IO_FILE
 *
°dîr
;

172 
	#°dö
 
°dö


	)

173 
	#°dout
 
°dout


	)

174 
	#°dîr
 
°dîr


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$ªmove
 (c⁄° *
__fûíame
Ë
__THROW
;

180 
	$ª«me
 (c⁄° *
__ﬁd
, c⁄° *
__√w
Ë
__THROW
;

181 
__END_NAMESPACE_STD


183 #ifde‡
__USE_ATFILE


185 
	$ª«mót
 (
__ﬁdfd
, c⁄° *
__ﬁd
, 
__√wfd
,

186 c⁄° *
__√w
Ë
__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #i‚de‡
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfûe
 (Ë
__wur
;

197 #ifde‡
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfûe
, (), 
tmpfûe64
Ë
__wur
;

200 
	#tmpfûe
 
tmpfûe64


	)

204 #ifde‡
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfûe64
 (Ë
__wur
;

209 *
	$tm≤am
 (*
__s
Ë
__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifde‡
__USE_MISC


215 *
	$tm≤am_r
 (*
__s
Ë
__THROW
 
__wur
;

219 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


227 *
	$ãm≤am
 (c⁄° *
__dú
, c⁄° *
__pfx
)

228 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`f˛o£
 (
FILE
 *
__°ªam
);

242 
	`fÊush
 (
FILE
 *
__°ªam
);

243 
__END_NAMESPACE_STD


245 #ifde‡
__USE_MISC


252 
	`fÊush_u∆ocked
 (
FILE
 *
__°ªam
);

255 #ifde‡
__USE_GNU


262 
	`f˛o£Æl
 ();

266 
__BEGIN_NAMESPACE_STD


267 #i‚de‡
__USE_FILE_OFFSET64


272 
FILE
 *
	$f›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

273 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

278 
FILE
 *
	$‰e›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

279 c⁄° *
__ª°ri˘
 
__modes
,

280 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

282 #ifde‡
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
f›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

284 c⁄° *
__ª°ri˘
 
__modes
), 
f›í64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
‰e›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

287 c⁄° *
__ª°ri˘
 
__modes
,

288 
FILE
 *
__ª°ri˘
 
__°ªam
), 
‰e›í64
)

289 
__wur
;

291 
	#f›í
 
f›í64


	)

292 
	#‰e›í
 
‰e›í64


	)

295 
__END_NAMESPACE_STD


296 #ifde‡
__USE_LARGEFILE64


297 
FILE
 *
	$f›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

298 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

299 
FILE
 *
	$‰e›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

300 c⁄° *
__ª°ri˘
 
__modes
,

301 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fd›í
 (
__fd
, c⁄° *
__modes
Ë
__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$f›ícookõ
 (*
__ª°ri˘
 
__magic_cookõ
,

313 c⁄° *
__ª°ri˘
 
__modes
,

314 
_IO_cookõ_io_fun˘i⁄s_t
 
__io_funcs
Ë
__THROW
 
__wur
;

317 #ifde‡
__USE_XOPEN2K8


319 
FILE
 *
	$fmem›í
 (*
__s
, 
size_t
 
__Àn
, c⁄° *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$›í_mem°ªam
 (**
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$£tbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
Ë
__THROW
;

336 
	$£tvbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

337 
__modes
, 
size_t
 
__n
Ë
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_MISC


343 
	$£tbuf„r
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

344 
size_t
 
__size
Ë
__THROW
;

347 
	$£éöebuf
 (
FILE
 *
__°ªam
Ë
__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`Ârötf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

357 c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

362 
	`¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

364 
	$•rötf
 (*
__ª°ri˘
 
__s
,

365 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROWNL
;

371 
	`vÂrötf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

372 
_G_va_li°
 
__¨g
);

377 
	`v¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
);

379 
	$v•rötf
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

380 
_G_va_li°
 
__¨g
Ë
__THROWNL
;

381 
__END_NAMESPACE_STD


383 #i‡
deföed
 
__USE_ISOC99
 || deföed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

387 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

388 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 4)));

390 
	$v¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

391 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

392 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifde‡
__USE_GNU


399 
	$va•rötf
 (**
__ª°ri˘
 
__±r
, c⁄° *__ª°ri˘ 
__f
,

400 
_G_va_li°
 
__¨g
)

401 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 0))Ë
__wur
;

402 
	$__a•rötf
 (**
__ª°ri˘
 
__±r
,

403 c⁄° *
__ª°ri˘
 
__fmt
, ...)

404 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

405 
	$a•rötf
 (**
__ª°ri˘
 
__±r
,

406 c⁄° *
__ª°ri˘
 
__fmt
, ...)

407 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

410 #ifde‡
__USE_XOPEN2K8


412 
	$vd¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
,

413 
_G_va_li°
 
__¨g
)

414 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

415 
	$d¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
, ...)

416 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

426 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

431 
	$sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

433 
	$ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

434 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

436 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

437 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

438 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

439 #ifde‡
__REDIRECT


443 
	`__REDIRECT
 (
fsˇnf
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

444 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

445 
__isoc99_fsˇnf
Ë
__wur
;

446 
	`__REDIRECT
 (
sˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

447 
__isoc99_sˇnf
Ë
__wur
;

448 
	`__REDIRECT_NTH
 (
ssˇnf
, (c⁄° *
__ª°ri˘
 
__s
,

449 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

450 
__isoc99_ssˇnf
);

452 
	$__isoc99_fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

453 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

454 
	$__isoc99_sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

455 
	$__isoc99_ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

456 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

457 
	#fsˇnf
 
__isoc99_fsˇnf


	)

458 
	#sˇnf
 
__isoc99_sˇnf


	)

459 
	#ssˇnf
 
__isoc99_ssˇnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

472 
_G_va_li°
 
__¨g
)

473 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

479 
	$vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

480 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

483 
	$vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

484 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

485 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

487 #i‡!
deföed
 
__USE_GNU
 \

488 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

489 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

490 #ifde‡
__REDIRECT


494 
	`__REDIRECT
 (
vfsˇnf
,

495 (
FILE
 *
__ª°ri˘
 
__s
,

496 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
),

497 
__isoc99_vfsˇnf
)

498 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

499 
	`__REDIRECT
 (
vsˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
,

500 
_G_va_li°
 
__¨g
), 
__isoc99_vsˇnf
)

501 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

502 
	`__REDIRECT_NTH
 (
vssˇnf
,

503 (c⁄° *
__ª°ri˘
 
__s
,

504 c⁄° *
__ª°ri˘
 
__f‹m©
,

505 
_G_va_li°
 
__¨g
), 
__isoc99_vssˇnf
)

506 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

508 
	$__isoc99_vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
,

509 c⁄° *
__ª°ri˘
 
__f‹m©
,

510 
_G_va_li°
 
__¨g
Ë
__wur
;

511 
	$__isoc99_vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
,

512 
_G_va_li°
 
__¨g
Ë
__wur
;

513 
	$__isoc99_vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

514 c⁄° *
__ª°ri˘
 
__f‹m©
,

515 
_G_va_li°
 
__¨g
Ë
__THROW
;

516 
	#vfsˇnf
 
__isoc99_vfsˇnf


	)

517 
	#vsˇnf
 
__isoc99_vsˇnf


	)

518 
	#vssˇnf
 
__isoc99_vssˇnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fgëc
 (
FILE
 *
__°ªam
);

532 
	`gëc
 (
FILE
 *
__°ªam
);

538 
	`gëch¨
 ();

539 
__END_NAMESPACE_STD


543 
	#gëc
(
_Â
Ë
	`_IO_gëc
 (_Â)

	)

545 #ifde‡
__USE_POSIX


550 
	`gëc_u∆ocked
 (
FILE
 *
__°ªam
);

551 
	`gëch¨_u∆ocked
 ();

554 #ifde‡
__USE_MISC


561 
	`fgëc_u∆ocked
 (
FILE
 *
__°ªam
);

565 
__BEGIN_NAMESPACE_STD


573 
	`Âutc
 (
__c
, 
FILE
 *
__°ªam
);

574 
	`putc
 (
__c
, 
FILE
 *
__°ªam
);

580 
	`putch¨
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_Â
Ë
	`_IO_putc
 (_ch, _Â)

	)

587 #ifde‡
__USE_MISC


594 
	`Âutc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

597 #ifde‡
__USE_POSIX


602 
	`putc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

603 
	`putch¨_u∆ocked
 (
__c
);

607 #i‡
deföed
 
__USE_MISC
 \

608 || (
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

610 
	`gëw
 (
FILE
 *
__°ªam
);

613 
	`putw
 (
__w
, 
FILE
 *
__°ªam
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fgës
 (*
__ª°ri˘
 
__s
, 
__n
, 
FILE
 *__ª°ri˘ 
__°ªam
)

623 
__wur
;

625 #i‡!
deföed
 
__USE_ISOC11
 \

626 || (
deföed
 
__˝lu•lus
 && __cplusplus <= 201103L)

638 *
	$gës
 (*
__s
Ë
__wur
 
__©åibuã_dïªˇãd__
;

640 
__END_NAMESPACE_STD


642 #ifde‡
__USE_GNU


649 *
	$fgës_u∆ocked
 (*
__ª°ri˘
 
__s
, 
__n
,

650 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__gëdñim
 (**
__ª°ri˘
 
__löïå
,

666 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

667 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

668 
_IO_ssize_t
 
	$gëdñim
 (**
__ª°ri˘
 
__löïå
,

669 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

670 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

678 
_IO_ssize_t
 
	$gëlöe
 (**
__ª°ri˘
 
__löïå
,

679 
size_t
 *
__ª°ri˘
 
__n
,

680 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`Âuts
 (c⁄° *
__ª°ri˘
 
__s
, 
FILE
 *__ª°ri˘ 
__°ªam
);

695 
	`puts
 (c⁄° *
__s
);

702 
	`ungëc
 (
__c
, 
FILE
 *
__°ªam
);

709 
size_t
 
	$‰ód
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

715 
size_t
 
	`fwrôe
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

716 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifde‡
__USE_GNU


726 
	`Âuts_u∆ocked
 (c⁄° *
__ª°ri˘
 
__s
,

727 
FILE
 *
__ª°ri˘
 
__°ªam
);

730 #ifde‡
__USE_MISC


737 
size_t
 
	$‰ód_u∆ocked
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

739 
size_t
 
	`fwrôe_u∆ocked
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

740 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
);

744 
__BEGIN_NAMESPACE_STD


749 
	`f£ek
 (
FILE
 *
__°ªam
, 
__off
, 
__whí˚
);

754 
	$·ñl
 (
FILE
 *
__°ªam
Ë
__wur
;

759 
	`ªwöd
 (
FILE
 *
__°ªam
);

760 
__END_NAMESPACE_STD


767 #i‡
deföed
 
__USE_LARGEFILE
 || deföed 
__USE_XOPEN2K


768 #i‚de‡
__USE_FILE_OFFSET64


773 
	`f£eko
 (
FILE
 *
__°ªam
, 
__off_t
 
__off
, 
__whí˚
);

778 
__off_t
 
	$·ñlo
 (
FILE
 *
__°ªam
Ë
__wur
;

780 #ifde‡
__REDIRECT


781 
	`__REDIRECT
 (
f£eko
,

782 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
),

783 
f£eko64
);

784 
__off64_t
 
	`__REDIRECT
 (
·ñlo
, (
FILE
 *
__°ªam
), 
·ñlo64
);

786 
	#f£eko
 
f£eko64


	)

787 
	#·ñlo
 
·ñlo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #i‚de‡
__USE_FILE_OFFSET64


798 
	`fgëpos
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos_t
 *__ª°ri˘ 
__pos
);

803 
	`f£ços
 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
);

805 #ifde‡
__REDIRECT


806 
	`__REDIRECT
 (
fgëpos
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

807 
Âos_t
 *
__ª°ri˘
 
__pos
), 
fgëpos64
);

808 
	`__REDIRECT
 (
f£ços
,

809 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
), 
f£ços64
);

811 
	#fgëpos
 
fgëpos64


	)

812 
	#f£ços
 
f£ços64


	)

815 
__END_NAMESPACE_STD


817 #ifde‡
__USE_LARGEFILE64


818 
	`f£eko64
 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
);

819 
__off64_t
 
	$·ñlo64
 (
FILE
 *
__°ªam
Ë
__wur
;

820 
	`fgëpos64
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos64_t
 *__ª°ri˘ 
__pos
);

821 
	`f£ços64
 (
FILE
 *
__°ªam
, c⁄° 
Âos64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$˛óªº
 (
FILE
 *
__°ªam
Ë
__THROW
;

828 
	$„of
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

830 
	$„º‹
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifde‡
__USE_MISC


835 
	$˛óªº_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
;

836 
	$„of_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

837 
	$„º‹_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`≥º‹
 (c⁄° *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<bôs/sys_îæi°.h
>

856 #ifdef 
__USE_POSIX


858 
	$fûío
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

861 #ifde‡
__USE_MISC


863 
	$fûío_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

867 #ifde‡
__USE_POSIX2


872 
FILE
 *
	$p›í
 (c⁄° *
__comm™d
, c⁄° *
__modes
Ë
__wur
;

878 
	`p˛o£
 (
FILE
 *
__°ªam
);

882 #ifdef 
__USE_POSIX


884 *
	$˘îmid
 (*
__s
Ë
__THROW
;

888 #ifde‡
__USE_XOPEN


890 *
	`cu£rid
 (*
__s
);

894 #ifdef 
__USE_GNU


895 
ob°ack
;

898 
	$ob°ack_¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

899 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

900 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

901 
	$ob°ack_v¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

902 c⁄° *
__ª°ri˘
 
__f‹m©
,

903 
_G_va_li°
 
__¨gs
)

904 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

908 #ifde‡
__USE_POSIX


912 
	$Êockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

916 
	$·rylockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

919 
	$fu∆ockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

922 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


926 
	#__√ed_gë›t


	)

927 
	~<gë›t.h
>

932 #ifde‡
__USE_EXTERN_INLINES


933 
	~<bôs/°dio.h
>

935 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


936 
	~<bôs/°dio2.h
>

938 #ifde‡
__LDBL_COMPAT


939 
	~<bôs/°dio-ldbl.h
>

942 
__END_DECLS


	@/usr/include/time.h

22 #i‚def 
_TIME_H


24 #i‡(! 
deföed
 
__√ed_time_t
 && !deföed 
__√ed_˛ock_t
 && \

25 ! 
deföed
 
	g__√ed_time•ec
)

26 
	#_TIME_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__√ed_size_t


	)

36 
	#__√ed_NULL


	)

37 
	~<°ddef.h
>

41 
	~<bôs/time.h
>

44 #i‡!
deföed
 
__STRICT_ANSI__
 && !deföed 
__USE_XOPEN2K


45 #i‚de‡
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #i‡!
deföed
 
__˛ock_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_˛ock_t
)

53 
	#__˛ock_t_deföed
 1

	)

55 
	~<bôs/ty≥s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__˛ock_t
 
	t˛ock_t
;

60 
	g__END_NAMESPACE_STD


61 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX


62 
	$__USING_NAMESPACE_STD
(
˛ock_t
)

66 #unde‡
__√ed_˛ock_t


68 #i‡!
deföed
 
__time_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_time_t
)

69 
	#__time_t_deföed
 1

	)

71 
	~<bôs/ty≥s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ifde‡
__USE_POSIX


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #unde‡
__√ed_time_t


84 #i‡!
deföed
 
__˛ockid_t_deföed
 && \

85 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_˛ockid_t
)

86 
	#__˛ockid_t_deföed
 1

	)

88 
	~<bôs/ty≥s.h
>

91 
__˛ockid_t
 
	t˛ockid_t
;

94 #unde‡
__˛ockid_time_t


96 #i‡!
deföed
 
__timî_t_deföed
 && \

97 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_timî_t
)

98 
	#__timî_t_deföed
 1

	)

100 
	~<bôs/ty≥s.h
>

103 
__timî_t
 
	ttimî_t
;

106 #unde‡
__√ed_timî_t


109 #i‡(!
deföed
 
__time•ec_deföed
 \

110 && ((
deföed
 
_TIME_H
 \

111 && (
deföed
 
__USE_POSIX199309
 \

112 || 
deföed
 
__USE_ISOC11
)) \

113 || 
deföed
 
__√ed_time•ec
))

114 
	#__time•ec_deföed
 1

	)

116 
	~<bôs/ty≥s.h
>

120 
	stime•ec


122 
__time_t
 
tv_£c
;

123 
__sysˇŒ_¶⁄g_t
 
tv_n£c
;

127 #unde‡
__√ed_time•ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mö
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_m⁄
;

140 
tm_yór
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd°
;

145 #ifdef 
__USE_MISC


146 
tm_gmtoff
;

147 c⁄° *
tm_z⁄e
;

149 
__tm_gmtoff
;

150 c⁄° *
__tm_z⁄e
;

153 
__END_NAMESPACE_STD


154 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifde‡
__USE_POSIX199309


161 
	sôimî•ec


163 
time•ec
 
ô_öãrvÆ
;

164 
time•ec
 
ô_vÆue
;

168 
sigevít
;

172 #ifde‡
__USE_XOPEN2K


173 #i‚de‡
__pid_t_deföed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_deföed


	)

180 #ifde‡
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
˛ock_t
 
	$˛ock
 (Ë
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__timî
Ë
__THROW
;

195 
	$dif·ime
 (
time_t
 
__time1
,Åime_à
__time0
)

196 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

199 
time_t
 
	$mktime
 (
tm
 *
__ç
Ë
__THROW
;

205 
size_t
 
	$°r·ime
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

206 c⁄° *
__ª°ri˘
 
__f‹m©
,

207 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifde‡
__USE_XOPEN


213 *
	$°Ωtime
 (c⁄° *
__ª°ri˘
 
__s
,

214 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
)

215 
__THROW
;

218 #ifde‡
__USE_XOPEN2K8


221 
	~<xloˇÀ.h
>

223 
size_t
 
	$°r·ime_l
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

224 c⁄° *
__ª°ri˘
 
__f‹m©
,

225 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

226 
__loˇÀ_t
 
__loc
Ë
__THROW
;

229 #ifde‡
__USE_GNU


230 *
	$°Ωtime_l
 (c⁄° *
__ª°ri˘
 
__s
,

231 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
,

232 
__loˇÀ_t
 
__loc
Ë
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

243 
tm
 *
	$loˇ…ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

244 
__END_NAMESPACE_STD


246 #ifde‡
__USE_POSIX


249 
tm
 *
	$gmtime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

250 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

254 
tm
 *
	$loˇ…ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

255 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$as˘ime
 (c⁄° 
tm
 *
__ç
Ë
__THROW
;

264 *
	$˘ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

265 
__END_NAMESPACE_STD


267 #ifde‡
__USE_POSIX


272 *
	$as˘ime_r
 (c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

273 *
__ª°ri˘
 
__buf
Ë
__THROW
;

276 *
	$˘ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

277 *
__ª°ri˘
 
__buf
Ë
__THROW
;

282 *
__tz«me
[2];

283 
__daylight
;

284 
__timez⁄e
;

287 #ifdef 
__USE_POSIX


289 *
tz«me
[2];

293 
	$tz£t
 (Ë
__THROW
;

296 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


297 
daylight
;

298 
timez⁄e
;

301 #ifde‡
__USE_MISC


304 
	$°ime
 (c⁄° 
time_t
 *
__whí
Ë
__THROW
;

310 
	#__i¶óp
(
yór
) \

311 ((
yór
Ë% 4 =0 && ((yórË% 100 !0 || (yórË% 400 =0))

	)

314 #ifde‡
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__ç
Ë
__THROW
;

322 
time_t
 
	$timñoˇl
 (
tm
 *
__ç
Ë
__THROW
;

325 
	$dysize
 (
__yór
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

329 #ifde‡
__USE_POSIX199309


334 
	`«no¶ìp
 (c⁄° 
time•ec
 *
__ªque°ed_time
,

335 
time•ec
 *
__ªmaöög
);

339 
	$˛ock_gëªs
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ªs
Ë
__THROW
;

342 
	$˛ock_gëtime
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ç
Ë
__THROW
;

345 
	$˛ock_£âime
 (
˛ockid_t
 
__˛ock_id
, c⁄° 
time•ec
 *
__ç
)

346 
__THROW
;

348 #ifde‡
__USE_XOPEN2K


353 
	`˛ock_«no¶ìp
 (
˛ockid_t
 
__˛ock_id
, 
__Êags
,

354 c⁄° 
time•ec
 *
__ªq
,

355 
time•ec
 *
__ªm
);

358 
	$˛ock_gë˝u˛ockid
 (
pid_t
 
__pid
, 
˛ockid_t
 *
__˛ock_id
Ë
__THROW
;

363 
	$timî_¸óã
 (
˛ockid_t
 
__˛ock_id
,

364 
sigevít
 *
__ª°ri˘
 
__evp
,

365 
timî_t
 *
__ª°ri˘
 
__timîid
Ë
__THROW
;

368 
	$timî_dñëe
 (
timî_t
 
__timîid
Ë
__THROW
;

371 
	$timî_£âime
 (
timî_t
 
__timîid
, 
__Êags
,

372 c⁄° 
ôimî•ec
 *
__ª°ri˘
 
__vÆue
,

373 
ôimî•ec
 *
__ª°ri˘
 
__ovÆue
Ë
__THROW
;

376 
	$timî_gëtime
 (
timî_t
 
__timîid
, 
ôimî•ec
 *
__vÆue
)

377 
__THROW
;

380 
	$timî_gëovîrun
 (
timî_t
 
__timîid
Ë
__THROW
;

384 #ifde‡
__USE_ISOC11


386 
	$time•ec_gë
 (
time•ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__n⁄nuŒ
 ((1));

391 #ifde‡
__USE_XOPEN_EXTENDED


403 
gëd©e_îr
;

412 
tm
 *
	`gëd©e
 (c⁄° *
__°rög
);

415 #ifde‡
__USE_GNU


426 
	`gëd©e_r
 (c⁄° *
__ª°ri˘
 
__°rög
,

427 
tm
 *
__ª°ri˘
 
__ªsbuÂ
);

430 
__END_DECLS


	@/usr/include/unistd.h

22 #i‚def 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


32 #ifde‡
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #ñi‡
deföed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #ñi‡
deföed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #ñi‡
deföed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifde‡
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #ñi‡
deföed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #ñi‡
deföed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

70 
	#_POSIX2_C_VERSION
 
__POSIX2_THIS_VERSION


	)

74 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

78 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

82 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

86 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

89 #ifde‡
__USE_XOPEN2K8


90 
	#_XOPEN_VERSION
 700

	)

91 #ñi‡
deföed
 
__USE_XOPEN2K


92 
	#_XOPEN_VERSION
 600

	)

93 #ñi‡
deföed
 
__USE_UNIX98


94 
	#_XOPEN_VERSION
 500

	)

96 
	#_XOPEN_VERSION
 4

	)

100 
	#_XOPEN_XCU_VERSION
 4

	)

103 
	#_XOPEN_XPG2
 1

	)

104 
	#_XOPEN_XPG3
 1

	)

105 
	#_XOPEN_XPG4
 1

	)

108 
	#_XOPEN_UNIX
 1

	)

111 
	#_XOPEN_CRYPT
 1

	)

115 
	#_XOPEN_ENH_I18N
 1

	)

118 
	#_XOPEN_LEGACY
 1

	)

205 
	~<bôs/posix_›t.h
>

208 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


209 
	~<bôs/ívú⁄míts.h
>

213 
	#STDIN_FILENO
 0

	)

214 
	#STDOUT_FILENO
 1

	)

215 
	#STDERR_FILENO
 2

	)

220 
	~<bôs/ty≥s.h
>

222 #i‚def 
__ssize_t_deföed


223 
__ssize_t
 
	tssize_t
;

224 
	#__ssize_t_deföed


	)

227 
	#__√ed_size_t


	)

228 
	#__√ed_NULL


	)

229 
	~<°ddef.h
>

231 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


234 #i‚de‡
__gid_t_deföed


235 
__gid_t
 
	tgid_t
;

236 
	#__gid_t_deföed


	)

239 #i‚de‡
__uid_t_deföed


240 
__uid_t
 
	tuid_t
;

241 
	#__uid_t_deföed


	)

244 #i‚de‡
__off_t_deföed


245 #i‚de‡
__USE_FILE_OFFSET64


246 
__off_t
 
	toff_t
;

248 
__off64_t
 
	toff_t
;

250 
	#__off_t_deföed


	)

252 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


253 
__off64_t
 
	toff64_t
;

254 
	#__off64_t_deföed


	)

257 #i‚de‡
__u£c⁄ds_t_deföed


258 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

259 
	#__u£c⁄ds_t_deföed


	)

262 #i‚de‡
__pid_t_deföed


263 
__pid_t
 
	tpid_t
;

264 
	#__pid_t_deföed


	)

268 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


269 #i‚de‡
__öçå_t_deföed


270 
__öçå_t
 
	töçå_t
;

271 
	#__öçå_t_deföed


	)

275 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


276 #i‚de‡
__sockÀn_t_deföed


277 
__sockÀn_t
 
	tsockÀn_t
;

278 
	#__sockÀn_t_deföed


	)

284 
	#R_OK
 4

	)

285 
	#W_OK
 2

	)

286 
	#X_OK
 1

	)

287 
	#F_OK
 0

	)

290 
	$ac˚ss
 (c⁄° *
__«me
, 
__ty≥
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

292 #ifde‡
__USE_GNU


295 
	$euidac˚ss
 (c⁄° *
__«me
, 
__ty≥
)

296 
__THROW
 
	`__n⁄nuŒ
 ((1));

299 
	$óc˚ss
 (c⁄° *
__«me
, 
__ty≥
)

300 
__THROW
 
	`__n⁄nuŒ
 ((1));

303 #ifde‡
__USE_ATFILE


307 
	$Ác˚sßt
 (
__fd
, c⁄° *
__fûe
, 
__ty≥
, 
__Êag
)

308 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

313 #i‚def 
_STDIO_H


314 
	#SEEK_SET
 0

	)

315 
	#SEEK_CUR
 1

	)

316 
	#SEEK_END
 2

	)

317 #ifde‡
__USE_GNU


318 
	#SEEK_DATA
 3

	)

319 
	#SEEK_HOLE
 4

	)

323 #i‡
deföed
 
__USE_MISC
 && !deföed 
L_SET


325 
	#L_SET
 
SEEK_SET


	)

326 
	#L_INCR
 
SEEK_CUR


	)

327 
	#L_XTND
 
SEEK_END


	)

336 #i‚de‡
__USE_FILE_OFFSET64


337 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__whí˚
Ë
__THROW
;

339 #ifde‡
__REDIRECT_NTH


340 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

341 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
),

342 
l£ek64
);

344 
	#l£ek
 
l£ek64


	)

347 #ifde‡
__USE_LARGEFILE64


348 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
)

349 
__THROW
;

356 
	`˛o£
 (
__fd
);

363 
ssize_t
 
	$ªad
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
Ë
__wur
;

369 
ssize_t
 
	$wrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
Ë
__wur
;

371 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


372 #i‚de‡
__USE_FILE_OFFSET64


379 
ssize_t
 
	$¥ód
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

380 
__off_t
 
__off£t
Ë
__wur
;

387 
ssize_t
 
	$pwrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

388 
__off_t
 
__off£t
Ë
__wur
;

390 #ifde‡
__REDIRECT


391 
ssize_t
 
	`__REDIRECT
 (
¥ód
, (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

392 
__off64_t
 
__off£t
),

393 
¥ód64
Ë
__wur
;

394 
ssize_t
 
	`__REDIRECT
 (
pwrôe
, (
__fd
, c⁄° *
__buf
,

395 
size_t
 
__nbyãs
, 
__off64_t
 
__off£t
),

396 
pwrôe64
Ë
__wur
;

398 
	#¥ód
 
¥ód64


	)

399 
	#pwrôe
 
pwrôe64


	)

403 #ifde‡
__USE_LARGEFILE64


407 
ssize_t
 
	$¥ód64
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

408 
__off64_t
 
__off£t
Ë
__wur
;

411 
ssize_t
 
	$pwrôe64
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

412 
__off64_t
 
__off£t
Ë
__wur
;

420 
	$pùe
 (
__pùedes
[2]Ë
__THROW
 
__wur
;

422 #ifde‡
__USE_GNU


425 
	$pùe2
 (
__pùedes
[2], 
__Êags
Ë
__THROW
 
__wur
;

435 
	$Æ¨m
 (
__£c⁄ds
Ë
__THROW
;

447 
	`¶ìp
 (
__£c⁄ds
);

449 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

450 || 
deföed
 
__USE_MISC


455 
__u£c⁄ds_t
 
	$uÆ¨m
 (
__u£c⁄ds_t
 
__vÆue
, __u£c⁄ds_à
__öãrvÆ
)

456 
__THROW
;

463 
	`u¶ìp
 (
__u£c⁄ds_t
 
__u£c⁄ds
);

472 
	`∑u£
 ();

476 
	$chown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

477 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

479 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


481 
	$fchown
 (
__fd
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
Ë
__THROW
 
__wur
;

486 
	$lchown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

487 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

491 #ifde‡
__USE_ATFILE


494 
	$fchow«t
 (
__fd
, c⁄° *
__fûe
, 
__uid_t
 
__ow√r
,

495 
__gid_t
 
__group
, 
__Êag
)

496 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

500 
	$chdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

502 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


504 
	$fchdú
 (
__fd
Ë
__THROW
 
__wur
;

514 *
	$gëcwd
 (*
__buf
, 
size_t
 
__size
Ë
__THROW
 
__wur
;

516 #ifdef 
__USE_GNU


520 *
	$gë_cuºít_dú_«me
 (Ë
__THROW
;

523 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

524 || 
deföed
 
__USE_MISC


528 *
	$gëwd
 (*
__buf
)

529 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
 
__wur
;

534 
	$dup
 (
__fd
Ë
__THROW
 
__wur
;

537 
	$dup2
 (
__fd
, 
__fd2
Ë
__THROW
;

539 #ifde‡
__USE_GNU


542 
	$dup3
 (
__fd
, 
__fd2
, 
__Êags
Ë
__THROW
;

546 **
__ívú⁄
;

547 #ifde‡
__USE_GNU


548 **
ívú⁄
;

554 
	$execve
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[],

555 *c⁄° 
__ívp
[]Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

557 #ifde‡
__USE_XOPEN2K8


560 
	$„xecve
 (
__fd
, *c⁄° 
__¨gv
[], *c⁄° 
__ívp
[])

561 
__THROW
 
	`__n⁄nuŒ
 ((2));

566 
	$execv
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[])

567 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

571 
	$exe˛e
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

572 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

576 
	$exe˛
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

577 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

581 
	$execvp
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[])

582 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

587 
	$exe˛p
 (c⁄° *
__fûe
, c⁄° *
__¨g
, ...)

588 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

590 #ifde‡
__USE_GNU


593 
	$execv≥
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[],

594 *c⁄° 
__ívp
[])

595 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

599 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


601 
	$ni˚
 (
__öc
Ë
__THROW
 
__wur
;

606 
	$_exô
 (
__°©us
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

612 
	~<bôs/c⁄‚ame.h
>

615 
	$∑thc⁄f
 (c⁄° *
__∑th
, 
__«me
)

616 
__THROW
 
	`__n⁄nuŒ
 ((1));

619 
	$Â©hc⁄f
 (
__fd
, 
__«me
Ë
__THROW
;

622 
	$sysc⁄f
 (
__«me
Ë
__THROW
;

624 #ifdef 
__USE_POSIX2


626 
size_t
 
	$c⁄f°r
 (
__«me
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

631 
__pid_t
 
	$gëpid
 (Ë
__THROW
;

634 
__pid_t
 
	$gëµid
 (Ë
__THROW
;

637 
__pid_t
 
	$gëpgΩ
 (Ë
__THROW
;

640 
__pid_t
 
	$__gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

641 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


642 
__pid_t
 
	$gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

649 
	$£çgid
 (
__pid_t
 
__pid
, __pid_à
__pgid
Ë
__THROW
;

651 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


663 
	$£çgΩ
 (Ë
__THROW
;

670 
__pid_t
 
	$£tsid
 (Ë
__THROW
;

672 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


674 
__pid_t
 
	$gësid
 (
__pid_t
 
__pid
Ë
__THROW
;

678 
__uid_t
 
	$gëuid
 (Ë
__THROW
;

681 
__uid_t
 
	$gëeuid
 (Ë
__THROW
;

684 
__gid_t
 
	$gëgid
 (Ë
__THROW
;

687 
__gid_t
 
	$gëegid
 (Ë
__THROW
;

692 
	$gëgroups
 (
__size
, 
__gid_t
 
__li°
[]Ë
__THROW
 
__wur
;

694 #ifdef 
__USE_GNU


696 
	$group_membî
 (
__gid_t
 
__gid
Ë
__THROW
;

703 
	$£tuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

705 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


708 
	$£åeuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
Ë
__THROW
 
__wur
;

711 #ifde‡
__USE_XOPEN2K


713 
	$£ãuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

720 
	$£tgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

722 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


725 
	$£åegid
 (
__gid_t
 
__rgid
, __gid_à
__egid
Ë
__THROW
 
__wur
;

728 #ifde‡
__USE_XOPEN2K


730 
	$£ãgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

733 #ifde‡
__USE_GNU


736 
	$gëªsuid
 (
__uid_t
 *
__ruid
, __uid_à*
__euid
, __uid_à*
__suid
)

737 
__THROW
;

741 
	$gëªsgid
 (
__gid_t
 *
__rgid
, __gid_à*
__egid
, __gid_à*
__sgid
)

742 
__THROW
;

746 
	$£åesuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
, __uid_à
__suid
)

747 
__THROW
 
__wur
;

751 
	$£åesgid
 (
__gid_t
 
__rgid
, __gid_à
__egid
, __gid_à
__sgid
)

752 
__THROW
 
__wur
;

759 
__pid_t
 
	$f‹k
 (Ë
__THROWNL
;

761 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

762 || 
deföed
 
__USE_MISC


767 
__pid_t
 
	$vf‹k
 (Ë
__THROW
;

773 *
	$ây«me
 (
__fd
Ë
__THROW
;

777 
	$ây«me_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

778 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

782 
	$ißây
 (
__fd
Ë
__THROW
;

784 #i‡
deföed
 
__USE_MISC
 \

785 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_UNIX98
)

788 
	$ây¶Ÿ
 (Ë
__THROW
;

793 
	$lök
 (c⁄° *
__‰om
, c⁄° *
__to
)

794 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

796 #ifde‡
__USE_ATFILE


799 
	$lök©
 (
__‰omfd
, c⁄° *
__‰om
, 
__tofd
,

800 c⁄° *
__to
, 
__Êags
)

801 
__THROW
 
	`__n⁄nuŒ
 ((2, 4)Ë
__wur
;

804 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


806 
	$symlök
 (c⁄° *
__‰om
, c⁄° *
__to
)

807 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

812 
ssize_t
 
	$ªadlök
 (c⁄° *
__ª°ri˘
 
__∑th
,

813 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

814 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

817 #ifde‡
__USE_ATFILE


819 
	$symlök©
 (c⁄° *
__‰om
, 
__tofd
,

820 c⁄° *
__to
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

823 
ssize_t
 
	$ªadlök©
 (
__fd
, c⁄° *
__ª°ri˘
 
__∑th
,

824 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

825 
__THROW
 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
;

829 
	$u∆ök
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

831 #ifde‡
__USE_ATFILE


833 
	$u∆ök©
 (
__fd
, c⁄° *
__«me
, 
__Êag
)

834 
__THROW
 
	`__n⁄nuŒ
 ((2));

838 
	$rmdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

842 
__pid_t
 
	$tcgëpgΩ
 (
__fd
Ë
__THROW
;

845 
	$tc£çgΩ
 (
__fd
, 
__pid_t
 
__pgΩ_id
Ë
__THROW
;

852 *
	`gëlogö
 ();

853 #i‡
deföed
 
__USE_REENTRANT
 || deföed 
__USE_POSIX199506


860 
	$gëlogö_r
 (*
__«me
, 
size_t
 
__«me_Àn
Ë
	`__n⁄nuŒ
 ((1));

863 #ifdef 
__USE_MISC


865 
	$£éogö
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

869 #ifdef 
__USE_POSIX2


873 
	#__√ed_gë›t


	)

874 
	~<gë›t.h
>

878 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


882 
	$gëho°«me
 (*
__«me
, 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

886 #i‡
deföed
 
__USE_MISC


889 
	$£tho°«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

890 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

894 
	$£tho°id
 (
__id
Ë
__THROW
 
__wur
;

900 
	$gëdomaö«me
 (*
__«me
, 
size_t
 
__Àn
)

901 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

902 
	$£tdomaö«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

903 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

909 
	$vh™gup
 (Ë
__THROW
;

912 
	$ªvoke
 (c⁄° *
__fûe
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

920 
	$¥ofû
 (*
__ßm∂e_buf„r
, 
size_t
 
__size
,

921 
size_t
 
__off£t
, 
__sˇÀ
)

922 
__THROW
 
	`__n⁄nuŒ
 ((1));

928 
	$ac˘
 (c⁄° *
__«me
Ë
__THROW
;

932 *
	$gëu£rshñl
 (Ë
__THROW
;

933 
	$ídu£rshñl
 (Ë
__THROW
;

934 
	$£tu£rshñl
 (Ë
__THROW
;

940 
	$d´m⁄
 (
__nochdú
, 
__no˛o£
Ë
__THROW
 
__wur
;

944 #i‡
deföed
 
__USE_MISC
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

947 
	$chroŸ
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

951 *
	$gë∑ss
 (c⁄° *
__¥om±
Ë
	`__n⁄nuŒ
 ((1));

959 
	`fsync
 (
__fd
);

962 #ifde‡
__USE_GNU


965 
	$syncfs
 (
__fd
Ë
__THROW
;

969 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


972 
	`gëho°id
 ();

975 
	$sync
 (Ë
__THROW
;

978 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K


981 
	$gë∑gesize
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

986 
	$gëdèbÀsize
 (Ë
__THROW
;

992 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


995 #i‚de‡
__USE_FILE_OFFSET64


996 
	$åunˇã
 (c⁄° *
__fûe
, 
__off_t
 
__Àngth
)

997 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

999 #ifde‡
__REDIRECT_NTH


1000 
	`__REDIRECT_NTH
 (
åunˇã
,

1001 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
),

1002 
åunˇã64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1004 
	#åunˇã
 
åunˇã64


	)

1007 #ifde‡
__USE_LARGEFILE64


1008 
	$åunˇã64
 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
)

1009 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1014 #i‡
deföed
 
__USE_POSIX199309
 \

1015 || 
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


1018 #i‚de‡
__USE_FILE_OFFSET64


1019 
	$·runˇã
 (
__fd
, 
__off_t
 
__Àngth
Ë
__THROW
 
__wur
;

1021 #ifde‡
__REDIRECT_NTH


1022 
	`__REDIRECT_NTH
 (
·runˇã
, (
__fd
, 
__off64_t
 
__Àngth
),

1023 
·runˇã64
Ë
__wur
;

1025 
	#·runˇã
 
·runˇã64


	)

1028 #ifde‡
__USE_LARGEFILE64


1029 
	$·runˇã64
 (
__fd
, 
__off64_t
 
__Àngth
Ë
__THROW
 
__wur
;

1035 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

1036 || 
deföed
 
__USE_MISC


1040 
	$brk
 (*
__addr
Ë
__THROW
 
__wur
;

1046 *
	$sbrk
 (
öçå_t
 
__dñè
Ë
__THROW
;

1050 #ifde‡
__USE_MISC


1061 
	$sysˇŒ
 (
__sy¢o
, ...Ë
__THROW
;

1066 #i‡(
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
Ë&& !deföed 
F_LOCK


1078 
	#F_ULOCK
 0

	)

1079 
	#F_LOCK
 1

	)

1080 
	#F_TLOCK
 2

	)

1081 
	#F_TEST
 3

	)

1083 #i‚de‡
__USE_FILE_OFFSET64


1084 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Àn
Ë
__wur
;

1086 #ifde‡
__REDIRECT


1087 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
),

1088 
lockf64
Ë
__wur
;

1090 
	#lockf
 
lockf64


	)

1093 #ifde‡
__USE_LARGEFILE64


1094 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
Ë
__wur
;

1099 #ifde‡
__USE_GNU


1104 
	#TEMP_FAILURE_RETRY
(
ex¥essi⁄
) \

1105 (
__exãnsi⁄__
 \

1106 ({ 
__ªsu…
; \

1107 dÿ
__ªsu…
 = (Ë(
ex¥essi⁄
); \

1108 
__ªsu…
 =-1L && 
î∫o
 =
EINTR
); \

1109 
__ªsu…
; 
	}
}))

	)

1112 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_UNIX98


1115 
fd©async
 (
__fûdes
);

1121 #ifdef 
__USE_XOPEN


1123 *
	$¸y±
 (c⁄° *
__key
, c⁄° *
__ß…
)

1124 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1128 
	$í¸y±
 (*
__glibc_block
, 
__edÊag
)

1129 
__THROW
 
	`__n⁄nuŒ
 ((1));

1136 
	$swab
 (c⁄° *
__ª°ri˘
 
__‰om
, *__ª°ri˘ 
__to
,

1137 
ssize_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1143 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K


1145 *
	$˘îmid
 (*
__s
Ë
__THROW
;

1150 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


1151 
	~<bôs/uni°d.h
>

1154 
__END_DECLS


	@/usr/include/zlib.h

31 #i‚de‡
ZLIB_H


32 
	#ZLIB_H


	)

34 
	~"zc⁄f.h
"

36 #ifde‡
__˝lu•lus


40 
	#ZLIB_VERSION
 "1.2.8"

	)

41 
	#ZLIB_VERNUM
 0x1280

	)

42 
	#ZLIB_VER_MAJOR
 1

	)

43 
	#ZLIB_VER_MINOR
 2

	)

44 
	#ZLIB_VER_REVISION
 8

	)

45 
	#ZLIB_VER_SUBREVISION
 0

	)

80 
voidpf
 (*
	tÆloc_func
Ë
	tOF
((
	tvoidpf
 
	t›aque
, 
	tuI¡
 
	tôems
, uI¡ 
	tsize
));

81 (*
‰ì_func
Ë
	tOF
((
	tvoidpf
 
	t›aque
, voidp‡
	taddªss
));

83 
öã∫Æ_°©e
;

85 
	sz_°ªam_s
 {

86 
z_c⁄°
 
Byãf
 *
√xt_ö
;

87 
uI¡
 
avaû_ö
;

88 
uL⁄g
 
tŸÆ_ö
;

90 
Byãf
 *
√xt_out
;

91 
uI¡
 
avaû_out
;

92 
uL⁄g
 
tŸÆ_out
;

94 
z_c⁄°
 *
msg
;

95 
öã∫Æ_°©e
 
FAR
 *
°©e
;

97 
Æloc_func
 
zÆloc
;

98 
‰ì_func
 
z‰ì
;

99 
voidpf
 
›aque
;

101 
d©a_ty≥
;

102 
uL⁄g
 
adÀr
;

103 
uL⁄g
 
ª£rved
;

104 } 
	tz_°ªam
;

106 
z_°ªam
 
	tFAR
 *
	tz_°ªamp
;

112 
	sgz_hódî_s
 {

113 
ãxt
;

114 
uL⁄g
 
time
;

115 
xÊags
;

116 
os
;

117 
Byãf
 *
exåa
;

118 
uI¡
 
exåa_Àn
;

119 
uI¡
 
exåa_max
;

120 
Byãf
 *
«me
;

121 
uI¡
 
«me_max
;

122 
Byãf
 *
commít
;

123 
uI¡
 
comm_max
;

124 
h¸c
;

125 
d⁄e
;

127 } 
	tgz_hódî
;

129 
gz_hódî
 
	tFAR
 *
	tgz_hódîp
;

164 
	#Z_NO_FLUSH
 0

	)

165 
	#Z_PARTIAL_FLUSH
 1

	)

166 
	#Z_SYNC_FLUSH
 2

	)

167 
	#Z_FULL_FLUSH
 3

	)

168 
	#Z_FINISH
 4

	)

169 
	#Z_BLOCK
 5

	)

170 
	#Z_TREES
 6

	)

173 
	#Z_OK
 0

	)

174 
	#Z_STREAM_END
 1

	)

175 
	#Z_NEED_DICT
 2

	)

176 
	#Z_ERRNO
 (-1)

	)

177 
	#Z_STREAM_ERROR
 (-2)

	)

178 
	#Z_DATA_ERROR
 (-3)

	)

179 
	#Z_MEM_ERROR
 (-4)

	)

180 
	#Z_BUF_ERROR
 (-5)

	)

181 
	#Z_VERSION_ERROR
 (-6)

	)

186 
	#Z_NO_COMPRESSION
 0

	)

187 
	#Z_BEST_SPEED
 1

	)

188 
	#Z_BEST_COMPRESSION
 9

	)

189 
	#Z_DEFAULT_COMPRESSION
 (-1)

	)

192 
	#Z_FILTERED
 1

	)

193 
	#Z_HUFFMAN_ONLY
 2

	)

194 
	#Z_RLE
 3

	)

195 
	#Z_FIXED
 4

	)

196 
	#Z_DEFAULT_STRATEGY
 0

	)

199 
	#Z_BINARY
 0

	)

200 
	#Z_TEXT
 1

	)

201 
	#Z_ASCII
 
Z_TEXT


	)

202 
	#Z_UNKNOWN
 2

	)

205 
	#Z_DEFLATED
 8

	)

208 
	#Z_NULL
 0

	)

210 
	#zlib_vîsi⁄
 
	`zlibVîsi⁄
()

	)

216 
ZEXTERN
 c⁄° * 
ZEXPORT
 
zlibVîsi⁄
 
OF
(());

246 
ZEXTERN
 
ZEXPORT
 
deÊ©e
 
OF
((
z_°ªamp
 
°rm
, 
Êush
));

353 
ZEXTERN
 
ZEXPORT
 
deÊ©eEnd
 
OF
((
z_°ªamp
 
°rm
));

392 
ZEXTERN
 
ZEXPORT
 
öÊ©e
 
OF
((
z_°ªamp
 
°rm
, 
Êush
));

508 
ZEXTERN
 
ZEXPORT
 
öÊ©eEnd
 
OF
((
z_°ªamp
 
°rm
));

587 
ZEXTERN
 
ZEXPORT
 
deÊ©eSëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

588 c⁄° 
Byãf
 *
di˘i⁄¨y
,

589 
uI¡
 
di˘Lígth
));

631 
ZEXTERN
 
ZEXPORT
 
deÊ©eC›y
 
OF
((
z_°ªamp
 
de°
,

632 
z_°ªamp
 
sour˚
));

649 
ZEXTERN
 
ZEXPORT
 
deÊ©eRe£t
 
OF
((
z_°ªamp
 
°rm
));

660 
ZEXTERN
 
ZEXPORT
 
deÊ©eP¨ams
 
OF
((
z_°ªamp
 
°rm
,

661 
Àvñ
,

662 
°øãgy
));

681 
ZEXTERN
 
ZEXPORT
 
deÊ©eTu√
 
OF
((
z_°ªamp
 
°rm
,

682 
good_Àngth
,

683 
max_œzy
,

684 
ni˚_Àngth
,

685 
max_chaö
));

698 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
deÊ©eBound
 
OF
((
z_°ªamp
 
°rm
,

699 
uL⁄g
 
sour˚Lí
));

713 
ZEXTERN
 
ZEXPORT
 
deÊ©ePídög
 
OF
((
z_°ªamp
 
°rm
,

714 *
≥ndög
,

715 *
bôs
));

728 
ZEXTERN
 
ZEXPORT
 
deÊ©ePrime
 
OF
((
z_°ªamp
 
°rm
,

729 
bôs
,

730 
vÆue
));

745 
ZEXTERN
 
ZEXPORT
 
deÊ©eSëHódî
 
OF
((
z_°ªamp
 
°rm
,

746 
gz_hódîp
 
hód
));

819 
ZEXTERN
 
ZEXPORT
 
öÊ©eSëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

820 c⁄° 
Byãf
 *
di˘i⁄¨y
,

821 
uI¡
 
di˘Lígth
));

842 
ZEXTERN
 
ZEXPORT
 
öÊ©eGëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

843 
Byãf
 *
di˘i⁄¨y
,

844 
uI¡
 *
di˘Lígth
));

857 
ZEXTERN
 
ZEXPORT
 
öÊ©eSync
 
OF
((
z_°ªamp
 
°rm
));

876 
ZEXTERN
 
ZEXPORT
 
öÊ©eC›y
 
OF
((
z_°ªamp
 
de°
,

877 
z_°ªamp
 
sour˚
));

892 
ZEXTERN
 
ZEXPORT
 
öÊ©eRe£t
 
OF
((
z_°ªamp
 
°rm
));

902 
ZEXTERN
 
ZEXPORT
 
öÊ©eRe£t2
 
OF
((
z_°ªamp
 
°rm
,

903 
wödowBôs
));

914 
ZEXTERN
 
ZEXPORT
 
öÊ©ePrime
 
OF
((
z_°ªamp
 
°rm
,

915 
bôs
,

916 
vÆue
));

935 
ZEXTERN
 
ZEXPORT
 
öÊ©eM¨k
 
OF
((
z_°ªamp
 
°rm
));

963 
ZEXTERN
 
ZEXPORT
 
öÊ©eGëHódî
 
OF
((
z_°ªamp
 
°rm
,

964 
gz_hódîp
 
hód
));

1025 (*
ö_func
Ë
	tOF
((
	tFAR
 *,

1026 
	tz_c⁄°
 
	tFAR
 * FAR *));

1027 (*
out_func
Ë
	tOF
((
	tFAR
 *, FAR *, ));

1029 
ZEXTERN
 
ZEXPORT
 
öÊ©eBack
 
OF
((
z_°ªamp
 
°rm
,

1030 
ö_func
 
ö
, 
FAR
 *
ö_desc
,

1031 
out_func
 
out
, 
FAR
 *
out_desc
));

1099 
ZEXTERN
 
ZEXPORT
 
öÊ©eBackEnd
 
OF
((
z_°ªamp
 
°rm
));

1107 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
zlibCompûeFœgs
 
OF
(());

1148 #i‚de‡
Z_SOLO


1160 
ZEXTERN
 
ZEXPORT
 
com¥ess
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1161 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
));

1174 
ZEXTERN
 
ZEXPORT
 
com¥ess2
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1175 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
,

1176 
Àvñ
));

1190 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
com¥essBound
 
OF
((uL⁄g 
sour˚Lí
));

1197 
ZEXTERN
 
ZEXPORT
 
uncom¥ess
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1198 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
));

1224 
gzFûe_s
 *
	tgzFûe
;

1264 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gzd›í
 
OF
((
fd
, c⁄° *
mode
));

1287 
ZEXTERN
 
ZEXPORT
 
gzbuf„r
 
OF
((
gzFûe
 
fûe
, 
size
));

1304 
ZEXTERN
 
ZEXPORT
 
gz£ç¨ams
 
OF
((
gzFûe
 
fûe
, 
Àvñ
, 
°øãgy
));

1313 
ZEXTERN
 
ZEXPORT
 
gzªad
 
OF
((
gzFûe
 
fûe
, 
voidp
 
buf
, 
Àn
));

1341 
ZEXTERN
 
ZEXPORT
 
gzwrôe
 
OF
((
gzFûe
 
fûe
,

1342 
voidpc
 
buf
, 
Àn
));

1349 
ZEXTERN
 
ZEXPORTVA
 
gz¥ötf
 
Z_ARG
((
gzFûe
 
fûe
, c⁄° *
f‹m©
, ...));

1364 
ZEXTERN
 
ZEXPORT
 
gzputs
 
OF
((
gzFûe
 
fûe
, c⁄° *
s
));

1372 
ZEXTERN
 * 
ZEXPORT
 
gzgës
 
OF
((
gzFûe
 
fûe
, *
buf
, 
Àn
));

1385 
ZEXTERN
 
ZEXPORT
 
gzputc
 
OF
((
gzFûe
 
fûe
, 
c
));

1391 
ZEXTERN
 
ZEXPORT
 
gzgëc
 
OF
((
gzFûe
 
fûe
));

1400 
ZEXTERN
 
ZEXPORT
 
gzungëc
 
OF
((
c
, 
gzFûe
 
fûe
));

1412 
ZEXTERN
 
ZEXPORT
 
gzÊush
 
OF
((
gzFûe
 
fûe
, 
Êush
));

1447 
ZEXTERN
 
ZEXPORT
 
gzªwöd
 
OF
((
gzFûe
 
fûe
));

1475 
ZEXTERN
 
ZEXPORT
 
gzeof
 
OF
((
gzFûe
 
fûe
));

1490 
ZEXTERN
 
ZEXPORT
 
gzdúe˘
 
OF
((
gzFûe
 
fûe
));

1511 
ZEXTERN
 
ZEXPORT
 
gz˛o£
 
OF
((
gzFûe
 
fûe
));

1524 
ZEXTERN
 
ZEXPORT
 
gz˛o£_r
 
OF
((
gzFûe
 
fûe
));

1525 
ZEXTERN
 
ZEXPORT
 
gz˛o£_w
 
OF
((
gzFûe
 
fûe
));

1536 
ZEXTERN
 c⁄° * 
ZEXPORT
 
gzîr‹
 
OF
((
gzFûe
 
fûe
, *
î∫um
));

1552 
ZEXTERN
 
ZEXPORT
 
gz˛óªº
 
OF
((
gzFûe
 
fûe
));

1569 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32
 
OF
((uL⁄g 
adÀr
, c⁄° 
Byãf
 *
buf
, 
uI¡
 
Àn
));

1600 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32
 
OF
((uL⁄g 
¸c
, c⁄° 
Byãf
 *
buf
, 
uI¡
 
Àn
));

1633 
ZEXTERN
 
ZEXPORT
 
deÊ©eInô_
 
OF
((
z_°ªamp
 
°rm
, 
Àvñ
,

1634 c⁄° *
vîsi⁄
, 
°ªam_size
));

1635 
ZEXTERN
 
ZEXPORT
 
öÊ©eInô_
 
OF
((
z_°ªamp
 
°rm
,

1636 c⁄° *
vîsi⁄
, 
°ªam_size
));

1637 
ZEXTERN
 
ZEXPORT
 
deÊ©eInô2_
 
OF
((
z_°ªamp
 
°rm
, 
Àvñ
, 
mëhod
,

1638 
wödowBôs
, 
memLevñ
,

1639 
°øãgy
, c⁄° *
vîsi⁄
,

1640 
°ªam_size
));

1641 
ZEXTERN
 
ZEXPORT
 
öÊ©eInô2_
 
OF
((
z_°ªamp
 
°rm
, 
wödowBôs
,

1642 c⁄° *
vîsi⁄
, 
°ªam_size
));

1643 
ZEXTERN
 
ZEXPORT
 
öÊ©eBackInô_
 
OF
((
z_°ªamp
 
°rm
, 
wödowBôs
,

1644 
FAR
 *
wödow
,

1645 c⁄° *
vîsi⁄
,

1646 
°ªam_size
));

1647 
	#deÊ©eInô
(
°rm
, 
Àvñ
) \

1648 
	`deÊ©eInô_
((
°rm
), (
Àvñ
), 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1649 
	#öÊ©eInô
(
°rm
) \

1650 
	`öÊ©eInô_
((
°rm
), 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1651 
	#deÊ©eInô2
(
°rm
, 
Àvñ
, 
mëhod
, 
wödowBôs
, 
memLevñ
, 
°øãgy
) \

1652 
	`deÊ©eInô2_
((
°rm
),(
Àvñ
),(
mëhod
),(
wödowBôs
),(
memLevñ
),\

1653 (
°øãgy
), 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1654 
	#öÊ©eInô2
(
°rm
, 
wödowBôs
) \

1655 
	`öÊ©eInô2_
((
°rm
), (
wödowBôs
), 
ZLIB_VERSION
, \

1656 ()(
z_°ªam
))

	)

1657 
	#öÊ©eBackInô
(
°rm
, 
wödowBôs
, 
wödow
) \

1658 
	`öÊ©eBackInô_
((
°rm
), (
wödowBôs
), (
wödow
), \

1659 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1661 #i‚de‡
Z_SOLO


1670 
	sgzFûe_s
 {

1671 
have
;

1672 *
√xt
;

1673 
z_off64_t
 
pos
;

1675 
ZEXTERN
 
ZEXPORT
 
gzgëc_
 
OF
((
gzFûe
 
fûe
));

1676 #ifde‡
Z_PREFIX_SET


1677 #unde‡
z_gzgëc


1678 
	#z_gzgëc
(
g
) \

1679 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
√xt
)++Ë: 
	`gzgëc
(g))

	)

1681 
	#gzgëc
(
g
) \

1682 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
√xt
)++Ë: 
	`gzgëc
(g))

	)

1691 #ifde‡
Z_LARGE64


1692 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í64
 
OF
((const *, const *));

1693 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFûe
, z_off64_t, ));

1694 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gzãŒ64
 
OF
((
gzFûe
));

1695 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFûe
));

1696 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off64_t
));

1697 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off64_t
));

1700 #i‡!
deföed
(
ZLIB_INTERNAL
Ë&& deföed(
Z_WANT64
)

1701 #ifde‡
Z_PREFIX_SET


1702 
	#z_gz›í
 
z_gz›í64


	)

1703 
	#z_gz£ek
 
z_gz£ek64


	)

1704 
	#z_gzãŒ
 
z_gzãŒ64


	)

1705 
	#z_gzoff£t
 
z_gzoff£t64


	)

1706 
	#z_adÀr32_comböe
 
z_adÀr32_comböe64


	)

1707 
	#z_¸c32_comböe
 
z_¸c32_comböe64


	)

1709 
	#gz›í
 
gz›í64


	)

1710 
	#gz£ek
 
gz£ek64


	)

1711 
	#gzãŒ
 
gzãŒ64


	)

1712 
	#gzoff£t
 
gzoff£t64


	)

1713 
	#adÀr32_comböe
 
adÀr32_comböe64


	)

1714 
	#¸c32_comböe
 
¸c32_comböe64


	)

1716 #i‚de‡
Z_LARGE64


1717 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í64
 
OF
((const *, const *));

1718 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFûe
, z_off_t, ));

1719 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzãŒ64
 
OF
((
gzFûe
));

1720 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFûe
));

1721 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1722 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1725 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í
 
OF
((const *, const *));

1726 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek
 
OF
((
gzFûe
, z_off_t, ));

1727 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzãŒ
 
OF
((
gzFûe
));

1728 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t
 
OF
((
gzFûe
));

1729 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1730 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1735 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1736 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1741 #i‡!
deföed
(
ZUTIL_H
Ë&& !deföed(
NO_DUMMY_DECL
)

1742 
	söã∫Æ_°©e
 {
dummy
;};

1746 
ZEXTERN
 c⁄° * 
ZEXPORT
 
zEº‹
 
OF
(());

1747 
ZEXTERN
 
ZEXPORT
 
öÊ©eSyncPoöt
 
OF
((
z_°ªamp
));

1748 
ZEXTERN
 c⁄° 
z_¸c_t
 
FAR
 * 
ZEXPORT
 
gë_¸c_èbÀ
 
OF
(());

1749 
ZEXTERN
 
ZEXPORT
 
öÊ©eUndîmöe
 
OF
((
z_°ªamp
, ));

1750 
ZEXTERN
 
ZEXPORT
 
öÊ©eRe£tKìp
 
OF
((
z_°ªamp
));

1751 
ZEXTERN
 
ZEXPORT
 
deÊ©eRe£tKìp
 
OF
((
z_°ªamp
));

1752 #i‡
deföed
(
_WIN32
Ë&& !deföed(
Z_SOLO
)

1753 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í_w
 
OF
((c⁄° 
wch¨_t
 *
∑th
,

1754 c⁄° *
mode
));

1756 #i‡
deföed
(
STDC
Ë|| deföed(
Z_HAVE_STDARG_H
)

1757 #i‚de‡
Z_SOLO


1758 
ZEXTERN
 
ZEXPORTVA
 
gzv¥ötf
 
Z_ARG
((
gzFûe
 
fûe
,

1759 c⁄° *
f‹m©
,

1760 
va_li°
 
va
));

1764 #ifde‡
__˝lu•lus


	@/usr/include/features.h

18 #i‚def 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

97 #unde‡
__USE_ISOC11


98 #unde‡
__USE_ISOC99


99 #unde‡
__USE_ISOC95


100 #unde‡
__USE_ISOCXX11


101 #unde‡
__USE_POSIX


102 #unde‡
__USE_POSIX2


103 #unde‡
__USE_POSIX199309


104 #unde‡
__USE_POSIX199506


105 #unde‡
__USE_XOPEN


106 #unde‡
__USE_XOPEN_EXTENDED


107 #unde‡
__USE_UNIX98


108 #unde‡
__USE_XOPEN2K


109 #unde‡
__USE_XOPEN2KXSI


110 #unde‡
__USE_XOPEN2K8


111 #unde‡
__USE_XOPEN2K8XSI


112 #unde‡
__USE_LARGEFILE


113 #unde‡
__USE_LARGEFILE64


114 #unde‡
__USE_FILE_OFFSET64


115 #unde‡
__USE_MISC


116 #unde‡
__USE_ATFILE


117 #unde‡
__USE_GNU


118 #unde‡
__USE_REENTRANT


119 #unde‡
__USE_FORTIFY_LEVEL


120 #unde‡
__KERNEL_STRICT_NAMES


124 #i‚de‡
_LOOSE_KERNEL_NAMES


125 
	#__KERNEL_STRICT_NAMES


	)

135 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


136 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

137 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

139 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

146 #i‡(
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE
) \

147 && !
deföed
 
	g_DEFAULT_SOURCE


152 #unde‡
_DEFAULT_SOURCE


153 
	#_DEFAULT_SOURCE
 1

	)

157 #ifde‡
_GNU_SOURCE


158 #unde‡
_ISOC95_SOURCE


159 
	#_ISOC95_SOURCE
 1

	)

160 #unde‡
_ISOC99_SOURCE


161 
	#_ISOC99_SOURCE
 1

	)

162 #unde‡
_ISOC11_SOURCE


163 
	#_ISOC11_SOURCE
 1

	)

164 #unde‡
_POSIX_SOURCE


165 
	#_POSIX_SOURCE
 1

	)

166 #unde‡
_POSIX_C_SOURCE


167 
	#_POSIX_C_SOURCE
 200809L

	)

168 #unde‡
_XOPEN_SOURCE


169 
	#_XOPEN_SOURCE
 700

	)

170 #unde‡
_XOPEN_SOURCE_EXTENDED


171 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

172 #unde‡
_LARGEFILE64_SOURCE


173 
	#_LARGEFILE64_SOURCE
 1

	)

174 #unde‡
_DEFAULT_SOURCE


175 
	#_DEFAULT_SOURCE
 1

	)

176 #unde‡
_ATFILE_SOURCE


177 
	#_ATFILE_SOURCE
 1

	)

182 #i‡(
deföed
 
_DEFAULT_SOURCE
 \

183 || (!
deföed
 
	g__STRICT_ANSI__
 \

184 && !
deföed
 
	g_ISOC99_SOURCE
 \

185 && !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 \

186 && !
deföed
 
	g_XOPEN_SOURCE
))

187 #unde‡
_DEFAULT_SOURCE


188 
	#_DEFAULT_SOURCE
 1

	)

192 #i‡(
deföed
 
_ISOC11_SOURCE
 \

193 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

194 
	#__USE_ISOC11
 1

	)

198 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

199 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

200 
	#__USE_ISOC99
 1

	)

204 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

205 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

206 
	#__USE_ISOC95
 1

	)

213 #i‡((
deföed
 
__˝lu•lus
 && __cplusplus >= 201103L) \

214 || 
deföed
 
__GXX_EXPERIMENTAL_CXX0X__
)

215 
	#__USE_ISOCXX11
 1

	)

221 #ifde‡
_DEFAULT_SOURCE


222 #i‡!
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE


223 
	#__USE_POSIX_IMPLICITLY
 1

	)

225 #unde‡
_POSIX_SOURCE


226 
	#_POSIX_SOURCE
 1

	)

227 #unde‡
_POSIX_C_SOURCE


228 
	#_POSIX_C_SOURCE
 200809L

	)

230 #i‡((!
deföed
 
__STRICT_ANSI__
 \

231 || (
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

232 && !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

233 
	#_POSIX_SOURCE
 1

	)

234 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

235 
	#_POSIX_C_SOURCE
 2

	)

236 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

237 
	#_POSIX_C_SOURCE
 199506L

	)

238 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

239 
	#_POSIX_C_SOURCE
 200112L

	)

241 
	#_POSIX_C_SOURCE
 200809L

	)

243 
	#__USE_POSIX_IMPLICITLY
 1

	)

246 #i‡(
deföed
 
_POSIX_SOURCE
 \

247 || (
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

248 || 
deföed
 
_XOPEN_SOURCE
)

249 
	#__USE_POSIX
 1

	)

252 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


253 
	#__USE_POSIX2
 1

	)

256 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

257 
	#__USE_POSIX199309
 1

	)

260 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

261 
	#__USE_POSIX199506
 1

	)

264 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

265 
	#__USE_XOPEN2K
 1

	)

266 #unde‡
__USE_ISOC95


267 
	#__USE_ISOC95
 1

	)

268 #unde‡
__USE_ISOC99


269 
	#__USE_ISOC99
 1

	)

272 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

273 
	#__USE_XOPEN2K8
 1

	)

274 #unde‡
_ATFILE_SOURCE


275 
	#_ATFILE_SOURCE
 1

	)

278 #ifdef 
_XOPEN_SOURCE


279 
	#__USE_XOPEN
 1

	)

280 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

281 
	#__USE_XOPEN_EXTENDED
 1

	)

282 
	#__USE_UNIX98
 1

	)

283 #unde‡
_LARGEFILE_SOURCE


284 
	#_LARGEFILE_SOURCE
 1

	)

285 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

286 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

287 
	#__USE_XOPEN2K8
 1

	)

288 
	#__USE_XOPEN2K8XSI
 1

	)

290 
	#__USE_XOPEN2K
 1

	)

291 
	#__USE_XOPEN2KXSI
 1

	)

292 #unde‡
__USE_ISOC95


293 
	#__USE_ISOC95
 1

	)

294 #unde‡
__USE_ISOC99


295 
	#__USE_ISOC99
 1

	)

298 #ifde‡
_XOPEN_SOURCE_EXTENDED


299 
	#__USE_XOPEN_EXTENDED
 1

	)

304 #ifde‡
_LARGEFILE_SOURCE


305 
	#__USE_LARGEFILE
 1

	)

308 #ifde‡
_LARGEFILE64_SOURCE


309 
	#__USE_LARGEFILE64
 1

	)

312 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

313 
	#__USE_FILE_OFFSET64
 1

	)

316 #i‡
deföed
 
_DEFAULT_SOURCE


317 
	#__USE_MISC
 1

	)

320 #ifdef 
_ATFILE_SOURCE


321 
	#__USE_ATFILE
 1

	)

324 #ifdef 
_GNU_SOURCE


325 
	#__USE_GNU
 1

	)

328 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


329 
	#__USE_REENTRANT
 1

	)

332 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

333 && 
__GNUC_PREREQ
 (4, 1Ë&& 
deföed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

334 #i‡
_FORTIFY_SOURCE
 > 1

335 
	#__USE_FORTIFY_LEVEL
 2

	)

337 
	#__USE_FORTIFY_LEVEL
 1

	)

340 
	#__USE_FORTIFY_LEVEL
 0

	)

345 
	~<°dc-¥edef.h
>

353 #unde‡
__GNU_LIBRARY__


354 
	#__GNU_LIBRARY__
 6

	)

358 
	#__GLIBC__
 2

	)

359 
	#__GLIBC_MINOR__
 23

	)

361 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

362 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

365 #i‚de‡
__ASSEMBLER__


366 #i‚de‡
_SYS_CDEFS_H


367 
	~<sys/cdefs.h
>

372 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


373 
	#__USE_LARGEFILE
 1

	)

374 
	#__USE_LARGEFILE64
 1

	)

380 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

381 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

382 && 
deföed
 
	g__exã∫_ölöe


383 
	#__USE_EXTERN_INLINES
 1

	)

391 
	~<gnu/°ubs.h
>

	@/usr/include/getopt.h

19 #i‚de‡
_GETOPT_H


21 #i‚de‡
__√ed_gë›t


22 
	#_GETOPT_H
 1

	)

32 #i‡!
deföed
 
__GNU_LIBRARY__


33 
	~<˘y≥.h
>

36 #i‚de‡
__THROW


37 #i‚de‡
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë(0)

	)

40 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__˝lu•lus


57 *
›èrg
;

71 
›töd
;

76 
›ãº
;

80 
›t›t
;

82 #i‚de‡
__√ed_gë›t


104 
	s›ti⁄


106 c⁄° *
	g«me
;

109 
	ghas_¨g
;

110 *
	gÊag
;

111 
	gvÆ
;

116 
	#no_¨gumít
 0

	)

117 
	#ªquúed_¨gumít
 1

	)

118 
	#›ti⁄Æ_¨gumít
 2

	)

146 #ifde‡
__GNU_LIBRARY__


150 
gë›t
 (
___¨gc
, *c⁄° *
___¨gv
, c⁄° *
__sh‹t›ts
)

151 
__THROW
;

153 #i‡
deföed
 
__√ed_gë›t
 && deföed 
__USE_POSIX2
 \

154 && !
deföed
 
	g__USE_POSIX_IMPLICITLY
 && !deföed 
	g__USE_GNU


158 #ifde‡
__REDIRECT


159 
__REDIRECT_NTH
 (
gë›t
, (
___¨gc
, *c⁄° *
___¨gv
,

160 c⁄° *
__sh‹t›ts
),

161 
__posix_gë›t
);

163 
__posix_gë›t
 (
___¨gc
, *c⁄° *
___¨gv
,

164 c⁄° *
__sh‹t›ts
Ë
__THROW
;

165 
	#gë›t
 
__posix_gë›t


	)

169 
gë›t
 ();

172 #i‚de‡
__√ed_gë›t


173 
gë›t_l⁄g
 (
___¨gc
, *c⁄° *
___¨gv
,

174 c⁄° *
__sh‹t›ts
,

175 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

176 
__THROW
;

177 
gë›t_l⁄g_⁄ly
 (
___¨gc
, *c⁄° *
___¨gv
,

178 c⁄° *
__sh‹t›ts
,

179 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

180 
__THROW
;

184 #ifdef 
__˝lu•lus


189 #unde‡
__√ed_gë›t


	@/usr/include/libio.h

28 #i‚de‡
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_c⁄fig.h
>

33 
	#_IO_Âos_t
 
_G_Âos_t


	)

34 
	#_IO_Âos64_t
 
_G_Âos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_ic⁄v_t
 
_G_ic⁄v_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li°
 
_G_va_li°


	)

45 
	#_IO_wöt_t
 
wöt_t


	)

48 
	#__√ed___va_li°


	)

49 
	~<°d¨g.h
>

50 #ifde‡
__GNUC_VA_LIST


51 #unde‡
_IO_va_li°


52 
	#_IO_va_li°
 
__gnuc_va_li°


	)

55 #i‚de‡
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #i‚de‡
EOF


62 
	#EOF
 (-1)

	)

64 #i‚de‡
NULL


65 #i‡
deföed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuŒ
)

	)

69 #i‡!
deföed
(
__˝lu•lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifde‡
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifde‡
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifde‡
_IO_MTSAFE_IO


150 
	t_IO_lock_t
;

156 
	s_IO_m¨kî
 {

157 
_IO_m¨kî
 *
	m_√xt
;

158 
_IO_FILE
 *
	m_sbuf
;

162 
	m_pos
;

164 
£t_°ªampos
(
°ªampos
 
•
Ë{ 
	m_•os
 = sp; }

165 
£t_off£t
(
off£t
Ë{ 
	m_pos
 = off£t; 
	m_•os
 = (
°ªampos
)(-2); }

166 
	mpublic
:

167 
°ªamm¨kî
(
°ªambuf
 *
sb
);

168 ~
°ªamm¨kî
();

169 
ßvög
(Ë{  
	m_•os
 == -2; }

170 
dñè
(
°ªamm¨kî
&);

171 
dñè
();

176 
	e__codecvt_ªsu…


178 
	m__codecvt_ok
,

179 
	m__codecvt_∑πül
,

180 
	m__codecvt_îr‹
,

181 
	m__codecvt_noc⁄v


184 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


187 
	s_IO_codecvt


189 (*
	m__codecvt_de°r
Ë(
	m_IO_codecvt
 *);

190 
__codecvt_ªsu…
 (*
__codecvt_do_out
Ë(
	m_IO_codecvt
 *,

191 
	m__mb°©e_t
 *,

192 c⁄° 
	mwch¨_t
 *,

193 c⁄° 
	mwch¨_t
 *,

194 c⁄° 
	mwch¨_t
 **, *,

196 
__codecvt_ªsu…
 (*
__codecvt_do_unshi·
Ë(
	m_IO_codecvt
 *,

197 
	m__mb°©e_t
 *, *,

199 
__codecvt_ªsu…
 (*
__codecvt_do_ö
Ë(
	m_IO_codecvt
 *,

200 
	m__mb°©e_t
 *,

202 c⁄° **, 
	mwch¨_t
 *,

203 
	mwch¨_t
 *, wchar_t **);

204 (*
	m__codecvt_do_ícodög
Ë(
	m_IO_codecvt
 *);

205 (*
	m__codecvt_do_Æways_noc⁄v
Ë(
	m_IO_codecvt
 *);

206 (*
	m__codecvt_do_Àngth
Ë(
	m_IO_codecvt
 *, 
	m__mb°©e_t
 *,

207 c⁄° *, c⁄° *, 
	m_IO_size_t
);

208 (*
	m__codecvt_do_max_Àngth
Ë(
	m_IO_codecvt
 *);

210 
_IO_ic⁄v_t
 
	m__cd_ö
;

211 
_IO_ic⁄v_t
 
	m__cd_out
;

215 
	s_IO_wide_d©a


217 
wch¨_t
 *
	m_IO_ªad_±r
;

218 
wch¨_t
 *
	m_IO_ªad_íd
;

219 
wch¨_t
 *
	m_IO_ªad_ba£
;

220 
wch¨_t
 *
	m_IO_wrôe_ba£
;

221 
wch¨_t
 *
	m_IO_wrôe_±r
;

222 
wch¨_t
 *
	m_IO_wrôe_íd
;

223 
wch¨_t
 *
	m_IO_buf_ba£
;

224 
wch¨_t
 *
	m_IO_buf_íd
;

226 
wch¨_t
 *
	m_IO_ßve_ba£
;

227 
wch¨_t
 *
	m_IO_backup_ba£
;

229 
wch¨_t
 *
	m_IO_ßve_íd
;

231 
__mb°©e_t
 
	m_IO_°©e
;

232 
__mb°©e_t
 
	m_IO_œ°_°©e
;

233 
_IO_codecvt
 
	m_codecvt
;

235 
wch¨_t
 
	m_sh‹tbuf
[1];

237 c⁄° 
_IO_jump_t
 *
	m_wide_vèbÀ
;

241 
	s_IO_FILE
 {

242 
	m_Êags
;

243 
	#_IO_fûe_Êags
 
_Êags


	)

247 * 
	m_IO_ªad_±r
;

248 * 
	m_IO_ªad_íd
;

249 * 
	m_IO_ªad_ba£
;

250 * 
	m_IO_wrôe_ba£
;

251 * 
	m_IO_wrôe_±r
;

252 * 
	m_IO_wrôe_íd
;

253 * 
	m_IO_buf_ba£
;

254 * 
	m_IO_buf_íd
;

256 *
	m_IO_ßve_ba£
;

257 *
	m_IO_backup_ba£
;

258 *
	m_IO_ßve_íd
;

260 
_IO_m¨kî
 *
	m_m¨kîs
;

262 
_IO_FILE
 *
	m_chaö
;

264 
	m_fûío
;

266 
	m_blksize
;

268 
	m_Êags2
;

270 
_IO_off_t
 
	m_ﬁd_off£t
;

272 
	#__HAVE_COLUMN


	)

274 
	m_cur_cﬁumn
;

275 sig√d 
	m_vèbÀ_off£t
;

276 
	m_sh‹tbuf
[1];

280 
_IO_lock_t
 *
	m_lock
;

281 #ifde‡
_IO_USE_OLD_IO_FILE


284 
	s_IO_FILE_com∂ëe


286 
_IO_FILE
 
	m_fûe
;

288 #i‡
deföed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

289 
_IO_off64_t
 
	m_off£t
;

290 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


292 
_IO_codecvt
 *
	m_codecvt
;

293 
_IO_wide_d©a
 *
	m_wide_d©a
;

294 
_IO_FILE
 *
	m_‰ìªs_li°
;

295 *
	m_‰ìªs_buf
;

297 *
	m__∑d1
;

298 *
	m__∑d2
;

299 *
	m__∑d3
;

300 *
	m__∑d4
;

302 
size_t
 
	m__∑d5
;

303 
	m_mode
;

305 
	m_unu£d2
[15 *  (Ë- 4 *  (*Ë-  (
size_t
)];

309 #i‚de‡
__˝lu•lus


310 
_IO_FILE
 
	t_IO_FILE
;

313 
	g_IO_FILE_∂us
;

315 
_IO_FILE_∂us
 
_IO_2_1_°dö_
;

316 
_IO_FILE_∂us
 
_IO_2_1_°dout_
;

317 
_IO_FILE_∂us
 
_IO_2_1_°dîr_
;

318 #i‚de‡
_LIBC


319 
	#_IO_°dö
 ((
_IO_FILE
*)(&
_IO_2_1_°dö_
))

	)

320 
	#_IO_°dout
 ((
_IO_FILE
*)(&
_IO_2_1_°dout_
))

	)

321 
	#_IO_°dîr
 ((
_IO_FILE
*)(&
_IO_2_1_°dîr_
))

	)

323 
_IO_FILE
 *
_IO_°dö
 
©åibuã_hiddí
;

324 
_IO_FILE
 *
_IO_°dout
 
©åibuã_hiddí
;

325 
_IO_FILE
 *
_IO_°dîr
 
©åibuã_hiddí
;

333 
__ssize_t
 
	t__io_ªad_‚
 (*
	t__cookõ
, *
	t__buf
, 
	tsize_t
 
	t__nbyãs
);

341 
__ssize_t
 
	t__io_wrôe_‚
 (*
	t__cookõ
, c⁄° *
	t__buf
,

342 
	tsize_t
 
	t__n
);

350 
	t__io_£ek_‚
 (*
	t__cookõ
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

353 
	t__io_˛o£_‚
 (*
	t__cookõ
);

356 #ifde‡
_GNU_SOURCE


358 
__io_ªad_‚
 
	tcookõ_ªad_fun˘i⁄_t
;

359 
__io_wrôe_‚
 
	tcookõ_wrôe_fun˘i⁄_t
;

360 
__io_£ek_‚
 
	tcookõ_£ek_fun˘i⁄_t
;

361 
__io_˛o£_‚
 
	tcookõ_˛o£_fun˘i⁄_t
;

366 
__io_ªad_‚
 *
	mªad
;

367 
__io_wrôe_‚
 *
	mwrôe
;

368 
__io_£ek_‚
 *
	m£ek
;

369 
__io_˛o£_‚
 *
	m˛o£
;

370 } 
	t_IO_cookõ_io_fun˘i⁄s_t
;

371 
_IO_cookõ_io_fun˘i⁄s_t
 
	tcookõ_io_fun˘i⁄s_t
;

373 
	g_IO_cookõ_fûe
;

376 
_IO_cookõ_öô
 (
_IO_cookõ_fûe
 *
__cfûe
, 
__ªad_wrôe
,

377 *
__cookõ
, 
_IO_cookõ_io_fun˘i⁄s_t
 
__‚s
);

381 #ifde‡
__˝lu•lus


385 
__undîÊow
 (
_IO_FILE
 *);

386 
__uÊow
 (
_IO_FILE
 *);

387 
__ovîÊow
 (
_IO_FILE
 *, );

388 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


389 
_IO_wöt_t
 
__wundîÊow
 (
_IO_FILE
 *);

390 
_IO_wöt_t
 
__wuÊow
 (
_IO_FILE
 *);

391 
_IO_wöt_t
 
__wovîÊow
 (
_IO_FILE
 *, _IO_wint_t);

394 #i‡ 
__GNUC__
 >= 3

395 
	#_IO_BE
(
ex¥
, 
ªs
Ë
	`__buûtö_ex≥˘
 (”x¥),Ñes)

	)

397 
	#_IO_BE
(
ex¥
, 
ªs
Ë”x¥)

	)

400 
	#_IO_gëc_u∆ocked
(
_Â
) \

401 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

402 ? 
	`__uÊow
 (
_Â
Ë: *(*Ë(_Â)->
_IO_ªad_±r
++)

	)

403 
	#_IO_≥ekc_u∆ocked
(
_Â
) \

404 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

405 && 
	`__undîÊow
 (
_Â
Ë=
EOF
 ? EOF \

406 : *(*Ë(
_Â
)->
_IO_ªad_±r
)

	)

407 
	#_IO_putc_u∆ocked
(
_ch
, 
_Â
) \

408 (
	`_IO_BE
 ((
_Â
)->
_IO_wrôe_±r
 >(_Â)->
_IO_wrôe_íd
, 0) \

409 ? 
	`__ovîÊow
 (
_Â
, (Ë(
_ch
)) \

410 : (Ë(*(
_Â
)->
_IO_wrôe_±r
++ = (
_ch
)))

	)

412 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


413 
	#_IO_gëwc_u∆ocked
(
_Â
) \

414 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

415 || ((
_Â
)->
_wide_d©a
->
_IO_ªad_±r
 \

416 >(
_Â
)->
_wide_d©a
->
_IO_ªad_íd
), 0) \

417 ? 
	`__wuÊow
 (
_Â
Ë: (
_IO_wöt_t
Ë*(_Â)->
_wide_d©a
->
_IO_ªad_±r
++)

	)

418 
	#_IO_putwc_u∆ocked
(
_wch
, 
_Â
) \

419 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

420 || ((
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
 \

421 >(
_Â
)->
_wide_d©a
->
_IO_wrôe_íd
), 0) \

422 ? 
	`__wovîÊow
 (
_Â
, 
_wch
) \

423 : (
_IO_wöt_t
Ë(*(
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
++ = (
_wch
)))

	)

426 
	#_IO_„of_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_EOF_SEEN
Ë!0)

	)

427 
	#_IO_„º‹_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_ERR_SEEN
Ë!0)

	)

429 
_IO_gëc
 (
_IO_FILE
 *
__Â
);

430 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__Â
);

431 
_IO_„of
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

432 
_IO_„º‹
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

434 
_IO_≥ekc_locked
 (
_IO_FILE
 *
__Â
);

437 
	#_IO_PENDING_OUTPUT_COUNT
(
_Â
) \

438 ((
_Â
)->
_IO_wrôe_±r
 - (_Â)->
_IO_wrôe_ba£
)

	)

440 
_IO_Êockfûe
 (
_IO_FILE
 *Ë
__THROW
;

441 
_IO_fu∆ockfûe
 (
_IO_FILE
 *Ë
__THROW
;

442 
_IO_·rylockfûe
 (
_IO_FILE
 *Ë
__THROW
;

444 #ifde‡
_IO_MTSAFE_IO


445 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_locked
 (_Â)

	)

446 
	#_IO_Êockfûe
(
_Â
) \

447 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_Êockfûe
 (_Â)

	)

448 
	#_IO_fu∆ockfûe
(
_Â
) \

449 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_fu∆ockfûe
 (_Â)

	)

451 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_u∆ocked
 (_Â)

	)

452 
	#_IO_Êockfûe
(
_Â
Ë

	)

453 
	#_IO_fu∆ockfûe
(
_Â
Ë

	)

454 
	#_IO_·rylockfûe
(
_Â
Ë

	)

455 
	#_IO_˛ónup_ªgi⁄_°¨t
(
_f˘
, 
_Â
Ë

	)

456 
	#_IO_˛ónup_ªgi⁄_íd
(
_Doô
Ë

	)

459 
_IO_vfsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, const * __restrict,

460 
_IO_va_li°
, *
__ª°ri˘
);

461 
_IO_vÂrötf
 (
_IO_FILE
 *
__ª°ri˘
, const *__restrict,

462 
_IO_va_li°
);

463 
_IO_ssize_t
 
_IO_∑dn
 (
_IO_FILE
 *, , _IO_ssize_t);

464 
_IO_size_t
 
_IO_sgën
 (
_IO_FILE
 *, *, _IO_size_t);

466 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

467 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

469 
_IO_‰ì_backup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

471 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


472 
_IO_wöt_t
 
_IO_gëwc
 (
_IO_FILE
 *
__Â
);

473 
_IO_wöt_t
 
_IO_putwc
 (
wch¨_t
 
__wc
, 
_IO_FILE
 *
__Â
);

474 
_IO_fwide
 (
_IO_FILE
 *
__Â
, 
__mode
Ë
__THROW
;

475 #i‡
__GNUC__
 >= 2

478 #i‡
deföed
 
_LIBC
 && deföed 
SHARED


479 
	~<shlib-com∑t.h
>

480 #i‡
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

481 
	#_IO_fwide_maybe_öcom∑tibÀ
 \

482 (
	`__buûtö_ex≥˘
 (&
_IO_°dö_u£d
 =
NULL
, 0))

	)

483 c⁄° 
_IO_°dö_u£d
;

484 
wók_exã∫
 (
_IO_°dö_u£d
);

487 #i‚de‡
_IO_fwide_maybe_öcom∑tibÀ


488 
	#_IO_fwide_maybe_öcom∑tibÀ
 (0)

	)

492 
	#_IO_fwide
(
__Â
, 
__mode
) \

493 ({ 
__ªsu…
 = (
__mode
); \

494 i‡(
__ªsu…
 < 0 && ! 
_IO_fwide_maybe_öcom∑tibÀ
) \

496 i‡((
__Â
)->
_mode
 == 0) \

498 (
__Â
)->
_mode
 = -1; \

499 
__ªsu…
 = (
__Â
)->
_mode
; \

501 i‡(
	`__buûtö_c⁄°™t_p
 (
__mode
) && (__mode) == 0) \

502 
__ªsu…
 = 
_IO_fwide_maybe_öcom∑tibÀ
 ? -1 : (
__Â
)->
_mode
; \

504 
__ªsu…
 = 
	`_IO_fwide
 (
__Â
, __result); \

505 
__ªsu…
; })

	)

508 
_IO_vfwsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, c⁄° 
wch¨_t
 * __restrict,

509 
_IO_va_li°
, *
__ª°ri˘
);

510 
_IO_vfw¥ötf
 (
_IO_FILE
 *
__ª°ri˘
, c⁄° 
wch¨_t
 *__restrict,

511 
_IO_va_li°
);

512 
_IO_ssize_t
 
_IO_w∑dn
 (
_IO_FILE
 *, 
wöt_t
, _IO_ssize_t);

513 
_IO_‰ì_wbackup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

516 #ifde‡
__LDBL_COMPAT


517 
	~<bôs/libio-ldbl.h
>

520 #ifde‡
__˝lu•lus


	@/usr/include/xlocale.h

20 #i‚de‡
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loˇÀ_°ru˘


30 
__loˇÀ_d©a
 *
	m__loˇÀs
[13];

33 c⁄° *
	m__˘y≥_b
;

34 c⁄° *
	m__˘y≥_tﬁowî
;

35 c⁄° *
	m__˘y≥_touµî
;

38 c⁄° *
	m__«mes
[13];

39 } *
	t__loˇÀ_t
;

42 
__loˇÀ_t
 
	tloˇÀ_t
;

	@/usr/include/zconf.h

8 #i‚de‡
ZCONF_H


9 
	#ZCONF_H


	)

17 #ifde‡
Z_PREFIX


18 
	#Z_PREFIX_SET


	)

21 
	#_di°_code
 
z__di°_code


	)

22 
	#_Àngth_code
 
z__Àngth_code


	)

23 
	#_å_Æign
 
z__å_Æign


	)

24 
	#_å_Êush_bôs
 
z__å_Êush_bôs


	)

25 
	#_å_Êush_block
 
z__å_Êush_block


	)

26 
	#_å_öô
 
z__å_öô


	)

27 
	#_å_°‹ed_block
 
z__å_°‹ed_block


	)

28 
	#_å_èŒy
 
z__å_èŒy


	)

29 
	#adÀr32
 
z_adÀr32


	)

30 
	#adÀr32_comböe
 
z_adÀr32_comböe


	)

31 
	#adÀr32_comböe64
 
z_adÀr32_comböe64


	)

32 #i‚de‡
Z_SOLO


33 
	#com¥ess
 
z_com¥ess


	)

34 
	#com¥ess2
 
z_com¥ess2


	)

35 
	#com¥essBound
 
z_com¥essBound


	)

37 
	#¸c32
 
z_¸c32


	)

38 
	#¸c32_comböe
 
z_¸c32_comböe


	)

39 
	#¸c32_comböe64
 
z_¸c32_comböe64


	)

40 
	#deÊ©e
 
z_deÊ©e


	)

41 
	#deÊ©eBound
 
z_deÊ©eBound


	)

42 
	#deÊ©eC›y
 
z_deÊ©eC›y


	)

43 
	#deÊ©eEnd
 
z_deÊ©eEnd


	)

44 
	#deÊ©eInô2_
 
z_deÊ©eInô2_


	)

45 
	#deÊ©eInô_
 
z_deÊ©eInô_


	)

46 
	#deÊ©eP¨ams
 
z_deÊ©eP¨ams


	)

47 
	#deÊ©ePídög
 
z_deÊ©ePídög


	)

48 
	#deÊ©ePrime
 
z_deÊ©ePrime


	)

49 
	#deÊ©eRe£t
 
z_deÊ©eRe£t


	)

50 
	#deÊ©eRe£tKìp
 
z_deÊ©eRe£tKìp


	)

51 
	#deÊ©eSëDi˘i⁄¨y
 
z_deÊ©eSëDi˘i⁄¨y


	)

52 
	#deÊ©eSëHódî
 
z_deÊ©eSëHódî


	)

53 
	#deÊ©eTu√
 
z_deÊ©eTu√


	)

54 
	#deÊ©e_c›yright
 
z_deÊ©e_c›yright


	)

55 
	#gë_¸c_èbÀ
 
z_gë_¸c_èbÀ


	)

56 #i‚de‡
Z_SOLO


57 
	#gz_îr‹
 
z_gz_îr‹


	)

58 
	#gz_ötmax
 
z_gz_ötmax


	)

59 
	#gz_°rwöîr‹
 
z_gz_°rwöîr‹


	)

60 
	#gzbuf„r
 
z_gzbuf„r


	)

61 
	#gz˛óªº
 
z_gz˛óªº


	)

62 
	#gz˛o£
 
z_gz˛o£


	)

63 
	#gz˛o£_r
 
z_gz˛o£_r


	)

64 
	#gz˛o£_w
 
z_gz˛o£_w


	)

65 
	#gzdúe˘
 
z_gzdúe˘


	)

66 
	#gzd›í
 
z_gzd›í


	)

67 
	#gzeof
 
z_gzeof


	)

68 
	#gzîr‹
 
z_gzîr‹


	)

69 
	#gzÊush
 
z_gzÊush


	)

70 
	#gzgëc
 
z_gzgëc


	)

71 
	#gzgëc_
 
z_gzgëc_


	)

72 
	#gzgës
 
z_gzgës


	)

73 
	#gzoff£t
 
z_gzoff£t


	)

74 
	#gzoff£t64
 
z_gzoff£t64


	)

75 
	#gz›í
 
z_gz›í


	)

76 
	#gz›í64
 
z_gz›í64


	)

77 #ifde‡
_WIN32


78 
	#gz›í_w
 
z_gz›í_w


	)

80 
	#gz¥ötf
 
z_gz¥ötf


	)

81 
	#gzv¥ötf
 
z_gzv¥ötf


	)

82 
	#gzputc
 
z_gzputc


	)

83 
	#gzputs
 
z_gzputs


	)

84 
	#gzªad
 
z_gzªad


	)

85 
	#gzªwöd
 
z_gzªwöd


	)

86 
	#gz£ek
 
z_gz£ek


	)

87 
	#gz£ek64
 
z_gz£ek64


	)

88 
	#gz£ç¨ams
 
z_gz£ç¨ams


	)

89 
	#gzãŒ
 
z_gzãŒ


	)

90 
	#gzãŒ64
 
z_gzãŒ64


	)

91 
	#gzungëc
 
z_gzungëc


	)

92 
	#gzwrôe
 
z_gzwrôe


	)

94 
	#öÊ©e
 
z_öÊ©e


	)

95 
	#öÊ©eBack
 
z_öÊ©eBack


	)

96 
	#öÊ©eBackEnd
 
z_öÊ©eBackEnd


	)

97 
	#öÊ©eBackInô_
 
z_öÊ©eBackInô_


	)

98 
	#öÊ©eC›y
 
z_öÊ©eC›y


	)

99 
	#öÊ©eEnd
 
z_öÊ©eEnd


	)

100 
	#öÊ©eGëHódî
 
z_öÊ©eGëHódî


	)

101 
	#öÊ©eInô2_
 
z_öÊ©eInô2_


	)

102 
	#öÊ©eInô_
 
z_öÊ©eInô_


	)

103 
	#öÊ©eM¨k
 
z_öÊ©eM¨k


	)

104 
	#öÊ©ePrime
 
z_öÊ©ePrime


	)

105 
	#öÊ©eRe£t
 
z_öÊ©eRe£t


	)

106 
	#öÊ©eRe£t2
 
z_öÊ©eRe£t2


	)

107 
	#öÊ©eSëDi˘i⁄¨y
 
z_öÊ©eSëDi˘i⁄¨y


	)

108 
	#öÊ©eGëDi˘i⁄¨y
 
z_öÊ©eGëDi˘i⁄¨y


	)

109 
	#öÊ©eSync
 
z_öÊ©eSync


	)

110 
	#öÊ©eSyncPoöt
 
z_öÊ©eSyncPoöt


	)

111 
	#öÊ©eUndîmöe
 
z_öÊ©eUndîmöe


	)

112 
	#öÊ©eRe£tKìp
 
z_öÊ©eRe£tKìp


	)

113 
	#öÊ©e_c›yright
 
z_öÊ©e_c›yright


	)

114 
	#öÊ©e_Á°
 
z_öÊ©e_Á°


	)

115 
	#öÊ©e_èbÀ
 
z_öÊ©e_èbÀ


	)

116 #i‚de‡
Z_SOLO


117 
	#uncom¥ess
 
z_uncom¥ess


	)

119 
	#zEº‹
 
z_zEº‹


	)

120 #i‚de‡
Z_SOLO


121 
	#zˇŒoc
 
z_zˇŒoc


	)

122 
	#zc‰ì
 
z_zc‰ì


	)

124 
	#zlibCompûeFœgs
 
z_zlibCompûeFœgs


	)

125 
	#zlibVîsi⁄
 
z_zlibVîsi⁄


	)

128 
	#Byã
 
z_Byã


	)

129 
	#Byãf
 
z_Byãf


	)

130 
	#Æloc_func
 
z_Æloc_func


	)

131 
	#ch¨f
 
z_ch¨f


	)

132 
	#‰ì_func
 
z_‰ì_func


	)

133 #i‚de‡
Z_SOLO


134 
	#gzFûe
 
z_gzFûe


	)

136 
	#gz_hódî
 
z_gz_hódî


	)

137 
	#gz_hódîp
 
z_gz_hódîp


	)

138 
	#ö_func
 
z_ö_func


	)

139 
	#ötf
 
z_ötf


	)

140 
	#out_func
 
z_out_func


	)

141 
	#uI¡
 
z_uI¡


	)

142 
	#uI¡f
 
z_uI¡f


	)

143 
	#uL⁄g
 
z_uL⁄g


	)

144 
	#uL⁄gf
 
z_uL⁄gf


	)

145 
	#voidp
 
z_voidp


	)

146 
	#voidpc
 
z_voidpc


	)

147 
	#voidpf
 
z_voidpf


	)

150 
	#gz_hódî_s
 
z_gz_hódî_s


	)

151 
	#öã∫Æ_°©e
 
z_öã∫Æ_°©e


	)

155 #i‡
deföed
(
__MSDOS__
Ë&& !deföed(
MSDOS
)

156 
	#MSDOS


	)

158 #i‡(
deföed
(
OS_2
Ë|| deföed(
__OS2__
)Ë&& !deföed(
OS2
)

159 
	#OS2


	)

161 #i‡
deföed
(
_WINDOWS
Ë&& !deföed(
WINDOWS
)

162 
	#WINDOWS


	)

164 #i‡
deföed
(
_WIN32
Ë|| deföed(
_WIN32_WCE
Ë|| deföed(
__WIN32__
)

165 #i‚de‡
WIN32


166 
	#WIN32


	)

169 #i‡(
deföed
(
MSDOS
Ë|| deföed(
OS2
Ë|| deföed(
WINDOWS
)Ë&& !deföed(
WIN32
)

170 #i‡!
deföed
(
__GNUC__
Ë&& !deföed(
__FLAT__
Ë&& !deföed(
__386__
)

171 #i‚de‡
SYS16BIT


172 
	#SYS16BIT


	)

181 #ifde‡
SYS16BIT


182 
	#MAXSEG_64K


	)

184 #ifde‡
MSDOS


185 
	#UNALIGNED_OK


	)

188 #ifde‡
__STDC_VERSION__


189 #i‚de‡
STDC


190 
	#STDC


	)

192 #i‡
__STDC_VERSION__
 >= 199901L

193 #i‚de‡
STDC99


194 
	#STDC99


	)

198 #i‡!
deföed
(
STDC
Ë&& (deföed(
__STDC__
Ë|| deföed(
__˝lu•lus
))

199 
	#STDC


	)

201 #i‡!
deföed
(
STDC
Ë&& (deföed(
__GNUC__
Ë|| deföed(
__BORLANDC__
))

202 
	#STDC


	)

204 #i‡!
deföed
(
STDC
Ë&& (deföed(
MSDOS
Ë|| deföed(
WINDOWS
Ë|| deföed(
WIN32
))

205 
	#STDC


	)

207 #i‡!
deföed
(
STDC
Ë&& (deföed(
OS2
Ë|| deföed(
__HOS_AIX__
))

208 
	#STDC


	)

211 #i‡
deföed
(
__OS400__
Ë&& !deföed(
STDC
)

212 
	#STDC


	)

215 #i‚de‡
STDC


217 c⁄°

	)

221 #i‡
deföed
(
ZLIB_CONST
Ë&& !deföed(
z_c⁄°
)

222 
	#z_c⁄°
 c⁄°

	)

224 
	#z_c⁄°


	)

228 #i‡
deföed
(
__MWERKS__
)||deföed(
≠∂ec
)||deföed(
THINK_C
)||deföed(
__SC__
)

229 
	#NO_DUMMY_DECL


	)

233 #i‚de‡
MAX_MEM_LEVEL


234 #ifde‡
MAXSEG_64K


235 
	#MAX_MEM_LEVEL
 8

	)

237 
	#MAX_MEM_LEVEL
 9

	)

246 #i‚de‡
MAX_WBITS


247 
	#MAX_WBITS
 15

	)

265 #i‚de‡
OF


266 #ifde‡
STDC


267 
	#OF
(
¨gs
Ë
	)
args

269 
	#OF
(
¨gs
Ë()

	)

273 #i‚de‡
Z_ARG


274 #i‡
deföed
(
STDC
Ë|| deföed(
Z_HAVE_STDARG_H
)

275 
	#Z_ARG
(
¨gs
Ë
	)
args

277 
	#Z_ARG
(
¨gs
Ë()

	)

287 #ifde‡
SYS16BIT


288 #i‡
deföed
(
M_I86SM
Ë|| deföed(
M_I86MM
)

290 
	#SMALL_MEDIUM


	)

291 #ifde‡
_MSC_VER


292 
	#FAR
 
_Ár


	)

294 
	#FAR
 
Ár


	)

297 #i‡(
deföed
(
__SMALL__
Ë|| deföed(
__MEDIUM__
))

299 
	#SMALL_MEDIUM


	)

300 #ifde‡
__BORLANDC__


301 
	#FAR
 
_Ár


	)

303 
	#FAR
 
Ár


	)

308 #i‡
deföed
(
WINDOWS
Ë|| deföed(
WIN32
)

312 #ifde‡
ZLIB_DLL


313 #i‡
deföed
(
WIN32
Ë&& (!deföed(
__BORLANDC__
) || (__BORLANDC__ >= 0x500))

314 #ifde‡
ZLIB_INTERNAL


315 
	#ZEXTERN
 
	`__de˛•ec
(
dŒexp‹t
)

	)

317 
	#ZEXTERN
 
	`__de˛•ec
(
dŒimp‹t
)

	)

325 #ifde‡
ZLIB_WINAPI


326 #ifde‡
FAR


327 #unde‡
FAR


329 
	~<wödows.h
>

332 
	#ZEXPORT
 
WINAPI


	)

333 #ifde‡
WIN32


334 
	#ZEXPORTVA
 
WINAPIV


	)

336 
	#ZEXPORTVA
 
FAR
 
CDECL


	)

341 #i‡
deföed
 (
__BEOS__
)

342 #ifde‡
ZLIB_DLL


343 #ifde‡
ZLIB_INTERNAL


344 
	#ZEXPORT
 
	`__de˛•ec
(
dŒexp‹t
)

	)

345 
	#ZEXPORTVA
 
	`__de˛•ec
(
dŒexp‹t
)

	)

347 
	#ZEXPORT
 
	`__de˛•ec
(
dŒimp‹t
)

	)

348 
	#ZEXPORTVA
 
	`__de˛•ec
(
dŒimp‹t
)

	)

353 #i‚de‡
ZEXTERN


354 
	#ZEXTERN
 

	)

356 #i‚de‡
ZEXPORT


357 
	#ZEXPORT


	)

359 #i‚de‡
ZEXPORTVA


360 
	#ZEXPORTVA


	)

363 #i‚de‡
FAR


364 
	#FAR


	)

367 #i‡!
deföed
(
__MACTYPES__
)

368 
	tByã
;

370 
	tuI¡
;

371 
	tuL⁄g
;

373 #ifde‡
SMALL_MEDIUM


375 
	#Byãf
 
Byã
 
FAR


	)

377 
Byã
 
	tFAR
 
	tByãf
;

379 
	tFAR
 
	tch¨f
;

380 
	tFAR
 
	tötf
;

381 
uI¡
 
	tFAR
 
	tuI¡f
;

382 
uL⁄g
 
	tFAR
 
	tuL⁄gf
;

384 #ifde‡
STDC


385 c⁄° *
	tvoidpc
;

386 
	tFAR
 *
	tvoidpf
;

387 *
	tvoidp
;

389 
Byã
 c⁄° *
	tvoidpc
;

390 
Byã
 
	tFAR
 *
	tvoidpf
;

391 
Byã
 *
	tvoidp
;

394 #i‡!
deföed
(
Z_U4
Ë&& !deföed(
Z_SOLO
Ë&& deföed(
STDC
)

395 
	~<limôs.h
>

396 #i‡(
UINT_MAX
 == 0xffffffffUL)

397 
	#Z_U4
 

	)

398 #ñi‡(
ULONG_MAX
 == 0xffffffffUL)

399 
	#Z_U4
 

	)

400 #ñi‡(
USHRT_MAX
 == 0xffffffffUL)

401 
	#Z_U4
 

	)

405 #ifde‡
Z_U4


406 
Z_U4
 
	tz_¸c_t
;

408 
	tz_¸c_t
;

412 
	#Z_HAVE_UNISTD_H


	)

416 
	#Z_HAVE_STDARG_H


	)

419 #ifde‡
STDC


420 #i‚de‡
Z_SOLO


421 
	~<sys/ty≥s.h
>

425 #i‡
deföed
(
STDC
Ë|| deföed(
Z_HAVE_STDARG_H
)

426 #i‚de‡
Z_SOLO


427 
	~<°d¨g.h
>

431 #ifde‡
_WIN32


432 #i‚de‡
Z_SOLO


433 
	~<°ddef.h
>

443 #i‡
deföed
(
_LARGEFILE64_SOURCE
) && -_LARGEFILE64_SOURCE - -1 == 1

444 #unde‡
_LARGEFILE64_SOURCE


447 #i‡
deföed
(
__WATCOMC__
Ë&& !deföed(
Z_HAVE_UNISTD_H
)

448 
	#Z_HAVE_UNISTD_H


	)

450 #i‚de‡
Z_SOLO


451 #i‡
deföed
(
Z_HAVE_UNISTD_H
Ë|| deföed(
_LARGEFILE64_SOURCE
)

452 
	~<uni°d.h
>

453 #ifde‡
VMS


454 
	~<unixio.h
>

456 #i‚de‡
z_off_t


457 
	#z_off_t
 
off_t


	)

462 #i‡
deföed
(
_LFS64_LARGEFILE
) && _LFS64_LARGEFILE-0

463 
	#Z_LFS64


	)

466 #i‡
deföed
(
_LARGEFILE64_SOURCE
Ë&& deföed(
Z_LFS64
)

467 
	#Z_LARGE64


	)

470 #i‡
deföed
(
_FILE_OFFSET_BITS
Ë&& _FILE_OFFSET_BITS-0 =64 && deföed(
Z_LFS64
)

471 
	#Z_WANT64


	)

474 #i‡!
deföed
(
SEEK_SET
Ë&& !deföed(
Z_SOLO
)

475 
	#SEEK_SET
 0

	)

476 
	#SEEK_CUR
 1

	)

477 
	#SEEK_END
 2

	)

480 #i‚de‡
z_off_t


481 
	#z_off_t
 

	)

484 #i‡!
deföed
(
_WIN32
Ë&& deföed(
Z_LARGE64
)

485 
	#z_off64_t
 
off64_t


	)

487 #i‡
deföed
(
_WIN32
Ë&& !deföed(
__GNUC__
Ë&& !deföed(
Z_SOLO
)

488 
	#z_off64_t
 
__öt64


	)

490 
	#z_off64_t
 
z_off_t


	)

495 #i‡
deföed
(
__MVS__
)

496 #¥agm®
m≠
(
deÊ©eInô_
,"DEIN")

497 #¥agm®
m≠
(
deÊ©eInô2_
,"DEIN2")

498 #¥agm®
m≠
(
deÊ©eEnd
,"DEEND")

499 #¥agm®
m≠
(
deÊ©eBound
,"DEBND")

500 #¥agm®
m≠
(
öÊ©eInô_
,"ININ")

501 #¥agm®
m≠
(
öÊ©eInô2_
,"ININ2")

502 #¥agm®
m≠
(
öÊ©eEnd
,"INEND")

503 #¥agm®
m≠
(
öÊ©eSync
,"INSY")

504 #¥agm®
m≠
(
öÊ©eSëDi˘i⁄¨y
,"INSEDI")

505 #¥agm®
m≠
(
com¥essBound
,"CMBND")

506 #¥agm®
m≠
(
öÊ©e_èbÀ
,"INTABL")

507 #¥agm®
m≠
(
öÊ©e_Á°
,"INFA")

508 #¥agm®
m≠
(
öÊ©e_c›yright
,"INCOPY")

	@/usr/include/_G_config.h

4 #i‚de‡
_G_c⁄fig_h


5 
	#_G_c⁄fig_h
 1

	)

9 
	~<bôs/ty≥s.h
>

10 
	#__√ed_size_t


	)

11 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


12 
	#__√ed_wch¨_t


	)

14 
	#__√ed_NULL


	)

15 
	~<°ddef.h
>

16 
	#__√ed_mb°©e_t


	)

17 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


18 
	#__√ed_wöt_t


	)

20 
	~<wch¨.h
>

23 
__off_t
 
	m__pos
;

24 
__mb°©e_t
 
	m__°©e
;

25 } 
	t_G_Âos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb°©e_t
 
	m__°©e
;

30 } 
	t_G_Âos64_t
;

31 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gc⁄v.h
>

35 
__gc⁄v_öfo
 
	m__cd
;

38 
__gc⁄v_öfo
 
	m__cd
;

39 
__gc⁄v_°ï_d©a
 
	m__d©a
;

40 } 
	m__comböed
;

41 } 
	t_G_ic⁄v_t
;

46 
	#_G_va_li°
 
__gnuc_va_li°


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`deföed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/ctype.h

22 #i‚def 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 
	g__BEGIN_DECLS


30 #i‚de‡
_ISbô


39 
	~<ídün.h
>

40 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


41 
	#_ISbô
(
bô
Ë(1 << (bô))

	)

43 
	#_ISbô
(
bô
Ë((bôË< 8 ? ((1 << (bô)Ë<< 8Ë: ((1 << (bô)Ë>> 8))

	)

48 
	m_ISuµî
 = 
_ISbô
 (0),

49 
	m_ISlowî
 = 
_ISbô
 (1),

50 
	m_ISÆpha
 = 
_ISbô
 (2),

51 
	m_ISdigô
 = 
_ISbô
 (3),

52 
	m_ISxdigô
 = 
_ISbô
 (4),

53 
	m_IS•a˚
 = 
_ISbô
 (5),

54 
	m_IS¥öt
 = 
_ISbô
 (6),

55 
	m_ISgøph
 = 
_ISbô
 (7),

56 
	m_ISbœnk
 = 
_ISbô
 (8),

57 
	m_IS˙ål
 = 
_ISbô
 (9),

58 
	m_ISpun˘
 = 
_ISbô
 (10),

59 
	m_ISÆnum
 = 
_ISbô
 (11)

79 c⁄° **
	$__˘y≥_b_loc
 ()

80 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

81 c⁄° 
__öt32_t
 **
	$__˘y≥_tﬁowî_loc
 ()

82 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

83 c⁄° 
__öt32_t
 **
	$__˘y≥_touµî_loc
 ()

84 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

87 #i‚de‡
__˝lu•lus


88 
	#__is˘y≥
(
c
, 
ty≥
) \

89 ((*
	`__˘y≥_b_loc
 ())[(Ë(
c
)] & (Ë
ty≥
)

	)

90 #ñi‡
deföed
 
__USE_EXTERN_INLINES


91 
	#__is˘y≥_f
(
ty≥
) \

92 
__exã∫_ölöe
 \

93 
is
##
	`ty≥
 (
__c
Ë
__THROW
 \

95  (*
	`__˘y≥_b_loc
 ())[(Ë(
__c
)] & (Ë
_IS
##
ty≥
; \

96 
	}

	)
}

99 
	#__ißscii
(
c
Ë(((cË& ~0x7fË=0Ë

	)

100 
	#__tﬂscii
(
c
Ë((cË& 0x7fË

	)

102 
	#__ex˘y≥
(
«me
Ë
	`«me
 (Ë
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__ex˘y≥
 (
iß um
);

111 
__ex˘y≥
 (
ißÕha
);

112 
__ex˘y≥
 (
is˙ål
);

113 
__ex˘y≥
 (
isdigô
);

114 
__ex˘y≥
 (
i¶owî
);

115 
__ex˘y≥
 (
isgøph
);

116 
__ex˘y≥
 (
i•röt
);

117 
__ex˘y≥
 (
i•un˘
);

118 
__ex˘y≥
 (
is•a˚
);

119 
__ex˘y≥
 (
isuµî
);

120 
__ex˘y≥
 (
isxdigô
);

124 
	$tﬁowî
 (
__c
Ë
__THROW
;

127 
	$touµî
 (
__c
Ë
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__ex˘y≥
 (
isbœnk
);

138 
__END_NAMESPACE_C99


141 #ifde‡
__USE_GNU


143 
	$is˘y≥
 (
__c
, 
__mask
Ë
__THROW
;

146 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


150 
	$ißscii
 (
__c
Ë
__THROW
;

154 
	$tﬂscii
 (
__c
Ë
__THROW
;

158 
	`__ex˘y≥
 (
_touµî
);

159 
	`__ex˘y≥
 (
_tﬁowî
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¨gs
) \

164 (
__exãnsi⁄__
 \

165 ({ 
__ªs
; \

166 i‡( (
c
) > 1) \

168 i‡(
	`__buûtö_c⁄°™t_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__ªs
 = 
__c
 < -128 || __¯> 255 ? __¯: (
a
)[__c]; \

174 
__ªs
 = 
f
 
¨gs
; \

177 
__ªs
 = (
a
)[(Ë(
c
)]; \

178 
__ªs
; 
	}
}))

	)

180 #i‡!
deföed
 
__NO_CTYPE


181 #ifde‡
__is˘y≥_f


182 
	$__is˘y≥_f
 (
Ænum
)

183 
	$__is˘y≥_f
 (
Æpha
)

184 
	$__is˘y≥_f
 (
˙ål
)

185 
	$__is˘y≥_f
 (
digô
)

186 
	$__is˘y≥_f
 (
lowî
)

187 
	$__is˘y≥_f
 (
gøph
)

188 
	$__is˘y≥_f
 (
¥öt
)

189 
	$__is˘y≥_f
 (
pun˘
)

190 
	$__is˘y≥_f
 (
•a˚
)

191 
	$__is˘y≥_f
 (
uµî
)

192 
	$__is˘y≥_f
 (
xdigô
)

193 #ifde‡
__USE_ISOC99


194 
	$__is˘y≥_f
 (
bœnk
)

196 #ñi‡
deföed
 
__is˘y≥


197 
	#iß um
(
c
Ë
	`__is˘y≥
((c), 
_ISÆnum
)

	)

198 
	#ißÕha
(
c
Ë
	`__is˘y≥
((c), 
_ISÆpha
)

	)

199 
	#is˙ål
(
c
Ë
	`__is˘y≥
((c), 
_IS˙ål
)

	)

200 
	#isdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISdigô
)

	)

201 
	#i¶owî
(
c
Ë
	`__is˘y≥
((c), 
_ISlowî
)

	)

202 
	#isgøph
(
c
Ë
	`__is˘y≥
((c), 
_ISgøph
)

	)

203 
	#i•röt
(
c
Ë
	`__is˘y≥
((c), 
_IS¥öt
)

	)

204 
	#i•un˘
(
c
Ë
	`__is˘y≥
((c), 
_ISpun˘
)

	)

205 
	#is•a˚
(
c
Ë
	`__is˘y≥
((c), 
_IS•a˚
)

	)

206 
	#isuµî
(
c
Ë
	`__is˘y≥
((c), 
_ISuµî
)

	)

207 
	#isxdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISxdigô
)

	)

208 #ifde‡
__USE_ISOC99


209 
	#isbœnk
(
c
Ë
	`__is˘y≥
((c), 
_ISbœnk
)

	)

213 #ifde‡
__USE_EXTERN_INLINES


214 
__exã∫_ölöe
 

215 
	`__NTH
 (
	$tﬁowî
 (
__c
))

217  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_tﬁowî_loc
 ())[__c] : __c;

218 
	}
}

220 
__exã∫_ölöe
 

221 
__NTH
 (
	$touµî
 (
__c
))

223  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_touµî_loc
 ())[__c] : __c;

224 
	}
}

227 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


228 
	#tﬁowî
(
c
Ë
	`__tobody
 (c, 
tﬁowî
, *
	`__˘y≥_tﬁowî_loc
 (), (c))

	)

229 
	#touµî
(
c
Ë
	`__tobody
 (c, 
touµî
, *
	`__˘y≥_touµî_loc
 (), (c))

	)

232 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


233 
	#ißscii
(
c
Ë
	`__ißscii
 (c)

	)

234 
	#tﬂscii
(
c
Ë
	`__tﬂscii
 (c)

	)

236 
	#_tﬁowî
(
c
Ë((Ë(*
	`__˘y≥_tﬁowî_loc
 ())[(Ë(c)])

	)

237 
	#_touµî
(
c
Ë((Ë(*
	`__˘y≥_touµî_loc
 ())[(Ë(c)])

	)

243 #ifde‡
__USE_XOPEN2K8


257 
	~<xloˇÀ.h
>

261 
	#__is˘y≥_l
(
c
, 
ty≥
, 
loˇÀ
) \

262 ((
loˇÀ
)->
__˘y≥_b
[(Ë(
c
)] & (Ë
ty≥
)

	)

264 
	#__ex˘y≥_l
(
«me
) \

265 
	`«me
 (, 
__loˇÀ_t
Ë
__THROW


	)

271 
__ex˘y≥_l
 (
iß um_l
);

272 
__ex˘y≥_l
 (
ißÕha_l
);

273 
__ex˘y≥_l
 (
is˙ål_l
);

274 
__ex˘y≥_l
 (
isdigô_l
);

275 
__ex˘y≥_l
 (
i¶owî_l
);

276 
__ex˘y≥_l
 (
isgøph_l
);

277 
__ex˘y≥_l
 (
i•röt_l
);

278 
__ex˘y≥_l
 (
i•un˘_l
);

279 
__ex˘y≥_l
 (
is•a˚_l
);

280 
__ex˘y≥_l
 (
isuµî_l
);

281 
__ex˘y≥_l
 (
isxdigô_l
);

283 
__ex˘y≥_l
 (
isbœnk_l
);

287 
	$__tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

288 
	$tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

291 
	$__touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

292 
	$touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

294 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


295 
	#__tﬁowî_l
(
c
, 
loˇÀ
) \

296 
	`__tobody
 (
c
, 
__tﬁowî_l
, (
loˇÀ
)->
__˘y≥_tﬁowî
, (c,ÜoˇÀ))

	)

297 
	#__touµî_l
(
c
, 
loˇÀ
) \

298 
	`__tobody
 (
c
, 
__touµî_l
, (
loˇÀ
)->
__˘y≥_touµî
, (c,ÜoˇÀ))

	)

299 
	#tﬁowî_l
(
c
, 
loˇÀ
Ë
	`__tﬁowî_l
 ((c), (loˇÀ))

	)

300 
	#touµî_l
(
c
, 
loˇÀ
Ë
	`__touµî_l
 ((c), (loˇÀ))

	)

304 #i‚de‡
__NO_CTYPE


305 
	#__iß um_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆnum
, (l))

	)

306 
	#__ißÕha_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆpha
, (l))

	)

307 
	#__is˙ål_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS˙ål
, (l))

	)

308 
	#__isdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISdigô
, (l))

	)

309 
	#__i¶owî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISlowî
, (l))

	)

310 
	#__isgøph_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISgøph
, (l))

	)

311 
	#__i•röt_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS¥öt
, (l))

	)

312 
	#__i•un˘_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISpun˘
, (l))

	)

313 
	#__is•a˚_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS•a˚
, (l))

	)

314 
	#__isuµî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISuµî
, (l))

	)

315 
	#__isxdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISxdigô
, (l))

	)

317 
	#__isbœnk_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISbœnk
, (l))

	)

319 #ifde‡
__USE_MISC


320 
	#__ißscii_l
(
c
,
l
Ë(÷), 
	`__ißscii
 (c))

	)

321 
	#__tﬂscii_l
(
c
,
l
Ë(÷), 
	`__tﬂscii
 (c))

	)

324 
	#iß um_l
(
c
,
l
Ë
	`__iß um_l
 ((c), (l))

	)

325 
	#ißÕha_l
(
c
,
l
Ë
	`__ißÕha_l
 ((c), (l))

	)

326 
	#is˙ål_l
(
c
,
l
Ë
	`__is˙ål_l
 ((c), (l))

	)

327 
	#isdigô_l
(
c
,
l
Ë
	`__isdigô_l
 ((c), (l))

	)

328 
	#i¶owî_l
(
c
,
l
Ë
	`__i¶owî_l
 ((c), (l))

	)

329 
	#isgøph_l
(
c
,
l
Ë
	`__isgøph_l
 ((c), (l))

	)

330 
	#i•röt_l
(
c
,
l
Ë
	`__i•röt_l
 ((c), (l))

	)

331 
	#i•un˘_l
(
c
,
l
Ë
	`__i•un˘_l
 ((c), (l))

	)

332 
	#is•a˚_l
(
c
,
l
Ë
	`__is•a˚_l
 ((c), (l))

	)

333 
	#isuµî_l
(
c
,
l
Ë
	`__isuµî_l
 ((c), (l))

	)

334 
	#isxdigô_l
(
c
,
l
Ë
	`__isxdigô_l
 ((c), (l))

	)

336 
	#isbœnk_l
(
c
,
l
Ë
	`__isbœnk_l
 ((c), (l))

	)

338 #ifde‡
__USE_MISC


339 
	#ißscii_l
(
c
,
l
Ë
	`__ißscii_l
 ((c), (l))

	)

340 
	#tﬂscii_l
(
c
,
l
Ë
	`__tﬂscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/limits.h

22 #i‚de‡
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<„©uªs.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

41 #i‚de‡
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<bôs/w‹dsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifde‡
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #i‡
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #i‡
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifde‡
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #i‡
deföed
 
__GNUC__
 && !deföed 
_GCC_LIMITS_H_


123 #ö˛ude_√xà<
limôs
.
h
>

129 #i‡
deföed
 
__USE_ISOC99
 && deföed 
__GNUC__


130 #i‚de‡
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #i‚de‡
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #i‚de‡
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<bôs/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<bôs/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<bôs/x›í_lim.h
>

	@/usr/include/stdc-predef.h

18 #i‚def 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifde‡
__GCC_IEC_559


37 #i‡
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifde‡
__GCC_IEC_559_COMPLEX


45 #i‡
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

55 
	#__STDC_ISO_10646__
 201505L

	)

58 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/endian.h

18 #i‚def 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<„©uªs.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<bôs/ídün.h
>

40 #i‚de‡
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_MISC


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËLO, 
	)
HI

53 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËHI, 
	)
LO

58 #i‡
deföed
 
__USE_MISC
 && !deföed 
__ASSEMBLER__


60 
	~<bôs/byãsw≠.h
>

62 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


63 
	#htobe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

64 
	#htﬁe16
(
x
Ë(x)

	)

65 
	#be16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

66 
	#À16toh
(
x
Ë(x)

	)

68 
	#htobe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

69 
	#htﬁe32
(
x
Ë(x)

	)

70 
	#be32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

71 
	#À32toh
(
x
Ë(x)

	)

73 
	#htobe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

74 
	#htﬁe64
(
x
Ë(x)

	)

75 
	#be64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

76 
	#À64toh
(
x
Ë(x)

	)

79 
	#htobe16
(
x
Ë(x)

	)

80 
	#htﬁe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

81 
	#be16toh
(
x
Ë(x)

	)

82 
	#À16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

84 
	#htobe32
(
x
Ë(x)

	)

85 
	#htﬁe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

86 
	#be32toh
(
x
Ë(x)

	)

87 
	#À32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

89 
	#htobe64
(
x
Ë(x)

	)

90 
	#htﬁe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

91 
	#be64toh
(
x
Ë(x)

	)

92 
	#À64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

	@/usr/include/gconv.h

22 #i‚de‡
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<„©uªs.h
>

26 
	#__√ed_mb°©e_t


	)

27 
	#__√ed_wöt_t


	)

28 
	~<wch¨.h
>

29 
	#__√ed_size_t


	)

30 
	#__√ed_wch¨_t


	)

31 
	~<°ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¨_t
Ë0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004,

60 
	m__GCONV_TRANSLIT
 = 0x0008

65 
	g__gc⁄v_°ï
;

66 
	g__gc⁄v_°ï_d©a
;

67 
	g__gc⁄v_lﬂded_obje˘
;

71 (*
	t__gc⁄v_f˘
Ë(
	t__gc⁄v_°ï
 *, 
	t__gc⁄v_°ï_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wöt_t
 (*
	t__gc⁄v_btowc_f˘
Ë(
	t__gc⁄v_°ï
 *, );

79 (*
	t__gc⁄v_öô_f˘
Ë(
	t__gc⁄v_°ï
 *);

80 (*
	t__gc⁄v_íd_f˘
Ë(
	t__gc⁄v_°ï
 *);

84 
	s__gc⁄v_°ï


86 
__gc⁄v_lﬂded_obje˘
 *
__shlib_h™dÀ
;

87 c⁄° *
__mod«me
;

89 
__cou¡î
;

91 *
__‰om_«me
;

92 *
__to_«me
;

94 
__gc⁄v_f˘
 
__f˘
;

95 
__gc⁄v_btowc_f˘
 
__btowc_f˘
;

96 
__gc⁄v_öô_f˘
 
__öô_f˘
;

97 
__gc⁄v_íd_f˘
 
__íd_f˘
;

101 
__mö_√eded_‰om
;

102 
__max_√eded_‰om
;

103 
__mö_√eded_to
;

104 
__max_√eded_to
;

107 
__°©eful
;

109 *
__d©a
;

114 
	s__gc⁄v_°ï_d©a


116 *
__outbuf
;

117 *
__outbu„nd
;

121 
__Êags
;

125 
__övoˇti⁄_cou¡î
;

129 
__öã∫Æ_u£
;

131 
__mb°©e_t
 *
__°©ï
;

132 
__mb°©e_t
 
__°©e
;

138 
	s__gc⁄v_öfo


140 
size_t
 
__n°ïs
;

141 
__gc⁄v_°ï
 *
__°ïs
;

142 
__exãnsi⁄__
 
__gc⁄v_°ï_d©a
 
__d©a
 
__Êex¨r
;

143 } *
	t__gc⁄v_t
;

146 
	`__gc⁄v_å™¶ôî©e
 (
__gc⁄v_°ï
 *
°ï
,

147 
__gc⁄v_°ï_d©a
 *
°ï_d©a
,

148 c⁄° *
öbuf°¨t
,

149 c⁄° **
öbuÂ
,

150 c⁄° *
öbu„nd
,

151 **
outbuf°¨t
,

152 
size_t
 *
úªvîsibÀ
);

	@/usr/include/wchar.h

23 #i‚de‡
_WCHAR_H


25 #i‡!
deföed
 
__√ed_mb°©e_t
 && !deföed 
__√ed_wöt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<„©uªs.h
>

30 #ifde‡
_WCHAR_H


32 
	#__√ed___FILE


	)

33 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


34 
	#__√ed_FILE


	)

36 
	~<°dio.h
>

38 
	#__√ed___va_li°


	)

39 
	~<°d¨g.h
>

41 
	~<bôs/wch¨.h
>

44 
	#__√ed_size_t


	)

45 
	#__√ed_wch¨_t


	)

46 
	#__√ed_NULL


	)

48 #i‡
deföed
 
_WCHAR_H
 || deföed 
__√ed_wöt_t
 || !deföed 
__WINT_TYPE__


49 #unde‡
__√ed_wöt_t


50 
	#__√ed_wöt_t


	)

51 
	~<°ddef.h
>

55 #i‚de‡
_WINT_T


60 
	#_WINT_T


	)

61 
	twöt_t
;

65 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
deföed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twöt_t
;

69 
	g__END_NAMESPACE_STD


74 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #i‡(
deföed
 
_WCHAR_H
 || deföed 
__√ed_mb°©e_t
Ë&& !deföed 
____mb°©e_t_deföed


80 
	#____mb°©e_t_deföed
 1

	)

84 
	m__cou¡
;

87 #ifde‡
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wöt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__vÆue
;

94 } 
	t__mb°©e_t
;

96 #unde‡
__√ed_mb°©e_t


101 #ifde‡
_WCHAR_H


103 #i‚de‡
__mb°©e_t_deföed


104 
__BEGIN_NAMESPACE_C99


106 
__mb°©e_t
 
	tmb°©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb°©e_t_deföed
 1

	)

111 #ifde‡
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb°©e_t
)

115 #i‚de‡
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #i‚de‡
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_UNIX98


128 
	~<w˘y≥.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¨_t
 *
	$wcs˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

148 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
)

149 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

152 
wch¨_t
 *
	$wc¢˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

153 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

154 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

157 
wch¨_t
 *
	$wcsˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

158 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
)

159 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

161 
wch¨_t
 *
	$wc¢ˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

162 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

163 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

166 
	$wcscmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
)

167 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

169 
	$wc¢cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

170 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

171 
__END_NAMESPACE_STD


173 #ifde‡
__USE_XOPEN2K8


175 
	$wcsˇ£cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
Ë
__THROW
;

178 
	$wc¢ˇ£cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

179 
size_t
 
__n
Ë
__THROW
;

183 
	~<xloˇÀ.h
>

185 
	$wcsˇ£cmp_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

186 
__loˇÀ_t
 
__loc
Ë
__THROW
;

188 
	$wc¢ˇ£cmp_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

189 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

192 
__BEGIN_NAMESPACE_STD


195 
	$wcscﬁl
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
Ë
__THROW
;

199 
size_t
 
	$wcsx‰m
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

200 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

201 
__END_NAMESPACE_STD


203 #ifde‡
__USE_XOPEN2K8


209 
	$wcscﬁl_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

210 
__loˇÀ_t
 
__loc
Ë
__THROW
;

215 
size_t
 
	$wcsx‰m_l
 (
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

216 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

219 
wch¨_t
 *
	$wcsdup
 (c⁄° 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_mÆloc__
;

222 
__BEGIN_NAMESPACE_STD


224 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


225 "C++" 
wch¨_t
 *
	$wcschr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

226 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

227 "C++" c⁄° 
wch¨_t
 *
	$wcschr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

228 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

230 
wch¨_t
 *
	$wcschr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

231 
__THROW
 
__©åibuã_puª__
;

234 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


235 "C++" 
wch¨_t
 *
	$wc§chr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

236 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

237 "C++" c⁄° 
wch¨_t
 *
	$wc§chr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

238 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

240 
wch¨_t
 *
	$wc§chr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

241 
__THROW
 
__©åibuã_puª__
;

243 
__END_NAMESPACE_STD


245 #ifde‡
__USE_GNU


248 
wch¨_t
 *
	$wcsch∫ul
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__wc
)

249 
__THROW
 
__©åibuã_puª__
;

252 
__BEGIN_NAMESPACE_STD


255 
size_t
 
	$wcsc•n
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ªje˘
)

256 
__THROW
 
__©åibuã_puª__
;

259 
size_t
 
	$wcs•n
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

260 
__THROW
 
__©åibuã_puª__
;

262 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


263 "C++" 
wch¨_t
 *
	$wc•brk
 (
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

264 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

265 "C++" c⁄° 
wch¨_t
 *
	$wc•brk
 (c⁄° 
wch¨_t
 *
__wcs
,

266 c⁄° 
wch¨_t
 *
__ac˚±
)

267 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

269 
wch¨_t
 *
	$wc•brk
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

270 
__THROW
 
__©åibuã_puª__
;

273 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


274 "C++" 
wch¨_t
 *
	$wcs°r
 (
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

275 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

276 "C++" c⁄° 
wch¨_t
 *
	$wcs°r
 (c⁄° 
wch¨_t
 *
__hay°ack
,

277 c⁄° 
wch¨_t
 *
__√edÀ
)

278 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

280 
wch¨_t
 *
	$wcs°r
 (c⁄° 
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

281 
__THROW
 
__©åibuã_puª__
;

285 
wch¨_t
 *
	$wc°ok
 (
wch¨_t
 *
__ª°ri˘
 
__s
,

286 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__dñim
,

287 
wch¨_t
 **
__ª°ri˘
 
__±r
Ë
__THROW
;

290 
size_t
 
	$wc¶í
 (c⁄° 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_puª__
;

291 
__END_NAMESPACE_STD


293 #ifde‡
__USE_XOPEN


295 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


296 "C++" 
wch¨_t
 *
	$wcswcs
 (
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

297 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

298 "C++" c⁄° 
wch¨_t
 *
	$wcswcs
 (c⁄° 
wch¨_t
 *
__hay°ack
,

299 c⁄° 
wch¨_t
 *
__√edÀ
)

300 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

302 
wch¨_t
 *
	$wcswcs
 (c⁄° 
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

303 
__THROW
 
__©åibuã_puª__
;

307 #ifde‡
__USE_XOPEN2K8


309 
size_t
 
	$wc¢Àn
 (c⁄° 
wch¨_t
 *
__s
, 
size_t
 
__maxÀn
)

310 
__THROW
 
__©åibuã_puª__
;

314 
__BEGIN_NAMESPACE_STD


316 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


317 "C++" 
wch¨_t
 *
	$wmemchr
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

319 "C++" c⁄° 
wch¨_t
 *
	$wmemchr
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__c
,

320 
size_t
 
__n
)

321 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

323 
wch¨_t
 *
	$wmemchr
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

324 
__THROW
 
__©åibuã_puª__
;

328 
	$wmemcmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

329 
__THROW
 
__©åibuã_puª__
;

332 
wch¨_t
 *
	$wmem˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

333 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

337 
wch¨_t
 *
	$wmemmove
 (
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

338 
__THROW
;

341 
wch¨_t
 *
	$wmem£t
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
Ë
__THROW
;

342 
__END_NAMESPACE_STD


344 #ifde‡
__USE_GNU


347 
wch¨_t
 *
	$wmemp˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

348 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
)

349 
__THROW
;

353 
__BEGIN_NAMESPACE_STD


356 
wöt_t
 
	$btowc
 (
__c
Ë
__THROW
;

360 
	$w˘ob
 (
wöt_t
 
__c
Ë
__THROW
;

364 
	$mbsöô
 (c⁄° 
mb°©e_t
 *
__ps
Ë
__THROW
 
__©åibuã_puª__
;

368 
size_t
 
	$mbπowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

369 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

370 
mb°©e_t
 *
__ª°ri˘
 
__p
Ë
__THROW
;

373 
size_t
 
	$w¸tomb
 (*
__ª°ri˘
 
__s
, 
wch¨_t
 
__wc
,

374 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

377 
size_t
 
	$__mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

378 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

379 
size_t
 
	$mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

380 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

381 
__END_NAMESPACE_STD


383 #ifde‡
__USE_EXTERN_INLINES


389 
wöt_t
 
	$__btowc_Æüs
 (
__c
Ë
	`__asm
 ("btowc");

390 
__exã∫_ölöe
 
wöt_t


391 
	`__NTH
 (
	$btowc
 (
__c
))

392 {  (
	`__buûtö_c⁄°™t_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

393 ? (
wöt_t
Ë
__c
 : 
	`__btowc_Æüs
 (__c)); 
	}
}

395 
	$__w˘ob_Æüs
 (
wöt_t
 
__c
Ë
	`__asm
 ("wctob");

396 
__exã∫_ölöe
 

397 
	`__NTH
 (
	$w˘ob
 (
wöt_t
 
__wc
))

398 {  (
	`__buûtö_c⁄°™t_p
 (
__wc
Ë&& __w¯>
L
'\0' && __wc <= L'\x7f'

399 ? (Ë
__wc
 : 
	`__w˘ob_Æüs
 (__wc)); 
	}
}

401 
__exã∫_ölöe
 
size_t


402 
__NTH
 (
	$mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

403 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

404 {  (
__ps
 !
NULL


405 ? 
	`mbπowc
 (
NULL
, 
__s
, 
__n
, 
__ps
Ë: 
	`__mbæí
 (__s, __n, NULL)); 
	}
}

408 
__BEGIN_NAMESPACE_STD


411 
size_t
 
	$mb§towcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

412 c⁄° **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

413 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

417 
size_t
 
	$wc§tombs
 (*
__ª°ri˘
 
__d°
,

418 c⁄° 
wch¨_t
 **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

419 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

420 
__END_NAMESPACE_STD


423 #ifdef 
__USE_XOPEN2K8


426 
size_t
 
	$mb¢πowcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

427 c⁄° **
__ª°ri˘
 
__§c
, 
size_t
 
__nmc
,

428 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

432 
size_t
 
	$wc¢πombs
 (*
__ª°ri˘
 
__d°
,

433 c⁄° 
wch¨_t
 **
__ª°ri˘
 
__§c
,

434 
size_t
 
__nwc
, size_à
__Àn
,

435 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

440 #ifde‡
__USE_XOPEN


442 
	$wcwidth
 (
wch¨_t
 
__c
Ë
__THROW
;

446 
	$wcswidth
 (c⁄° 
wch¨_t
 *
__s
, 
size_t
 
__n
Ë
__THROW
;

450 
__BEGIN_NAMESPACE_STD


453 
	$wc°od
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

454 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

455 
__END_NAMESPACE_STD


457 #ifde‡
__USE_ISOC99


458 
__BEGIN_NAMESPACE_C99


460 
	$wc°of
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

461 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

462 
	$wc°ﬁd
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

463 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

464 
__END_NAMESPACE_C99


468 
__BEGIN_NAMESPACE_STD


471 
	$wc°ﬁ
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

472 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

476 
	$wc°oul
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

477 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

478 
__THROW
;

479 
__END_NAMESPACE_STD


481 #ifde‡
__USE_ISOC99


482 
__BEGIN_NAMESPACE_C99


485 
__exãnsi⁄__


486 
	$wc°ﬁl
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

487 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

488 
__THROW
;

492 
__exãnsi⁄__


493 
	$wc°ouŒ
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

494 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

495 
__ba£
Ë
__THROW
;

496 
__END_NAMESPACE_C99


499 #ifde‡
__USE_GNU


502 
__exãnsi⁄__


503 
	$wc°oq
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

504 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

505 
__THROW
;

509 
__exãnsi⁄__


510 
	$wc°ouq
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

511 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

512 
__ba£
Ë
__THROW
;

515 #ifde‡
__USE_GNU


529 
	~<xloˇÀ.h
>

533 
	$wc°ﬁ_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

534 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

535 
__loˇÀ_t
 
__loc
Ë
__THROW
;

537 
	$wc°oul_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

538 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

539 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

541 
__exãnsi⁄__


542 
	$wc°ﬁl_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

543 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

544 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

546 
__exãnsi⁄__


547 
	$wc°ouŒ_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

548 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

549 
__ba£
, 
__loˇÀ_t
 
__loc
)

550 
__THROW
;

552 
	$wc°od_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

553 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

554 
__THROW
;

556 
	$wc°of_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

557 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

558 
__THROW
;

560 
	$wc°ﬁd_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

561 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

562 
__loˇÀ_t
 
__loc
Ë
__THROW
;

566 #ifde‡
__USE_XOPEN2K8


569 
wch¨_t
 *
	$w˝˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

570 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

574 
wch¨_t
 *
	$w˝n˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

575 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

576 
__THROW
;

583 
__FILE
 *
	$›í_wmem°ªam
 (
wch¨_t
 **
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
;

586 #i‡
deföed
 
__USE_ISOC95
 || deföed 
__USE_UNIX98


587 
__BEGIN_NAMESPACE_STD


590 
	$fwide
 (
__FILE
 *
__Â
, 
__mode
Ë
__THROW
;

597 
	`fw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

598 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

604 
	`w¥ötf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

607 
	$sw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

608 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

609 
__THROW
 ;

615 
	`vfw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__s
,

616 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

617 
__gnuc_va_li°
 
__¨g
)

623 
	`vw¥ötf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

624 
__gnuc_va_li°
 
__¨g
)

628 
	$vsw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

629 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

630 
__gnuc_va_li°
 
__¨g
)

631 
__THROW
 ;

638 
	`fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

639 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

645 
	`wsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

648 
	$swsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

649 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

650 
__THROW
 ;

652 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

653 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

654 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

655 #ifde‡
__REDIRECT


659 
	`__REDIRECT
 (
fwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__°ªam
,

660 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

661 
__isoc99_fwsˇnf
)

663 
	`__REDIRECT
 (
wsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

664 
__isoc99_wsˇnf
)

666 
	`__REDIRECT_NTH
 (
swsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

667 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

668 ...), 
__isoc99_swsˇnf
)

671 
	`__isoc99_fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

672 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

673 
	`__isoc99_wsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

674 
	$__isoc99_swsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

675 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

676 
__THROW
;

677 
	#fwsˇnf
 
__isoc99_fwsˇnf


	)

678 
	#wsˇnf
 
__isoc99_wsˇnf


	)

679 
	#swsˇnf
 
__isoc99_swsˇnf


	)

683 
__END_NAMESPACE_STD


686 #ifde‡
__USE_ISOC99


687 
__BEGIN_NAMESPACE_C99


692 
	`vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

693 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

694 
__gnuc_va_li°
 
__¨g
)

700 
	`vwsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

701 
__gnuc_va_li°
 
__¨g
)

704 
	$vswsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

705 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

706 
__gnuc_va_li°
 
__¨g
)

707 
__THROW
 ;

709 #i‡!
deföed
 
__USE_GNU
 \

710 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

711 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

712 #ifde‡
__REDIRECT


713 
	`__REDIRECT
 (
vfwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__s
,

714 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

715 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vfwsˇnf
)

717 
	`__REDIRECT
 (
vwsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

718 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vwsˇnf
)

720 
	`__REDIRECT_NTH
 (
vswsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

721 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

722 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vswsˇnf
)

725 
	`__isoc99_vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

726 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

727 
__gnuc_va_li°
 
__¨g
);

728 
	`__isoc99_vwsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

729 
__gnuc_va_li°
 
__¨g
);

730 
	$__isoc99_vswsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

731 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

732 
__gnuc_va_li°
 
__¨g
Ë
__THROW
;

733 
	#vfwsˇnf
 
__isoc99_vfwsˇnf


	)

734 
	#vwsˇnf
 
__isoc99_vwsˇnf


	)

735 
	#vswsˇnf
 
__isoc99_vswsˇnf


	)

739 
__END_NAMESPACE_C99


743 
__BEGIN_NAMESPACE_STD


748 
wöt_t
 
	`fgëwc
 (
__FILE
 *
__°ªam
);

749 
wöt_t
 
	`gëwc
 (
__FILE
 *
__°ªam
);

755 
wöt_t
 
	`gëwch¨
 ();

762 
wöt_t
 
	`Âutwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

763 
wöt_t
 
	`putwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

769 
wöt_t
 
	`putwch¨
 (
wch¨_t
 
__wc
);

777 
wch¨_t
 *
	`fgëws
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

778 
__FILE
 *
__ª°ri˘
 
__°ªam
);

784 
	`Âutws
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__ws
,

785 
__FILE
 *
__ª°ri˘
 
__°ªam
);

792 
wöt_t
 
	`ungëwc
 (wöt_à
__wc
, 
__FILE
 *
__°ªam
);

793 
__END_NAMESPACE_STD


796 #ifde‡
__USE_GNU


804 
wöt_t
 
	`gëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

805 
wöt_t
 
	`gëwch¨_u∆ocked
 ();

813 
wöt_t
 
	`fgëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

821 
wöt_t
 
	`Âutwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

830 
wöt_t
 
	`putwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

831 
wöt_t
 
	`putwch¨_u∆ocked
 (
wch¨_t
 
__wc
);

840 
wch¨_t
 *
	`fgëws_u∆ocked
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

841 
__FILE
 *
__ª°ri˘
 
__°ªam
);

849 
	`Âutws_u∆ocked
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__ws
,

850 
__FILE
 *
__ª°ri˘
 
__°ªam
);

854 
__BEGIN_NAMESPACE_C99


858 
size_t
 
	$wcs·ime
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

859 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

860 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

861 
__END_NAMESPACE_C99


863 #ifde‡
__USE_GNU


864 
	~<xloˇÀ.h
>

868 
size_t
 
	$wcs·ime_l
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

869 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

870 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

871 
__loˇÀ_t
 
__loc
Ë
__THROW
;

880 #i‡
deföed
 
__USE_UNIX98
 && !deföed 
__USE_GNU


881 
	#__√ed_iswxxx


	)

882 
	~<w˘y≥.h
>

886 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


887 
	~<bôs/wch¨2.h
>

890 #ifde‡
__LDBL_COMPAT


891 
	~<bôs/wch¨-ldbl.h
>

894 
__END_DECLS


902 #unde‡
__√ed_mb°©e_t


903 #unde‡
__√ed_wöt_t


	@/usr/include/wctype.h

23 #i‚de‡
_WCTYPE_H


25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 #i‚de‡
__√ed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__√ed_wöt_t


	)

33 
	~<wch¨.h
>

37 #i‚de‡
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #unde‡
__√ed_iswxxx


46 #i‚de‡
__iswxxx_deföed


47 
	#__iswxxx_deföed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	tw˘y≥_t
;

53 
	g__END_NAMESPACE_C99


55 #i‚de‡
_ISwbô


60 
	~<ídün.h
>

61 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


62 
	#_ISwbô
(
bô
Ë(1 << (bô))

	)

64 
	#_ISwbô
(
bô
) \

65 ((
bô
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
bô
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
bô
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (Ë((1UL << (
bô
)Ë>> 24))))

	)

73 
	m__ISwuµî
 = 0,

74 
	m__ISwlowî
 = 1,

75 
	m__ISwÆpha
 = 2,

76 
	m__ISwdigô
 = 3,

77 
	m__ISwxdigô
 = 4,

78 
	m__ISw•a˚
 = 5,

79 
	m__ISw¥öt
 = 6,

80 
	m__ISwgøph
 = 7,

81 
	m__ISwbœnk
 = 8,

82 
	m__ISw˙ål
 = 9,

83 
	m__ISwpun˘
 = 10,

84 
	m__ISwÆnum
 = 11,

86 
	m_ISwuµî
 = 
_ISwbô
 (
__ISwuµî
),

87 
	m_ISwlowî
 = 
_ISwbô
 (
__ISwlowî
),

88 
	m_ISwÆpha
 = 
_ISwbô
 (
__ISwÆpha
),

89 
	m_ISwdigô
 = 
_ISwbô
 (
__ISwdigô
),

90 
	m_ISwxdigô
 = 
_ISwbô
 (
__ISwxdigô
),

91 
	m_ISw•a˚
 = 
_ISwbô
 (
__ISw•a˚
),

92 
	m_ISw¥öt
 = 
_ISwbô
 (
__ISw¥öt
),

93 
	m_ISwgøph
 = 
_ISwbô
 (
__ISwgøph
),

94 
	m_ISwbœnk
 = 
_ISwbô
 (
__ISwbœnk
),

95 
	m_ISw˙ål
 = 
_ISwbô
 (
__ISw˙ål
),

96 
	m_ISwpun˘
 = 
_ISwbô
 (
__ISwpun˘
),

97 
	m_ISwÆnum
 = 
_ISwbô
 (
__ISwÆnum
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$iswÆnum
 (
wöt_t
 
__wc
Ë
__THROW
;

117 
	$iswÆpha
 (
wöt_t
 
__wc
Ë
__THROW
;

120 
	$isw˙ål
 (
wöt_t
 
__wc
Ë
__THROW
;

124 
	$iswdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

128 
	$iswgøph
 (
wöt_t
 
__wc
Ë
__THROW
;

133 
	$iswlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

136 
	$isw¥öt
 (
wöt_t
 
__wc
Ë
__THROW
;

141 
	$iswpun˘
 (
wöt_t
 
__wc
Ë
__THROW
;

146 
	$isw•a˚
 (
wöt_t
 
__wc
Ë
__THROW
;

151 
	$iswuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

156 
	$iswxdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

161 #ifde‡
__USE_ISOC99


162 
	$iswbœnk
 (
wöt_t
 
__wc
Ë
__THROW
;

171 
w˘y≥_t
 
	$w˘y≥
 (c⁄° *
__¥›îty
Ë
__THROW
;

175 
	$isw˘y≥
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
Ë
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 c⁄° 
	t__öt32_t
 *
	tw˘øns_t
;

187 
__END_NAMESPACE_C99


188 #ifde‡
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
w˘øns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wöt_t
 
	$towlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

197 
wöt_t
 
	$towuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifde‡
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
w˘øns_t
 
	$w˘øns
 (c⁄° *
__¥›îty
Ë
__THROW
;

221 
wöt_t
 
	$tow˘øns
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
Ë
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifde‡
__USE_XOPEN2K8


226 
	~<xloˇÀ.h
>

230 
	$iswÆnum_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

236 
	$iswÆpha_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

239 
	$isw˙ål_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

243 
	$iswdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

247 
	$iswgøph_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

252 
	$iswlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

255 
	$isw¥öt_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

260 
	$iswpun˘_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

265 
	$isw•a˚_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

270 
	$iswuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

275 
	$iswxdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

280 
	$iswbœnk_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

284 
w˘y≥_t
 
	$w˘y≥_l
 (c⁄° *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

285 
__THROW
;

289 
	$isw˘y≥_l
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
, 
__loˇÀ_t
 
__loˇÀ
)

290 
__THROW
;

298 
wöt_t
 
	$towlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

301 
wöt_t
 
	$towuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

305 
w˘øns_t
 
	$w˘øns_l
 (c⁄° *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

306 
__THROW
;

309 
wöt_t
 
	$tow˘øns_l
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
,

310 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

314 
__END_DECLS


	@
1
.
1
/usr/include
31
552
buf.cc
buf.h
buf0buddy.cc
buf0buf.cc
buf0dblwr.cc
buf0dblwr_back.cc
buf0dump.cc
buf0flu.cc
buf0lru.cc
buf0rea.cc
calclock.h
checksum.cc
/usr/include/errno.h
/usr/include/math.h
/usr/include/stdio.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/zlib.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/xlocale.h
/usr/include/zconf.h
/usr/include/_G_config.h
/usr/include/ctype.h
/usr/include/limits.h
/usr/include/stdc-predef.h
/usr/include/endian.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
